/*!
 * rcfm 0.3.0-beta.1 | Model iife | https://jilinxiangyun.com
 * Copyright 2021 JLxiangyun | MIT license
 */
var ReactiveForm=(()=>{var ct=Object.defineProperty,yi=Object.defineProperties;var Ei=Object.getOwnPropertyDescriptors;var Jt=Object.getOwnPropertySymbols;var gi=Object.prototype.hasOwnProperty,xi=Object.prototype.propertyIsEnumerable;var ft=(e,t,r)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,p=(e,t)=>{for(var r in t||(t={}))gi.call(t,r)&&ft(e,r,t[r]);if(Jt)for(var r of Jt(t))xi.call(t,r)&&ft(e,r,t[r]);return e},I=(e,t)=>yi(e,Ei(t)),Ai=e=>ct(e,"__esModule",{value:!0});var Ii=(e,t)=>{Ai(e);for(var r in t)ct(e,r,{get:t[r],enumerable:!0})};var v=(e,t,r)=>(ft(e,typeof t!="symbol"?t+"":t,r),r);var lo={};Ii(lo,{Calculator:()=>F,Context:()=>C,Exception:()=>D,Form:()=>k,I18n:()=>U,Reactive:()=>A,Schema:()=>lt,Struct:()=>Me,Type:()=>N,Validator:()=>x,guid:()=>P});var Ne=class extends Error{constructor(t={}){typeof t=="string"&&(t={type:t});let{type:r,message:i,data:o}=t;super(i);if(this.type=this.name=r,this.data=o||{},typeof this.data!="object"||Array.isArray(this.data))throw new Error("Exception data must be included in an object.")}static create(...t){return new Ne(...t)}static raise(...t){throw new Ne(...t)}static isException(t){return t instanceof Ne}static isntException(t){return!Ne.isException(t)}static mustbeException(t,r=""){Ne.isntException(t)&&Ne.raise({type:Ne.exceptions.INVALID_INSTANCE,message:r||"Invalid exception instance."})}},D=Ne;v(D,"exceptions",{INVALID_INSTANCE:"EXCEPTION_INVALID_INSTANCE"});var g=D.raise;var vi=0;function P(){return`${Date.now()}${vi+=1}`}var N={ANY_TYPE:"*",SPECIFIC_TYPES:["String","Number","Boolean","Array","Object","RegExp","Function","Null","Undefined","Map","WeakMap","Symbol","File","Blob","Promise"],exceptions:{INVALID_DATA_TYPE:"TYPE_INVALID_DATA_TYPE"},get(e){let t=/\[object\s+(.*)\]/;return Object.prototype.toString.call(e).match(t)[1]},within(e={}){let{type:t,types:r}=e;return!Array.isArray(t)&&(t=[t]),!Array.isArray(r)&&(r=[r]),t.includes(N.ANY_TYPE)||r.includes(N.ANY_TYPE)?!0:!t.some(i=>!r.includes(i))},mustWithin(e={},t=""){!N.within(e)&&g({type:N.exceptions.INVALID_DATA_TYPE,message:t||`Data type ${e.type} isn't within ${e.types}`})}},m=N.is={null(e){return N.get(e)==="Null"},undefined(e){return N.get(e)==="Undefined"},number(e){return N.get(e)==="Number"},integer(e){return Number.isInteger(e)},string(e){return N.get(e)==="String"},boolean(e){return N.get(e)==="Boolean"},array(e){return Array.isArray(e)},object(e){return N.get(e)==="Object"},regexp(e){return N.get(e)==="RegExp"},function(e){return N.get(e)==="Function"},positiveInteger(e){return m.integer(e)&&e>0},negativeInteger(e){return m.integer(e)&&e<0},blankArray(e){return m.array(e)&&e.length===0},blankString(e){return m.string(e)&&!!e.match(/^\s*$/)},blankObject(e){return m.object(e)&&Object.keys(e).length===0},nonblankArray(e){return m.array(e)&&e.length>0},nonblankString(e){return m.string(e)&&!!e.match(/\S/)},nonblankObject(e){return m.object(e)&&Object.keys(e).length>0},typeString(e){return e===N.ANY_TYPE?!0:N.SPECIFIC_TYPES.includes(e)},typeArray(e){return m.nonblankArray(e)?e.every(t=>t===N.ANY_TYPE?!0:N.within({type:t,types:N.SPECIFIC_TYPES})):!1},type(e){return m.typeString(e)||m.typeArray(e)},blank(e){return!!([null,void 0,NaN].includes(e)||m.blankString(e)||m.blankArray(e)||m.blankObject(e))}},h=N.isnt=(()=>{let e={};return Object.keys(m).forEach(t=>{e[t]=function(r){return!m[t](r)}}),e})(),b=N.mustbe=(()=>{let e={};return Object.keys(h).forEach(t=>{e[t]=function(r,i="The argument"){let o=m.object(i)?i.message:"";h[t](r)&&g({type:N.exceptions.INVALID_DATA_TYPE,message:o||`${i} must be '${t.toUpperCase()}'`})}}),e})(),mt=N.musntbe=(()=>{let e={};return Object.keys(m).forEach(t=>{e[t]=function(r,i="The argument"){let o=m.object(i)?i.message:"";m[t](r)&&g({type:N.exceptions.INVALID_DATA_TYPE,message:o||`${i} must not be '${t.toUpperCase()}'`})}}),e})();var Me={},ee=Me.array={unique(e=[]){return e.filter((t,r)=>e.indexOf(t)===r)}},G=Me.object={from(e=[]){b.array(e);let t={};return e.forEach(r=>t[r[0]]=r[1]),t},collect(e={},t=[]){b.object(e),b.array(t);let r={};return Object.keys(e).forEach(i=>{t.includes(i)&&(r[i]=e[i])}),r},exclude(e={},t=[]){b.object(e),b.array(t);let r={};return Object.keys(e).forEach(i=>{!t.includes(i)&&(r[i]=e[i])}),r}},fo=Me.string={capitalize(e=""){return e.replace(/\b\w/g,t=>t.toUpperCase())},dashCase(e=""){let t=/[A-Z]/g,r=i=>`-${i.toLowerCase()}`;return e[0].toLowerCase()+e.slice(1).replace(t,r)}};var Qt={name:"add",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t+r)}};var er={name:"devide",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t/r)}};var tr={name:"map",argumentSize:1,argumentType:"*",calculate(e){return e}};var rr={name:"minus",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t-r)}};var ir={name:"multiple",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t*r)}};var or=[Qt,rr,ir,er,tr];function fe(e={},t={}){return e._calculator||(e._calculator=p({},t))}var dt=class{constructor(){fe(this,{installed:{}}),or.forEach(t=>this.install(t))}static create(...t){return new dt(...t)}},F=dt;v(F,"exceptions",{CONFLICTED_NAME:"CALCULATOR_CONFLICTED_NAME",UNSUPPORTED_CALCULATION:"CALCULATOR_UNSUPPORTED_CALCULATION",INVALID_ARGUMENT_SIZE:"CALCULATOR_INVALID_ARGUMENT_SIZE",INVALID_ARGUMENT_TYPE:"CALCULATOR_INVALID_ARGUMENT_TYPE"});function je(e={}){let t=Object.keys(e)[0],r=e[t];return h.array(r)&&(r=[r]),{name:t,args:r}}function ht(e,t){return e.length>=t.min}function bt(e=[],t){return!e.some((r,i)=>{let o=t;return h.type(o)&&(o=o[i]||o[o.length-1]),!N.within({type:N.get(r),types:o})})}F.prototype.mustbeSupported=function(e={},t={}){b.object(e,"Calculation struct");let r="strict"in t?t.strict:!1,{name:i,args:o}=je(e),{installed:l}=fe(this);!l[i]&&g({type:F.exceptions.UNSUPPORTED_CALCULATION,message:`Unsupported calculator "${i}".`}),!!r&&o.forEach(a=>m.object(a)&&this.mustbeSupported(a,t))};F.prototype.isSupported=function(e={},t={}){try{this.mustbeSupported(e,t)}catch(r){return!1}return!0};F.prototype.isntSupported=function(e={},t={}){return!this.isSupported(e,t)};F.prototype.calculate=function(e={}){if(this.isntSupported(e))return null;let{installed:t}=fe(this),{name:r,args:i}=je(e),{argumentType:o,argumentSize:l,calculate:a}=t[r];return!ht(i,l)||(i=i.slice(0,l.max).map(n=>this.isSupported(n)?this.calculate(n):n),!bt(i,o))?null:a(...i)};function yt(e){return e===1/0?!1:m.positiveInteger(e)?!0:!m.nonblankArray(e)||e.length!==2||!m.positiveInteger(e[0])?!1:e[1]===1/0?!0:e[1]>e[0]}function Et(e){return m.type(e)?!0:h.nonblankArray(e)?!1:e.every(t=>m.typeArray(t))}function gt(e){return{min:m.integer(e)?e:e[0],max:m.integer(e)?e:e[1]}}F.prototype.install=function(e={}){b.object(e,"Calculator installer");let{name:t,argumentSize:r,argumentType:i,calculate:o}=e;b.nonblankString(t,'Calculator installer "name"'),b.function(o,'Calculator installer "calculate"'),!yt(r)&&g({type:F.exceptions.INVALID_ARGUMENT_SIZE,message:'Invalid calculator installer "argumentSize".'}),!Et(i)&&g({type:F.exceptions.INVALID_ARGUMENT_TYPE,message:'Invalid calculator installer "argumentType".'});let{installed:l}=fe(this);t in l&&g({type:F.exceptions.CONFLICTED_NAME,message:`Conflicted calculator name "${t}".`}),l[t]=I(p({},e),{name:t,argumentType:i,calculate:o,argumentSize:gt(r)})};F.prototype.uninstall=function(e=""){let{installed:t}=fe(this);e in t&&delete t[e]};function w(e={},t={}){return e._family||(e._family=p({},t))}var ke=class{constructor(){let t=P();w(this,{rootId:t,members:{[t]:{id:t,parentId:null,order:0}}})}static create(...t){return new ke(...t)}static isFamily(t){return t instanceof ke}static isntFamily(t){return!ke.isFamily(t)}static mustbeFamily(t,r=""){ke.isntFamily(t)&&g({type:ke.exceptions.INVALID_INSTANCE,message:r||"Invalid family instance."})}},R=ke;v(R,"exceptions",{MEMBER_NOT_EXIST:"FAMILY_MEMBER_NOT_EXIST",CONFLICTED_PARENT:"FAMILY_MEMBER_CONFLICTED_PARENT",SELF_REFERENCE:"FAMILY_MEMBER_SELF_REFERENCE",INVALID_INSTANCE:"FAMILY_INVALID_INSTANCE"});function lr(e={},t=[]){t=t.sort((i,o)=>"order"in i?"order"in o?i.order-o.order:-1:1);let r=t.find(i=>"expectedOrder"in i);if(r){let[i,o]=[t.indexOf(r),r.expectedOrder];t.splice(i,1),o<0?t.unshift(r):o>t.length-1?t.push(r):t.splice(o,0,r)}return t.forEach((i,o)=>{delete e[i.id].expectedOrder,e[i.id].order=o}),t}R.prototype.descendant=function(e={},t={}){let{rootId:r,members:i}=w(this),o=e.id||r,l="deep"in t?t.deep:!1,a="self"in t?t.self:!1,n="sort"in t?t.sort:!0;if(!i[o])return null;let[s,u]=[[p({},i[o])],-1];for(;++u<s.length;){let[d,c]=[s[u],[]];if(Object.values(i).forEach(E=>{E.id!==r&&E.parentId===d.id&&c.push(p({},E))}),c.length&&(n&&(c=lr(i,c)),s=s.concat(c)),!l)break}return a||s.shift(),s.length?s:null};R.prototype.add=function(e={}){let{rootId:t,members:r}=w(this),i=e.id||P(),o=(e.parent?e.parent.id:e.parentId)||t,l=e.order||1/0;if(b.nonblankString(i,'Family member "id"'),b.nonblankString(o,'Family member "parentId"'),b.number(l,'Family member "order"'),i===o&&g({type:R.exceptions.SELF_REFERENCE,message:"Any family member's parent cannot be itself."}),!r[o]&&g({type:R.exceptions.MEMBER_NOT_EXIST,message:`Family member ${o} is not existed.`}),r[i]){if(r[i].parentId===o)return p({},r[i]);g({type:R.exceptions.CONFLICTED_PARENT,message:"Any family member's parent cannot be changed."})}return r[i]={id:i,parentId:o,expectedOrder:l,touchedAt:P()},this.descendant({id:o},{sort:!0}),p({},r[i])};R.prototype.ancestor=function(e={},t={}){let{id:r}=e,{members:i}=w(this),o="deep"in t?t.deep:!1,l="self"in t?t.self:!1;if(!i[r])return null;let[a,n]=[[p({},i[r])],-1];for(;++n<a.length;){let s=i[a[n].parentId];if(s&&a.push(p({},s)),!o)break}return o?(l||a.shift(),a.length?a:null):(a.shift(),a[0]?a[0]:null)};R.prototype.delete=function(e={}){let{members:t,rootId:r}=w(this);if(e.id===r)return;let i=t[e.id];if(!i)return;let{parentId:o}=i;this.descendant({id:e.id},{self:!0,deep:!0,sort:!1}).forEach(({id:l})=>delete t[l]),this.descendant({id:o},{sort:!0})};R.prototype.has=function(e={}){let{members:t}=w(this);return e.id in t};R.prototype.hasnt=function(e={}){return!this.has(e)};R.prototype.reorder=function(e={}){let{id:t,order:r}=e,{rootId:i,members:o}=w(this);b.number(r,'Family member "order"'),!(!o[t]||t===i)&&r!==o[t].order&&(o[t].expectedOrder=r,o[t].touchedAt=P(),this.descendant({id:o[t].parentId},{sort:!0}))};R.prototype.root=function(){let{rootId:e,members:t}=w(this);return p({},t[e])};R.prototype.sibling=function(e={},t={}){let{id:r}=e,{members:i,rootId:o}=w(this),l="self"in t?t.self:!1;if(!i[r])return null;if(r===o)return l?[this.root()]:null;let a=this.ancestor({id:r});if(!a)return null;let n=this.descendant(a);return l?n:(n=n.filter(s=>s.id!==r),n.length?n:null)};function B(e={},t={}){return e._dependency||(e._dependency=p({},t))}var Ce=class{constructor(){B(this,{associations:{},group:{reliers:{}},cache:{reliers:{}}})}static create(...t){return new Ce(...t)}static isDependency(t){return t instanceof Ce}static isntDependency(t){return!Ce.isDependency(t)}static mustbeDependency(t,r=""){Ce.isntDependency(t)&&g({type:Ce.exceptions.INVALID_INSTANCE,message:r||"Invalid dependency instance."})}},oe=Ce;v(oe,"exceptions",{CIRCLE_REFERENCE:"DEPENDENCY_CIRCLE_REFERENCE",INVALID_INSTANCE:"DEPENDENCY_INVALID_INSTANCE"});var ar="#",Qe="_";function ae(e={}){let{id:t,prop:r}=e;return t?`${t}${ar}${r||""}`:Qe}function me(e=""){if(e===Qe)return{id:"",prop:""};let[t,r]=e.split(ar);return{id:t,prop:r}}function _e(e={},t){if(!t)return Object.keys(e).forEach(l=>delete e[l]);let{id:r,prop:i}=t;if(!r)return delete e[Qe];let o=ae({id:r,prop:i});i?(delete e[o],delete e[ae({id:r})],Object.keys(e).forEach(l=>{e[l].includes(o)&&delete e[l]})):Object.keys(e).forEach(l=>{(me(l).id===r||e[l].includes(o))&&delete e[l]})}var Fe="__GLOBAL__";oe.prototype.add=function(e=[],t={}){let r="group"in t?t.group:Fe;b.nonblankString(r,'Association "group"'),h.array(e)&&(e=[e]),e=e.map(({provider:l,relier:a})=>{b.nonblankString(a.id,'Association "relier.id"'),b.nonblankString(l.id,'Association "provider.id"'),b.nonblankString(a.prop,'Association "relier.prop"'),b.nonblankString(l.prop,'Association "provider.prop"');let n={provider:ae(l),relier:ae(a)};return{provider:l,relier:a,path:n}});let{error:i,rollbackQueue:o}=Ni(this,e);if(!i)return Ti(this,e,r);throw _i(this,o),i};function Ni(e,t){let r=[],{associations:i}=B(e),o=B(e).cache.reliers;return t.some(({provider:a,relier:n,path:s})=>{if(s.provider===s.relier)return!0;let u=e.reliers(n,{split:!1});return u&&u.includes(s.provider)?!0:(i[s.provider]||(i[s.provider]=[]),i[s.provider].includes(s.relier)||(i[s.provider].push(s.relier),r.push({provider:a,relier:n,path:s}),_e(o,a)),!1)})?{rollbackQueue:r,error:D.create({type:oe.exceptions.CIRCLE_REFERENCE})}:{error:null,rollbackQueue:null}}function _i(e,t){let{associations:r}=B(e),i=B(e).cache.reliers;t.forEach(({provider:o,path:l})=>{let a=r[l.provider].indexOf(l.relier);a<0||(r[l.provider].splice(a,1),!r[l.provider].length&&delete r[l.provider],_e(i,o))})}function Ti(e,t,r){let i=B(e).group.reliers;t.forEach(({path:o})=>{let l=i[o.provider]||(i[o.provider]={}),a=l[o.relier]||(l[o.relier]=[]);!a.includes(r)&&a.push(r)})}oe.prototype.delete=function(e={},t={}){let{id:r,prop:i}=e;if(!r)return;let{only:o,group:l}=t,a=ae(e),{associations:n}=B(this),s=B(this).cache.reliers,u=B(this).group.reliers,d=i?c=>c===a:c=>me(c).id===r;o!=="relier"&&(_e(s,e),i?(delete n[a],delete u[a]):Object.keys(n).map(c=>{!d(c)||(delete n[c],delete u[c])})),Object.keys(n).forEach(c=>{let E=n[c].length;n[c]=n[c].filter(T=>{if(!d(T))return!0;if(o!=="relier"||!l||l===Fe)return delete u[c][T],!1;let O=u[c][T].findIndex(V=>V===l);return O>=0&&u[c][T].splice(O,1),u[c][T].length?!0:(delete u[c][T],!1)});let S=n[c].length;S!==E&&(_e(s,me(c)),!S&&delete n[c],!Object.keys(u[c]).length&&delete u[c])})};oe.prototype.reliers=function(e=[],t={}){h.array(e)&&(e=[e]);let r=e.some(L=>h.object(L)||!L.id);r&&(e=[{}]);let i="reload"in t?t.reload:!1,o="split"in t?t.split:!0,l="deep"in t?t.deep:!0,a="self"in t?t.self:!0,n="group"in t?t.group:"",{associations:s}=B(this),u=B(this).cache.reliers,d=B(this).group.reliers,[c,E,S]=[[],[],[]];if(e.forEach(L=>{let Q=ae(L);if("prop"in L?S.push(Q):Object.keys(s).forEach(q=>{me(q).id===L.id&&S.push(q)}),E.push(L.id),!Si(s,L))return _e(u,L);(i||!(Q in u))&&(u[Q]=Oi(s,L),u[Q]=nr(s,u[Q])),c=c.concat(u[Q])}),!c.length)return null;if(e.length>1&&(c=nr(s,ee.unique(c))),r||l&&a&&(!n||n===Fe))return o?c.map(L=>me(L)):c;let[T,O]=[[],S.slice()],V=S.map(L=>s[L]).flat();return c.forEach(L=>{if(!l&&!V.includes(L))return;let Q=me(L);if(!(!a&&E.includes(Q.id))){if(n&&n!==Fe){let q=Object.keys(d).some(Re=>!O.includes(Re)||!Object.keys(d[Re]).includes(L)?!1:d[Re][L].includes(n));if(O.push(L),!q)return}T.push(o?Q:L)}}),T.length?T:null};function Si(e={},t={}){let{id:r,prop:i}=t;return r?i?ae(t)in e:Object.keys(e).filter(o=>me(o).id===r).length>0:Object.keys(e).length>0}function Oi(e={},t={}){let{id:r,prop:i}=t,o=(()=>r?i?(e[ae(t)]||[]).slice():ee.unique(Object.keys(e).filter(a=>me(a).id===r).map(a=>e[a]).flat()):ee.unique(Object.values(e).flat()))(),l=-1;for(;++l<o.length;)(e[o[l]]||[]).forEach(n=>!o.includes(n)&&o.push(n));return o}function nr(e={},t=[]){let r=-1;for(;++r<t.length;)(e[t[r]]||[]).forEach(o=>{let l=t.indexOf(o);l>r||(t.splice(l,1),t.push(o),r--)});return t}function de(e={},t={}){return e._dispatcher||(e._dispatcher=p({},t))}var z=class{constructor(t={}){"target"in t&&b.function(t.target,"options.target"),de(this,{isAborted:!1,listeners:{},target:t.target||function(r){return r}})}static create(...t){return new z(...t)}};z.prototype.abort=function(e=!0){de(this).isAborted=e===!0};function Be(e={},t,r){t in e&&(r?r=m.array(r)?r:[r]:r=Object.keys(e[t]),r.forEach(i=>{i in e[t]&&!e[t][i].length&&delete e[t][i]}),!Object.keys(e[t]).length&&delete e[t])}z.prototype.add=function(e={},t){let{id:r,event:i}=e,{listeners:o}=de(this);b.nonblankString(r,'Dispatcher "id"'),b.nonblankString(i,'Dispatcher "event"'),b.function(t,'Dispatcher "handler"'),o[r]||(o[r]={});let l=o[r][i]||(o[r][i]=[]),a=l.push({callback:t})-1;return function(){l.splice(a,1),Be(o,r,i)}};z.prototype.delete=function(e={},t){let{id:r,event:i}=e,{listeners:o}=de(this);if(!!o[r]){if(!i){r in o&&delete o[r];return}if(!!o[r][i]){if(!t){i in o[r]&&delete o[r][i];return}o[r][i]=o[r][i].filter(l=>l.callback!==t),Be(o,r,i)}}};z.prototype.trigger=function(e={},t){t&&b.function(t,'Dispatcher "handler"');let{id:r,event:i,detail:o}=e,{listeners:l,target:a,isAborted:n}=de(this);if(n||!l[r]||!l[r][i])return!1;let s=!1,u={type:i,target:a(r),detail:o};return t?t(u,o)===!1:(l[r][i].forEach(({callback:d})=>{let c=d(u,o)===!1;s||(s=c)}),!s)};function De(e={},t={}){return e._executor||(e._executor=p({},t))}var he=class{constructor(t={}){b.function(t.runner,"options.runner"),De(this,{isAborted:!1,queues:{current:[],next:[]},runner:t.runner||function(r){return r}})}static create(...t){return new he(...t)}};he.prototype.abort=function(e=!0){De(this).isAborted=e===!0};he.prototype.run=function(e){let{queues:t,runner:r,isAborted:i}=De(this);if(arguments.length&&(h.array(e)&&(e=[e]),t.next=t.next.concat(e)),!i&&!t.current.length&&!!t.next.length){t.current=t.next,t.next=[];try{r(t.current.slice())}catch(o){t.current=[],g({type:o.type||o.name,message:o.message})}t.current=[],this.run()}};function be(e={},t={}){return e._hook||(e._hook=p({},t))}var W=class{constructor(){be(this,{isAborted:!1,hooks:{}})}static create(...t){return new W(...t)}};W.prototype.abort=function(e=!0){be(this).isAborted=e===!0};W.prototype.add=function(e="",t){b.nonblankString(e,'Hook "type"'),b.function(t,'Hook "handler"');let{hooks:r}=be(this);return r[e]||(r[e]=[]),r[e].push(t),function(){let i=r[e].indexOf(t);i>=0&&r[e].splice(i,1)}};W.prototype.delete=function(e="",t){let{hooks:r}=be(this);!r[e]||(t?r[e]=r[e].filter(i=>i!==t):r[e]=[])};W.prototype.run=function(e="",t={}){let{hooks:r,isAborted:i}=be(this);if(i)return!1;if(!r[e])return!0;let[o,l]=[t.arguments,!1];return h.array(o)&&(o=[o]),r[e].forEach(a=>{let n=a(...o);l||(l=n===!1)}),i?!1:!l};function xt(e={},t={}){let{members:r,family:i,dependency:o,hooks:l}=t,a="id"in e?e.id:e.id=P(),n=i.root().id,s=a===n;if(s&&r[a])return{};let u=s?null:(()=>"parentId"in e?e.parentId:e.parentId=n)();if(!s&&i.has({id:a}))return{};if(!s&&i.hasnt({id:u}))return{};let d="props"in e?e.props:e.props={};"children"in d||(d.children=[]),"order"in d||(d.order=1/0);let c={mutations:{set:[]},mutated:[]};return l.run("before-add",{arguments:[e,"before-add"]})?(!s&&i.add({id:a,parentId:u}),r[a]={},c.mutated=[{id:a}],Object.keys(e.props).forEach(E=>{c.mutations.set.push({id:a,prop:E,value:d[E]})}),!s&&o.add({provider:{id:a,prop:"order"},relier:{id:u,prop:"children"}}),l.run("after-add",{arguments:[e,c,"after-add"]}),c):{}}var et="__raw__prop__",tt="__raw__error__",rt="__prop__",it="__error__";function ye(e,t={}){return(t.raw?et:rt)+e}function Ee(e,t={}){return(t.raw?tt:it)+e}function At(e={},t={}){let{members:r,family:i,hooks:o}=t,{id:l,prop:a}=e;if(i.hasnt({id:l}))return{};let n={mutated:[]},s={raw:ye(a,{raw:!0}),calc:ye(a)},u={raw:Ee(a,{raw:!0}),calc:Ee(a)};if(!o.run("before-calc",{arguments:[e,"before-calc"]}))return{};if(a==="children"){let d=i.descendant({id:l})||[];return r[l][s.calc]=d.map(({id:c})=>({id:c})),r[l][u.calc]=r[l][u.raw],n.mutated.push({id:l}),o.run("after-calc",{arguments:[e,n,"after-calc"]}),n}return r[l][s.calc]=r[l][s.raw],r[l][u.calc]=r[l][u.raw],n.mutated.push({id:l}),o.run("after-calc",{arguments:[e,n,"after-calc"]}),n}function It(e={},t={}){let{id:r}=e,{members:i,family:o,dependency:l,hooks:a}=t;if(o.hasnt({id:r}))return{};if(r===o.root().id)return{};if(!a.run("before-del",{arguments:[e,"before-del"]}))return{};let n={mutations:{set:[],calc:[]},mutated:[]},s=o.ancestor({id:r}),u=o.descendant({id:r},{deep:!0,self:!0}),d=l.reliers(u,{self:!1});return u.forEach(({id:c})=>{delete i[c],o.delete({id:c}),l.delete({id:c}),n.mutated.push({id:c})}),d&&(n.mutations.calc=d),s&&(o.descendant({id:s.id})||[]).forEach((c,E)=>{n.mutations.set.push({id:c.id,prop:"order",value:E})}),a.run("after-del",{arguments:[e,n,"after-del"]}),n}function vt(e={},t={}){let{members:r,family:i,dependency:o,hooks:l}=t,{id:a,prop:n,value:s}=e;if(i.hasnt({id:a}))return{};let u={raw:ye(n,{raw:!0})},d={raw:Ee(n,{raw:!0})};if(Object.is(r[a][u.raw],s))return{};let c={mutations:{calc:[]},mutated:[]};if(n==="order"){let S=i.ancestor({id:a});return S?l.run("before-set",{arguments:[e,"before-set"]})?(i.reorder({id:a,order:e.value}),i.descendant(S).forEach(({id:T,order:O})=>{r[T][u.raw]=O,r[T][d.raw]=null,c.mutated.push({id:T}),c.mutations.calc.push({id:T,prop:n});let V=o.reliers({id:T,prop:n})||[];c.mutations.calc=c.mutations.calc.concat(V)}),l.run("after-set",{arguments:[e,c,"after-set"]}),c):{}:{}}if(!l.run("before-set",{arguments:[e,"before-set"]}))return{};r[a][u.raw]=e.value,r[a][d.raw]=null,c.mutated=[{id:a}];let E=o.reliers({id:a,prop:n})||[];return c.mutations.calc=[{id:a,prop:n}].concat(E),l.run("after-set",{arguments:[e,c,"after-set"]}),c}function Li(e=[],t=[]){let[r,i]=[{},{}];return t.forEach(o=>{i[o]=[],r[o]=[]}),e.forEach(o=>{let{id:l,action:a}=o;!t.includes(a)||(i[a].push(l),r[a].push(o))}),{jobs:r,ids:i}}function He(e={},t,r=[]){t||(t={}),t.mutated&&(e.mutated=e.mutated.concat(t.mutated)),r.forEach(i=>{e.mutations[i]||(e.mutations[i]=[]),t.mutations&&t.mutations[i]&&(e.mutations[i]=e.mutations[i].concat(t.mutations[i]))})}function sr(e=[]){return e.filter((t,r,i)=>i.findIndex(l=>l.id===t.id&&l.prop===t.prop)===r)}function Nt(e=[],t={}){let{dispatcher:r,family:i}=t,o=["del","add","set","calc"],{jobs:l,ids:a}=Li(e,o),n={mutated:[],mutations:{}};He(n,{},o),l.del.forEach(s=>{He(n,It(s,t),["add","set","calc"])}),l.add=n.mutations.add.concat(l.add),l.add.forEach(s=>{let{id:u,parentId:d}=s;a.del.includes(u)||a.del.includes(d)||He(n,xt(s,t),["set","calc"])}),l.set=n.mutations.set.concat(l.set),l.set=sr(l.set.reverse()).reverse(),l.set.forEach(s=>{a.del.includes(s.id)||He(n,vt(s,t),["calc"])}),l.calc=n.mutations.calc.concat(l.calc),l.calc=sr(l.calc.reverse()).reverse(),l.calc.forEach(s=>{a.del.includes(s.id)||He(n,At(s,t),[])}),ee.unique(n.mutated.map(s=>s.id)).forEach(s=>{r.trigger({id:s,event:"after-mutation"}),i.hasnt({id:s})&&r.delete({id:s})})}var Pe=class{constructor(){this.members={},this.family=R.create(),this.dependency=oe.create(),this.dispatcher=z.create(),this.hooks=W.create(),this.executor=he.create({runner:t=>Nt(t,this)}),this.executor.run({action:"add",id:this.family.root().id})}static create(...t){return new Pe(...t)}static isContext(t){return t instanceof Pe}static isntContext(t){return!Pe.isContext(t)}static mustbeContext(t,r=""){Pe.isntContext(t)&&g({type:Pe.exceptions.INVALID_INSTANCE,message:r||"Invalid context instance."})}},C=Pe;v(C,"Family",R),v(C,"Dependency",oe),v(C,"Executor",he),v(C,"Dispatcher",z),v(C,"Hook",W),v(C,"exceptions",{INVALID_INSTANCE:"INVALID_CONTEXT_INSTANCE"});C.prototype.add=function(e){let t=h.array(e);t&&(e=[e||{}]);let r=e.map(i=>I(p({},i),{id:P(),action:"add"}));return this.executor.run(r),t?r[0].id:r.map(i=>i.id)};C.prototype.delete=function(e){if(!e){this.executor.abort(),this.dispatcher.abort(),this.hooks.abort();for(let r in this)delete this[r];return}h.array(e)&&(e=[e]);let t=e.map(r=>I(p({},r),{action:"del"}));this.executor.run(t)};C.prototype.find=function(e){return h.function(e)?null:Object.keys(this.members).find(t=>e({id:t}))};C.prototype.get=function(e={},t={}){let{members:r}=this,i="include"in t?t.include:[],o=i.includes("error"),l=i.includes("raw");return"prop"in e?Ri(r,e,o,l):ki(r,e,o,l)};function Ri(e,t,r,i){let{id:o,prop:l}=t;if(!e[o])return null;let[a,n,s,u]=[null,null,null,null],d=ye(l);if(a=d in e[o]?e[o][d]:null,r){let c=Ee(l);n=e[o][c]||null}if(i){let c=ye(l,{raw:!0});if(s=c in e[o]?e[o][c]:null,r){let E=Ee(l,{raw:!0});u=e[o][E]||null}}return!r&&!i?a:r&&!i?{value:a,error:n}:r?{value:a,error:n,raw:{value:s,error:u}}:{value:a,raw:{value:s}}}function ki(e,t,r,i){let{id:o}=t,[l,a,n,s]=[{},null,{},null];return e[o]?(Object.keys(e[o]).forEach(u=>{let d=e[o][u];if(u.startsWith(rt))return l[u.replace(rt,"")]=d;if(d&&r&&u.startsWith(it))return a||(a={}),a[u.replace(it,"")]=d;if(i&&u.startsWith(et))return n[u.replace(et,"")]=d;if(d&&i&&r&&u.startsWith(tt))return s||(s={}),s[u.replace(tt,"")]=d}),!i&&!r?l:r&&!i?{values:l,errors:a}:r?{values:l,errors:a,raw:{values:n,errors:s}}:{values:l,raw:{values:n}}):null}C.prototype.naming=function(e=""){return{prop:ye(e),error:Ee(e),raw:{prop:ye(e,{raw:!0}),error:Ee(e,{raw:!0})}}};C.prototype.set=function(e){if(!e)return;h.array(e)&&(e=[e]);let t=e.map(r=>I(p({},r),{action:"set"}));this.executor.run(t)};C.prototype.subscribe=function(e={},t){let r={id:e.id,event:"after-mutation"},i="immediately"in e?e.immediately:!0,o=this.dispatcher.add(r,t);return i&&this.dispatcher.trigger(r,t),o};var Te={type:"Fieldset"};function Ke(e,t={}){let r=e._storeOfSchema||(e._storeOfSchema={});return t===void 0?e._storeOfSchema:(Object.assign(r,G.collect(t,["parseExpression","parseReference"])),r)}var Le="when",Ae="then",Ie="else",ne="and",se="or",le="not",Ue="_";function Se(e){return h.object(e)?!1:Le in e&&Ae in e}function Oe(e){return h.object(e)?!1:Ie in e}function pe(e){return Se(e)||Oe(e)}function ot(e){return h.array(e)||!e.length?!1:!e.some(t=>!pe(t))}var Ye=class{static isConditionObject(t){return pe(t)}static isConditionArray(t){return ot(t)}static isCondition(t){return pe(t)||ot(t)}static isntCondition(t){return!Ye.isCondition(t)}static mustbeCondition(t,r=""){Ye.isCondition(t)||g({type:Ye.exceptions.INVALID_CONDITION,message:r||"Invalid condition statement."})}},K=Ye;v(K,"exceptions",{INVALID_CONDITION:"CONDITION_INVALID_CONDITION"});K.combine=function(e={}){let t=[],r=m.array(e.whens)?e.whens:[],i=m.object(e.else)?e.else:{};return r.forEach(o=>{h.object(o)&&(o={}),t.push({[Le]:Ci(o.rules),[Ae]:o.result})}),t.push({[Ie]:i.result}),t};function Ci(e=[]){h.array(e)&&(e=[e]);let t=[ne,le].join(Ue),r=[se,le].join(Ue),i=[ne,se,le,t,r];return e.map(o=>{h.object(o)&&(o={});let l=i.includes(o.logic)?o.logic:"";if(!l)return o.expression;if([ne,se].includes(l))return{[l]:o.expression};let a=l.split(Ue);return{[a[0]]:{[a[1]]:o.expression}}})}K.extract=function(e){let[t,r]=[[],{result:void 0}];return K.isntCondition(e)?{whens:t,else:r}:(pe(e)&&(e=[e]),e.forEach(i=>{Se(i)?t.push({result:i[Ae],rules:Fi(i[Le])}):Oe(i)&&(r={result:i[Ie]})}),{whens:t,else:r})};function Fi(e=[]){return h.array(e)&&(e=[e]),e.map(t=>{if(h.object(t))return{logic:"",expression:t};let r=ne in t?ne:se in t?se:"";if(!r)return{logic:"",expression:t};let i=t[r];return m.object(i)&&le in i&&(r=[r,le].join(Ue),i=i[le]),{logic:r,expression:i}})}function _t(e={},t){let[r,i,o]=["unknown",e[Le],-1];for(h.array(i)&&(i=[i]);++o<i.length;){let[l,a]=[i[o],[]];if(m.object(l)&&ne in l){if(o>0&&r!==!0)break;l=l[ne],a.push(ne)}else if(m.object(l)&&se in l){if(o>0&&r===!0)break;l=l[se],a.push(se)}m.object(l)&&le in l&&(l=l[le],a.push(le));let n=t(l);if(h.boolean(n)&&(n="unknown"),a.includes(le)&&m.boolean(n)&&(n=!n),a.includes(ne)){if(r=n,r!==!0)break}else if(a.includes(se)){if(r!==!0&&(r=n),r===!0)break}else r=n}return{truthy:r,result:e[Ae]}}function Tt(e={}){return{result:e[Ie]}}function Di(e){if(m.boolean(e))return e}K.parse=function(e,t){K.mustbeCondition(e),t===void 0&&(t=Di),b.function(t,'Condition "parseExpression"'),pe(e)&&(e=[e]);let r;return e.some(i=>{if(Se(i)){let{truthy:o,result:l}=_t(i,t);if(o===!0)return r=l,!0}else if(Oe(i)){let{result:o}=Tt(i);return r=o,!0}return!1}),r};K.possibilities=function(e){K.mustbeCondition(e),pe(e)&&(e=[e]);let t=!1,r=e.map(i=>{if(Se(i))return i[Ae];if(Oe(i))return t=!0,i[Ie]});return r=ee.unique(r),t||!r.includes(void 0)&&r.push(void 0),r};var ue=K;var $e=/<<\s*([^(<<)(>>)\s]+)\s*>>/,pr=new RegExp($e,"g");function qe(e="",t={}){let{raw:r,flag:i,strict:o}=t;if(r)return`<< ${e} >>`;let l=`<<\\s*${e}\\s*>>`;return o&&(l=`^${l}$`),new RegExp(l,i)}function St(e){return h.string(e)?!1:!!e.match($e)}var Ge=class{static isInterpolation(t){return St(t)}static isntInterpolation(t){return!Ge.isInterpolation(t)}static mustbeInterpolation(t,r=""){Ge.isInterpolation(t)||g({type:Ge.exceptions.INVALID_INTERPOLATION,message:r||"Invalid interpolation statement."})}},X=Ge;v(X,"exceptions",{INVALID_INTERPOLATION:"INVALID_INTERPOLATION"});function ze(e=""){return e.match(pr)}function Ot(e=""){let t=e.match($e);return t?t[1]:null}X.references=function(e="",t={}){if(X.isntInterpolation(e))return null;let i=(ze(e)||[]).map(o=>Ot(o));return t.unique!==!1&&(i=ee.unique(i)),i.length?i:null};X.parse=function(e="",t={}){X.mustbeInterpolation(e);let r=ze(e),i=X.references(e,{unique:!1}),o=l=>m.function(t)?t(l):t[l];if(r.length===1){let l=qe(i[0],{strict:!0});if(e.match(l))return e=o(i[0])}return i.forEach((l,a)=>{e=e.replace(r[a],o(l))}),e};X.replace=function(e="",t={}){return X.mustbeInterpolation(e),Object.keys(t).forEach(r=>{let i=qe(t[r],{raw:!0});r=qe(r,{flag:"g"}),e=e.replace(r,i)}),e};var ge=X;var Lt=class{constructor(t={}){Ke(this,t)}static create(...t){return new Lt(...t)}},te=Lt;v(te,"Condition",ue),v(te,"Interpolation",ge);function Rt(e,t){return m.array(e)?e=e.map(r=>Rt(r,t)):m.object(e)?e=G.from(Object.keys(e).map(r=>[r,Rt(e[r],t)])):ge.isInterpolation(e)&&(e=ge.parse(e,t)),e}function kt(e,t,r){if(m.array(e)){let i=ue.isConditionArray(e);e=e.map(o=>kt(o,t,i))}else m.object(e)&&(e=G.from(Object.keys(e).map(i=>[i,kt(e[i],t)])));return ue.isConditionArray(e)?e=ue.parse(e,t):ue.isConditionObject(e)&&!r&&(e=ue.parse(e,t)),e}te.prototype.parse=function(e){let{parseReference:t,parseExpression:r}=Ke(this);return e=Rt(e,t),e=kt(e,r),e};te.prototype.possibilities=function(e){let t=null;return ue.isCondition(e)?(t=[],ue.possibilities(e).forEach(r=>{if(!ue.isCondition(r))return t.push(r);t=t.concat(this.possibilities(r))})):m.object(e)?Object.keys(e).forEach(r=>{let i=this.possibilities(e[r]);!i||(t=t?t.concat(i):i)}):m.array(e)&&e.forEach(r=>{let i=this.possibilities(r);!i||(t=t?t.concat(i):i)}),t&&ee.unique(t)};te.prototype.references=function(e,t={}){let r=[];if(m.array(e))e.forEach(i=>{let o=this.references(i,t);o&&(r=r.concat(o))});else if(m.object(e))Object.keys(e).forEach(i=>{let o=this.references(e[i],t);o&&(r=r.concat(o))});else if(ge.isInterpolation(e)){let i=ge.references(e,t);i&&(r=r.concat(i))}return t.unique!==!1&&(r=ee.unique(r)),r.length?r:null};te.prototype.replace=function(e,t={}){return m.array(e)?e=e.map(r=>this.replace(r,t)):m.object(e)?e=G.from(Object.keys(e).map(r=>[r,this.replace(e[r],t)])):ge.isInterpolation(e)&&(e=ge.replace(e,t)),e};var lt=te;function H(e={},t={}){return e._reactive||(e._reactive=p({},t))}var Pi={prop:()=>P(),default:null,schemable:!0,calculable:!0,validation:null,rawValidation:null},ur=Pi;function xe(e={},t={}){return e._i18n||(e._i18n=p({},t))}var Ve=class{constructor(){xe(this,{locales:{},locale:"en"})}static create(...t){return new Ve(...t)}static isI18n(t){return t instanceof Ve}static isntI18n(t){return!Ve.isI18n(t)}static mustbeI18n(t,r){Ve.isntI18n(t)&&g({type:Ve.exceptions.NOT_AN_INSTANCE,message:r||"Invalid i18n instance."})}},U=Ve;v(U,"exceptions",{NOT_AN_INSTANCE:"I18N_NOT_AN_INSTANCE_OF_I18N",UNSUPPORTED_LOCALE:"I18N_UNSUPPORTED_LOCALE"});var cr=".";function at(e=""){return e.split(cr).map(t=>t.trim()).filter(t=>t.length)}function fr(e=[]){return e.map(t=>t.trim()).filter(t=>t.length).join(cr)}U.prototype.define=function(e="",t=""){let r=xe(this).locales;if(!arguments.length)return JSON.parse(JSON.stringify(r));if(h.object(e))return mr(r,e,t);Object.keys(e).forEach(i=>{if(h.object(e[i]))return mr(r,i,e[i]);let o=Object.keys(e[i]).map(l=>[fr([i,l]),e[i][l]]);this.define(G.from(o))})};function mr(e={},t="",r=""){b.nonblankString(t,"I18n locale path"),b.string(r,"I18n locale template");let[i,o]=["",at(t)];for(;i=o.shift();){if(!(i in e))e[i]=o.length?{}:r;else{let l=e[i];o.length?m.string(l)&&(e[i]={_:l}):m.string(l)?e[i]=r:e[i]._=r}e=e[i]}}U.prototype.locale=function(e){if(!e)return xe(this).locale;xe(this).locale=e};function dr(e="",t="",r=""){let i=new RegExp(`{\\s*${t}\\s*}`,"g");if(m.string(r))return e.replace(i,r);try{r=JSON.stringify(r)}catch(o){r=String(r)}return e.replace(i,r)}U.prototype.translate=function(e="",t={}){let r="default"in t?t.default:"",i="variables"in t?t.variables:null;b.string(r,"Default i18n template"),i&&b.object(i,"I18n variables");let[o,l]=[at(e),xe(this).locales],a=Vi(l,[xe(this).locale].concat(o));return m.null(a)&&(a=r),!a||!i?a:wi(a,i)};U.prototype.t=U.prototype.translate;function Vi(e={},t=""){let r="";return t.every((o,l)=>o in e?(e=e[o],l!==t.length-1||(r=m.string(e)?e:e._),!0):!1)?r:null}function wi(e="",t={}){return Object.keys(t).forEach(r=>{e=dr(e,r,t[r])}),e}U.prototype.try=function(e=[],t={}){let r="";return e.some(i=>{if(r=this.translate(i,t),r)return!0}),r};var Z=U.global=U.create();var hr={memberIsReferenced:"Member { id } is referenced.",conflictedMemberName:"Member name { name } has been occupied.",memberNameRequired:"Member name cannot be blank.",mustBelongsToValidParent:"{ memberType } members can only be inserted into { acceptedParentTypes } parents.",referenceNotFound:"Cannot find reference { reference } among members.",conditionNotComplete:"Condition must contain at lease one case.",conditionBranchNotComplete:"Condition branch must contain at least one rule.",conditionReferenceNotPresence:"Condition reference cannot be blank.",conditionLogicNotSupported:"Lack of valid and/or keyword.",conditionValidationNotSupported:"Unsupported validation { label }.",conditionValidationRuleNotSupported:"Validation rule { rule } is not supported by { label }."};var br={memberIsReferenced:"\u6210\u5458{ id }\u6B63\u5728\u88AB\u5F15\u7528\u3002",conflictedMemberName:"\u6210\u5458\u540D\u79F0{ name }\u5DF2\u88AB\u5360\u7528\u3002",memberNameRequired:"\u6210\u5458\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\u3002",mustBelongsToValidParent:"{ memberType }\u7C7B\u578B\u6210\u5458\u53EA\u80FD\u4F5C\u4E3A{ acceptedParentTypes }\u7C7B\u578B\u5B50\u7EA7\u3002",referenceNotFound:"\u6210\u5458\u4E2D\u4E0D\u5B58\u5728\u5F15\u7528\u8DEF\u5F84{ reference }",conditionNotComplete:"\u6761\u4EF6\u5206\u652F\u81F3\u5C11\u8981\u5305\u542B\u4E00\u79CD\u60C5\u51B5\u3002",conditionBranchNotComplete:"\u6761\u4EF6\u5206\u652F\u5185\u81F3\u5C11\u8981\u5305\u542B\u4E00\u4E2A\u89C4\u5219\u3002",conditionReferenceNotPresence:"\u6761\u4EF6\u4F9D\u8D56\u4E0D\u80FD\u4E3A\u7A7A\u3002",conditionLogicNotSupported:"\u7F3A\u5C11\u5408\u6CD5\u7684\u4E0E\u6216\u5173\u952E\u5B57\u3002",conditionValidationNotSupported:"\u4E0D\u88AB\u652F\u6301\u7684\u6821\u9A8C{ label }\u3002",conditionValidationRuleNotSupported:"\u4E0D\u88AB{ label }\u652F\u6301\u7684\u6821\u9A8C\u89C4\u5219{ rule }\u3002"};Z.define({en:{reactive:hr},zh:{reactive:br}});var M=Z;var yr=".",ce=["children","order","type","name"],We="__REACTIVE_SCEHMA_REFERENCE__";function Er(e=""){let t=e.split(yr),r=t.pop();return{names:t,prop:r}}function Xe(e=[],t=""){return(t?e.concat(t):e).join(yr)}function gr(e,t){let[r,i]=[e.schema.references(t),{}];return r?(r.forEach(o=>{let l=e.schema.reference.parse(o),a=m.object(l);if(a&&(a=m.nonblankString(l.id)),a&&(a=m.nonblankString(l.prop)),a)return i[o]=JSON.stringify(l);g({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:M.t("reactive.referenceNotFound",{variables:{reference:o}})})}),e.schema.replace(t,i)):t}function xr(e,t){let[r,i]=[e.schema.references(t),{}];return r?(r.forEach(o=>{let l=null;try{l=JSON.parse(o)}catch(s){return}let a=e.schema.reference.stringify(l);if(m.nonblankString(a))return i[o]=a;g({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:M.t("reactive.referenceNotFound",{variables:{reference:o}})})}),e.schema.replace(t,i)):t}function Ar(e={},t={}){return p(p(p({},ur),t),e)}function Ir(e={}){return Object.keys(e).forEach(t=>{h.function(e[t])||(e[t]=e[t]())}),e}function Ct(e={}){let{id:t,prop:r}=e,i=this.get({id:t,prop:"type"}),{props:o,fallback:l}=H(this).installed[i].config.schema;if(!r)return o.map(s=>{let u=Ir(Ar(s,l));return ce.includes(u.prop)&&(u.schemable=u.calculable=!1),u});let a=o.find(s=>s.prop===r),n=Ir(Ar(a||l,l));return n.prop=r,ce.includes(r)&&(n.schemable=n.calculable=!1),n}function Ft(e="",t={}){var n,s;e=(this.schema.references(e)||[])[0]||e;let{names:r,prop:i}=Er(e),o=t.under||this.family.root(),[l,a]=[null,o.id];if(!r.length||this.family.hasnt({id:a}))return null;for(;l=r.shift();){if(a=(s=(n=this.family.descendant({id:a}))==null?void 0:n.find(E=>this.get({id:E.id,prop:"name"})===l))==null?void 0:s.id,!a)return null;let u=this.get({id:a,prop:"type"}),c=H(this).installed[u].config.schema.reference.parse;if(c)return e=Xe(r,i),c.call(this,{id:a},e)}return{id:a,prop:i}}function Dt(e={},t={}){let{id:r,prop:i}=e,o=t.under||this.family.root(),l=(()=>t.format!=="interpolation"?d=>d:d=>d&&`<< ${d} >>`)();if(this.family.hasnt({id:r}))return"";let a=this.family.ancestor({id:r},{deep:!0,self:!0}),[n,s]=[a.findIndex(d=>d.id===o.id),[]];if(n<0||(a=a.slice(0,n),!a.length))return"";let u=null;for(;u=a.pop();){s.push(this.get({id:u.id,prop:"name"}));let d=this.get({id:u.id,prop:"type"}),E=H(this).installed[d].config.schema.reference.stringify;if(E){let S=Xe(s),T=E.call(this,{id:u.id,reference:S},i);return l(T)}}return l(Xe(s,i))}function Pt(e){let t=lt.create({parseReference(r){return e.get(JSON.parse(r))},parseExpression(r={}){return e.validator.mustbeSupported(r),!e.validator.error(r)}});return t.for=Ct.bind(e),t.reference={parse:Ft.bind(e),stringify:Dt.bind(e)},t}var vr={validators:{dataType:{label:"Data Type",invalidValue:"Must be a data type within { rule }."},equalTo:{label:"Equal To",invalidRule:'Rule of "Equal To" validator Cannot be blank.',invalidValue:"Must be equal to { rule }."},isInteger:{label:"Is Integer",invalidValue:"{ value } is not an integer."},maxLength:{label:"Max Length",invalidRule:'Rule of "Max Length" validator must be a positive integer.',invalidValue:"Maximum length is { rule }."},presence:{label:"Presence",invalidValue:"Musn't be blank."},withFormat:{label:"With Format",invalidRule:'Rule of "With Format" validator must be a regexp or a string wrapped with "/".',invalidValue:"Must match format { rule }."}}};var Nr={validators:{dataType:{label:"\u6570\u636E\u7C7B\u578B",invalidValue:"\u6570\u636E\u7C7B\u578B\u5FC5\u987B\u662F{ rule }\u3002"},equalTo:{label:"\u7B49\u4E8E",invalidRule:"\u7B49\u4E8E\u7684\u6821\u9A8C\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A\u3002",invalidValue:"\u5FC5\u987B\u7B49\u4E8E{ rule }\u3002"},isInteger:{label:"\u662F\u6574\u6570",invalidValue:"{ value }\u4E0D\u662F\u4E00\u4E2A\u6574\u6570\u3002"},maxLength:{label:"\u6700\u5927\u957F\u5EA6",invalidRule:"\u6700\u5927\u957F\u5EA6\u7684\u6821\u9A8C\u89C4\u5219\u5FC5\u987B\u662F\u4E00\u4E2A\u6B63\u6574\u6570\u3002",invalidValue:"\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7{ rule }\u3002"},presence:{label:"\u4E0D\u4E3A\u7A7A",invalidValue:"\u4E0D\u80FD\u4E3A\u7A7A\u3002"},withFormat:{label:"\u7B26\u5408\u683C\u5F0F",invalidRule:"\u683C\u5F0F\u6821\u9A8C\u7684\u89C4\u5219\u5FC5\u987B\u662F\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\u6216\u88AB\u201C/\u201D\u5305\u62EC\u7684\u5B57\u7B26\u4E32\u3002",invalidValue:"\u5FC5\u987B\u7B26\u5408\u683C\u5F0F{ rule }\u3002"}}};Z.define({en:{validator:vr},zh:{validator:Nr}});var J=Z;var _r={name:"dataType",ruleType:["String","Array"],valueType:"*",validate(e,t){if(!N.within({type:N.get(e),types:t}))return J.t("validator.validators.dataType.invalidValue",{variables:{value:e,rule:t}})}};function Tr(e,t){if(e===t)return!0;if(typeof e!="object"||typeof t!="object"||e==null||t==null)return!1;let[r,i]=[Object.keys(e),Object.keys(t)];if(r.length!==i.length)return!1;for(let o of r)if(!i.includes(o)||!Tr(e[o],t[o]))return!1;return!0}var Sr={name:"equalTo",ruleType:"*",valueType:"*",validateRule(e){if(m.blank(e))return J.t("validator.validators.equalTo.invalidRule")},validate(e,t){if(!Tr(e,t))return J.t("validator.validators.equalTo.invalidValue",{variables:{value:e,rule:t}})}};var Or={name:"isInteger",valueType:"Number",validate(e){if(!m.integer(e))return J.t("validator.validators.isInteger.invalidValue",{variables:{value:e}})}};var Lr={name:"maxLength",ruleType:"Number",valueType:["String","Array"],validateRule(e){if(!m.positiveInteger(e))return J.t("validator.validators.maxLength.invalidRule")},validate(e,t){if(e.length>t)return J.t("validator.validators.maxLength.invalidValue",{variables:{value:e,rule:t}})}};var Rr={name:"presence",valueType:"*",validate(e){if(m.blank(e))return J.t("validator.validators.presence.invalidValue",{variables:{value:e}})}};var kr=/^\/(.+)\/$/,Cr={name:"withFormat",ruleType:["RegExp","String"],valueType:"String",validateRule(e){if(!m.regexp(e)&&!(m.string(e)&&e.match(kr)))return J.t("validator.validators.withFormat.invalidRule",{variables:{rule:e}})},validate(e,t){if(m.string(t)&&(t=new RegExp(t.match(kr)[1])),!e.match(t))return J.t("validator.validators.withFormat.invalidValue",{variables:{value:e,rule:String(t)}})}};var Fr=[Rr,_r,Or,Cr,Sr,Lr];function j(e={},t={}){return e._validator||(e._validator=p({},t))}var Vt=class{constructor(){j(this,{installed:{}}),Fr.forEach(t=>this.install(t))}static create(...t){return new Vt(...t)}},x=Vt;v(x,"exceptions",{CONFLICTED_NAME:"VALIDATOR_CONFLICTED_NAME",VALIDATION_FAILED:"VALIDATOR_VALIDATION_FAILED",UNSUPPORTED_VALIDATION:"VALIDATOR_UNSUPPORTED_VALIDATION",UNSUPPORTED_VALIDATION_RULE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE",UNSUPPORTED_VALIDATION_RULE_TYPE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE_TYPE"});var Ui="valOf";function nt(e={}){let t={};return"value"in e&&(t[Ui]=e.value),e.name&&(t[e.name]=void 0,"rule"in e&&(t[e.name]=e.rule)),t}x.prototype.combineValidation=function(e={}){let{installed:t}=j(this);return e.name in t?nt(I(p({},e),{rule:t[e.name].ruleType?e.rule:!0})):nt(e)};var Dr="valOf";function we(e={}){let t=e[Dr];e=G.exclude(e,[Dr]);let r=Object.keys(e)[0],i=e[r];return{name:r,rule:i,value:t}}x.prototype.mustbeSupported=function(e={},t={}){b.object(e,"Validation struct");let r="strict"in t?t.strict:!0,{name:i,rule:o}=we(e),{installed:l}=j(this),a=l[i];if(!a&&g({type:x.exceptions.UNSUPPORTED_VALIDATION,message:`Unsupported validator "${i}"`}),!(!r||!a.ruleType)){try{N.mustWithin({type:N.get(o),types:a.ruleType})}catch(n){g({type:x.exceptions.UNSUPPORTED_VALIDATION_RULE_TYPE,message:n.message||"Unsupported validation rule data type."})}if(!!a.validateRule)try{let n=a.validateRule(o);if(n)throw new Error(n)}catch(n){g({type:x.exceptions.UNSUPPORTED_VALIDATION_RULE,message:n.message||"Unsupported validation rule."})}}};x.prototype.error=function(e={},t){let r=null;try{this.mustbeSupported(e)}catch(i){r=i}if(!r){let{installed:i}=j(this),{name:o,rule:l,value:a}=we(e);arguments.length>1&&(a=t);let n=i[o],[s,u]=[N.get(a),n.valueType];try{N.mustWithin({type:s,types:u})}catch(d){r=d}r||(r=n.validate(a,l))}return r?D.create({type:x.exceptions.VALIDATION_FAILED,message:(()=>{let i="Not valid.";return m.string(r)?r:r instanceof Error&&r.message||i})()}):null};x.prototype.extractValidation=function(e={}){let{installed:t}=j(this),r=we(e);return r.name in t&&(t[r.name].ruleType||(r.rule=!0)),r};x.prototype.for=function(e="*",t={}){let[r,i]=[[],j(this).installed],o="except"in t?t.except:[];return h.array(o)&&(o=[o]),Object.values(i).forEach(l=>{o.includes(l.name)||!N.within({type:e,types:l.valueType})||r.push(p({},l))}),r.length?r:null};x.prototype.get=function(e=""){let t=j(this).installed;return e in t?p({},t[e]):null};x.prototype.install=function(e={}){b.object(e,"Validator installer");let{name:t,valueType:r,ruleType:i,validate:o,validateRule:l}=e;b.nonblankString(t,'Validator installer "name"'),b.type(r,'Validator installer "valueType"'),b.function(o,'Validator installer "validate"'),i&&b.type(i,'Validator installer "ruleType"'),l&&b.function(l,'Validator "validateRule"');let{installed:a}=j(this);t in a&&g({type:x.exceptions.CONFLICTED_NAME,message:`Validator name ${t} has been occupied.`}),a[t]=I(p({},e),{name:t,valueType:r,ruleType:i,validate:o,validateRule:l})};x.prototype.isSupported=function(...e){try{this.mustbeSupported(...e)}catch(t){return!1}return!0};x.prototype.isValid=function(...e){return!this.error(...e)};x.prototype.isntSupported=function(...e){return!this.isSupported(...e)};x.prototype.isntValid=function(...e){return!this.isValid(...e)};x.prototype.uninstall=function(e=""){let{installed:t}=j(this);e in t&&delete t[e]};function wt(e){return x.create()}function Ut(e){return F.create()}function Ze(e,t){!(t in H(e).installed)&&g({type:e.exceptions.UNINSTALLED_MEMBER_TYPE,message:`Member type ${t} is not installed.`})}function Mi(e,t={},r){let{hook:i,handler:o}=t;return h.array(i)&&(i=[i]),h.array(o)&&(o=[o]),o=o.map(l=>l.bind(e)),r?(o=o.map(l=>(a,...n)=>{let s=e.get({id:a.id,prop:"type"});if(s||(s=(a.props||{}).type||"default"),Ze(e,s),s===r)return l(a,...n)}),{hook:i,handler:o}):{hook:i,handler:o}}function Mt(e,t={}){if(!e)return;let r=t.only;h.array(e)&&(e=[e]),e.forEach(i=>{let{hook:o,handler:l}=Mi(this,i,r);o.forEach(a=>l.forEach(n=>this.hooks.add(a,n)))})}function jt(e){return e.hooks.mount=Mt.bind(e),e.hooks}function Bt(e){let t=e.get;return e.get=function(r={},i={}){let{id:o,prop:l}=r,a=t.call(e,r,i);if(!a||!a.raw)return a;if("prop"in r){let n=a.raw.value;a.raw.value=Pr(e,o,l,n)}else Object.keys(a.raw.values).forEach(n=>{let s=a.raw.values[n];a.raw.values[n]=Pr(e,o,n,s)});return a}}function Pr(e,t,r,i){return ce.includes(r)||!e.schema.for({id:t,prop:r}).schemable?i:xr(e,i)}function Vr(e={}){let{installed:t}=H(this),r=e.type,i=m.function(e.collect)?e.collect:null,o=m.function(e.seed)?e.seed:null,l="hooks"in e?e.hooks:[],a="schema"in e?e.schema:{},n="props"in a?a.props:[],s="fallback"in a?a.fallback:{},u="reference"in a?a.reference:{},d="parse"in u?u.parse:null,c="stringify"in u?u.stringify:null;b.nonblankString(r,'Reactive Member "type"'),o&&b.function(o,'Reactive Member "seed"'),i&&b.function(i,'Reactive Member "collect"'),d&&b.function(d,'Reactive Member "schema.reference.parse"'),c&&b.function(c,'Member "schema.reference.stringify"'),b.array(n,'Reactive Member "schema.props"'),b.object(s,'Reactive Member "schema.fallback"'),b.array(l,'Reactive Member "hooks"'),n.forEach(E=>b.object(E,"Reactive Member prop schema")),l=l.flat(1/0),l.forEach(E=>{let{hook:S,handler:T,scope:O}=E;O&&b.nonblankString(O,'Reactive Member hook "scope"'),S=m.array(S)?S:[S],T=m.array(T)?T:[T],S.forEach(V=>b.nonblankString(V,'Reactive Member hook "type"')),T.forEach(V=>b.function(V,'Reactive Member hook "handler"'))}),r in t&&g({type:this.exceptions.CONFLICTED_MEMBER_TYPE,message:`Reactive Member type '${r}' has been occupied.`}),t[r]={config:{type:r,hooks:l,collect:i,seed:o,schema:{fallback:s,props:n,reference:{parse:d,stringify:c}}}},l.forEach(E=>{if(!E.scope)return this.hooks.mount(E,{only:r});let S=m.array(E.hook)?E.hook:[E.hook];(m.array(E.handler)?E.handler:[E.handler]).forEach(O=>S.forEach(V=>{Object.keys(t).some(Q=>Q!==r&&t[Q].config.hooks.some(q=>{let Re=m.array(q.hook)?q.hook:[q.hook],Zt=m.array(q.handler)?q.handler:[q.handler];return q.scope===E.scope&&Zt.includes(O)&&Re.includes(V)}))||this.hooks.mount(I(p({},E),{hook:V,handler:O}),{only:E.scope})}))})}function Ht(e={},t={}){let{id:r}=e;if(this.family.hasnt({id:r}))return null;let i="errors"in t?t.errors:!0,[o,l]=[t.only||[],t.except||[]];h.array(o)&&(o=[o]),h.array(l)&&(l=[l]);let{values:a,raw:n}=wr(this,r);if(a=Kt(this,a,o,l),n.values=Kt(this,n.values,o,l),!i)return{values:a,raw:n};let[s,u]=ji(this,r);return{values:a,errors:s,raw:I(p({},n),{errors:u})}}function wr(e,t){let r=e.get({id:t,prop:"type"}),i=H(e).installed[r].config.collect;if(i){let n=i.call(e,{id:t});return n||(n={}),n.values||(n.values={}),n.raw||(n.raw={}),n.raw.values||(n.raw.values={}),n}let{values:o,raw:l}=e.get({id:t},{include:"raw"});o.children=[],l.values.children=[];let a=e.family.descendant({id:t});return a?(a.forEach(n=>{let s=wr(e,n.id);o.children.push(s.values),l.values.children.push(s.raw.values)}),{values:o,raw:l}):{values:o,raw:l}}function Kt(e,t={},r=[],i=[]){return Object.keys(t).forEach(o=>{r.length&&!r.includes(o)&&delete t[o],i.length&&i.includes(o)&&delete t[o]}),t.children&&t.children.forEach((o,l)=>{t.children[l]=Kt(e,o,r,i)}),t}function ji(e,t){let[r,i]=[[],[]];return e.family.descendant({id:t},{deep:!0,self:!0}).forEach(({id:l})=>{let a=e.get({id:l},{include:["raw","error"]});a.errors&&r.push({id:l,errors:a.errors}),a.raw.errors&&i.push({id:l,errors:a.raw.errors})}),[r.length?r:null,i.length?i:null]}function Yt(e={},t={},r={}){let i="execute"in r?r.execute:!0;if(i&&this.family.hasnt({id:e.id}))return;let[o,l,a]=[null,[{id:e.id,props:t}],[]];for(;o=l.shift();){let[n,s]=[o.id,o.props],u=this.family.has({id:n}),d=(()=>u?this.get({id:n,prop:"type"}):s.type||"default")(),c=H(this).installed[d].config.seed;if(c){let E=c.call(this,{id:n},s);E&&(a=a.concat(E))}else Object.keys(s).forEach(E=>{if(E!=="children"){let O={action:"set",id:n,prop:E,value:s[E]};return a.push(O)}let[S,T]=[n,this.family.descendant({id:n})||[]];s.children.forEach((O,V)=>{if(T[V])return l.push({id:T[V].id,props:O});let[L,Q,q]=[P(),O.name,O.type||"default"],Re={action:"add",parentId:S,id:L,props:{type:q,name:Q}};a.push(Re),l.push({id:L,props:I(p({},O),{type:q})})})})}return i?this.executor.run(a):a}var Bi=[{hook:"before-add",handler(e){let t=(e.props||{}).type||"default";Ze(this,t)}}],Ur=Bi;var Hi=[{hook:"before-del",handler(e){let{id:t}=e,{family:r,dependency:i}=this,o=r.descendant({id:t},{self:!0}),l={self:!1,group:We};i.reliers(o,l)&&g({type:this.exceptions.CONSTRAINTS_EXIST,message:M.t("reactive.memberIsReferenced",{variables:{id:t}})})}}],Mr=Hi;var Ki=[{hook:"after-add",handler(e){let[t,r]=[e.id,(e.props||{}).type||"default"],[i,o]=[this.members,this.naming("type")];i[t][o.raw.prop]=i[t][o.prop]=r,i[t][o.raw.error]=i[t][o.error]=null}},{hook:"before-del",handler(e){let t=this.get({id:e.id,prop:"type"});e.props||(e.props={}),e.props.type=t}}],jr=Ki;var Yi=[{hook:"before-add",handler(e){let{id:t,props:r}=e;r||(e.props={}),e.props.name||(e.props.name=t)}},{hook:"after-add",handler(e){let{id:t,props:r}=e,[i,o]=[this.members,this.naming("name")];i[t][o.raw.prop]=i[t][o.prop]=r.name,i[t][o.raw.error]=i[t][o.error]=null}},{hook:"after-set",handler(e){let{id:t,prop:r,value:i}=e;if(r!=="name")return;let[o,l]=[this.members,this.naming("name")];o[t][l.raw.prop]=o[t][l.prop]=i,o[t][l.raw.error]=o[t][l.error]=null}}],Br=Yi;var $i=[{hook:["before-set","before-calc"],handler(e){if(e.prop==="type")return!1}}],Hr=$i;function Kr(e,t,r){let i=e.family.sibling({id:t});!i||i.find(({id:o})=>e.get({id:o,prop:"name"})===r)&&g({type:e.exceptions.CONFLICTED_MEMBER_NAME,message:M.t("reactive.conflictedMemberName",{variables:{name:r}})})}var qi=[{hook:"after-add",handler(e){let{id:t}=e,r=this.get({id:t,prop:"name"});mt.blank(r,M.t("reactive.memberNameRequired")),Kr(this,t,r)}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(r!=="name")return;let i=this.get({id:t,prop:r},{include:["error","raw"]});if(i.raw.error){let o=`Skipping validating name of member ${t},`;return o+=" since prev errors exist.",console.warn(o,i.raw.error)}try{mt.blank(i.raw.value,M.t("reactive.memberNameRequired")),Kr(this,t,i.raw.value)}catch(o){this.members[t][this.naming(r).raw.error]=[o]}}}],Yr=qi;function $t(e,t){try{return e.validator.mustbeSupported(t,{strict:!0}),null}catch(r){let o=e.validator.constructor.exceptions,l=o.UNSUPPORTED_VALIDATION,a=o.UNSUPPORTED_VALIDATION_RULE_TYPE,n=o.UNSUPPORTED_VALIDATION_RULE,{name:s,rule:u}=e.validator.extractValidation(t),d=M.t(`validator.validators.${s}.label`)||s;if([n,a].includes(r.type)){let c="reactive.conditionValidationRuleNotSupported",E=M.t(c,{variables:{label:d,rule:u}}),S=r.type===a;r.message=S?E:r.message||E}else if(r.type===l){let c="reactive.conditionValidationNotSupported";r.message=M.t(c,{variables:{label:d}})}return r}}var $r=[{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(ce.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let o=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(o.raw.error){let u=`Skipping validating ${r} schema of member ${t},`;return u+=" since previous errors exist.",console.warn(u,o.raw.error)}let l=this.schema.constructor.Condition;if(!l.isCondition(o.raw.value))return;let a=l.extract(o.raw.value),[n,s]=[this.members,this.naming(r)];if(!a.whens.length){n[t][s.raw.error]=[D.create({data:{dueto:"whens"},type:l.exceptions.INVALID_CONDITION,message:M.t("reactive.conditionNotComplete")})];return}a.whens.some((u,d)=>!u.rules||!u.rules.length?(n[t][s.raw.error]=[D.create({data:{branchIndex:d,dueto:"rules"},type:l.exceptions.INVALID_CONDITION,message:M.t("reactive.conditionBranchNotComplete")})],!0):u.rules.some((c,E)=>{let{logic:S,expression:T}=c;if(E!==0&&!["and","or"].includes(S)){let V="reactive.conditionLogicNotSupported";return n[t][s.raw.error]=[D.create({data:{branchIndex:d,ruleIndex:E,dueto:"logic"},type:l.exceptions.INVALID_CONDITION,message:M.t(V,{variables:{logic:S}})})],!0}if(h.object(T)||m.blank(T.valOf)){let V="reactive.conditionReferenceNotPresence";return n[t][s.raw.error]=[D.create({data:{branchIndex:d,ruleIndex:E,dueto:"provider"},type:l.exceptions.INVALID_CONDITION,message:M.t(V)})],!0}let O=$t(this,T);return O?(n[t][s.raw.error]=[D.create({data:{branchIndex:d,ruleIndex:E,dueto:"validation"},type:l.exceptions.INVALID_CONDITION,message:O.message})],!0):!1}))}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(ce.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let o=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(o.raw.error){let n=`Skipping translating ${r} schema of member ${t},`;return n+=" since previous errors exist.",console.warn(n,o.raw.error)}let[l,a]=[this.members,this.naming(r)];try{l[t][a.raw.prop]=gr(this,o.raw.value)}catch(n){l[t][a.raw.error]=[n]}}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,{schema:i,dependency:o,family:l,members:a}=this;if(ce.includes(r)||!i.for({id:t,prop:r}).schemable)return;o.delete({id:t,prop:r},{only:"relier",group:We});let s=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(s.raw.error){let c="Skipping adding new associations for";return c+=` member ${t}'s ${r} since previous errors exist.`,console.warn(c,s.raw.error)}let u=i.references(s.raw.value);if(!u)return;let d=u.map(c=>({relier:{id:t,prop:r},provider:JSON.parse(c)}));d.forEach(c=>{let{provider:E,relier:S}=c,T={self:!0,deep:!0},O=l.ancestor({id:E.id},T);O.forEach((V,L)=>{L!==O.length-1&&d.push({relier:S,provider:{id:V.id,prop:"name"}})})});try{o.add(d,{group:We})}catch(c){a[t][this.naming(r).raw.error]=[c]}}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(ce.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let i=this.constructor.prototype.get,{value:o,error:l}=i.call(this,{id:t,prop:r},{include:"error"}),[a,n]=[this.members,this.naming(r)];if(l){a[t][n.prop]=null;let s=`Skipping parsing ${r} schema of member ${t},`;return s+=" since previous errors exist.",console.warn(s,l)}try{a[t][n.prop]=this.schema.parse(o)}catch(s){a[t][n.prop]=null,a[t][n.error]=[s],console.warn(`Failed to parse ${r} schema of member ${t}.`,s)}}}];var Gi=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(ce.includes(r))return;let i=this.schema.for({id:t,prop:r});if(!i.schemable||!i.calculable)return;let o=this.constructor.prototype.get,{value:l,error:a}=o.call(this,{id:t,prop:r},{include:"error"}),[n,s]=[this.members,this.naming(r)];if(a){let u=`Skipping trying to calculate ${r} of member ${t},`;return u+=" since previous errors exist.",console.warn(u,a)}if(!!this.calculator.isSupported(l,{strict:!1}))try{n[t][s.prop]=this.calculator.calculate(l)}catch(u){n[t][s.error]=[u],console.warn(`Failed to calculate ${r} of member ${t}.`,u)}}}],qr=Gi;var zi=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{i.find(l=>l.prop===o.prop)||i.push({id:r,prop:o.prop,value:o.default})})}}],Gr=zi;var Wi=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{if(!("always"in o))return;let l=i.find(a=>a.prop===o.prop);if(l)return l.value=o.always;i.push({id:r,prop:o.prop,value:o.always})})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i}=e,o=this.schema.for({id:t,prop:r});"always"in o&&i!==o.always&&(e.value=o.always)}}],zr=Wi;var Xi=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{!o.validation||i.find(l=>l.prop===o.prop)||i.push({id:r,prop:o.prop,value:o.default||null})})}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,i=this.get({id:t,prop:r},{include:["error","raw"]}),{value:o,error:l}=i.raw,a=`${x.exceptions.VALIDATION_FAILED}_RAW`;if(Wr(l,{exclude:a})){let E=`Skipping validating raw ${r} of member ${t},`;return E+=" since previous errors exist.",console.warn(E,l)}let n=this.schema.constructor.Condition,s=this.schema.for({id:t,prop:r}).rawValidation,[u,d]=[this.members,this.naming(r)],c=d.raw.error;if(!s)return u[t][c]=null;if(n.isntCondition(o)){if(l=qt(this,{id:t,prop:r,value:o,validation:s}),!l)return u[t][c]=null;u[t][c]=[Gt(l,{type:a})]}else{let[E,S]=[n.extract(o),-1];if(E.whens.concat(E.else).some(({result:T},O)=>{if(l=qt(this,{id:t,prop:r,value:T,validation:s}),l)return(S=O)||!0}),!l)return u[t][c]=null;u[t][c]=[Gt(l,{type:a,data:{branchIndex:S,dueto:"result"}})]}}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e,{value:i,error:o}=this.get({id:t,prop:r},{include:"error"}),l=x.exceptions.VALIDATION_FAILED;if(Wr(o,{exclude:l})){let u=`Skipping validating ${r} of member ${t},`;return u+=" since previous errors exist.",console.warn(u,o)}let{validation:a}=this.schema.for({id:t,prop:r}),[n,s]=[this.members,this.naming(r)];if(!a||(o=qt(this,{id:t,prop:r,value:i,validation:a}),!o))return n[t][s.error]=null;n[t][s.error]=[Gt(o,{type:l})]}}];function Wr(e,t={}){if(!e)return!1;h.array(e)&&(e=[e]);let r=m.array(t.exclude)?t.exclude:[t.exclude];if(e=e.find(i=>!r.includes(i.type)),e)return!0}function qt(e,t={}){let{id:r,prop:i,value:o,validation:l}=t;h.array(l)&&(l=[l]);let[a,n]=[null,l.find(s=>"presence"in s)];return n||![null,void 0,""].includes(o)?(l.some(s=>{try{return m.function(s)?a=s.call(e,{id:r,prop:i,value:o}):a=e.validator.error(s,o)}catch(u){return a=u}}),a):a=null}function Gt(e={},t={}){let r=m.string(e)?e:e.message||e.name,i=m.string(e)?{}:e.data,o=t.data||{};return D.create({type:t.type,message:r,data:p(p({},i),o)})}var Xr=Xi;var Zr=[];function zt(e={}){let t=e.accept;h.array(t)&&(t=[t]),t.forEach(i=>b.nonblankString(i));let r=Zr.find(i=>i.accept.length!==t.length?!1:!i.accept.some(o=>!t.includes(o)));return r||(r={accept:t,HOOKS:[{hook:"before-add",handler(i){let o=(i.props||{}).type||"default",l=this.get({id:i.parentId,prop:"type"});!t.includes(l)&&g({type:this.exceptions.INVALID_PARENT,message:M.t("reactive.mustBelongsToValidParent",{variables:{memberType:o,acceptedParentTypes:t}})})}}]},Zr.push(r)),r.HOOKS}var Wt={CONFLICTED_MEMBER_TYPE:"REACTIVE_CONFLICTED_MEMBER_TYPE",UNINSTALLED_MEMBER_TYPE:"REACTIVE_UNINSTALLED_MEMBER_TYPE",CONSTRAINTS_EXIST:"REACTIVE_CONSTRAINTS_EXIST",CONFLICTED_MEMBER_NAME:"REACTIVE_CONFLICTED_MEMBER_NAME",REFERENCED_PROVIDER_NOT_FOUND:"REACTIVE_REFERENCED_PROVIDER_NOT_FOUND",INVALID_PARENT:"REACTIVE_INVALID_PARENT",HOOK_NOT_EXIST:"REACTIVE_HOOK_NOT_EXIST",VALIDATION_FAILED:"REACTIVE_VALIDATION_FAILED"},st={ENABLE_SCHEMA_DEFAULT:Gr,ENABLE_SCHEMA_ALWAYS:zr,ENABLE_SCHEMA_VALIDATION:Xr,BLOCK_INVALID_PARENT:zt};function A(){let e=C.create();H(e,{installed:{}}),e.guid=P,e.exceptions=Wt,e.seed=Yt.bind(e),e.collect=Ht.bind(e),e.install=Vr.bind(e),e.get=Bt(e),e.schema=Pt(e),e.validator=wt(e),e.calculator=Ut(e),e.hooks=jt(e),e.hooks.mount(Ur),e.hooks.mount(Mr),e.hooks.mount(jr),e.hooks.mount(Br),e.hooks.mount(Hr),e.hooks.mount(Yr),e.hooks.mount($r),e.hooks.mount(qr),e.install({type:"default",schema:{props:[{prop:"name"}]}});let t=e.members[e.family.root().id],r=e.naming("type");return t[r.raw.prop]=t[r.prop]="default",e}A.guid=P;A.exceptions=Wt;A.hooks={use(e,...t){return!(e in st)&&g({type:Wt.HOOK_NOT_EXIST}),h.function(st[e])?st[e]:st[e](...t)}};Te.hooks=[A.hooks.use("ENABLE_SCHEMA_DEFAULT"),A.hooks.use("ENABLE_SCHEMA_VALIDATION")];var Jr={schema:{props:{name:{label:"Fieldset Name"},label:{label:"Fieldset Title",default:"Fieldset"},description:{label:"Fieldset Description",default:"This is a fieldset."}}}};var Qr={schema:{props:{name:{label:"\u8F93\u5165\u9879\u96C6\u5408Name"},label:{label:"\u8F93\u5165\u9879\u96C6\u5408\u6807\u9898",default:"\u8F93\u5165\u9879\u96C6\u5408"},description:{label:"\u8F93\u5165\u9879\u96C6\u5408\u63CF\u8FF0",default:"\u8FD9\u662F\u4E00\u4E2A\u8F93\u5165\u9879\u96C6\u5408\u3002"}}}};Z.define({en:{form:{fieldset:Jr}},zh:{form:{fieldset:Qr}}});var re=Z;Te.schema={fallback:{prop:()=>A.guid(),label:()=>A.guid(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>re.t("form.fieldset.schema.fallback.placeholder"),hint:()=>re.t("form.fieldset.schema.fallback.hint")},props:[{prop:"name",validation:[{dataType:"String"}],label:()=>re.t("form.fieldset.schema.props.name.label"),placeholder:()=>re.t("form.fieldset.schema.props.name.placeholder"),hint:()=>re.t("form.fieldset.schema.props.name.hint")},{prop:"label",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>re.t("form.fieldset.schema.props.label.default"),label:()=>re.t("form.fieldset.schema.props.label.label"),placeholder:()=>re.t("form.fieldset.schema.props.label.placeholder"),hint:()=>re.t("form.fieldset.schema.props.label.hint")},{prop:"description",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>re.t("form.fieldset.schema.props.description.default"),label:()=>re.t("form.fieldset.schema.props.description.label"),placeholder:()=>re.t("form.fieldset.schema.props.description.placeholder"),hint:()=>re.t("form.fieldset.schema.props.description.hint")}]};var f=class{};v(f,"GROUP_NAME","Field"),v(f,"PARENT_TYPE","Fieldset"),v(f,"exceptions",{PROP_SCHEMA_NOT_EXIST:"FIELD_PROP_SCHEMA_NOT_EXIST",HOOK_NOT_EXIST:"FIELD_HOOK_NOT_EXIST",INVALID_PARENT:"FIELD_INVALID_PARENT",UNINSTALLED_TYPE:"FIELD_UNINSTALLED_TYPE"});f.extend=function(e={}){let{type:t,hooks:r,schema:i}=p({},e);return!r&&(r=f.hooks.default()),!i&&(i=f.schema.default()),!i.fallback&&(i.fallback=f.schema.default("fallback")),!i.props&&(i.props=f.schema.default("props")),I(p({},e),{group:f.GROUP_NAME,type:t,hooks:r,schema:i})};var ei={schema:{props:{name:{label:"Name"},label:{label:"Label",default:"Form Field"},value:{label:"Initial Value"},placeholder:{label:"Placeholder",default:""},editable:{label:"If Editable"},visible:{label:"If Visible"},validation:{label:"Validation"},calculation:{label:"Calculation",placeholder:'E.g, {"add": ["<< fields.age.value >>", "<< fields.count.value >>"]}',notSupported:"Unsupported calculation algorithm { name }."},options:{label:"Options",each:{mustbeObject:"Each option must be an object.",labelMustbeNonblankString:"Option label must be a non-blank string.",valueMustbeNonblankString:"Option value must be a non-blank string",mustbeUnique:"Option value must be unique.",label:"Option"}}}},textField:{schema:{props:{label:{default:"Text Field"}}}},multilineTextField:{schema:{props:{label:{default:"Multiline Text Field"}}}},numberField:{schema:{props:{label:{default:"Number Field"}}}},singleSelectField:{schema:{props:{label:{default:"Single Select"}}}},multipleSelectField:{schema:{props:{label:{default:"Multiple Select"}}}},radioField:{schema:{props:{label:{default:"Radio Field"}}}},checkboxField:{schema:{props:{label:{default:"Checkbox Field"}}}}};var ti={schema:{props:{name:{label:"\u8F93\u5165\u9879Name"},label:{label:"\u6807\u9898",default:"\u8F93\u5165\u9879"},value:{label:"\u521D\u59CB\u503C"},placeholder:{label:"\u5360\u4F4D\u7B26",default:""},editable:{label:"\u662F\u5426\u53EF\u7F16\u8F91"},visible:{label:"\u662F\u5426\u53EF\u89C1"},validation:{label:"\u6821\u9A8C\u89C4\u5219"},calculation:{label:"\u8BA1\u7B97\u89C4\u5219",placeholder:'\u4F8B\u5982: {"add": ["<< fields.age.value >>", "<< fields.count.value >>"]}',notSupported:"\u4E0D\u88AB\u652F\u6301\u7684\u8BA1\u7B97{ name }\u3002"},options:{label:"\u9009\u9879",each:{mustbeObject:"\u53EF\u9009\u9879\u76EE\u987B\u662F\u5BF9\u8C61\u3002",labelMustbeNonblankString:"\u53EF\u9009\u9879\u6807\u9898\u987B\u662F\u975E\u7A7A\u5B57\u7B26\u4E32\u3002",valueMustbeNonblankString:"\u53EF\u9009\u9879\u7684\u503C\u987B\u662F\u975E\u7A7A\u5B57\u7B26\u4E32\u3002",mustbeUnique:"\u9009\u9879\u503C\u4E0D\u80FD\u91CD\u590D\u3002",label:"\u9009\u9879"}}}},textField:{schema:{props:{label:{default:"\u5355\u884C\u6587\u672C"}}}},multilineTextField:{schema:{props:{label:{default:"\u591A\u884C\u6587\u672C"}}}},numberField:{schema:{props:{label:{default:"\u6570\u5B57"}}}},singleSelectField:{schema:{props:{label:{default:"\u4E0B\u62C9\u5355\u9009"}}}},multipleSelectField:{schema:{props:{label:{default:"\u4E0B\u62C9\u591A\u9009"}}}},radioField:{schema:{props:{label:{default:"\u5355\u9009"}}}},checkboxField:{schema:{props:{label:{default:"\u591A\u9009"}}}}};Z.define({en:{form:{field:ei}},zh:{form:{field:ti}}});var _=Z;var Zi=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"calculation"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="calculation")return;let i=this.get({id:t,prop:r},{include:["raw","error"]});if(i.error)return console.warn("Skipping using calculated value since prev errors exist.",i.error);!i.raw.value||this.set({id:t,prop:"value",value:i.value})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i}=e;if(r!=="value")return;let o=this.get({id:t,prop:"calculation"},{include:"raw"});if(o.raw.value&&i!==o.value)return!1}}],ri=Zi;var Ji=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"validation"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let i=this.get({id:t,prop:"validation"},{include:"error"});if(i.error){let u=`Skipping validating ${r} using field validation`;return u+=" since field validation has errors.",console.warn(u,i.error)}if(!i.value)return;let{value:o,error:l}=this.get({id:t,prop:r},{include:"error"});if(l){let u="Skipping validating value using validation rules";return u+=" since prev value errors exist.",console.warn(u,l)}h.array(i.value)&&(i.value=[i.value]),(i.value.find(u=>u&&"presence"in u)||h.blank(o))&&i.value.some(u=>{try{return l=this.validator.error(u,o)}catch(d){return l=d}});let[n,s]=[this.members,this.naming(r)];if(!l)return n[t][s.error]=null;n[t][s.error]=[D.create({type:x.exceptions.VALIDATION_FAILED,message:m.string(l)?l:l.message||l.name})]}}],ii=Ji;var Qi=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"options"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let{value:i,error:o}=this.get({id:t,prop:r},{include:"error"});if(o){let d="Skipping checking if value is within field options";return d+=" since prev value errors exist.",console.warn(d,o)}let l=this.get({id:t,prop:"options"},{include:"error"});if(l.error){let d="Skipping checking if value is within field options";return d+=" since field options has errors.",console.warn(d,l.error)}if(!l.value)return;let[a,n]=[this.members,this.naming(r)];if(m.blank(i))return a[t][n.error]=null;let s=l.value.map(d=>d.value);if(h.array(i)&&(i=[i]),!i.some(d=>!s.includes(d)))return a[t][n.error]=null;a[t][n.error]=[D.create({type:x.exceptions.VALIDATION_FAILED,message:"Each picked value must be included in option values."})]}}],oi=Qi;var pt={ENABLE_VALUE_CALCULATION:ri,ENABLE_VALUE_VALIDATION:ii,ENSURE_VALUE_WITHIN_OPTIONS:oi},eo=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),pt.ENABLE_VALUE_CALCULATION,A.hooks.use("ENABLE_SCHEMA_VALIDATION"),pt.ENABLE_VALUE_VALIDATION];f.hooks={use(e){return!(e in pt)&&g({type:f.exceptions.HOOK_NOT_EXIST}),pt[e]},default(){return eo.slice()}};var Je={FALLBACK:{prop:()=>P(),label:()=>P(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>_.t("form.field.schema.fallback.placeholder"),hint:()=>_.t("form.field.schema.fallback.hint")},PROPS:[{prop:"name",validation:[{dataType:"String"}],label:()=>_.t("form.field.schema.props.name.label"),placeholder:()=>_.t("form.field.schema.props.name.placeholder"),hint:()=>_.t("form.field.schema.props.name.placeholder")},{prop:"label",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],default:()=>_.t("form.field.schema.props.label.default"),label:()=>_.t("form.field.schema.props.label.label"),placeholder:()=>_.t("form.field.schema.props.label.placeholder"),hint:()=>_.t("form.field.schema.props.label.hint")},{prop:"value",schemable:!1,calculable:!1,validation:null,default:null,label:()=>_.t("form.field.schema.props.value.label"),placeholder:()=>_.t("form.field.schema.props.value.placeholder"),hint:()=>_.t("form.field.schema.props.value.hint")},{prop:"placeholder",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>_.t("form.field.schema.props.placeholder.default"),label:()=>_.t("form.field.schema.props.placeholder.label"),placeholder:()=>_.t("form.field.schema.props.placeholder.placeholder"),hint:()=>_.t("form.field.schema.props.placeholder.hint")},{prop:"editable",schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],rawValidation:[{presence:!0},{dataType:"Boolean"}],default:!0,label:()=>_.t("form.field.schema.props.editable.label"),placeholder:()=>_.t("form.field.schema.props.editable.placeholder"),hint:()=>_.t("form.field.schema.props.editable.hint")},{prop:"visible",schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],rawValidation:[{presence:!0},{dataType:"Boolean"}],default:!0,label:()=>_.t("form.field.schema.props.visible.label"),placeholder:()=>_.t("form.field.schema.props.visible.placeholder"),hint:()=>_.t("form.field.schema.props.visible.hint")},p({prop:"validation",schemable:!0,calculable:!0,default:null,label:()=>_.t("form.field.schema.props.validation.label"),placeholder:()=>_.t("form.field.schema.props.validation.placeholder"),hint:()=>_.t("form.field.schema.props.validation.hint")},(()=>{let e=[{dataType:"Array"},function(t){let[r,i]=[-1,null];for(;++r<t.value.length;){i=t.value[r];let o=$t(this,i);if(o)return o.data.validationIndex=r,o}}];return{validation:e,rawValidation:e}})()),{prop:"calculation",schemable:!0,calculable:!0,default:null,label:()=>_.t("form.field.schema.props.calculation.label"),placeholder:()=>_.t("form.field.schema.props.calculation.placeholder"),hint:()=>_.t("form.field.schema.props.calculation.hint"),validation:null,rawValidation:[function(e){if(!this.calculator.isSupported(e.value,{strict:!0}))return D.create({type:F.exceptions.UNSUPPORTED_CALCULATION,message:_.t("form.field.schema.props.calculation.notSupported",{variables:{name:e.value}})})}]}]},to={PROPS:[{prop:"options",schemable:!1,calculable:!1,default:()=>{let e="1",t="form.field.schema.props.options.each.label";return[{value:e,label:`${_.t(t)} ${e}`}]},label:()=>_.t("form.field.schema.props.options.label"),placeholder:()=>_.t("form.field.schema.props.options.placeholder"),hint:()=>_.t("form.field.schema.props.options.hint"),rawValidation:null,validation:[{presence:!0},{dataType:"Array"},function(e){let t=e.value;t.forEach((r,i)=>{let[o,l,a]=[!0,"",-1];h.object(r)?(o=!1,l="form.field.schema.props.options.each.mustbeObject"):h.nonblankString(r.label)?(o=!1,l="form.field.schema.props.options.each.labelMustbeNonblankString"):h.nonblankString(r.value)?(o=!1,l="form.field.schema.props.options.each.valueMustbeNonblankString"):(a=t.findIndex((n,s)=>s!==i&&n.value===r.value),a>=0&&(o=!1,l="form.field.schema.props.options.each.mustbeUnique")),!o&&g({data:{optionIndex:a>=0?a:i},type:x.exceptions.VALIDATION_FAILED,message:_.t(l)})})}]}]};f.schema={use(e){return p({},li(e))},extend(e,t={}){return p(p({},li(e)),t)},default(e){return e==="fallback"?p({},Je.FALLBACK):e==="props"?Je.PROPS.slice():{fallback:p({},Je.FALLBACK),props:Je.PROPS.slice()}}};function li(e){let r=Je.PROPS.concat(to.PROPS).find(i=>i.prop===e);return!r&&g({type:f.exceptions.PROP_SCHEMA_NOT_EXIST,message:`Prop schema of '${e}' does not exist.`}),r}function y(e="",t="",r){return m.undefined(r)&&(r=["label","placeholder","hint"]),G.from(r.map(i=>[i,ro(e,t,i)]))}function ro(e,t,r){return()=>_.try([`form.field.${e}.schema.props.${t}.${r}`,`form.field.schema.props.${t}.${r}`])}var ai=f.extend({type:"CheckboxField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),f.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),f.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),f.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[f.schema.extend("name",p({},y("checkboxField","name"))),f.schema.extend("label",p({},y("checkboxField","label",["label","placeholder","hint","default"]))),f.schema.extend("value",I(p({},y("checkboxField","value")),{validation:[{dataType:"Array"}]})),f.schema.extend("options",p({},y("checkboxField","options"))),f.schema.extend("editable",p({},y("checkboxField","editable"))),f.schema.extend("visible",p({},y("checkboxField","visible"))),f.schema.extend("validation",p({},y("checkboxField","validation"))),f.schema.extend("calculation",p({},y("checkboxField","calculation")))]}});var ni=f.extend({type:"MultilineTextField",schema:{props:[f.schema.extend("name",p({},y("multilineTextField","name"))),f.schema.extend("label",p({},y("multilineTextField","label",["label","placeholder","hint","default"]))),f.schema.extend("placeholder",p({},y("multilineTextField","placeholder",["label","placeholder","hint","default"]))),f.schema.extend("value",I(p({},y("multilineTextField","value")),{validation:[{dataType:"String"}]})),f.schema.extend("editable",p({},y("multilineTextField","editable"))),f.schema.extend("visible",p({},y("multilineTextField","visible"))),f.schema.extend("validation",p({},y("multilineTextField","validation"))),f.schema.extend("calculation",p({},y("multilineTextField","calculation")))]}});var si=f.extend({type:"MultipleSelectField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),f.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),f.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),f.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[f.schema.extend("name",p({},y("multipleSelectField","name"))),f.schema.extend("label",p({},y("multipleSelectField","label",["label","placeholder","hint","default"]))),f.schema.extend("placeholder",p({},y("multipleSelectField","placeholder",["label","placeholder","hint","default"]))),f.schema.extend("value",I(p({},y("multipleSelectField","value")),{validation:[{dataType:"Array"}]})),f.schema.extend("options",p({},y("multipleSelectField","options"))),f.schema.extend("editable",p({},y("multipleSelectField","editable"))),f.schema.extend("visible",p({},y("multipleSelectField","visible"))),f.schema.extend("validation",p({},y("multipleSelectField","validation"))),f.schema.extend("calculation",p({},y("multipleSelectField","calculation")))]}});var pi=f.extend({type:"NumberField",schema:{props:[f.schema.extend("name",p({},y("numberField","name"))),f.schema.extend("label",p({},y("numberField","label",["label","placeholder","hint","default"]))),f.schema.extend("placeholder",p({},y("numberField","placeholder",["label","placeholder","hint","default"]))),f.schema.extend("value",I(p({},y("numberField","value")),{validation:[{dataType:"Number"}]})),f.schema.extend("editable",p({},y("numberField","editable"))),f.schema.extend("visible",p({},y("numberField","visible"))),f.schema.extend("validation",p({},y("numberField","validation"))),f.schema.extend("calculation",p({},y("numberField","calculation")))]}});var ui=f.extend({type:"RadioField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),f.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),f.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),f.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[f.schema.extend("name",p({},y("radioField","name"))),f.schema.extend("label",p({},y("radioField","label",["label","placeholder","hint","default"]))),f.schema.extend("value",I(p({},y("radioField","value")),{validation:[{dataType:"String"}]})),f.schema.extend("options",p({},y("radioField","options"))),f.schema.extend("editable",p({},y("radioField","editable"))),f.schema.extend("visible",p({},y("radioField","visible"))),f.schema.extend("validation",p({},y("radioField","validation"))),f.schema.extend("calculation",p({},y("radioField","calculation")))]}});var ci=f.extend({type:"SingleSelectField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),f.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),f.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),f.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[f.schema.extend("name",p({},y("singleSelectField","name"))),f.schema.extend("label",p({},y("singleSelectField","label",["label","placeholder","hint","default"]))),f.schema.extend("placeholder",p({},y("singleSelectField","placeholder",["label","placeholder","hint","default"]))),f.schema.extend("value",I(p({},y("singleSelectField","value")),{validation:[{dataType:"String"}]})),f.schema.extend("options",p({},y("singleSelectField","options"))),f.schema.extend("editable",p({},y("singleSelectField","editable"))),f.schema.extend("visible",p({},y("singleSelectField","visible"))),f.schema.extend("validation",p({},y("singleSelectField","validation"))),f.schema.extend("calculation",p({},y("singleSelectField","calculation")))]}});var fi=f.extend({type:"TextField",schema:{props:[f.schema.extend("name",p({},y("textField","name"))),f.schema.extend("label",p({},y("textField","label",["label","placeholder","hint","default"]))),f.schema.extend("placeholder",p({},y("textField","placeholder",["label","placeholder","hint","default"]))),f.schema.extend("value",I(p({},y("textField","value")),{validation:[{dataType:"String"}]})),f.schema.extend("editable",p({},y("textField","editable"))),f.schema.extend("visible",p({},y("textField","visible"))),f.schema.extend("validation",p({},y("textField","validation"))),f.schema.extend("calculation",p({},y("textField","calculation")))]}});var Xt=[fi,ni,pi,ci,si,ui,ai];var ie={type:"Subform"};ie.collect=function(e){let t=this.get({id:e.id},{include:"raw"}),[r,i]=[[],[]],[o,l]=[[],[]];return(this.family.descendant(e)||[]).forEach((a,n)=>{let[s,u]=[{},{}];(this.family.descendant(a)||[]).forEach(d=>{let c=this.collect({id:d.id},{errors:!1});s[c.values.name]=c.values.value,u[c.values.name]=c.raw.values.value,n===0&&(delete c.values.value,delete c.raw.values.value,o.push(c.values),l.push(c.raw.values))}),r.push(s),i.push(u)}),t.values.value=r,t.raw.values.value=i,t.values.children=o,t.raw.values.children=l,t};ie.hooks=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:"Fieldset"}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),A.hooks.use("ENABLE_SCHEMA_VALIDATION")];var mi={schema:{props:{name:{label:"Name"},label:{label:"Label",default:"Subform"},editable:{label:"If Editable"},visible:{label:"If Visible"}}}};var di={schema:{props:{name:{label:"\u5B50\u8868\u5355Name"},label:{label:"\u5B50\u8868\u5355\u6807\u9898",default:"\u5B50\u8868\u5355"},editable:{label:"\u662F\u5426\u53EF\u7F16\u8F91"},visible:{label:"\u662F\u5426\u53EF\u89C1"}}}};Z.define({en:{form:{subform:mi}},zh:{form:{subform:di}}});var Y=Z;ie.schema={fallback:{prop:()=>A.guid(),label:()=>A.guid(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>Y.t("form.subform.schema.fallback.placeholder"),hint:()=>Y.t("form.subform.schema.fallback.hint")},props:[{prop:"name",validation:[{dataType:"String"}],label:()=>Y.t("form.subform.schema.props.name.label"),placeholder:()=>Y.t("form.subform.schema.props.name.placeholder"),hint:()=>Y.t("form.subform.schema.props.name.hint")},{prop:"label",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],default:()=>Y.t("form.subform.schema.props.label.default"),label:()=>Y.t("form.subform.schema.props.label.label"),placeholder:()=>Y.t("form.subform.schema.props.label.placeholder"),hint:()=>Y.t("form.subform.schema.props.label.hint")},{prop:"editable",default:!0,schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],label:()=>Y.t("form.subform.schema.props.editable.label"),placeholder:()=>Y.t("form.subform.schema.props.editable.placeholder"),hint:()=>Y.t("form.subform.schema.props.editable.hint")},{prop:"visible",default:!0,schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],label:()=>Y.t("form.subform.schema.props.visible.label"),placeholder:()=>Y.t("form.subform.schema.props.visible.placeholder"),hint:()=>Y.t("form.subform.schema.props.visible.hint")}]};ie.seed=function(e,t){let r=t.children||[],i=t.value||[];!i.length&&i.push({});let o=i.map(()=>{let[n,s]=[this.guid(),"SubformFieldset"];return{action:"add",parentId:e.id,id:n,props:{type:s}}}),l=Object.keys(t).map(n=>{if(!["children","value"].includes(n))return{action:"set",id:e.id,prop:n,value:t[n]}}).filter(n=>n),a=o.map((n,s)=>(r=r.map((u,d)=>{let E=m.object(i[s])&&u.name in i[s]?i[s][u.name]:null;return I(p({},u),{order:d,value:E})}),this.seed({id:n.id},{children:r},{execute:!1}))).flat();return o.concat(l,a).map(n=>I(p({},n),{__syncSubformField__:!0}))};var ve={type:"SubformFieldset"};ve.hooks=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:"Subform"})];var $=class{};v($,"GROUP_NAME","SubformField"),v($,"PARENT_TYPE","SubformFieldset"),v($,"TYPE_PREFIX","Subform"),v($,"LABEL_PREFIX","Subform "),v($,"exceptions",{INVALID_PARENT:"SUBFORM_FIELD_INVALID_PARENT",INVALID_FIELD_INSTALLER:"SUBFORM_FIELD_INVALID_FIELD_INSTALLER"});var io=[{hook:"before-add",handler(e){let{parentId:t,props:r,__syncSubformField__:i}=e;if(i)return;let o=[I(p({},e),{action:"add",__syncSubformField__:!0})],l=this.family.sibling({id:t})||[];return o=o.concat(l.map(a=>({action:"add",__syncSubformField__:!0,parentId:a.id,id:this.guid(),props:r}))),this.executor.run(o),!1}},{hook:"before-del",handler(e){let{id:t,__syncSubformField__:r}=e;if(r)return;let i=[I(p({},e),{action:"del",__syncSubformField__:!0})],l=this.family.sibling({id:t},{self:!0}).findIndex(s=>s.id===t),a=this.family.ancestor({id:t}),n=this.family.sibling(a)||[];return i=i.concat(n.map(s=>({action:"del",__syncSubformField__:!0,id:this.family.descendant(s)[l].id}))),this.executor.run(i),!1}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i,__syncSubformField__:o}=e;if(o||r==="value")return;let l=[I(p({},e),{action:"set",__syncSubformField__:!0})],n=this.family.sibling({id:t},{self:!0}).findIndex(d=>d.id===t),s=this.family.ancestor({id:t}),u=this.family.sibling(s)||[];return l=l.concat(u.map(d=>({action:"set",__syncSubformField__:!0,id:this.family.descendant(d)[n].id,prop:r,value:i}))),this.executor.run(l),!1}},{scope:ve.type,hook:"after-add",handler(e){let{id:t,props:r}=e,i=this.family.sibling({id:t});if(!i)return;let o=this.collect({id:i[0].id}).raw.values.children;if(!o.length)return;let l=o.map((a,n)=>{let s=((r==null?void 0:r.children)||[])[n]||{},u="value"in s?s.value:null;return{action:"add",__syncSubformField__:!0,parentId:t,id:this.guid(),props:I(p({},a),{order:n,value:u})}});this.executor.run(l)}}],hi=io;var oo=[{hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:i,schema:o}=this;if(!o.for({id:t}).find(u=>u.prop==="value"))return;let a=r.ancestor({id:t}),s={id:r.ancestor(a).id,prop:"value"};i.add({relier:s,provider:{id:t,prop:"name"}}),i.add({relier:s,provider:{id:t,prop:"value"}})}},{scope:ve.type,hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:i}=this,l={id:r.ancestor({id:t}).id,prop:"value"};i.add({relier:l,provider:{id:t,prop:"order"}})}},{scope:ie.type,hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let{family:i}=this,o=(i.descendant({id:t})||[]).map(l=>G.from((i.descendant(l)||[]).map(a=>{let n=this.get({id:a.id,prop:"name"}),s=this.get({id:a.id,prop:"value"});return[n,s]})));this.members[t][this.naming(r).prop]=o}}],bi=oo;$.generate=function(e={}){e.group!==f.GROUP_NAME&&g({type:$.exceptions.INVALID_FIELD_INSTALLER,message:`SubformField.generate only accepts field installer
             to generate a subform field installer.`});let t=e.hooks.slice(),r=$.TYPE_PREFIX+e.type,i="BLOCK_INVALID_PARENT",o=A.hooks.use(i,{accept:f.PARENT_TYPE}),l=A.hooks.use(i,{accept:$.PARENT_TYPE}),a=t.indexOf(o);return a>-1&&(t[a]=l),t=t.concat(hi,bi),I(p({},e),{type:r,group:$.GROUP_NAME,hooks:t})};var ut=class{constructor(){this.i18n=U.create(),this.reactive=A({i18n:this.i18n}),ut.MEMBERS.forEach(t=>this.reactive.install(t))}static create(...t){return new ut(...t)}},k=ut;v(k,"MEMBERS",[]),v(k,"Field",f);k.group=function(e=""){let t=k.MEMBERS.filter(r=>e?r.group===e:!r.group);return t.length?t:null};k.install=function(e={}){h.array(e)&&(e=[e]),e.forEach(t=>{let{type:r,group:i,providers:o,validators:l}=p({},t);b.nonblankString(r,'Form Member "Type"'),i&&b.nonblankString(i,'Form Member "group"'),o&&b.function(o,'Form Member "providers"'),l&&b.function(l,'Form Member "validators"'),k.MEMBERS.push(p({},t)),i===f.GROUP_NAME&&k.MEMBERS.push($.generate(t))})};k.providers=function(e,t={}){var u;let{id:r,prop:i}=t,o=[];i="value";let l=e.get({id:r,prop:"type"}),a=(u=k.MEMBERS.find(d=>d.type===l))==null?void 0:u.providers;if(a)return a.call(e,{id:r,prop:i});if(Object.keys(e.members).forEach(d=>{if(d===r)return;let c=e.family.ancestor({id:d});!c||e.get({id:c.id,prop:"type"})!==Te.type||!(e.naming("value").prop in e.members[d])||o.push({id:d,prop:i})}),!o.length)return null;let n=e.dependency.reliers({id:r,prop:i});if(!n)return o;let s=o.filter(d=>!n.some(c=>d.id===c.id&&d.prop===c.prop));return s.length?s:null};k.uninstall=function(e=""){!e||(k.MEMBERS=k.MEMBERS.filter(t=>t.type!==e))};k.validators=function(e,t={}){var s;let{id:r,prop:i}=t;i="value";let o=e.get({id:r,prop:"type"}),l=(s=k.MEMBERS.find(u=>u.type===o))==null?void 0:s.validators;if(l)return l.call(e,{id:r,prop:i});let a=e.schema.for({id:r,prop:i}).validation||[];h.array(a)&&(a=[a]);let n=a.find(u=>"dataType"in u);return n?e.validator.for(n.dataType,{except:"dataType"}):[e.validator.get("presence")]};k.install(Te);k.install(ie);k.install(ve);k.install(Xt);return lo;})();
//# sourceMappingURL=rcfm.model.iife.min.js-1a23c589.map
