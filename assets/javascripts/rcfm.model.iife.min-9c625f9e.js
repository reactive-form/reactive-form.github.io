/*!
 * rcfm 0.2.4 | Model iife | https://jilinxiangyun.com
 * Copyright 2021 JLxiangyun | MIT license
 */
var ReactiveForm=(()=>{var ut=Object.defineProperty,ho=Object.defineProperties;var bo=Object.getOwnPropertyDescriptors;var zt=Object.getOwnPropertySymbols;var yo=Object.prototype.hasOwnProperty,Eo=Object.prototype.propertyIsEnumerable;var ct=(e,t,r)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t)=>{for(var r in t||(t={}))yo.call(t,r)&&ct(e,r,t[r]);if(zt)for(var r of zt(t))Eo.call(t,r)&&ct(e,r,t[r]);return e},I=(e,t)=>ho(e,bo(t)),go=e=>ut(e,"__esModule",{value:!0});var xo=(e,t)=>{go(e);for(var r in t)ut(e,r,{get:t[r],enumerable:!0})};var T=(e,t,r)=>(ct(e,typeof t!="symbol"?t+"":t,r),r);var ii={};xo(ii,{Calculator:()=>D,Context:()=>k,Exception:()=>F,Form:()=>R,I18n:()=>U,Reactive:()=>A,Schema:()=>it,Struct:()=>Ue,Type:()=>_,Validator:()=>x,guid:()=>P});var F=class extends Error{constructor(t={}){typeof t=="string"&&(t={type:t});let{type:r,message:o}=t;super(o);this.type=this.name=r}static create(...t){return new F(...t)}static raise(...t){throw new F(...t)}},g=F.raise;var Ao=0;function P(){return`${Date.now()}${Ao+=1}`}var _={ANY_TYPE:"*",SPECIFIC_TYPES:["String","Number","Boolean","Array","Object","RegExp","Function","Null","Undefined","Map","WeakMap","Symbol","File","Blob","Promise"],exceptions:{INVALID_DATA_TYPE:"TYPE_INVALID_DATA_TYPE"},get(e){let t=/\[object\s+(.*)\]/;return Object.prototype.toString.call(e).match(t)[1]},within(e={}){let{type:t,types:r}=e;return!Array.isArray(t)&&(t=[t]),!Array.isArray(r)&&(r=[r]),t.includes(_.ANY_TYPE)||r.includes(_.ANY_TYPE)?!0:!t.some(o=>!r.includes(o))},mustWithin(e={}){!_.within(e)&&g({type:_.exceptions.INVALID_DATA_TYPE,message:`Data type ${e.type} isn't within ${e.types}`})}},f=_.is={null(e){return _.get(e)==="Null"},undefined(e){return _.get(e)==="Undefined"},number(e){return _.get(e)==="Number"},integer(e){return Number.isInteger(e)},string(e){return _.get(e)==="String"},boolean(e){return _.get(e)==="Boolean"},array(e){return Array.isArray(e)},object(e){return _.get(e)==="Object"},regexp(e){return _.get(e)==="RegExp"},function(e){return _.get(e)==="Function"},positiveInteger(e){return f.integer(e)&&e>0},negativeInteger(e){return f.integer(e)&&e<0},blankArray(e){return f.array(e)&&e.length===0},blankString(e){return f.string(e)&&!!e.match(/^\s*$/)},blankObject(e){return f.object(e)&&Object.keys(e).length===0},nonblankArray(e){return f.array(e)&&e.length>0},nonblankString(e){return f.string(e)&&!!e.match(/\S/)},nonblankObject(e){return f.object(e)&&Object.keys(e).length>0},typeString(e){return e===_.ANY_TYPE?!0:_.SPECIFIC_TYPES.includes(e)},typeArray(e){return f.nonblankArray(e)?e.every(t=>t===_.ANY_TYPE?!0:_.within({type:t,types:_.SPECIFIC_TYPES})):!1},type(e){return f.typeString(e)||f.typeArray(e)},blank(e){return[null,void 0,NaN].includes(e)||f.blankString(e)||f.blankArray(e)||f.blankObject(e)?!0:f.array(e)?!e.some(t=>!f.blank(t)):!1}},b=_.isnt=(()=>{let e={};return Object.keys(f).forEach(t=>{e[t]=function(r){return!f[t](r)}}),e})(),h=_.mustbe=(()=>{let e={};return Object.keys(b).forEach(t=>{e[t]=function(r,o="The argument"){let i=f.object(o)?o.message:"";b[t](r)&&g({type:_.exceptions.INVALID_DATA_TYPE,message:i||`${o} must be '${t.toUpperCase()}'`})}}),e})(),ft=_.musntbe=(()=>{let e={};return Object.keys(f).forEach(t=>{e[t]=function(r,o="The argument"){let i=f.object(o)?o.message:"";f[t](r)&&g({type:_.exceptions.INVALID_DATA_TYPE,message:i||`${o} must not be '${t.toUpperCase()}'`})}}),e})();var Ue={},Q=Ue.array={unique(e=[]){return e.filter((t,r)=>e.indexOf(t)===r)}},G=Ue.object={from(e=[]){h.array(e);let t={};return e.forEach(r=>t[r[0]]=r[1]),t},collect(e={},t=[]){h.object(e),h.array(t);let r={};return Object.keys(e).forEach(o=>{t.includes(o)&&(r[o]=e[o])}),r},exclude(e={},t=[]){h.object(e),h.array(t);let r={};return Object.keys(e).forEach(o=>{!t.includes(o)&&(r[o]=e[o])}),r}},ci=Ue.string={capitalize(e=""){return e.replace(/\b\w/g,t=>t.toUpperCase())}};var Wt={name:"add",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t+r)}};var Xt={name:"devide",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t/r)}};var Zt={name:"map",argumentSize:1,argumentType:"*",calculate(e){return e}};var Jt={name:"minus",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t-r)}};var Qt={name:"multiple",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t*r)}};var er=[Wt,Jt,Qt,Xt,Zt];function fe(e={},t={}){return e._calculator||(e._calculator=u({},t))}var mt=class{constructor(){fe(this,{installed:{}}),er.forEach(t=>this.install(t))}static create(...t){return new mt(...t)}},D=mt;T(D,"exceptions",{CONFLICTED_NAME:"CALCULATOR_CONFLICTED_NAME",UNSUPPORTED_CALCULATION:"CALCULATOR_UNSUPPORTED_CALCULATION",INVALID_ARGUMENT_SIZE:"CALCULATOR_INVALID_ARGUMENT_SIZE",INVALID_ARGUMENT_TYPE:"CALCULATOR_INVALID_ARGUMENT_TYPE"});function Me(e={}){let t=Object.keys(e)[0],r=e[t];return b.array(r)&&(r=[r]),{name:t,args:r}}function dt(e,t){return e.length>=t.min}function ht(e=[],t){return!e.some((r,o)=>{let i=t;return b.type(i)&&(i=i[o]||i[i.length-1]),!_.within({type:_.get(r),types:i})})}D.prototype.mustbeSupported=function(e={}){h.object(e,"Calculation struct");let{name:t}=Me(e),{installed:r}=fe(this);!r[t]&&g({type:D.exceptions.UNSUPPORTED_CALCULATION,message:`Unsupported calculator "${t}".`})};D.prototype.isSupported=function(e={}){try{this.mustbeSupported(e)}catch(t){return!1}return!0};D.prototype.isntSupported=function(e={}){return!this.isSupported(e)};D.prototype.calculate=function(e={}){if(this.isntSupported(e))return null;let{installed:t}=fe(this),{name:r,args:o}=Me(e),{argumentType:i,argumentSize:l,calculate:a}=t[r];return!dt(o,l)||(o=o.slice(0,l.max).map(n=>this.isSupported(n)?this.calculate(n):n),!ht(o,i))?null:a(...o)};function bt(e){return e===1/0?!1:f.positiveInteger(e)?!0:!f.nonblankArray(e)||e.length!==2||!f.positiveInteger(e[0])?!1:e[1]===1/0?!0:e[1]>e[0]}function yt(e){return f.type(e)?!0:b.nonblankArray(e)?!1:e.every(t=>f.typeArray(t))}function Et(e){return{min:f.integer(e)?e:e[0],max:f.integer(e)?e:e[1]}}D.prototype.install=function(e={}){h.object(e,"Calculator installer");let{name:t,argumentSize:r,argumentType:o,calculate:i}=e;h.nonblankString(t,'Calculator installer "name"'),h.function(i,'Calculator installer "calculate"'),!bt(r)&&g({type:D.exceptions.INVALID_ARGUMENT_SIZE,message:'Invalid calculator installer "argumentSize".'}),!yt(o)&&g({type:D.exceptions.INVALID_ARGUMENT_TYPE,message:'Invalid calculator installer "argumentType".'});let{installed:l}=fe(this);t in l&&g({type:D.exceptions.CONFLICTED_NAME,message:`Conflicted calculator name "${t}".`}),l[t]=I(u({},e),{name:t,argumentType:o,calculate:i,argumentSize:Et(r)})};D.prototype.uninstall=function(e=""){let{installed:t}=fe(this);e in t&&delete t[e]};function w(e={},t={}){return e._family||(e._family=u({},t))}var Re=class{constructor(){let t=P();w(this,{rootId:t,members:{[t]:{id:t,parentId:null,order:0}}})}static create(...t){return new Re(...t)}static isFamily(t){return t instanceof Re}static isntFamily(t){return!Re.isFamily(t)}static mustbeFamily(t,r=""){Re.isntFamily(t)&&g({type:Re.exceptions.INVALID_INSTANCE,message:r||"Invalid family instance."})}},L=Re;T(L,"exceptions",{MEMBER_NOT_EXIST:"FAMILY_MEMBER_NOT_EXIST",CONFLICTED_PARENT:"FAMILY_MEMBER_CONFLICTED_PARENT",SELF_REFERENCE:"FAMILY_MEMBER_SELF_REFERENCE",INVALID_INSTANCE:"FAMILY_INVALID_INSTANCE"});function tr(e={},t=[]){t=t.sort((o,i)=>"order"in o?"order"in i?o.order-i.order:-1:1);let r=t.find(o=>"expectedOrder"in o);if(r){let[o,i]=[t.indexOf(r),r.expectedOrder];t.splice(o,1),i<0?t.unshift(r):i>t.length-1?t.push(r):t.splice(i,0,r)}return t.forEach((o,i)=>{delete e[o.id].expectedOrder,e[o.id].order=i}),t}L.prototype.descendant=function(e={},t={}){let{rootId:r,members:o}=w(this),i=e.id||r,l="deep"in t?t.deep:!1,a="self"in t?t.self:!1,n="sort"in t?t.sort:!0;if(!o[i])return null;let[s,p]=[[u({},o[i])],-1];for(;++p<s.length;){let[d,c]=[s[p],[]];if(Object.values(o).forEach(y=>{y.id!==r&&y.parentId===d.id&&c.push(u({},y))}),c.length&&(n&&(c=tr(o,c)),s=s.concat(c)),!l)break}return a||s.shift(),s.length?s:null};L.prototype.add=function(e={}){let{rootId:t,members:r}=w(this),o=e.id||P(),i=(e.parent?e.parent.id:e.parentId)||t,l=e.order||1/0;if(h.nonblankString(o,'Family member "id"'),h.nonblankString(i,'Family member "parentId"'),h.number(l,'Family member "order"'),o===i&&g({type:L.exceptions.SELF_REFERENCE,message:"Any family member's parent cannot be itself."}),!r[i]&&g({type:L.exceptions.MEMBER_NOT_EXIST,message:`Family member ${i} is not existed.`}),r[o]){if(r[o].parentId===i)return u({},r[o]);g({type:L.exceptions.CONFLICTED_PARENT,message:"Any family member's parent cannot be changed."})}return r[o]={id:o,parentId:i,expectedOrder:l,touchedAt:P()},this.descendant({id:i},{sort:!0}),u({},r[o])};L.prototype.ancestor=function(e={},t={}){let{id:r}=e,{members:o}=w(this),i="deep"in t?t.deep:!1,l="self"in t?t.self:!1;if(!o[r])return null;let[a,n]=[[u({},o[r])],-1];for(;++n<a.length;){let s=o[a[n].parentId];if(s&&a.push(u({},s)),!i)break}return i?(l||a.shift(),a.length?a:null):(a.shift(),a[0]?a[0]:null)};L.prototype.delete=function(e={}){let{members:t,rootId:r}=w(this);if(e.id===r)return;let o=t[e.id];if(!o)return;let{parentId:i}=o;this.descendant({id:e.id},{self:!0,deep:!0,sort:!1}).forEach(({id:l})=>delete t[l]),this.descendant({id:i},{sort:!0})};L.prototype.has=function(e={}){let{members:t}=w(this);return e.id in t};L.prototype.hasnt=function(e={}){return!this.has(e)};L.prototype.reorder=function(e={}){let{id:t,order:r}=e,{rootId:o,members:i}=w(this);h.number(r,'Family member "order"'),!(!i[t]||t===o)&&r!==i[t].order&&(i[t].expectedOrder=r,i[t].touchedAt=P(),this.descendant({id:i[t].parentId},{sort:!0}))};L.prototype.root=function(){let{rootId:e,members:t}=w(this);return u({},t[e])};L.prototype.sibling=function(e={},t={}){let{id:r}=e,{members:o,rootId:i}=w(this),l="self"in t?t.self:!1;if(!o[r])return null;if(r===i)return l?[this.root()]:null;let a=this.ancestor({id:r});if(!a)return null;let n=this.descendant(a);return l?n:(n=n.filter(s=>s.id!==r),n.length?n:null)};function j(e={},t={}){return e._dependency||(e._dependency=u({},t))}var ke=class{constructor(){j(this,{associations:{},group:{reliers:{}},cache:{reliers:{}}})}static create(...t){return new ke(...t)}static isDependency(t){return t instanceof ke}static isntDependency(t){return!ke.isDependency(t)}static mustbeDependency(t,r=""){ke.isntDependency(t)&&g({type:ke.exceptions.INVALID_INSTANCE,message:r||"Invalid dependency instance."})}},ie=ke;T(ie,"exceptions",{CIRCLE_REFERENCE:"DEPENDENCY_CIRCLE_REFERENCE",INVALID_INSTANCE:"DEPENDENCY_INVALID_INSTANCE"});var rr="#",Je="_";function ae(e={}){let{id:t,prop:r}=e;return t?`${t}${rr}${r||""}`:Je}function me(e=""){if(e===Je)return{id:"",prop:""};let[t,r]=e.split(rr);return{id:t,prop:r}}function ve(e={},t){if(!t)return Object.keys(e).forEach(l=>delete e[l]);let{id:r,prop:o}=t;if(!r)return delete e[Je];let i=ae({id:r,prop:o});o?(delete e[i],delete e[ae({id:r})],Object.keys(e).forEach(l=>{e[l].includes(i)&&delete e[l]})):Object.keys(e).forEach(l=>{(me(l).id===r||e[l].includes(i))&&delete e[l]})}var Ce="__GLOBAL__";ie.prototype.add=function(e=[],t={}){let r="group"in t?t.group:Ce;h.nonblankString(r,'Association "group"'),b.array(e)&&(e=[e]),e=e.map(({provider:l,relier:a})=>{h.nonblankString(a.id,'Association "relier.id"'),h.nonblankString(l.id,'Association "provider.id"'),h.nonblankString(a.prop,'Association "relier.prop"'),h.nonblankString(l.prop,'Association "provider.prop"');let n={provider:ae(l),relier:ae(a)};return{provider:l,relier:a,path:n}});let{error:o,rollbackQueue:i}=Io(this,e);if(!o)return vo(this,e,r);throw _o(this,i),o};function Io(e,t){let r=[],{associations:o}=j(e),i=j(e).cache.reliers;return t.some(({provider:a,relier:n,path:s})=>{if(s.provider===s.relier)return!0;let p=e.reliers(n,{split:!1});return p&&p.includes(s.provider)?!0:(o[s.provider]||(o[s.provider]=[]),o[s.provider].includes(s.relier)||(o[s.provider].push(s.relier),r.push({provider:a,relier:n,path:s}),ve(i,a)),!1)})?{rollbackQueue:r,error:F.create({type:ie.exceptions.CIRCLE_REFERENCE})}:{error:null,rollbackQueue:null}}function _o(e,t){let{associations:r}=j(e),o=j(e).cache.reliers;t.forEach(({provider:i,path:l})=>{let a=r[l.provider].indexOf(l.relier);a<0||(r[l.provider].splice(a,1),!r[l.provider].length&&delete r[l.provider],ve(o,i))})}function vo(e,t,r){let o=j(e).group.reliers;t.forEach(({path:i})=>{let l=o[i.provider]||(o[i.provider]={}),a=l[i.relier]||(l[i.relier]=[]);!a.includes(r)&&a.push(r)})}ie.prototype.delete=function(e={},t={}){let{id:r,prop:o}=e;if(!r)return;let{only:i,group:l}=t,a=ae(e),{associations:n}=j(this),s=j(this).cache.reliers,p=j(this).group.reliers,d=o?c=>c===a:c=>me(c).id===r;i!=="relier"&&(ve(s,e),o?(delete n[a],delete p[a]):Object.keys(n).map(c=>{!d(c)||(delete n[c],delete p[c])})),Object.keys(n).forEach(c=>{let y=n[c].length;n[c]=n[c].filter(S=>{if(!d(S))return!0;if(i!=="relier"||!l||l===Ce)return delete p[c][S],!1;let C=p[c][S].findIndex(V=>V===l);return C>=0&&p[c][S].splice(C,1),p[c][S].length?!0:(delete p[c][S],!1)});let N=n[c].length;N!==y&&(ve(s,me(c)),!N&&delete n[c],!Object.keys(p[c]).length&&delete p[c])})};ie.prototype.reliers=function(e=[],t={}){b.array(e)&&(e=[e]);let r=e.some(O=>b.object(O)||!O.id);r&&(e=[{}]);let o="reload"in t?t.reload:!1,i="split"in t?t.split:!0,l="deep"in t?t.deep:!0,a="self"in t?t.self:!0,n="group"in t?t.group:"",{associations:s}=j(this),p=j(this).cache.reliers,d=j(this).group.reliers,[c,y,N]=[[],[],[]];if(e.forEach(O=>{let J=ae(O);if("prop"in O?N.push(J):Object.keys(s).forEach(q=>{me(q).id===O.id&&N.push(q)}),y.push(O.id),!No(s,O))return ve(p,O);(o||!(J in p))&&(p[J]=To(s,O),p[J]=or(s,p[J])),c=c.concat(p[J])}),!c.length)return null;if(e.length>1&&(c=or(s,Q.unique(c))),r||l&&a&&(!n||n===Ce))return i?c.map(O=>me(O)):c;let[S,C]=[[],N.slice()],V=N.map(O=>s[O]).flat();return c.forEach(O=>{if(!l&&!V.includes(O))return;let J=me(O);if(!(!a&&y.includes(J.id))){if(n&&n!==Ce){let q=Object.keys(d).some(Le=>!C.includes(Le)||!Object.keys(d[Le]).includes(O)?!1:d[Le][O].includes(n));if(C.push(O),!q)return}S.push(i?J:O)}}),S.length?S:null};function No(e={},t={}){let{id:r,prop:o}=t;return r?o?ae(t)in e:Object.keys(e).filter(i=>me(i).id===r).length>0:Object.keys(e).length>0}function To(e={},t={}){let{id:r,prop:o}=t,i=(()=>r?o?(e[ae(t)]||[]).slice():Q.unique(Object.keys(e).filter(a=>me(a).id===r).map(a=>e[a]).flat()):Q.unique(Object.values(e).flat()))(),l=-1;for(;++l<i.length;)(e[i[l]]||[]).forEach(n=>!i.includes(n)&&i.push(n));return i}function or(e={},t=[]){let r=-1;for(;++r<t.length;)(e[t[r]]||[]).forEach(i=>{let l=t.indexOf(i);l>r||(t.splice(l,1),t.push(i),r--)});return t}function de(e={},t={}){return e._dispatcher||(e._dispatcher=u({},t))}var z=class{constructor(t={}){"target"in t&&h.function(t.target,"options.target"),de(this,{isAborted:!1,listeners:{},target:t.target||function(r){return r}})}static create(...t){return new z(...t)}};z.prototype.abort=function(e=!0){de(this).isAborted=e===!0};function je(e={},t,r){t in e&&(r?r=f.array(r)?r:[r]:r=Object.keys(e[t]),r.forEach(o=>{o in e[t]&&!e[t][o].length&&delete e[t][o]}),!Object.keys(e[t]).length&&delete e[t])}z.prototype.add=function(e={},t){let{id:r,event:o}=e,{listeners:i}=de(this);h.nonblankString(r,'Dispatcher "id"'),h.nonblankString(o,'Dispatcher "event"'),h.function(t,'Dispatcher "handler"'),i[r]||(i[r]={});let l=i[r][o]||(i[r][o]=[]),a=l.push({callback:t})-1;return function(){l.splice(a,1),je(i,r,o)}};z.prototype.delete=function(e={},t){let{id:r,event:o}=e,{listeners:i}=de(this);if(!!i[r]){if(!o){r in i&&delete i[r];return}if(!!i[r][o]){if(!t){o in i[r]&&delete i[r][o];return}i[r][o]=i[r][o].filter(l=>l.callback!==t),je(i,r,o)}}};z.prototype.trigger=function(e={},t){t&&h.function(t,'Dispatcher "handler"');let{id:r,event:o,detail:i}=e,{listeners:l,target:a,isAborted:n}=de(this);if(n||!l[r]||!l[r][o])return!1;let s=!1,p={type:o,target:a(r),detail:i};return t?t(p,i)===!1:(l[r][o].forEach(({callback:d})=>{let c=d(p,i)===!1;s||(s=c)}),!s)};function Fe(e={},t={}){return e._executor||(e._executor=u({},t))}var he=class{constructor(t={}){h.function(t.runner,"options.runner"),Fe(this,{isAborted:!1,queues:{current:[],next:[]},runner:t.runner||function(r){return r}})}static create(...t){return new he(...t)}};he.prototype.abort=function(e=!0){Fe(this).isAborted=e===!0};he.prototype.run=function(e){let{queues:t,runner:r,isAborted:o}=Fe(this);arguments.length&&(b.array(e)&&(e=[e]),t.next=t.next.concat(e)),!o&&(t.current.length||!t.next.length||(t.current=t.next,t.next=[],r(t.current.slice()),t.current=[],this.run()))};function be(e={},t={}){return e._hook||(e._hook=u({},t))}var W=class{constructor(){be(this,{isAborted:!1,hooks:{}})}static create(...t){return new W(...t)}};W.prototype.abort=function(e=!0){be(this).isAborted=e===!0};W.prototype.add=function(e="",t){h.nonblankString(e,'Hook "type"'),h.function(t,'Hook "handler"');let{hooks:r}=be(this);return r[e]||(r[e]=[]),r[e].push(t),function(){let o=r[e].indexOf(t);o>=0&&r[e].splice(o,1)}};W.prototype.delete=function(e="",t){let{hooks:r}=be(this);!r[e]||(t?r[e]=r[e].filter(o=>o!==t):r[e]=[])};W.prototype.run=function(e="",t={}){let{hooks:r,isAborted:o}=be(this);if(o)return!1;if(!r[e])return!0;let[i,l]=[t.arguments,!1];return b.array(i)&&(i=[i]),r[e].forEach(a=>{let n=a(...i);l||(l=n===!1)}),o?!1:!l};function gt(e={},t={}){let{members:r,family:o,dependency:i,hooks:l}=t,a="id"in e?e.id:e.id=P(),n=o.root().id,s=a===n;if(s&&r[a])return{};let p=s?null:(()=>"parentId"in e?e.parentId:e.parentId=n)();if(!s&&o.has({id:a}))return{};if(!s&&o.hasnt({id:p}))return{};let d="props"in e?e.props:e.props={};"children"in d||(d.children=[]),"order"in d||(d.order=1/0);let c={mutations:{set:[]},mutated:[]};return l.run("before-add",{arguments:[e,"before-add"]})?(!s&&o.add({id:a,parentId:p}),r[a]={},c.mutated=[{id:a}],Object.keys(e.props).forEach(y=>{c.mutations.set.push({id:a,prop:y,value:d[y]})}),!s&&i.add({provider:{id:a,prop:"order"},relier:{id:p,prop:"children"}}),l.run("after-add",{arguments:[e,c,"after-add"]}),c):{}}var Qe="__raw__prop__",et="__raw__error__",tt="__prop__",rt="__error__";function ye(e,t={}){return(t.raw?Qe:tt)+e}function Ee(e,t={}){return(t.raw?et:rt)+e}function xt(e={},t={}){let{members:r,family:o,hooks:i}=t,{id:l,prop:a}=e;if(o.hasnt({id:l}))return{};let n={mutated:[]},s={raw:ye(a,{raw:!0}),calc:ye(a)},p={raw:Ee(a,{raw:!0}),calc:Ee(a)};if(!i.run("before-calc",{arguments:[e,"before-calc"]}))return{};if(a==="children"){let d=o.descendant({id:l})||[];return r[l][s.calc]=d.map(({id:c})=>({id:c})),r[l][p.calc]=r[l][p.raw],n.mutated.push({id:l}),i.run("after-calc",{arguments:[e,n,"after-calc"]}),n}return r[l][s.calc]=r[l][s.raw],r[l][p.calc]=r[l][p.raw],n.mutated.push({id:l}),i.run("after-calc",{arguments:[e,n,"after-calc"]}),n}function At(e={},t={}){let{id:r}=e,{members:o,family:i,dependency:l,hooks:a}=t;if(i.hasnt({id:r}))return{};if(r===i.root().id)return{};if(!a.run("before-del",{arguments:[e,"before-del"]}))return{};let n={mutations:{set:[],calc:[]},mutated:[]},s=i.ancestor({id:r}),p=i.descendant({id:r},{deep:!0,self:!0}),d=l.reliers(p,{self:!1});return p.forEach(({id:c})=>{delete o[c],i.delete({id:c}),l.delete({id:c}),n.mutated.push({id:c})}),d&&(n.mutations.calc=d),s&&(i.descendant({id:s.id})||[]).forEach((c,y)=>{n.mutations.set.push({id:c.id,prop:"order",value:y})}),a.run("after-del",{arguments:[e,n,"after-del"]}),n}function It(e={},t={}){let{members:r,family:o,dependency:i,hooks:l}=t,{id:a,prop:n,value:s}=e;if(o.hasnt({id:a}))return{};let p={raw:ye(n,{raw:!0})},d={raw:Ee(n,{raw:!0})};if(Object.is(r[a][p.raw],s))return{};let c={mutations:{calc:[]},mutated:[]};if(n==="order"){let N=o.ancestor({id:a});return N?l.run("before-set",{arguments:[e,"before-set"]})?(o.reorder({id:a,order:e.value}),o.descendant(N).forEach(({id:S,order:C})=>{r[S][p.raw]=C,r[S][d.raw]=null,c.mutated.push({id:S}),c.mutations.calc.push({id:S,prop:n});let V=i.reliers({id:S,prop:n})||[];c.mutations.calc=c.mutations.calc.concat(V)}),l.run("after-set",{arguments:[e,c,"after-set"]}),c):{}:{}}if(!l.run("before-set",{arguments:[e,"before-set"]}))return{};r[a][p.raw]=e.value,r[a][d.raw]=null,c.mutated=[{id:a}];let y=i.reliers({id:a,prop:n})||[];return c.mutations.calc=[{id:a,prop:n}].concat(y),l.run("after-set",{arguments:[e,c,"after-set"]}),c}function So(e=[],t=[]){let[r,o]=[{},{}];return t.forEach(i=>{o[i]=[],r[i]=[]}),e.forEach(i=>{let{id:l,action:a}=i;!t.includes(a)||(o[a].push(l),r[a].push(i))}),{jobs:r,ids:o}}function Be(e={},t,r=[]){t||(t={}),t.mutated&&(e.mutated=e.mutated.concat(t.mutated)),r.forEach(o=>{e.mutations[o]||(e.mutations[o]=[]),t.mutations&&t.mutations[o]&&(e.mutations[o]=e.mutations[o].concat(t.mutations[o]))})}function ir(e=[]){return e.filter((t,r,o)=>o.findIndex(l=>l.id===t.id&&l.prop===t.prop)===r)}function _t(e=[],t={}){let{dispatcher:r}=t,o=["del","add","set","calc"],{jobs:i,ids:l}=So(e,o),a={mutated:[],mutations:{}};Be(a,{},o),i.del.forEach(n=>{Be(a,At(n,t),["add","set","calc"])}),i.add=a.mutations.add.concat(i.add),i.add.forEach(n=>{let{id:s,parentId:p}=n;l.del.includes(s)||l.del.includes(p)||Be(a,gt(n,t),["set","calc"])}),i.set=a.mutations.set.concat(i.set),i.set=ir(i.set.reverse()).reverse(),i.set.forEach(n=>{l.del.includes(n.id)||Be(a,It(n,t),["calc"])}),i.calc=a.mutations.calc.concat(i.calc),i.calc=ir(i.calc.reverse()).reverse(),i.calc.forEach(n=>{l.del.includes(n.id)||Be(a,xt(n,t),[])}),Q.unique(a.mutated.map(n=>n.id)).forEach(n=>{r.trigger({id:n,event:"after-mutation"})})}var De=class{constructor(){this.members={},this.family=L.create(),this.dependency=ie.create(),this.dispatcher=z.create(),this.hooks=W.create(),this.executor=he.create({runner:t=>_t(t,this)}),this.executor.run({action:"add",id:this.family.root().id})}static create(...t){return new De(...t)}static isContext(t){return t instanceof De}static isntContext(t){return!De.isContext(t)}static mustbeContext(t,r=""){De.isntContext(t)&&g({type:De.exceptions.INVALID_INSTANCE,message:r||"Invalid context instance."})}},k=De;T(k,"Family",L),T(k,"Dependency",ie),T(k,"Executor",he),T(k,"Dispatcher",z),T(k,"Hook",W),T(k,"exceptions",{INVALID_INSTANCE:"INVALID_CONTEXT_INSTANCE"});k.prototype.add=function(e){let t=b.array(e);t&&(e=[e||{}]);let r=e.map(o=>I(u({},o),{id:P(),action:"add"}));return this.executor.run(r),t?r[0].id:r.map(o=>o.id)};k.prototype.delete=function(e){if(!e){this.executor.abort(),this.dispatcher.abort(),this.hook.abort();for(let r in this)delete this[r];return}b.array(e)&&(e=[e]);let t=e.map(r=>I(u({},r),{action:"del"}));this.executor.run(t)};k.prototype.find=function(e){return b.function(e)?null:Object.keys(this.members).find(t=>e({id:t}))};k.prototype.get=function(e={},t={}){let{members:r}=this,o="include"in t?t.include:[],i=o.includes("error"),l=o.includes("raw");return"prop"in e?Oo(r,e,i,l):Lo(r,e,i,l)};function Oo(e,t,r,o){let{id:i,prop:l}=t;if(!e[i])return null;let[a,n,s,p]=[null,null,null,null],d=ye(l);if(a=d in e[i]?e[i][d]:null,r){let c=Ee(l);n=e[i][c]||null}if(o){let c=ye(l,{raw:!0});if(s=c in e[i]?e[i][c]:null,r){let y=Ee(l,{raw:!0});p=e[i][y]||null}}return!r&&!o?a:r&&!o?{value:a,error:n}:r?{value:a,error:n,raw:{value:s,error:p}}:{value:a,raw:{value:s}}}function Lo(e,t,r,o){let{id:i}=t,[l,a,n,s]=[{},null,{},null];return e[i]?(Object.keys(e[i]).forEach(p=>{let d=e[i][p];if(p.startsWith(tt))return l[p.replace(tt,"")]=d;if(d&&r&&p.startsWith(rt))return a||(a={}),a[p.replace(rt,"")]=d;if(o&&p.startsWith(Qe))return n[p.replace(Qe,"")]=d;if(d&&o&&r&&p.startsWith(et))return s||(s={}),s[p.replace(et,"")]=d}),!o&&!r?l:r&&!o?{values:l,errors:a}:r?{values:l,errors:a,raw:{values:n,errors:s}}:{values:l,raw:{values:n}}):null}k.prototype.naming=function(e=""){return{prop:ye(e),error:Ee(e),raw:{prop:ye(e,{raw:!0}),error:Ee(e,{raw:!0})}}};k.prototype.set=function(e){if(!e)return;b.array(e)&&(e=[e]);let t=e.map(r=>I(u({},r),{action:"set"}));this.executor.run(t)};k.prototype.subscribe=function(e={},t){let r={id:e.id,event:"after-mutation"},o="immediately"in e?e.immediately:!0,i=this.dispatcher.add(r,t);return o&&this.dispatcher.trigger(r,t),i};var Ne={type:"Fieldset"};function He(e,t={}){let r=e._storeOfSchema||(e._storeOfSchema={});return t===void 0?e._storeOfSchema:(Object.assign(r,G.collect(t,["parseExpression","parseReference"])),r)}var Oe="when",Ae="then",Ie="else",ne="and",se="or",le="not",we="_";function Te(e){return b.object(e)?!1:Oe in e&&Ae in e}function Se(e){return b.object(e)?!1:Ie in e}function pe(e){return Te(e)||Se(e)}function ot(e){return b.array(e)?!1:!e.some(t=>!pe(t))}var Ke=class{static isConditionObject(t){return pe(t)}static isConditionArray(t){return ot(t)}static isCondition(t){return pe(t)||ot(t)}static isntCondition(t){return!Ke.isCondition(t)}static mustbeCondition(t,r=""){Ke.isCondition(t)||g({type:Ke.exceptions.INVALID_CONDITION,message:r||"Invalid condition statement."})}},K=Ke;T(K,"exceptions",{INVALID_CONDITION:"CONDITION_INVALID_CONDITION"});K.combine=function(e={}){let t=[],r=f.array(e.whens)?e.whens:[],o=f.object(e.else)?e.else:{};return r.forEach(i=>{b.object(i)&&(i={}),t.push({[Oe]:Ro(i.rules),[Ae]:i.result})}),t.push({[Ie]:o.result}),t};function Ro(e=[]){b.array(e)&&(e=[e]);let t=[ne,le].join(we),r=[se,le].join(we),o=[ne,se,le,t,r];return e.map(i=>{b.object(i)&&(i={});let l=o.includes(i.logic)?i.logic:"";if(!l)return i.expression;if([ne,se].includes(l))return{[l]:i.expression};let a=l.split(we);return{[a[0]]:{[a[1]]:i.expression}}})}K.extract=function(e){let[t,r]=[[],{result:void 0}];return K.isntCondition(e)?{whens:t,else:r}:(pe(e)&&(e=[e]),e.forEach(o=>{Te(o)?t.push({result:o[Ae],rules:ko(o[Oe])}):Se(o)&&(r={result:o[Ie]})}),{whens:t,else:r})};function ko(e=[]){return b.array(e)&&(e=[e]),e.map(t=>{if(b.object(t))return{logic:"",expression:t};let r=ne in t?ne:se in t?se:"";if(!r)return{logic:"",expression:t};let o=t[r];return f.object(o)&&le in o&&(r=[r,le].join(we),o=o[le]),{logic:r,expression:o}})}function vt(e={},t){let[r,o,i]=["unknown",e[Oe],-1];for(b.array(o)&&(o=[o]);++i<o.length;){let[l,a]=[o[i],[]];if(f.object(l)&&ne in l){if(i>0&&r!==!0)break;l=l[ne],a.push(ne)}else if(f.object(l)&&se in l){if(i>0&&r===!0)break;l=l[se],a.push(se)}f.object(l)&&le in l&&(l=l[le],a.push(le));let n=t(l);if(b.boolean(n)&&(n="unknown"),a.includes(le)&&f.boolean(n)&&(n=!n),a.includes(ne)){if(r=n,r!==!0)break}else if(a.includes(se)){if(r!==!0&&(r=n),r===!0)break}else r=n}return{truthy:r,result:e[Ae]}}function Nt(e={}){return{result:e[Ie]}}function Co(e){if(f.boolean(e))return e}K.parse=function(e,t){K.mustbeCondition(e),t===void 0&&(t=Co),h.function(t,'Condition "parseExpression"'),pe(e)&&(e=[e]);let r;return e.some(o=>{if(Te(o)){let{truthy:i,result:l}=vt(o,t);if(i===!0)return r=l,!0}else if(Se(o)){let{result:i}=Nt(o);return r=i,!0}return!1}),r};K.possibilities=function(e){K.mustbeCondition(e),pe(e)&&(e=[e]);let t=!1,r=e.map(o=>{if(Te(o))return o[Ae];if(Se(o))return t=!0,o[Ie]});return r=Q.unique(r),t||!r.includes(void 0)&&r.push(void 0),r};var ue=K;var Ye=/<<\s*([^(<<)(>>)\s]+)\s*>>/,lr=new RegExp(Ye,"g");function $e(e="",t={}){let{raw:r,flag:o,strict:i}=t;if(r)return`<< ${e} >>`;let l=`<<\\s*${e}\\s*>>`;return i&&(l=`^${l}$`),new RegExp(l,o)}function Tt(e){return b.string(e)?!1:!!e.match(Ye)}var qe=class{static isInterpolation(t){return Tt(t)}static isntInterpolation(t){return!qe.isInterpolation(t)}static mustbeInterpolation(t,r=""){qe.isInterpolation(t)||g({type:qe.exceptions.INVALID_INTERPOLATION,message:r||"Invalid interpolation statement."})}},X=qe;T(X,"exceptions",{INVALID_INTERPOLATION:"INVALID_INTERPOLATION"});function Ge(e=""){return e.match(lr)}function St(e=""){let t=e.match(Ye);return t?t[1]:null}X.references=function(e="",t={}){if(X.isntInterpolation(e))return null;let o=(Ge(e)||[]).map(i=>St(i));return t.unique!==!1&&(o=Q.unique(o)),o.length?o:null};X.parse=function(e="",t={}){X.mustbeInterpolation(e);let r=Ge(e),o=X.references(e,{unique:!1}),i=l=>f.function(t)?t(l):t[l];if(r.length===1){let l=$e(o[0],{strict:!0});if(e.match(l))return e=i(o[0])}return o.forEach((l,a)=>{e=e.replace(r[a],i(l))}),e};X.replace=function(e="",t={}){return X.mustbeInterpolation(e),Object.keys(t).forEach(r=>{let o=$e(t[r],{raw:!0});r=$e(r,{flag:"g"}),e=e.replace(r,o)}),e};var ge=X;var Ot=class{constructor(t={}){He(this,t)}static create(...t){return new Ot(...t)}},ee=Ot;T(ee,"Condition",ue),T(ee,"Interpolation",ge);function Lt(e,t){return f.array(e)?e=e.map(r=>Lt(r,t)):f.object(e)?e=G.from(Object.keys(e).map(r=>[r,Lt(e[r],t)])):ge.isInterpolation(e)&&(e=ge.parse(e,t)),e}function Rt(e,t,r){if(f.array(e)){let o=ue.isConditionArray(e);e=e.map(i=>Rt(i,t,o))}else f.object(e)&&(e=G.from(Object.keys(e).map(o=>[o,Rt(e[o],t)])));return ue.isConditionArray(e)?e=ue.parse(e,t):ue.isConditionObject(e)&&!r&&(e=ue.parse(e,t)),e}ee.prototype.parse=function(e){let{parseReference:t,parseExpression:r}=He(this);return e=Lt(e,t),e=Rt(e,r),e};ee.prototype.possibilities=function(e){let t=null;return ue.isCondition(e)?(t=[],ue.possibilities(e).forEach(r=>{if(!ue.isCondition(r))return t.push(r);t=t.concat(this.possibilities(r))})):f.object(e)?Object.keys(e).forEach(r=>{let o=this.possibilities(e[r]);!o||(t=t?t.concat(o):o)}):f.array(e)&&e.forEach(r=>{let o=this.possibilities(r);!o||(t=t?t.concat(o):o)}),t&&Q.unique(t)};ee.prototype.references=function(e,t={}){let r=[];if(f.array(e))e.forEach(o=>{let i=this.references(o,t);i&&(r=r.concat(i))});else if(f.object(e))Object.keys(e).forEach(o=>{let i=this.references(e[o],t);i&&(r=r.concat(i))});else if(ge.isInterpolation(e)){let o=ge.references(e,t);o&&(r=r.concat(o))}return t.unique!==!1&&(r=Q.unique(r)),r.length?r:null};ee.prototype.replace=function(e,t={}){return f.array(e)?e=e.map(r=>this.replace(r,t)):f.object(e)?e=G.from(Object.keys(e).map(r=>[r,this.replace(e[r],t)])):ge.isInterpolation(e)&&(e=ge.replace(e,t)),e};var it=ee;function B(e={},t={}){return e._reactive||(e._reactive=u({},t))}var Fo={prop:()=>P(),default:null,schemable:!0,calculable:!0,validation:null,rawValidation:null},ar=Fo;function xe(e={},t={}){return e._i18n||(e._i18n=u({},t))}var Pe=class{constructor(){xe(this,{locales:{},locale:"en"})}static create(...t){return new Pe(...t)}static isI18n(t){return t instanceof Pe}static isntI18n(t){return!Pe.isI18n(t)}static mustbeI18n(t,r){Pe.isntI18n(t)&&g({type:Pe.exceptions.NOT_AN_INSTANCE,message:r||"Invalid i18n instance."})}},U=Pe;T(U,"exceptions",{NOT_AN_INSTANCE:"I18N_NOT_AN_INSTANCE_OF_I18N",UNSUPPORTED_LOCALE:"I18N_UNSUPPORTED_LOCALE"});var nr=".";function lt(e=""){return e.split(nr).map(t=>t.trim()).filter(t=>t.length)}function sr(e=[]){return e.map(t=>t.trim()).filter(t=>t.length).join(nr)}U.prototype.define=function(e="",t=""){let r=xe(this).locales;if(!arguments.length)return JSON.parse(JSON.stringify(r));if(b.object(e))return pr(r,e,t);Object.keys(e).forEach(o=>{if(b.object(e[o]))return pr(r,o,e[o]);let i=Object.keys(e[o]).map(l=>[sr([o,l]),e[o][l]]);this.define(G.from(i))})};function pr(e={},t="",r=""){h.nonblankString(t,"I18n locale path"),h.string(r,"I18n locale template");let[o,i]=["",lt(t)];for(;o=i.shift();){if(!(o in e))e[o]=i.length?{}:r;else{let l=e[o];i.length?f.string(l)&&(e[o]={_:l}):f.string(l)?e[o]=r:e[o]._=r}e=e[o]}}U.prototype.locale=function(e){if(!e)return xe(this).locale;xe(this).locale=e};function ur(e="",t="",r=""){let o=new RegExp(`{\\s*${t}\\s*}`,"g");if(f.string(r))return e.replace(o,r);try{r=JSON.stringify(r)}catch(i){r=String(r)}return e.replace(o,r)}U.prototype.translate=function(e="",t={}){let r="default"in t?t.default:"",o="variables"in t?t.variables:null;h.string(r,"Default i18n template"),o&&h.object(o,"I18n variables");let[i,l]=[lt(e),xe(this).locales],a=Do(l,[xe(this).locale].concat(i));return f.null(a)&&(a=r),!a||!o?a:Po(a,o)};U.prototype.t=U.prototype.translate;function Do(e={},t=""){let r="";return t.every((i,l)=>i in e?(e=e[i],l!==t.length-1||(r=f.string(e)?e:e._),!0):!1)?r:null}function Po(e="",t={}){return Object.keys(t).forEach(r=>{e=ur(e,r,t[r])}),e}U.prototype.try=function(e=[],t={}){let r="";return e.some(o=>{if(r=this.translate(o,t),r)return!0}),r};var Z=U.global=U.create();var cr={memberIsReferenced:"Member { id } is referenced.",conflictedMemberName:"Member name { name } has been occupied.",memberNameRequired:"Member name cannot be blank.",mustBelongsToValidParent:"{ memberType } members can only be inserted into { acceptedParentTypes } parents.",referenceNotFound:"Cannot find reference { reference } among members.",conditionNotComplete:"Condition must contain at lease one case.",conditionBranchNotComplete:"Condition branch must contain at least one rule.",conditionReferenceNotPresence:"Condition reference cannot be blank.",conditionLogicNotSupported:"Lack of valid and/or keyword.",conditionExpressionNotSupported:"Condition expression { expression } is not supported."};var fr={memberIsReferenced:"\u6210\u5458{ id }\u6B63\u5728\u88AB\u5F15\u7528\u3002",conflictedMemberName:"\u6210\u5458\u540D\u79F0{ name }\u5DF2\u88AB\u5360\u7528\u3002",memberNameRequired:"\u6210\u5458\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\u3002",mustBelongsToValidParent:"{ memberType }\u7C7B\u578B\u4E58\u5458\u53EA\u80FD\u4F5C\u4E3A{ acceptedParentTypes }\u7C7B\u578B\u5B50\u7EA7\u3002",referenceNotFound:"\u6210\u5458\u4E2D\u4E0D\u5B58\u5728\u5F15\u7528\u8DEF\u5F84{ reference }",conditionNotComplete:"\u6761\u4EF6\u5206\u652F\u81F3\u5C11\u8981\u5305\u542B\u4E00\u79CD\u60C5\u51B5\u3002",conditionBranchNotComplete:"\u6761\u4EF6\u5206\u652F\u5185\u81F3\u5C11\u8981\u5305\u542B\u4E00\u4E2A\u89C4\u5219\u3002",conditionReferenceNotPresence:"\u6761\u4EF6\u4F9D\u8D56\u4E0D\u80FD\u4E3A\u7A7A\u3002",conditionLogicNotSupported:"\u7F3A\u5C11\u5408\u6CD5\u7684\u4E0E\u6216\u5173\u952E\u5B57\u3002",conditionExpressionNotSupported:"\u6761\u4EF6\u8868\u8FBE\u5F0F{ expression }\u4E0D\u88AB\u652F\u6301\u3002"};Z.define({en:{reactive:cr},zh:{reactive:fr}});var H=Z;var mr=".",ce=["children","order","type","name"],ze="__REACTIVE_SCEHMA_REFERENCE__";function dr(e=""){let t=e.split(mr),r=t.pop();return{names:t,prop:r}}function We(e=[],t=""){return(t?e.concat(t):e).join(mr)}function hr(e,t){let[r,o]=[e.schema.references(t),{}];return r?(r.forEach(i=>{let l=e.schema.reference.parse(i),a=f.object(l);if(a&&(a=f.nonblankString(l.id)),a&&(a=f.nonblankString(l.prop)),a)return o[i]=JSON.stringify(l);g({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:H.t("reactive.referenceNotFound",{variables:{reference:i}})})}),e.schema.replace(t,o)):t}function br(e,t){let[r,o]=[e.schema.references(t),{}];return r?(r.forEach(i=>{let l=null;try{l=JSON.parse(i)}catch(s){return}let a=e.schema.reference.stringify(l);if(f.nonblankString(a))return o[i]=a;g({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:H.t("reactive.referenceNotFound",{variables:{reference:i}})})}),e.schema.replace(t,o)):t}function yr(e={},t={}){return u(u(u({},ar),t),e)}function Er(e={}){return Object.keys(e).forEach(t=>{b.function(e[t])||(e[t]=e[t]())}),e}function kt(e={}){let{id:t,prop:r}=e,o=this.get({id:t,prop:"type"}),{props:i,fallback:l}=B(this).installed[o].config.schema;if(!r)return i.map(s=>{let p=Er(yr(s,l));return ce.includes(p.prop)&&(p.schemable=p.calculable=!1),p});let a=i.find(s=>s.prop===r),n=Er(yr(a||l,l));return n.prop=r,ce.includes(r)&&(n.schemable=n.calculable=!1),n}function Ct(e="",t={}){var n,s;e=(this.schema.references(e)||[])[0]||e;let{names:r,prop:o}=dr(e),i=t.under||this.family.root(),[l,a]=[null,i.id];if(!r.length||this.family.hasnt({id:a}))return null;for(;l=r.shift();){if(a=(s=(n=this.family.descendant({id:a}))==null?void 0:n.find(y=>this.get({id:y.id,prop:"name"})===l))==null?void 0:s.id,!a)return null;let p=this.get({id:a,prop:"type"}),c=B(this).installed[p].config.schema.reference.parse;if(c)return e=We(r,o),c.call(this,{id:a},e)}return{id:a,prop:o}}function Ft(e={},t={}){let{id:r,prop:o}=e,i=t.under||this.family.root(),l=(()=>t.format!=="interpolation"?d=>d:d=>d&&`<< ${d} >>`)();if(this.family.hasnt({id:r}))return"";let a=this.family.ancestor({id:r},{deep:!0,self:!0}),[n,s]=[a.findIndex(d=>d.id===i.id),[]];if(n<0||(a=a.slice(0,n),!a.length))return"";let p=null;for(;p=a.pop();){s.push(this.get({id:p.id,prop:"name"}));let d=this.get({id:p.id,prop:"type"}),y=B(this).installed[d].config.schema.reference.stringify;if(y){let N=We(s),S=y.call(this,{id:p.id,reference:N},o);return l(S)}}return l(We(s,o))}function Dt(e){let t=it.create({parseReference(r){return e.get(JSON.parse(r))},parseExpression(r={}){return e.validator.mustbeSupported(r),!e.validator.error(r)}});return t.for=kt.bind(e),t.reference={parse:Ct.bind(e),stringify:Ft.bind(e)},t}var gr={validators:{dataType:{label:"Data Type",invalidValue:"Must be a data type within { rule }."},equalTo:{label:"Equal To",invalidValue:"Must be equal to { rule }."},isInteger:{label:"Is Integer",invalidValue:"{ value } is not an integer."},maxLength:{label:"Max Length",invalidRule:'Rule of "maxLength" validator must be a positive integer.',invalidValue:"Maximum length is { rule }."},presence:{label:"Presence",invalidValue:"Musn't be blank."},withFormat:{label:"With Format",invalidRule:'Rule of "withFormat" validator must be a regexp or a string wrapped with "/".',invalidValue:"Must match format { rule }."}}};var xr={validators:{dataType:{label:"\u6570\u636E\u7C7B\u578B",invalidValue:"\u6570\u636E\u7C7B\u578B\u5FC5\u987B\u662F{ rule }\u3002"},equalTo:{label:"\u7B49\u4E8E",invalidValue:"\u5FC5\u987B\u7B49\u4E8E{ rule }\u3002"},isInteger:{label:"\u662F\u6574\u6570",invalidValue:"{ value }\u4E0D\u662F\u4E00\u4E2A\u6574\u6570\u3002"},maxLength:{label:"\u6700\u5927\u957F\u5EA6",invalidRule:"\u6700\u5927\u957F\u5EA6\u7684\u6821\u9A8C\u89C4\u5219\u5FC5\u987B\u662F\u4E00\u4E2A\u6B63\u6574\u6570\u3002",invalidValue:"\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7{ rule }\u3002"},presence:{label:"\u4E0D\u4E3A\u7A7A",invalidValue:"\u4E0D\u80FD\u4E3A\u7A7A\u3002"},withFormat:{label:"\u7B26\u5408\u683C\u5F0F",invalidRule:"\u683C\u5F0F\u6821\u9A8C\u7684\u89C4\u5219\u5FC5\u987B\u662F\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\u6216\u88AB\u201C/\u201D\u5305\u62EC\u7684\u5B57\u7B26\u4E32\u3002",invalidValue:"\u5FC5\u987B\u7B26\u5408\u683C\u5F0F{ rule }\u3002"}}};Z.define({en:{validator:gr},zh:{validator:xr}});var te=Z;var Ar={name:"dataType",ruleType:["String","Array"],valueType:"*",validate(e,t){if(!_.within({type:_.get(e),types:t}))return te.t("validator.validators.dataType.invalidValue",{variables:{value:e,rule:t}})}};function Ir(e,t){if(e===t)return!0;if(typeof e!="object"||typeof t!="object"||e==null||t==null)return!1;let[r,o]=[Object.keys(e),Object.keys(t)];if(r.length!==o.length)return!1;for(let i of r)if(!o.includes(i)||!Ir(e[i],t[i]))return!1;return!0}var _r={name:"equalTo",ruleType:"*",valueType:"*",validate(e,t){if(!Ir(e,t))return te.t("validator.validators.equalTo.invalidValue",{variables:{value:e,rule:t}})}};var vr={name:"isInteger",valueType:"Number",validate(e){if(!f.integer(e))return te.t("validator.validators.isInteger.invalidValue",{variables:{value:e}})}};var Nr={name:"maxLength",ruleType:"Number",valueType:["String","Array"],validateRule(e){if(!f.positiveInteger(e))return te.t("validator.validators.maxLength.invalidRule")},validate(e,t){if(e.length>t)return te.t("validator.validators.maxLength.invalidValue",{variables:{value:e,rule:t}})}};var Tr={name:"presence",valueType:"*",validate(e){if(f.blank(e))return te.t("validator.validators.presence.invalidValue",{variables:{value:e}})}};var Sr=/^\/(.+)\/$/,Or={name:"withFormat",ruleType:["RegExp","String"],valueType:"String",validateRule(e){if(!f.regexp(e)&&!(f.string(e)&&e.match(Sr)))return te.t("validator.validators.withFormat.invalidRule",{variables:{rule:e}})},validate(e,t){if(f.string(t)&&(t=new RegExp(t.match(Sr)[1])),!e.match(t))return te.t("validator.validators.withFormat.invalidValue",{variables:{value:e,rule:t}})}};var Lr=[Tr,Ar,vr,Or,_r,Nr];function M(e={},t={}){return e._validator||(e._validator=u({},t))}var Pt=class{constructor(){M(this,{installed:{}}),Lr.forEach(t=>this.install(t))}static create(...t){return new Pt(...t)}},x=Pt;T(x,"exceptions",{CONFLICTED_NAME:"VALIDATOR_CONFLICTED_NAME",VALIDATION_FAILED:"VALIDATOR_VALIDATION_FAILED",UNSUPPORTED_VALIDATION:"VALIDATOR_UNSUPPORTED_VALIDATION",UNSUPPORTED_VALIDATION_RULE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE",UNSUPPORTED_VALIDATION_RULE_TYPE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE_TYPE"});var Vo="valOf";function at(e={}){let t={};return"value"in e&&(t[Vo]=e.value),e.name&&(t[e.name]=void 0,"rule"in e&&(t[e.name]=e.rule)),t}x.prototype.combineValidation=function(e={}){let{installed:t}=M(this);return e.name in t?at(I(u({},e),{rule:t[e.name].ruleType?e.rule:!0})):at(e)};var Rr="valOf";function Ve(e={}){let t=e[Rr];e=G.exclude(e,[Rr]);let r=Object.keys(e)[0],o=e[r];return{name:r,rule:o,value:t}}x.prototype.mustbeSupported=function(e={},t={}){h.object(e,"Validation struct");let r="strict"in t?t.strict:!0,{name:o,rule:i}=Ve(e),{installed:l}=M(this),a=l[o];if(!a&&g({type:x.exceptions.UNSUPPORTED_VALIDATION,message:`Unsupported validator "${o}"`}),!(!r||!a.ruleType)){try{_.mustWithin({type:_.get(i),types:a.ruleType})}catch(n){g({type:x.exceptions.UNSUPPORTED_VALIDATION_RULE_TYPE,message:n.message||"Unsupported validation rule data type."})}if(!!a.validateRule)try{let n=a.validateRule(i);if(n)throw new Error(n)}catch(n){g({type:x.exceptions.UNSUPPORTED_VALIDATION_RULE,message:n.message||"Unsupported validation rule."})}}};x.prototype.error=function(e={},t){let r=null;try{this.mustbeSupported(e)}catch(o){r=o}if(!r){let{installed:o}=M(this),{name:i,rule:l,value:a}=Ve(e);arguments.length>1&&(a=t);let n=o[i],[s,p]=[_.get(a),n.valueType];try{_.mustWithin({type:s,types:p})}catch(d){r=d}r||(r=n.validate(a,l))}return r?F.create({type:x.exceptions.VALIDATION_FAILED,message:(()=>{let o="Not valid.";return f.string(r)?r:r instanceof Error&&r.message||o})()}):null};x.prototype.extractValidation=function(e={}){let{installed:t}=M(this),r=Ve(e);return r.name in t&&(t[r.name].ruleType||(r.rule=!0)),r};x.prototype.for=function(e="*",t={}){let[r,o]=[[],M(this).installed],i="except"in t?t.except:[];return b.array(i)&&(i=[i]),Object.values(o).forEach(l=>{i.includes(l.name)||!_.within({type:e,types:l.valueType})||r.push(u({},l))}),r.length?r:null};x.prototype.get=function(e=""){let t=M(this).installed;return e in t?u({},t[e]):null};x.prototype.install=function(e={}){h.object(e,"Validator installer");let{name:t,valueType:r,ruleType:o,validate:i,validateRule:l}=e;h.nonblankString(t,'Validator installer "name"'),h.type(r,'Validator installer "valueType"'),h.function(i,'Validator installer "validate"'),o&&h.type(o,'Validator installer "ruleType"'),l&&h.function(l,'Validator "validateRule"');let{installed:a}=M(this);t in a&&g({type:x.exceptions.CONFLICTED_NAME,message:`Validator name ${t} has been occupied.`}),a[t]=I(u({},e),{name:t,valueType:r,ruleType:o,validate:i,validateRule:l})};x.prototype.isSupported=function(...e){try{this.mustbeSupported(...e)}catch(t){return!1}return!0};x.prototype.isValid=function(...e){return!this.error(...e)};x.prototype.isntSupported=function(...e){return!this.isSupported(...e)};x.prototype.isntValid=function(...e){return!this.isValid(...e)};x.prototype.uninstall=function(e=""){let{installed:t}=M(this);e in t&&delete t[e]};function Vt(e){return x.create()}function wt(e){return D.create()}function Xe(e,t){!(t in B(e).installed)&&g({type:e.exceptions.UNINSTALLED_MEMBER_TYPE,message:`Member type ${t} is not installed.`})}function wo(e,t={},r){let{hook:o,handler:i}=t;return b.array(o)&&(o=[o]),b.array(i)&&(i=[i]),i=i.map(l=>l.bind(e)),r?(i=i.map(l=>(a,...n)=>{let s=e.get({id:a.id,prop:"type"});if(s||(s=(a.props||{}).type||"default"),Xe(e,s),s===r)return l(a,...n)}),{hook:o,handler:i}):{hook:o,handler:i}}function Ut(e,t={}){if(!e)return;let r=t.only;b.array(e)&&(e=[e]),e.forEach(o=>{let{hook:i,handler:l}=wo(this,o,r);i.forEach(a=>l.forEach(n=>this.hooks.add(a,n)))})}function Mt(e){return e.hooks.mount=Ut.bind(e),e.hooks}function jt(e){let t=e.get;return e.get=function(r={},o={}){let{id:i,prop:l}=r,a=t.call(e,r,o);if(!a||!a.raw)return a;if("prop"in r){let n=a.raw.value;a.raw.value=kr(e,i,l,n)}else Object.keys(a.raw.values).forEach(n=>{let s=a.raw.values[n];a.raw.values[n]=kr(e,i,n,s)});return a}}function kr(e,t,r,o){return ce.includes(r)||!e.schema.for({id:t,prop:r}).schemable?o:br(e,o)}function Cr(e={}){let{installed:t}=B(this),r=e.type,o=f.function(e.collect)?e.collect:null,i=f.function(e.seed)?e.seed:null,l="hooks"in e?e.hooks:[],a="schema"in e?e.schema:{},n="props"in a?a.props:[],s="fallback"in a?a.fallback:{},p="reference"in a?a.reference:{},d="parse"in p?p.parse:null,c="stringify"in p?p.stringify:null;h.nonblankString(r,'Reactive Member "type"'),i&&h.function(i,'Reactive Member "seed"'),o&&h.function(o,'Reactive Member "collect"'),d&&h.function(d,'Reactive Member "schema.reference.parse"'),c&&h.function(c,'Member "schema.reference.stringify"'),h.array(n,'Reactive Member "schema.props"'),h.object(s,'Reactive Member "schema.fallback"'),h.array(l,'Reactive Member "hooks"'),n.forEach(y=>h.object(y,"Reactive Member prop schema")),l=l.flat(1/0),l.forEach(y=>{let{hook:N,handler:S,scope:C}=y;C&&h.nonblankString(C,'Reactive Member hook "scope"'),N=f.array(N)?N:[N],S=f.array(S)?S:[S],N.forEach(V=>h.nonblankString(V,'Reactive Member hook "type"')),S.forEach(V=>h.function(V,'Reactive Member hook "handler"'))}),r in t&&g({type:this.exceptions.CONFLICTED_MEMBER_TYPE,message:`Reactive Member type '${r}' has been occupied.`}),t[r]={config:{type:r,hooks:l,collect:o,seed:i,schema:{fallback:s,props:n,reference:{parse:d,stringify:c}}}},l.forEach(y=>{if(!y.scope)return this.hooks.mount(y,{only:r});let N=f.array(y.hook)?y.hook:[y.hook];(f.array(y.handler)?y.handler:[y.handler]).forEach(C=>N.forEach(V=>{Object.keys(t).some(J=>J!==r&&t[J].config.hooks.some(q=>{let Le=f.array(q.hook)?q.hook:[q.hook],Gt=f.array(q.handler)?q.handler:[q.handler];return q.scope===y.scope&&Gt.includes(C)&&Le.includes(V)}))||this.hooks.mount(I(u({},y),{hook:V,handler:C}),{only:y.scope})}))})}function Bt(e={},t={}){let{id:r}=e;if(this.family.hasnt({id:r}))return null;let o="errors"in t?t.errors:!0,[i,l]=[t.only||[],t.except||[]];b.array(i)&&(i=[i]),b.array(l)&&(l=[l]);let{values:a,raw:n}=Fr(this,r);if(a=Ht(this,a,i,l),n.values=Ht(this,n.values,i,l),!o)return{values:a,raw:n};let[s,p]=Uo(this,r);return{values:a,errors:s,raw:I(u({},n),{errors:p})}}function Fr(e,t){let r=e.get({id:t,prop:"type"}),o=B(e).installed[r].config.collect;if(o){let n=o.call(e,{id:t});return n||(n={}),n.values||(n.values={}),n.raw||(n.raw={}),n.raw.values||(n.raw.values={}),n}let{values:i,raw:l}=e.get({id:t},{include:"raw"});i.children=[],l.values.children=[];let a=e.family.descendant({id:t});return a?(a.forEach(n=>{let s=Fr(e,n.id);i.children.push(s.values),l.values.children.push(s.raw.values)}),{values:i,raw:l}):{values:i,raw:l}}function Ht(e,t={},r=[],o=[]){return Object.keys(t).forEach(i=>{r.length&&!r.includes(i)&&delete t[i],o.length&&o.includes(i)&&delete t[i]}),t.children&&t.children.forEach((i,l)=>{t.children[l]=Ht(e,i,r,o)}),t}function Uo(e,t){let[r,o]=[[],[]];return e.family.descendant({id:t},{deep:!0,self:!0}).forEach(({id:l})=>{let a=e.get({id:l},{include:["raw","error"]});a.errors&&r.push({id:l,errors:a.errors}),a.raw.errors&&o.push({id:l,errors:a.raw.errors})}),[r.length?r:null,o.length?o:null]}function Kt(e={},t={},r={}){let o="execute"in r?r.execute:!0;if(o&&this.family.hasnt({id:e.id}))return;let[i,l,a]=[null,[{id:e.id,props:t}],[]];for(;i=l.shift();){let[n,s]=[i.id,i.props],p=this.family.has({id:n}),d=(()=>p?this.get({id:n,prop:"type"}):s.type||"default")(),c=B(this).installed[d].config.seed;if(c){let y=c.call(this,{id:n},s);y&&(a=a.concat(y))}else Object.keys(s).forEach(y=>{if(y!=="children"){let C={action:"set",id:n,prop:y,value:s[y]};return a.push(C)}let[N,S]=[n,this.family.descendant({id:n})||[]];s.children.forEach((C,V)=>{if(S[V])return l.push({id:S[V].id,props:C});let[O,J,q]=[P(),C.name,C.type||"default"],Le={action:"add",parentId:N,id:O,props:{type:q,name:J}};a.push(Le),l.push({id:O,props:I(u({},C),{type:q})})})})}return o?this.executor.run(a):a}var Mo=[{hook:"before-add",handler(e){let t=(e.props||{}).type||"default";Xe(this,t)}}],Dr=Mo;var jo=[{hook:"before-del",handler(e){let{id:t}=e,{family:r,dependency:o}=this,i=r.descendant({id:t},{self:!0}),l={self:!1,group:ze};o.reliers(i,l)&&g({type:this.exceptions.CONSTRAINTS_EXIST,message:H.t("reactive.memberIsReferenced",{variables:{id:t}})})}}],Pr=jo;var Bo=[{hook:"after-add",handler(e){let[t,r]=[e.id,(e.props||{}).type||"default"],[o,i]=[this.members,this.naming("type")];o[t][i.raw.prop]=o[t][i.prop]=r,o[t][i.raw.error]=o[t][i.error]=null}},{hook:"before-del",handler(e){let t=this.get({id:e.id,prop:"type"});e.props||(e.props={}),e.props.type=t}}],Vr=Bo;var Ho=[{hook:"before-add",handler(e){let{id:t,props:r}=e;r||(e.props={}),e.props.name||(e.props.name=t)}},{hook:"after-add",handler(e){let{id:t,props:r}=e,[o,i]=[this.members,this.naming("name")];o[t][i.raw.prop]=o[t][i.prop]=r.name,o[t][i.raw.error]=o[t][i.error]=null}},{hook:"after-set",handler(e){let{id:t,prop:r,value:o}=e;if(r!=="name")return;let[i,l]=[this.members,this.naming("name")];i[t][l.raw.prop]=i[t][l.prop]=o,i[t][l.raw.error]=i[t][l.error]=null}}],wr=Ho;var Ko=[{hook:["before-set","before-calc"],handler(e){if(e.prop==="type")return!1}}],Ur=Ko;function Mr(e,t,r){let o=e.family.sibling({id:t});!o||o.find(({id:i})=>e.get({id:i,prop:"name"})===r)&&g({type:e.exceptions.CONFLICTED_MEMBER_NAME,message:H.t("reactive.conflictedMemberName",{variables:{name:r}})})}var Yo=[{hook:"after-add",handler(e){let{id:t}=e,r=this.get({id:t,prop:"name"});ft.blank(r,H.t("reactive.memberNameRequired")),Mr(this,t,r)}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(r!=="name")return;let o=this.get({id:t,prop:r},{include:["error","raw"]});if(o.raw.error){let i=`Skipping validating name of member ${t},`;return i+=" since prev errors exist.",console.warn(i,o.raw.error)}try{ft.blank(o.raw.value,H.t("reactive.memberNameRequired")),Mr(this,t,o.raw.value)}catch(i){this.members[t][this.naming(r).raw.error]=[i]}}}],jr=Yo;var $o=[{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(ce.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let i=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(i.raw.error){let p=`Skipping validating ${r} schema of member ${t},`;return p+=" since previous errors exist.",console.warn(p,i.raw.error)}let l=this.schema.constructor.Condition;if(!l.isCondition(i.raw.value))return;let a=l.extract(i.raw.value),[n,s]=[this.members,this.naming(r)];if(!a.whens.length){n[t][s.raw.error]=[F.create({type:l.exceptions.INVALID_CONDITION,message:H.t("reactive.conditionNotComplete")})];return}a.whens.some(p=>!p.rules||!p.rules.length?(n[t][s.raw.error]=[F.create({type:l.exceptions.INVALID_CONDITION,message:H.t("reactive.conditionBranchNotComplete")})],!0):p.rules.some((d,c)=>{let{logic:y,expression:N}=d;if(c!==0&&!["and","or"].includes(y)){let V="reactive.conditionLogicNotSupported";return n[t][s.raw.error]=[F.create({type:l.exceptions.INVALID_CONDITION,message:H.t(V,{variables:{logic:y}})})],!0}if(b.object(N)||f.blank(N.valOf)){let V="reactive.conditionReferenceNotPresence";return n[t][s.raw.error]=[F.create({type:l.exceptions.INVALID_CONDITION,message:H.t(V)})],!0}if(this.validator.isSupported(N,{strict:!0}))return!1;let C="reactive.conditionExpressionNotSupported";return n[t][s.raw.error]=[F.create({type:l.exceptions.INVALID_CONDITION,message:H.t(C,{variables:{expression:N}})})],!0}))}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(ce.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let i=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(i.raw.error){let n=`Skipping translating ${r} schema of member ${t},`;return n+=" since previous errors exist.",console.warn(n,i.raw.error)}let[l,a]=[this.members,this.naming(r)];try{l[t][a.raw.prop]=hr(this,i.raw.value)}catch(n){l[t][a.raw.error]=[n]}}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,{schema:o,dependency:i,family:l,members:a}=this;if(ce.includes(r)||!o.for({id:t,prop:r}).schemable)return;i.delete({id:t,prop:r},{only:"relier",group:ze});let s=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(s.raw.error){let c="Skipping adding new associations for";return c+=` member ${t}'s ${r} since previous errors exist.`,console.warn(c,s.raw.error)}let p=o.references(s.raw.value);if(!p)return;let d=p.map(c=>({relier:{id:t,prop:r},provider:JSON.parse(c)}));d.forEach(c=>{let{provider:y,relier:N}=c,S={self:!0,deep:!0},C=l.ancestor({id:y.id},S);C.forEach((V,O)=>{O!==C.length-1&&d.push({relier:N,provider:{id:V.id,prop:"name"}})})});try{i.add(d,{group:ze})}catch(c){a[t][this.naming(r).raw.error]=[c]}}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(ce.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let o=this.constructor.prototype.get,{value:i,error:l}=o.call(this,{id:t,prop:r},{include:"error"}),[a,n]=[this.members,this.naming(r)];if(l){a[t][n.prop]=null;let s=`Skipping parsing ${r} schema of member ${t},`;return s+=" since previous errors exist.",console.warn(s,l)}try{a[t][n.prop]=this.schema.parse(i)}catch(s){a[t][n.prop]=null,a[t][n.error]=[s],console.warn(`Failed to parse ${r} schema of member ${t}.`,s)}}}],Br=$o;var qo=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(ce.includes(r))return;let o=this.schema.for({id:t,prop:r});if(!o.schemable||!o.calculable)return;let i=this.constructor.prototype.get,{value:l,error:a}=i.call(this,{id:t,prop:r},{include:"error"}),[n,s]=[this.members,this.naming(r)];if(a){let p=`Skipping trying to calculate ${r} of member ${t},`;return p+=" since previous errors exist.",console.warn(p,a)}if(!!this.calculator.isSupported(l,{strict:!1}))try{n[t][s.prop]=this.calculator.calculate(l)}catch(p){n[t][s.error]=[p],console.warn(`Failed to calculate ${r} of member ${t}.`,p)}}}],Hr=qo;var Go=[{hook:"after-add",handler(e,t){let[r,o]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(i=>{o.find(l=>l.prop===i.prop)||o.push({id:r,prop:i.prop,value:i.default})})}}],Kr=Go;var zo=[{hook:"after-add",handler(e,t){let[r,o]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(i=>{if(!("always"in i))return;let l=o.find(a=>a.prop===i.prop);if(l)return l.value=i.always;o.push({id:r,prop:i.prop,value:i.always})})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:o}=e,i=this.schema.for({id:t,prop:r});"always"in i&&o!==i.always&&(e.value=i.always)}}],Yr=zo;var Wo=[{hook:"after-add",handler(e,t){let[r,o]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(i=>{!i.validation||o.find(l=>l.prop===i.prop)||o.push({id:r,prop:i.prop,value:i.default||null})})}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,o=this.get({id:t,prop:r},{include:["error","raw"]}),{value:i,error:l}=o.raw,a=`${x.exceptions.VALIDATION_FAILED}_RAW`;if($r(l,{exclude:a})){let N=`Skipping validating raw ${r} of member ${t},`;return N+=" since previous errors exist.",console.warn(N,l)}let n=this.schema.constructor.Condition,s=this.schema.for({id:t,prop:r}).rawValidation,[p,d]=[this.members,this.naming(r)],c=d.raw.error;if(!s||(i=n.isCondition(i)?this.schema.possibilities(i):[i],i.some(N=>{if(l=qr(this,{id:t,prop:r,value:N,validation:s}),l)return!0}),!l))return p[t][c]=null;p[t][c]=[Gr(l,{type:a})]}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e,{value:o,error:i}=this.get({id:t,prop:r},{include:"error"}),l=x.exceptions.VALIDATION_FAILED;if($r(i,{exclude:l})){let p=`Skipping validating ${r} of member ${t},`;return p+=" since previous errors exist.",console.warn(p,i)}let{validation:a}=this.schema.for({id:t,prop:r}),[n,s]=[this.members,this.naming(r)];if(!a||(i=qr(this,{id:t,prop:r,value:o,validation:a}),!i))return n[t][s.error]=null;n[t][s.error]=[Gr(i,{type:l})]}}];function $r(e,t={}){if(!e)return!1;b.array(e)&&(e=[e]);let r=f.array(t.exclude)?t.exclude:[t.exclude];if(e=e.find(o=>!r.includes(o.type)),e)return!0}function qr(e,t={}){let{id:r,prop:o,value:i,validation:l}=t;b.array(l)&&(l=[l]);let[a,n]=[null,l.find(s=>"presence"in s)];return n||b.blank(i)?(l.some(s=>{try{return f.function(s)?a=s.call(e,{id:r,prop:o,value:i}):a=e.validator.error(s,i)}catch(p){return a=p}}),a):a=null}function Gr(e={},t={}){let r=f.string(e)?e:e.message||e.name;return F.create({type:t.type,message:r})}var zr=Wo;var Wr=[];function Yt(e={}){let t=e.accept;b.array(t)&&(t=[t]),t.forEach(o=>h.nonblankString(o));let r=Wr.find(o=>o.accept.length!==t.length?!1:!o.accept.some(i=>!t.includes(i)));return r||(r={accept:t,HOOKS:[{hook:"before-add",handler(o){let i=(o.props||{}).type||"default",l=this.get({id:o.parentId,prop:"type"});!t.includes(l)&&g({type:this.exceptions.INVALID_PARENT,message:H.t("reactive.mustBelongsToValidParent",{variables:{memberType:i,acceptedParentTypes:t}})})}}]},Wr.push(r)),r.HOOKS}var $t={CONFLICTED_MEMBER_TYPE:"REACTIVE_CONFLICTED_MEMBER_TYPE",UNINSTALLED_MEMBER_TYPE:"REACTIVE_UNINSTALLED_MEMBER_TYPE",CONSTRAINTS_EXIST:"REACTIVE_CONSTRAINTS_EXIST",CONFLICTED_MEMBER_NAME:"REACTIVE_CONFLICTED_MEMBER_NAME",REFERENCED_PROVIDER_NOT_FOUND:"REACTIVE_REFERENCED_PROVIDER_NOT_FOUND",INVALID_PARENT:"REACTIVE_INVALID_PARENT",HOOK_NOT_EXIST:"REACTIVE_HOOK_NOT_EXIST",VALIDATION_FAILED:"REACTIVE_VALIDATION_FAILED"},nt={ENABLE_SCHEMA_DEFAULT:Kr,ENABLE_SCHEMA_ALWAYS:Yr,ENABLE_SCHEMA_VALIDATION:zr,BLOCK_INVALID_PARENT:Yt};function A(){let e=k.create();B(e,{installed:{}}),e.guid=P,e.exceptions=$t,e.seed=Kt.bind(e),e.collect=Bt.bind(e),e.install=Cr.bind(e),e.get=jt(e),e.schema=Dt(e),e.validator=Vt(e),e.calculator=wt(e),e.hooks=Mt(e),e.hooks.mount(Dr),e.hooks.mount(Pr),e.hooks.mount(Vr),e.hooks.mount(wr),e.hooks.mount(Ur),e.hooks.mount(jr),e.hooks.mount(Br),e.hooks.mount(Hr),e.install({type:"default",schema:{props:[{prop:"name"}]}});let t=e.members[e.family.root().id],r=e.naming("type");return t[r.raw.prop]=t[r.prop]="default",e}A.guid=P;A.exceptions=$t;A.hooks={use(e,...t){return!(e in nt)&&g({type:$t.HOOK_NOT_EXIST}),b.function(nt[e])?nt[e]:nt[e](...t)}};Ne.hooks=[A.hooks.use("ENABLE_SCHEMA_DEFAULT"),A.hooks.use("ENABLE_SCHEMA_VALIDATION")];var Xr={schema:{props:{name:{label:"Fieldset Name"},label:{label:"Fieldset Title",default:""},description:{label:"Fieldset Description",default:""}}}};var Zr={schema:{props:{name:{label:"\u8F93\u5165\u9879\u96C6\u5408Name"},label:{label:"\u8F93\u5165\u9879\u96C6\u5408\u6807\u9898",default:""},description:{label:"\u8F93\u5165\u9879\u96C6\u5408\u63CF\u8FF0",default:""}}}};Z.define({en:{form:{fieldset:Xr}},zh:{form:{fieldset:Zr}}});var re=Z;Ne.schema={fallback:{prop:()=>A.guid(),label:()=>A.guid(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>re.t("form.fieldset.schema.fallback.placeholder"),hint:()=>re.t("form.fieldset.schema.fallback.hint")},props:[{prop:"name",label:()=>re.t("form.fieldset.schema.props.name.label"),placeholder:()=>re.t("form.fieldset.schema.props.name.placeholder"),hint:()=>re.t("form.fieldset.schema.props.name.hint")},{prop:"label",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>re.t("form.fieldset.schema.props.label.default"),label:()=>re.t("form.fieldset.schema.props.label.label"),placeholder:()=>re.t("form.fieldset.schema.props.label.placeholder"),hint:()=>re.t("form.fieldset.schema.props.label.hint")},{prop:"description",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>re.t("form.fieldset.schema.props.description.default"),label:()=>re.t("form.fieldset.schema.props.description.label"),placeholder:()=>re.t("form.fieldset.schema.props.description.placeholder"),hint:()=>re.t("form.fieldset.schema.props.description.hint")}]};var m=class{};T(m,"GROUP_NAME","field"),T(m,"PARENT_TYPE","Fieldset"),T(m,"exceptions",{PROP_SCHEMA_NOT_EXIST:"FIELD_PROP_SCHEMA_NOT_EXIST",HOOK_NOT_EXIST:"FIELD_HOOK_NOT_EXIST",INVALID_PARENT:"FIELD_INVALID_PARENT",UNINSTALLED_TYPE:"FIELD_UNINSTALLED_TYPE"});m.extend=function(e={}){let{type:t,hooks:r,schema:o}=u({},e);return!r&&(r=m.hooks.default()),!o&&(o=m.schema.default()),!o.fallback&&(o.fallback=m.schema.default("fallback")),!o.props&&(o.props=m.schema.default("props")),I(u({},e),{group:m.GROUP_NAME,type:t,hooks:r,schema:o})};var Jr={schema:{props:{name:{label:"Name"},label:{label:"Label",default:"Form Field"},value:{label:"Value"},placeholder:{label:"Placeholder",default:""},editable:{label:"If Editable"},visible:{label:"If Visible"},validation:{label:"Validation",notSupported:"Unsupported validation { name }.",notSupportedRule:"Validation rule { rule } is not supported by { name }."},calculation:{label:"Calculation",placeholder:'E.g, {add: ["<< fields.age.value >>", "<< fields.count.value >>"]}',notSupported:"Unsupported calculation algorithm { name }."},options:{label:"Options",mustbeUnique:"Option value must be unique.",optionLabel:"Option"}}},textField:{schema:{props:{label:{default:"Text Field"}}}},numberField:{schema:{props:{label:{default:"Number Field"}}}},singleSelectField:{schema:{props:{label:{default:"Single Select"}}}},multipleSelectField:{schema:{props:{label:{default:"Multiple Select"}}}},radioField:{schema:{props:{label:{default:"Radio Field"}}}},checkboxField:{schema:{props:{label:{default:"Checkbox Field"}}}}};var Qr={schema:{props:{name:{label:"\u8F93\u5165\u9879Name"},label:{label:"\u6807\u9898",default:"\u8F93\u5165\u9879"},value:{label:"\u521D\u59CB\u503C"},placeholder:{label:"\u5360\u4F4D\u7B26",default:""},editable:{label:"\u662F\u5426\u53EF\u7F16\u8F91"},visible:{label:"\u662F\u5426\u53EF\u89C1"},validation:{label:"\u6821\u9A8C\u89C4\u5219",notSupported:"\u4E0D\u88AB\u652F\u6301\u7684\u6821\u9A8C{ name }\u3002",notSupportedRule:"\u4E0D\u88AB{ name }\u652F\u6301\u7684\u6821\u9A8C\u89C4\u5219{ rule }\u3002"},calculation:{label:"\u8BA1\u7B97\u89C4\u5219",placeholder:'\u4F8B\u5982: {add: ["<< fields.age.value >>", "<< fields.count.value >>"]}',notSupported:"\u4E0D\u88AB\u652F\u6301\u7684\u8BA1\u7B97{ name }\u3002"},options:{label:"\u9009\u9879",mustbeUnique:"\u9009\u9879\u503C\u4E0D\u80FD\u91CD\u590D\u3002",optionLabel:"\u9009\u9879"}}},textField:{schema:{props:{label:{default:"\u5355\u884C\u6587\u672C"}}}},numberField:{schema:{props:{label:{default:"\u6570\u5B57"}}}},singleSelectField:{schema:{props:{label:{default:"\u4E0B\u62C9\u5355\u9009"}}}},multipleSelectField:{schema:{props:{label:{default:"\u4E0B\u62C9\u591A\u9009"}}}},radioField:{schema:{props:{label:{default:"\u5355\u9009"}}}},checkboxField:{schema:{props:{label:{default:"\u591A\u9009"}}}}};Z.define({en:{form:{field:Jr}},zh:{form:{field:Qr}}});var v=Z;var Xo=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"calculation"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="calculation")return;let o=this.get({id:t,prop:r},{include:["raw","error"]});if(o.error)return console.warn("Skipping using calculated value since prev errors exist.",o.error);!o.raw.value||this.set({id:t,prop:"value",value:o.value})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:o}=e;if(r!=="value")return;let i=this.get({id:t,prop:"calculation"},{include:"raw"});if(i.raw.value&&o!==i.value)return!1}}],eo=Xo;var Zo=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"validation"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let o=this.get({id:t,prop:"validation"},{include:"error"});if(o.error){let p=`Skipping validating ${r} using field validation`;return p+=" since field validation has errors.",console.warn(p,o.error)}if(!o.value)return;let{value:i,error:l}=this.get({id:t,prop:r},{include:"error"});if(l){let p="Skipping validating value using validation rules";return p+=" since prev value errors exist.",console.warn(p,l)}b.array(o.value)&&(o.value=[o.value]),(o.value.find(p=>p&&"presence"in p)||b.blank(i))&&o.value.some(p=>{try{return l=this.validator.error(p,i)}catch(d){return l=d}});let[n,s]=[this.members,this.naming(r)];if(!l)return n[t][s.error]=null;n[t][s.error]=[F.create({type:x.exceptions.VALIDATION_FAILED,message:f.string(l)?l:l.message||l.name})]}}],to=Zo;var Jo=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"options"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let{value:o,error:i}=this.get({id:t,prop:r},{include:"error"});if(i){let d="Skipping checking if value is within field options";return d+=" since prev value errors exist.",console.warn(d,i)}let l=this.get({id:t,prop:"options"},{include:"error"});if(l.error){let d="Skipping checking if value is within field options";return d+=" since field options has errors.",console.warn(d,l.error)}if(!l.value)return;let[a,n]=[this.members,this.naming(r)];if(f.blank(o))return a[t][n.error]=null;let s=l.value.map(d=>d.value);if(b.array(o)&&(o=[o]),!o.some(d=>!s.includes(d)))return a[t][n.error]=null;a[t][n.error]=[F.create({type:x.exceptions.VALIDATION_FAILED,message:"Each picked value must be included in option values."})]}}],ro=Jo;var st={ENABLE_VALUE_CALCULATION:eo,ENABLE_VALUE_VALIDATION:to,ENSURE_VALUE_WITHIN_OPTIONS:ro},Qo=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),st.ENABLE_VALUE_CALCULATION,A.hooks.use("ENABLE_SCHEMA_VALIDATION"),st.ENABLE_VALUE_VALIDATION];m.hooks={use(e){return!(e in st)&&g({type:m.exceptions.HOOK_NOT_EXIST}),st[e]},default(){return Qo.slice()}};var Ze={FALLBACK:{prop:()=>P(),label:()=>P(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>v.t("form.field.schema.fallback.placeholder"),hint:()=>v.t("form.field.schema.fallback.hint")},PROPS:[{prop:"name",label:()=>v.t("form.field.schema.props.name.label"),placeholder:()=>v.t("form.field.schema.props.name.placeholder"),hint:()=>v.t("form.field.schema.props.name.placeholder")},{prop:"label",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],default:()=>v.t("form.field.schema.props.label.default"),label:()=>v.t("form.field.schema.props.label.label"),placeholder:()=>v.t("form.field.schema.props.label.placeholder"),hint:()=>v.t("form.field.schema.props.label.hint")},{prop:"value",schemable:!1,calculable:!1,validation:null,default:null,label:()=>v.t("form.field.schema.props.value.label"),placeholder:()=>v.t("form.field.schema.props.value.placeholder"),hint:()=>v.t("form.field.schema.props.value.hint")},{prop:"placeholder",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>v.t("form.field.schema.props.placeholder.default"),label:()=>v.t("form.field.schema.props.placeholder.label"),placeholder:()=>v.t("form.field.schema.props.placeholder.placeholder"),hint:()=>v.t("form.field.schema.props.placeholder.hint")},{prop:"editable",schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],rawValidation:[{presence:!0},{dataType:"Boolean"}],default:!0,label:()=>v.t("form.field.schema.props.editable.label"),placeholder:()=>v.t("form.field.schema.props.editable.placeholder"),hint:()=>v.t("form.field.schema.props.editable.hint")},{prop:"visible",schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],rawValidation:[{presence:!0},{dataType:"Boolean"}],default:!0,label:()=>v.t("form.field.schema.props.visible.label"),placeholder:()=>v.t("form.field.schema.props.visible.placeholder"),hint:()=>v.t("form.field.schema.props.visible.hint")},u({prop:"validation",schemable:!0,calculable:!0,default:null,label:()=>v.t("form.field.schema.props.validation.label"),placeholder:()=>v.t("form.field.schema.props.validation.placeholder"),hint:()=>v.t("form.field.schema.props.validation.hint")},(()=>{let e=[{dataType:"Array"},function(t){let[r,o]=[-1,null];for(;++r<t.value.length;){o=t.value[r];try{this.validator.mustbeSupported(o,{strict:!0})}catch(i){let l=x.exceptions,a=l.UNSUPPORTED_VALIDATION,n=l.UNSUPPORTED_VALIDATION_RULE_TYPE,s=l.UNSUPPORTED_VALIDATION_RULE,{name:p,rule:d}=this.validator.extractValidation(o);if([s,n].includes(i.type)){let c="form.field.schema.props.validation.notSupportedRule",y=v.t(c,{variables:{name:p,rule:d}}),N=i.type===n;i.message=N?y:i.message||y}else if(i.type===a){let c="form.field.schema.props.validation.notSupported";i.message=v.t(c,{variables:{name:p}})}return i}}}];return{validation:e,rawValidation:e}})()),{prop:"calculation",schemable:!0,calculable:!0,default:null,label:()=>v.t("form.field.schema.props.calculation.label"),placeholder:()=>v.t("form.field.schema.props.calculation.placeholder"),hint:()=>v.t("form.field.schema.props.calculation.hint"),validation:null,rawValidation:[function(e){if(!this.calculator.isSupported(e.value,{strict:!1}))return F.create({type:D.exceptions.UNSUPPORTED_CALCULATION,message:v.t("form.field.schema.props.calculation.notSupported",{variables:{name:e.value}})})}]}]},ei={PROPS:[{prop:"options",schemable:!1,calculable:!1,default:()=>[{value:"1",label:v.t("form.field.schema.props.options.optionLabel")+" 1"}],label:()=>v.t("form.field.schema.props.options.label"),placeholder:()=>v.t("form.field.schema.props.options.placeholder"),hint:()=>v.t("form.field.schema.props.options.hint"),rawValidation:null,validation:[{presence:!0},{dataType:"Array"},function(e){let t=e.value;t.forEach((r,o)=>{h.object(r,"Each option"),h.string(r.label,"Option label"),h.string(r.value,"Option value"),t.some((i,l)=>l!==o&&i.value===r.value)&&g({type:x.exceptions.VALIDATION_FAILED,message:v.t("form.field.schema.props.options.mustbeUnique")})})}]}]};m.schema={use(e){return u({},oo(e))},extend(e,t={}){return u(u({},oo(e)),t)},default(e){return e==="fallback"?u({},Ze.FALLBACK):e==="props"?Ze.PROPS.slice():{fallback:u({},Ze.FALLBACK),props:Ze.PROPS.slice()}}};function oo(e){let r=Ze.PROPS.concat(ei.PROPS).find(o=>o.prop===e);return!r&&g({type:m.exceptions.PROP_SCHEMA_NOT_EXIST,message:`Prop schema of '${e}' does not exist.`}),r}function E(e="",t="",r){return f.undefined(r)&&(r=["label","placeholder","hint"]),G.from(r.map(o=>[o,ti(e,t,o)]))}function ti(e,t,r){return()=>v.try([`form.field.${e}.schema.props.${t}.${r}`,`form.field.schema.props.${t}.${r}`])}var io=m.extend({type:"CheckboxField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},E("checkboxField","name"))),m.schema.extend("label",u({},E("checkboxField","label",["label","placeholder","hint","default"]))),m.schema.extend("value",I(u({},E("checkboxField","value")),{validation:[{dataType:"Array"}]})),m.schema.extend("options",u({},E("checkboxField","options"))),m.schema.extend("editable",u({},E("checkboxField","editable"))),m.schema.extend("visible",u({},E("checkboxField","visible"))),m.schema.extend("validation",u({},E("checkboxField","validation"))),m.schema.extend("calculation",u({},E("checkboxField","calculation")))]}});var lo=m.extend({type:"MultipleSelectField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},E("multipleSelectField","name"))),m.schema.extend("label",u({},E("multipleSelectField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},E("multipleSelectField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",I(u({},E("multipleSelectField","value")),{validation:[{dataType:"Array"}]})),m.schema.extend("options",u({},E("multipleSelectField","options"))),m.schema.extend("editable",u({},E("multipleSelectField","editable"))),m.schema.extend("visible",u({},E("multipleSelectField","visible"))),m.schema.extend("validation",u({},E("multipleSelectField","validation"))),m.schema.extend("calculation",u({},E("multipleSelectField","calculation")))]}});var ao=m.extend({type:"NumberField",schema:{props:[m.schema.extend("name",u({},E("numberField","name"))),m.schema.extend("label",u({},E("numberField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},E("numberField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",I(u({},E("numberField","value")),{validation:[{dataType:"Number"}]})),m.schema.extend("editable",u({},E("numberField","editable"))),m.schema.extend("visible",u({},E("numberField","visible"))),m.schema.extend("validation",u({},E("numberField","validation"))),m.schema.extend("calculation",u({},E("numberField","calculation")))]}});var no=m.extend({type:"RadioField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},E("radioField","name"))),m.schema.extend("label",u({},E("radioField","label",["label","placeholder","hint","default"]))),m.schema.extend("value",I(u({},E("radioField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("options",u({},E("radioField","options"))),m.schema.extend("editable",u({},E("radioField","editable"))),m.schema.extend("visible",u({},E("radioField","visible"))),m.schema.extend("validation",u({},E("radioField","validation"))),m.schema.extend("calculation",u({},E("radioField","calculation")))]}});var so=m.extend({type:"SingleSelectField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},E("singleSelectField","name"))),m.schema.extend("label",u({},E("singleSelectField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},E("singleSelectField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",I(u({},E("singleSelectField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("options",u({},E("singleSelectField","options"))),m.schema.extend("editable",u({},E("singleSelectField","editable"))),m.schema.extend("visible",u({},E("singleSelectField","visible"))),m.schema.extend("validation",u({},E("singleSelectField","validation"))),m.schema.extend("calculation",u({},E("singleSelectField","calculation")))]}});var po=m.extend({type:"TextField",schema:{props:[m.schema.extend("name",u({},E("textField","name"))),m.schema.extend("label",u({},E("textField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},E("textField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",I(u({},E("textField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("editable",u({},E("textField","editable"))),m.schema.extend("visible",u({},E("textField","visible"))),m.schema.extend("validation",u({},E("textField","validation"))),m.schema.extend("calculation",u({},E("textField","calculation")))]}});var qt=[po,ao,so,lo,no,io];var oe={type:"Subform"};oe.collect=function(e){let t=this.get({id:e.id},{include:"raw"}),[r,o]=[[],[]],[i,l]=[[],[]];return(this.family.descendant(e)||[]).forEach((a,n)=>{let[s,p]=[{},{}];(this.family.descendant(a)||[]).forEach(d=>{let c=this.collect({id:d.id},{errors:!1});s[c.values.name]=c.values.value,p[c.values.name]=c.raw.values.value,n===0&&(delete c.values.value,delete c.raw.values.value,i.push(c.values),l.push(c.raw.values))}),r.push(s),o.push(p)}),t.values.value=r,t.raw.values.value=o,t.values.children=i,t.raw.values.children=l,t};oe.hooks=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:"Fieldset"}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),A.hooks.use("ENABLE_SCHEMA_VALIDATION")];var uo={schema:{props:{name:{label:"Name"},label:{label:"Label",default:"Subform"},editable:{label:"If Editable"},visible:{label:"If Visible"}}}};var co={schema:{props:{name:{label:"\u5B50\u8868\u5355Name"},label:{label:"\u5B50\u8868\u5355\u6807\u9898",default:"\u5B50\u8868\u5355"},editable:{label:"\u662F\u5426\u53EF\u7F16\u8F91"},visible:{label:"\u662F\u5426\u53EF\u89C1"}}}};Z.define({en:{form:{subform:uo}},zh:{form:{subform:co}}});var Y=Z;oe.schema={fallback:{prop:()=>A.guid(),label:()=>A.guid(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>Y.t("form.subform.schema.fallback.placeholder"),hint:()=>Y.t("form.subform.schema.fallback.hint")},props:[{prop:"name",label:()=>Y.t("form.subform.schema.props.name.label"),placeholder:()=>Y.t("form.subform.schema.props.name.placeholder"),hint:()=>Y.t("form.subform.schema.props.name.hint")},{prop:"label",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],default:()=>Y.t("form.subform.schema.props.label.default"),label:()=>Y.t("form.subform.schema.props.label.label"),placeholder:()=>Y.t("form.subform.schema.props.label.placeholder"),hint:()=>Y.t("form.subform.schema.props.label.hint")},{prop:"editable",default:!0,schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],label:()=>Y.t("form.subform.schema.props.editable.label"),placeholder:()=>Y.t("form.subform.schema.props.editable.placeholder"),hint:()=>Y.t("form.subform.schema.props.editable.hint")},{prop:"visible",default:!0,schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],label:()=>Y.t("form.subform.schema.props.visible.label"),placeholder:()=>Y.t("form.subform.schema.props.visible.placeholder"),hint:()=>Y.t("form.subform.schema.props.visible.hint")}]};oe.seed=function(e,t){let r=t.children||[],o=t.value||[];!o.length&&o.push({});let i=o.map(()=>{let[n,s]=[this.guid(),"SubformFieldset"];return{action:"add",parentId:e.id,id:n,props:{type:s}}}),l=Object.keys(t).map(n=>{if(!["children","value"].includes(n))return{action:"set",id:e.id,prop:n,value:t[n]}}).filter(n=>n),a=i.map((n,s)=>(r=r.map((p,d)=>{let y=f.object(o[s])&&p.name in o[s]?o[s][p.name]:null;return I(u({},p),{order:d,value:y})}),this.seed({id:n.id},{children:r},{execute:!1}))).flat();return i.concat(l,a).map(n=>I(u({},n),{__syncSubformField__:!0}))};var _e={type:"SubformFieldset"};_e.hooks=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:"Subform"})];var $=class{};T($,"GROUP_NAME","SubformField"),T($,"PARENT_TYPE","SubformFieldset"),T($,"TYPE_PREFIX","Subform"),T($,"LABEL_PREFIX","Subform "),T($,"exceptions",{INVALID_PARENT:"SUBFORM_FIELD_INVALID_PARENT",INVALID_FIELD_INSTALLER:"SUBFORM_FIELD_INVALID_FIELD_INSTALLER"});var ri=[{hook:"before-add",handler(e){let{parentId:t,props:r,__syncSubformField__:o}=e;if(o)return;let i=[I(u({},e),{action:"add",__syncSubformField__:!0})],l=this.family.sibling({id:t})||[];return i=i.concat(l.map(a=>({action:"add",__syncSubformField__:!0,parentId:a.id,id:this.guid(),props:r}))),this.executor.run(i),!1}},{hook:"before-del",handler(e){let{id:t,__syncSubformField__:r}=e;if(r)return;let o=[I(u({},e),{action:"del",__syncSubformField__:!0})],l=this.family.sibling({id:t},{self:!0}).findIndex(s=>s.id===t),a=this.family.ancestor({id:t}),n=this.family.sibling(a)||[];return o=o.concat(n.map(s=>({action:"del",__syncSubformField__:!0,id:this.family.descendant(s)[l].id}))),this.executor.run(o),!1}},{hook:"before-set",handler(e){let{id:t,prop:r,value:o,__syncSubformField__:i}=e;if(i||r==="value")return;let l=[I(u({},e),{action:"set",__syncSubformField__:!0})],n=this.family.sibling({id:t},{self:!0}).findIndex(d=>d.id===t),s=this.family.ancestor({id:t}),p=this.family.sibling(s)||[];return l=l.concat(p.map(d=>({action:"set",__syncSubformField__:!0,id:this.family.descendant(d)[n].id,prop:r,value:o}))),this.executor.run(l),!1}},{scope:_e.type,hook:"after-add",handler(e){let{id:t,props:r}=e,o=this.family.sibling({id:t});if(!o)return;let i=this.collect({id:o[0].id}).raw.values.children;if(!i.length)return;let l=i.map((a,n)=>{let s=((r==null?void 0:r.children)||[])[n]||{},p="value"in s?s.value:null;return{action:"add",__syncSubformField__:!0,parentId:t,id:this.guid(),props:I(u({},a),{order:n,value:p})}});this.executor.run(l)}}],fo=ri;var oi=[{hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:o,schema:i}=this;if(!i.for({id:t}).find(p=>p.prop==="value"))return;let a=r.ancestor({id:t}),s={id:r.ancestor(a).id,prop:"value"};o.add({relier:s,provider:{id:t,prop:"name"}}),o.add({relier:s,provider:{id:t,prop:"value"}})}},{scope:_e.type,hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:o}=this,l={id:r.ancestor({id:t}).id,prop:"value"};o.add({relier:l,provider:{id:t,prop:"order"}})}},{scope:oe.type,hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let{family:o}=this,i=(o.descendant({id:t})||[]).map(l=>G.from((o.descendant(l)||[]).map(a=>{let n=this.get({id:a.id,prop:"name"}),s=this.get({id:a.id,prop:"value"});return[n,s]})));this.members[t][this.naming(r).prop]=i}}],mo=oi;$.generate=function(e={}){e.group!==m.GROUP_NAME&&g({type:$.exceptions.INVALID_FIELD_INSTALLER,message:`SubformField.generate only accepts field installer
             to generate a subform field installer.`});let t=e.hooks.slice(),r=$.TYPE_PREFIX+e.type,o="BLOCK_INVALID_PARENT",i=A.hooks.use(o,{accept:m.PARENT_TYPE}),l=A.hooks.use(o,{accept:$.PARENT_TYPE}),a=t.indexOf(i);return a>-1&&(t[a]=l),t=t.concat(fo,mo),I(u({},e),{type:r,group:$.GROUP_NAME,hooks:t})};var pt=class{constructor(){this.i18n=U.create(),this.reactive=A({i18n:this.i18n}),pt.MEMBERS.forEach(t=>this.reactive.install(t))}static create(...t){return new pt(...t)}},R=pt;T(R,"MEMBERS",[]),T(R,"Field",m);R.group=function(e=""){let t=R.MEMBERS.filter(r=>e?r.group===e:!r.group);return t.length?t:null};R.install=function(e={}){b.array(e)&&(e=[e]),e.forEach(t=>{let{type:r,group:o,providers:i,validators:l}=u({},t);h.nonblankString(r,'Form Member "Type"'),o&&h.nonblankString(o,'Form Member "group"'),i&&h.function(i,'Form Member "providers"'),l&&h.function(l,'Form Member "validators"'),R.MEMBERS.push(u({},t)),o===m.GROUP_NAME&&R.MEMBERS.push($.generate(t))})};R.providers=function(e,t={}){var p;let{id:r,prop:o}=t,i=[];o="value";let l=e.get({id:r,prop:"type"}),a=(p=R.MEMBERS.find(d=>d.type===l))==null?void 0:p.providers;if(a)return a.call(e,{id:r,prop:o});if(Object.keys(e.members).forEach(d=>{if(d===r)return;let c=e.family.ancestor({id:d});!c||e.get({id:c.id,prop:"type"})!==Ne.type||!(e.naming("value").prop in e.members[d])||i.push({id:d,prop:o})}),!i.length)return null;let n=e.dependency.reliers({id:r,prop:o});if(!n)return i;let s=i.filter(d=>!n.some(c=>d.id===c.id&&d.prop===c.prop));return s.length?s:null};R.uninstall=function(e=""){!e||(R.MEMBERS=R.MEMBERS.filter(t=>t.type!==e))};R.validators=function(e,t={}){var s;let{id:r,prop:o}=t;o="value";let i=e.get({id:r,prop:"type"}),l=(s=R.MEMBERS.find(p=>p.type===i))==null?void 0:s.validators;if(l)return l.call(e,{id:r,prop:o});let a=e.schema.for({id:r,prop:o}).validation||[];b.array(a)&&(a=[a]);let n=a.find(p=>"dataType"in p);return n?e.validator.for(n.dataType,{except:"dataType"}):e.validator.get("presence")};R.install(Ne);R.install(oe);R.install(_e);R.install(qt);return ii;})();
//# sourceMappingURL=rcfm.model.iife.min.js-6ea261ad.map
