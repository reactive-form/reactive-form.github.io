/*!
 * rcfm 0.2.0 | Model iife | https://jilinxiangyun.com
 * Copyright 2021 JLxiangyun | MIT license
 */
var ReactiveForm=(()=>{var ze=Object.defineProperty,Vr=Object.defineProperties;var wr=Object.getOwnPropertyDescriptors;var Ft=Object.getOwnPropertySymbols;var Ur=Object.prototype.hasOwnProperty,Mr=Object.prototype.propertyIsEnumerable;var Je=(e,t,r)=>t in e?ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t)=>{for(var r in t||(t={}))Ur.call(t,r)&&Je(e,r,t[r]);if(Ft)for(var r of Ft(t))Mr.call(t,r)&&Je(e,r,t[r]);return e},T=(e,t)=>Vr(e,wr(t)),jr=e=>ze(e,"__esModule",{value:!0});var Hr=(e,t)=>{jr(e);for(var r in t)ze(e,r,{get:t[r],enumerable:!0})};var I=(e,t,r)=>(Je(e,typeof t!="symbol"?t+"":t,r),r);var Ao={};Hr(Ao,{Calculator:()=>L,Context:()=>v,Exception:()=>P,Form:()=>N,Reactive:()=>g,Schema:()=>Ge,Struct:()=>Ue,Type:()=>A,Validator:()=>_,guid:()=>C});var P=class extends Error{constructor(t={}){typeof t=="string"&&(t={type:t});let{type:r,message:o}=t;super(o);this.type=this.name=r}static create(...t){return new P(...t)}static raise(...t){throw new P(...t)}},b=P.raise;var Br=0;function C(){return`${Date.now()}${Br+=1}`}var A={ANY_TYPE:"*",SPECIFIC_TYPES:["String","Number","Boolean","Array","Object","RegExp","Function","Null","Undefined","Map","WeakMap","Symbol","File","Blob","Promise"],exceptions:{INVALID_DATA_TYPE:"TYPE_INVALID_DATA_TYPE"},get(e){let t=/\[object\s+(.*)\]/;return Object.prototype.toString.call(e).match(t)[1]},within(e={}){let{type:t,types:r}=e;return!Array.isArray(t)&&(t=[t]),!Array.isArray(r)&&(r=[r]),t.includes(A.ANY_TYPE)||r.includes(A.ANY_TYPE)?!0:!t.some(o=>!r.includes(o))},mustWithin(e={}){!A.within(e)&&b({type:A.exceptions.INVALID_DATA_TYPE,message:`Data type ${e.type} isn't within ${e.types}`})}},c=A.is={null(e){return A.get(e)==="Null"},undefined(e){return A.get(e)==="Undefined"},number(e){return A.get(e)==="Number"},integer(e){return Number.isInteger(e)},string(e){return A.get(e)==="String"},boolean(e){return A.get(e)==="Boolean"},array(e){return Array.isArray(e)},object(e){return A.get(e)==="Object"},regexp(e){return A.get(e)==="RegExp"},function(e){return A.get(e)==="Function"},positiveInteger(e){return c.integer(e)&&e>0},negativeInteger(e){return c.integer(e)&&e<0},blankArray(e){return c.array(e)&&e.length===0},blankString(e){return c.string(e)&&!!e.match(/^\s*$/)},blankObject(e){return c.object(e)&&Object.keys(e).length===0},nonblankArray(e){return c.array(e)&&e.length>0},nonblankString(e){return c.string(e)&&!!e.match(/\S/)},nonblankObject(e){return c.object(e)&&Object.keys(e).length>0},typeString(e){return e===A.ANY_TYPE?!0:A.SPECIFIC_TYPES.includes(e)},typeArray(e){return c.nonblankArray(e)?e.every(t=>t===A.ANY_TYPE?!0:A.within({type:t,types:A.SPECIFIC_TYPES})):!1},type(e){return c.typeString(e)||c.typeArray(e)},blank(e){return[null,void 0,NaN].includes(e)||c.blankString(e)||c.blankArray(e)||c.blankObject(e)?!0:c.array(e)?!e.some(t=>!c.blank(t)):!1}},E=A.isnt=(()=>{let e={};return Object.keys(c).forEach(t=>{e[t]=function(r){return!c[t](r)}}),e})(),m=A.mustbe=(()=>{let e={};return Object.keys(E).forEach(t=>{e[t]=function(r,o="The argument"){E[t](r)&&b({type:A.exceptions.INVALID_DATA_TYPE,message:`${o} must be '${t.toUpperCase()}'`})}}),e})(),Qe=A.musntbe=(()=>{let e={};return Object.keys(c).forEach(t=>{e[t]=function(r,o="The argument"){c[t](r)&&b({type:A.exceptions.INVALID_DATA_TYPE,message:`${o} must not be '${t.toUpperCase()}'`})}}),e})();var Ue={},Y=Ue.array={unique(e=[]){return e.filter((t,r)=>e.indexOf(t)===r)}},J=Ue.object={from(e=[]){m.array(e);let t={};return e.forEach(r=>t[r[0]]=r[1]),t},collect(e={},t=[]){m.object(e),m.array(t);let r={};return Object.keys(e).forEach(o=>{t.includes(o)&&(r[o]=e[o])}),r},exclude(e={},t=[]){m.object(e),m.array(t);let r={};return Object.keys(e).forEach(o=>{!t.includes(o)&&(r[o]=e[o])}),r}};var Vt={name:"add",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t+r)}};var wt={name:"devide",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t/r)}};var Ut={name:"map",argumentSize:1,argumentType:"*",calculate(e){return e}};var Mt={name:"minus",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t-r)}};var jt={name:"multiple",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t*r)}};var Ht=[Vt,Mt,jt,wt,Ut];function Q(e={},t={}){return e._calculator||(e._calculator=h({},t))}var Ze=class{constructor(){Q(this,{installed:{}}),Ht.forEach(t=>this.install(t))}static create(...t){return new Ze(...t)}},L=Ze;I(L,"exceptions",{CONFLICTED_NAME:"CALCULATOR_CONFLICTED_NAME",UNSUPPORTED_CALCULATION:"CALCULATOR_UNSUPPORTED_CALCULATION",INVALID_ARGUMENT_SIZE:"CALCULATOR_INVALID_ARGUMENT_SIZE",INVALID_ARGUMENT_TYPE:"CALCULATOR_INVALID_ARGUMENT_TYPE"});function _e(e={}){let t=Object.keys(e)[0],r=e[t];return E.array(r)&&(r=[r]),{name:t,args:r}}function et(e,t){return e.length>=t.min}function tt(e=[],t){return!e.some((r,o)=>{let i=t;return E.type(i)&&(i=i[o]||i[i.length-1]),!A.within({type:A.get(r),types:i})})}L.prototype.mustbeSupported=function(e={}){m.object(e,"Any calculation");let{name:t}=_e(e),{installed:r}=Q(this);!r[t]&&b({type:L.exceptions.UNSUPPORTED_CALCULATION,message:`Calculation '${t}' is not supported.`})};L.prototype.isSupported=function(e={}){try{this.mustbeSupported(e)}catch(t){return!1}return!0};L.prototype.isntSupported=function(e={}){return!this.isSupported(e)};L.prototype.calculate=function(e={}){if(this.isntSupported(e))return null;let{installed:t}=Q(this),{name:r,args:o}=_e(e),{argumentType:i,argumentSize:a,calculate:n}=t[r];return!et(o,a)||(o=o.slice(0,a.max).map(l=>this.isSupported(l)?this.calculate(l):l),!tt(o,i))?null:n(...o)};function rt(e){return e===1/0?!1:c.positiveInteger(e)?!0:!c.nonblankArray(e)||e.length!==2||!c.positiveInteger(e[0])?!1:e[1]===1/0?!0:e[1]>e[0]}function ot(e){return c.type(e)?!0:E.nonblankArray(e)?!1:e.every(t=>c.typeArray(t))}function it(e){return{min:c.integer(e)?e:e[0],max:c.integer(e)?e:e[1]}}L.prototype.install=function(e={}){m.object(e,"Any calculator installer");let{name:t,argumentSize:r,argumentType:o,calculate:i}=e;m.nonblankString(t,"Calculator name"),m.function(i,"Calculator calculate property"),!rt(r)&&b({type:L.exceptions.INVALID_ARGUMENT_SIZE,message:"The argument size of your calculator is not valid."}),!ot(o)&&b({type:L.exceptions.INVALID_ARGUMENT_TYPE,message:"The argument type of your calculator is not valid."});let{installed:a}=Q(this);t in a&&b({type:L.exceptions.CONFLICTED_NAME,message:`Calculator name '${t}' has been occupied.`}),a[t]=T(h({},e),{name:t,argumentType:o,calculate:i,argumentSize:it(r)})};L.prototype.uninstall=function(e=""){let{installed:t}=Q(this);e in t&&delete t[e]};function D(e={},t={}){return e._family||(e._family=h({},t))}var de=class{constructor(){let t=C();D(this,{rootId:t,members:{[t]:{id:t,parentId:null,order:0}}})}static create(...t){return new de(...t)}static isFamily(t){return t instanceof de}static isntFamily(t){return!de.isFamily(t)}static mustbeFamily(t){de.isntFamily(t)&&b({type:de.exceptions.INVALID_INSTANCE})}},S=de;I(S,"exceptions",{MEMBER_NOT_EXIST:"FAMILY_MEMBER_NOT_EXIST",CONFLICTED_PARENT:"FAMILY_MEMBER_CONFLICTED_PARENT",SELF_REFERENCE:"FAMILY_MEMBER_SELF_REFERENCE",INVALID_INSTANCE:"FAMILY_INVALID_INSTANCE"});function Bt(e={},t=[]){t=t.sort((o,i)=>"order"in o?"order"in i?o.order-i.order:-1:1);let r=t.find(o=>"expectedOrder"in o);if(r){let[o,i]=[t.indexOf(r),r.expectedOrder];if(t.splice(o,1),i<0)t.unshift(r);else if(i>t.length-1)t.push(r);else{let a=i>=o?i-1:i;t.splice(a,0,r)}}return t.forEach((o,i)=>{delete e[o.id].expectedOrder,e[o.id].order=i}),t}S.prototype.descendant=function(e={},t={}){let{rootId:r,members:o}=D(this),i=e.id||r,a="deep"in t?t.deep:!1,n="self"in t?t.self:!1,l="sort"in t?t.sort:!0;if(!o[i])return null;let[s,p]=[[h({},o[i])],-1];for(;++p<s.length;){let[d,u]=[s[p],[]];if(Object.values(o).forEach(y=>{y.id!==r&&y.parentId===d.id&&u.push(h({},y))}),u.length&&(l&&(u=Bt(o,u)),s=s.concat(u)),!a)break}return n||s.shift(),s.length?s:null};S.prototype.add=function(e={}){let{rootId:t,members:r}=D(this),o=e.id||C(),i=(e.parent?e.parent.id:e.parentId)||t,a=e.order||1/0;if(m.nonblankString(o,"params.id"),m.nonblankString(i,"params.parentId"),m.number(a,"params.order"),o===i&&b({type:S.exceptions.SELF_REFERENCE}),!r[i]&&b({type:S.exceptions.MEMBER_NOT_EXIST}),r[o]){if(r[o].parentId===i)return h({},r[o]);b({type:S.exceptions.CONFLICTED_PARENT})}return r[o]={id:o,parentId:i,expectedOrder:a,touchedAt:C()},this.descendant({id:i},{sort:!0}),h({},r[o])};S.prototype.ancestor=function(e={},t={}){let{id:r}=e,{members:o}=D(this),i="deep"in t?t.deep:!1,a="self"in t?t.self:!1;if(!o[r])return null;let[n,l]=[[h({},o[r])],-1];for(;++l<n.length;){let s=o[n[l].parentId];if(s&&n.push(h({},s)),!i)break}return i?(a||n.shift(),n.length?n:null):(n.shift(),n[0]?n[0]:null)};S.prototype.delete=function(e={}){let{members:t,rootId:r}=D(this);if(e.id===r)return;let o=t[e.id];if(!o)return;let{parentId:i}=o;this.descendant({id:e.id},{self:!0,deep:!0,sort:!1}).forEach(({id:a})=>delete t[a]),this.descendant({id:i},{sort:!0})};S.prototype.has=function(e={}){let{members:t}=D(this);return e.id in t};S.prototype.hasnt=function(e={}){return!this.has(e)};S.prototype.reorder=function(e={}){let{id:t,order:r}=e,{rootId:o,members:i}=D(this);m.number(r,"params.order"),!(!i[t]||t===o)&&r!==i[t].order&&(i[t].expectedOrder=r,i[t].touchedAt=C(),this.descendant({id:i[t].parentId},{sort:!0}))};S.prototype.root=function(){let{rootId:e,members:t}=D(this);return h({},t[e])};S.prototype.sibling=function(e={},t={}){let{id:r}=e,{members:o,rootId:i}=D(this),a="self"in t?t.self:!1;if(!o[r])return null;if(r===i)return a?[this.root()]:null;let n=this.ancestor({id:r});if(!n)return null;let l=this.descendant(n);return a?l:(l=l.filter(s=>s.id!==r),l.length?l:null)};function V(e={},t={}){return e._dependency||(e._dependency=h({},t))}var me=class{constructor(){V(this,{associations:{},group:{reliers:{}},cache:{reliers:{}}})}static create(...t){return new me(...t)}static isDependency(t){return t instanceof me}static isntDependency(t){return!me.isDependency(t)}static mustbeDependency(t){me.isntDependency(t)&&b({type:me.exceptions.INVALID_INSTANCE})}},q=me;I(q,"exceptions",{CIRCLE_REFERENCE:"DEPENDENCY_CIRCLE_REFERENCE",INVALID_INSTANCE:"DEPENDENCY_INVALID_INSTANCE"});var Kt="#",Me="_";function W(e={}){let{id:t,prop:r}=e;return t?`${t}${Kt}${r||""}`:Me}function Z(e=""){if(e===Me)return{id:"",prop:""};let[t,r]=e.split(Kt);return{id:t,prop:r}}function ue(e={},t){if(!t)return Object.keys(e).forEach(a=>delete e[a]);let{id:r,prop:o}=t;if(!r)return delete e[Me];let i=W({id:r,prop:o});o?(delete e[i],delete e[W({id:r})],Object.keys(e).forEach(a=>{e[a].includes(i)&&delete e[a]})):Object.keys(e).forEach(a=>{(Z(a).id===r||e[a].includes(i))&&delete e[a]})}var he="__GLOBAL__";q.prototype.add=function(e=[],t={}){let r="group"in t?t.group:he;m.nonblankString(r,"association group"),E.array(e)&&(e=[e]),e=e.map(({provider:a,relier:n})=>{m.nonblankString(n.id,"association.relier.id"),m.nonblankString(a.id,"association.provider.id"),m.nonblankString(n.prop,"association.relier.prop"),m.nonblankString(a.prop,"association.provider.prop");let l={provider:W(a),relier:W(n)};return{provider:a,relier:n,path:l}});let{error:o,rollbackQueue:i}=Kr(this,e);if(!o)return $r(this,e,r);throw Yr(this,i),o};function Kr(e,t){let r=[],{associations:o}=V(e),i=V(e).cache.reliers;return t.some(({provider:n,relier:l,path:s})=>{if(s.provider===s.relier)return!0;let p=e.reliers(l,{split:!1});return p&&p.includes(s.provider)?!0:(o[s.provider]||(o[s.provider]=[]),o[s.provider].includes(s.relier)||(o[s.provider].push(s.relier),r.push({provider:n,relier:l,path:s}),ue(i,n)),!1)})?{rollbackQueue:r,error:P.create({type:q.exceptions.CIRCLE_REFERENCE})}:{error:null,rollbackQueue:null}}function Yr(e,t){let{associations:r}=V(e),o=V(e).cache.reliers;t.forEach(({provider:i,path:a})=>{let n=r[a.provider].indexOf(a.relier);n<0||(r[a.provider].splice(n,1),!r[a.provider].length&&delete r[a.provider],ue(o,i))})}function $r(e,t,r){let o=V(e).group.reliers;t.forEach(({path:i})=>{let a=o[i.provider]||(o[i.provider]={}),n=a[i.relier]||(a[i.relier]=[]);!n.includes(r)&&n.push(r)})}q.prototype.delete=function(e={},t={}){let{id:r,prop:o}=e;if(!r)return;let{only:i,group:a}=t,n=W(e),{associations:l}=V(this),s=V(this).cache.reliers,p=V(this).group.reliers,d=o?u=>u===n:u=>Z(u).id===r;i!=="relier"&&(ue(s,e),o?(delete l[n],delete p[n]):Object.keys(l).map(u=>{!d(u)||(delete l[u],delete p[u])})),Object.keys(l).forEach(u=>{let y=l[u].length;l[u]=l[u].filter(x=>{if(!d(x))return!0;if(i!=="relier"||!a||a===he)return delete p[u][x],!1;let R=p[u][x].findIndex(F=>F===a);return R>=0&&p[u][x].splice(R,1),p[u][x].length?!0:(delete p[u][x],!1)});let k=l[u].length;k!==y&&(ue(s,Z(u)),!k&&delete l[u],!Object.keys(p[u]).length&&delete p[u])})};q.prototype.reliers=function(e=[],t={}){E.array(e)&&(e=[e]);let r=e.some(O=>E.object(O)||!O.id);r&&(e=[{}]);let o="reload"in t?t.reload:!1,i="split"in t?t.split:!0,a="deep"in t?t.deep:!0,n="self"in t?t.self:!0,l="group"in t?t.group:"",{associations:s}=V(this),p=V(this).cache.reliers,d=V(this).group.reliers,[u,y,k]=[[],[],[]];if(e.forEach(O=>{let K=W(O);if("prop"in O?k.push(K):Object.keys(s).forEach(M=>{Z(M).id===O.id&&k.push(M)}),y.push(O.id),!Gr(s,O))return ue(p,O);(o||!(K in p))&&(p[K]=qr(s,O),p[K]=Yt(s,p[K])),u=u.concat(p[K])}),!u.length)return null;if(e.length>1&&(u=Yt(s,Y.unique(u))),r||a&&n&&(!l||l===he))return i?u.map(O=>Z(O)):u;let[x,R]=[[],k.slice()],F=k.map(O=>s[O]).flat();return u.forEach(O=>{if(!a&&!F.includes(O))return;let K=Z(O);if(!(!n&&y.includes(K.id))){if(l&&l!==he){let M=Object.keys(d).some(ce=>!R.includes(ce)||!Object.keys(d[ce]).includes(O)?!1:d[ce][O].includes(l));if(R.push(O),!M)return}x.push(i?K:O)}}),x.length?x:null};function Gr(e={},t={}){let{id:r,prop:o}=t;return r?o?W(t)in e:Object.keys(e).filter(i=>Z(i).id===r).length>0:Object.keys(e).length>0}function qr(e={},t={}){let{id:r,prop:o}=t,i=(()=>r?o?(e[W(t)]||[]).slice():Y.unique(Object.keys(e).filter(n=>Z(n).id===r).map(n=>e[n]).flat()):Y.unique(Object.values(e).flat()))(),a=-1;for(;++a<i.length;)(e[i[a]]||[]).forEach(l=>!i.includes(l)&&i.push(l));return i}function Yt(e={},t=[]){let r=-1;for(;++r<t.length;)(e[t[r]]||[]).forEach(i=>{let a=t.indexOf(i);a>r||(t.splice(a,1),t.push(i),r--)});return t}function ee(e={},t={}){return e._dispatcher||(e._dispatcher=h({},t))}var j=class{constructor(t={}){"target"in t&&m.function(t.target,"options.target"),ee(this,{isAborted:!1,listeners:{},target:t.target||function(r){return r}})}static create(...t){return new j(...t)}};j.prototype.abort=function(e=!0){ee(this).isAborted=e===!0};function Ie(e={},t,r){t in e&&(r?r=c.array(r)?r:[r]:r=Object.keys(e[t]),r.forEach(o=>{o in e[t]&&!e[t][o].length&&delete e[t][o]}),!Object.keys(e[t]).length&&delete e[t])}j.prototype.add=function(e={},t){let{id:r,event:o}=e,{listeners:i}=ee(this);m.nonblankString(r,"params.id"),m.nonblankString(o,"params.event"),m.function(t,"callback"),i[r]||(i[r]={});let a=i[r][o]||(i[r][o]=[]),n=a.push({callback:t})-1;return function(){a.splice(n,1),Ie(i,r,o)}};j.prototype.delete=function(e={},t){let{id:r,event:o}=e,{listeners:i}=ee(this);if(!!i[r]){if(!o){r in i&&delete i[r];return}if(!!i[r][o]){if(!t){o in i[r]&&delete i[r][o];return}i[r][o]=i[r][o].filter(a=>a.callback!==t),Ie(i,r,o)}}};j.prototype.trigger=function(e={},t){t&&m.function(t);let{id:r,event:o,detail:i}=e,{listeners:a,target:n,isAborted:l}=ee(this);if(l||!a[r]||!a[r][o])return!1;let s=!1,p={type:o,target:n(r),detail:i};return t?t(p,i)===!1:(a[r][o].forEach(({callback:d})=>{let u=d(p,i)===!1;s||(s=u)}),!s)};function Ee(e={},t={}){return e._executor||(e._executor=h({},t))}var te=class{constructor(t={}){m.function(t.runner,"options.runner"),Ee(this,{isAborted:!1,queues:{current:[],next:[]},runner:t.runner||function(r){return r}})}static create(...t){return new te(...t)}};te.prototype.abort=function(e=!0){Ee(this).isAborted=e===!0};te.prototype.run=function(e){let{queues:t,runner:r,isAborted:o}=Ee(this);arguments.length&&(E.array(e)&&(e=[e]),t.next=t.next.concat(e)),!o&&(t.current.length||!t.next.length||(t.current=t.next,t.next=[],r(t.current.slice()),t.current=[],this.run()))};function re(e={},t={}){return e._hook||(e._hook=h({},t))}var H=class{constructor(){re(this,{isAborted:!1,hooks:{}})}static create(...t){return new H(...t)}};H.prototype.abort=function(e=!0){re(this).isAborted=e===!0};H.prototype.add=function(e="",t){m.nonblankString(e),m.function(t);let{hooks:r}=re(this);return r[e]||(r[e]=[]),r[e].push(t),function(){let o=r[e].indexOf(t);o>=0&&r[e].splice(o,1)}};H.prototype.delete=function(e="",t){let{hooks:r}=re(this);!r[e]||(t?r[e]=r[e].filter(o=>o!==t):r[e]=[])};H.prototype.run=function(e="",t={}){let{hooks:r,isAborted:o}=re(this);if(o)return!1;if(!r[e])return!0;let[i,a]=[t.arguments,!1];return E.array(i)&&(i=[i]),r[e].forEach(n=>{let l=n(...i);a||(a=l===!1)}),o?!1:!a};function at(e={},t={}){let{members:r,family:o,dependency:i,hooks:a}=t,n="id"in e?e.id:e.id=C(),l=o.root().id,s=n===l;if(s&&r[n])return{};let p=s?null:(()=>"parentId"in e?e.parentId:e.parentId=l)();if(!s&&o.has({id:n}))return{};if(!s&&o.hasnt({id:p}))return{};let d="props"in e?e.props:e.props={};"children"in d||(d.children=[]),"order"in d||(d.order=1/0);let u={mutations:{set:[]},mutated:[]};return a.run("before-add",{arguments:[e,"before-add"]})?(!s&&o.add({id:n,parentId:p}),r[n]={},u.mutated=[{id:n}],Object.keys(e.props).forEach(y=>{u.mutations.set.push({id:n,prop:y,value:d[y]})}),!s&&i.add({provider:{id:n,prop:"order"},relier:{id:p,prop:"children"}}),a.run("after-add",{arguments:[e,u,"after-add"]}),u):{}}var je="__raw__prop__",He="__raw__error__",Be="__prop__",Ke="__error__";function oe(e,t={}){return(t.raw?je:Be)+e}function ie(e,t={}){return(t.raw?He:Ke)+e}function nt(e={},t={}){let{members:r,family:o,hooks:i}=t,{id:a,prop:n}=e;if(o.hasnt({id:a}))return{};let l={mutated:[]},s={raw:oe(n,{raw:!0}),calc:oe(n)},p={raw:ie(n,{raw:!0}),calc:ie(n)};if(!i.run("before-calc",{arguments:[e,"before-calc"]}))return{};if(n==="children"){let d=o.descendant({id:a})||[];return r[a][s.calc]=d.map(({id:u})=>({id:u})),r[a][p.calc]=r[a][p.raw],l.mutated.push({id:a}),i.run("after-calc",{arguments:[e,l,"after-calc"]}),l}return r[a][s.calc]=r[a][s.raw],r[a][p.calc]=r[a][p.raw],l.mutated.push({id:a}),i.run("after-calc",{arguments:[e,l,"after-calc"]}),l}function lt(e={},t={}){let{id:r}=e,{members:o,family:i,dependency:a,hooks:n}=t;if(i.hasnt({id:r}))return{};if(r===i.root().id)return{};if(!n.run("before-del",{arguments:[e,"before-del"]}))return{};let l={mutations:{set:[],calc:[]},mutated:[]},s=i.ancestor({id:r}),p=i.descendant({id:r},{deep:!0,self:!0}),d=a.reliers(p,{self:!1});return p.forEach(({id:u})=>{delete o[u],i.delete({id:u}),a.delete({id:u}),l.mutated.push({id:u})}),d&&(l.mutations.calc=d),s&&(i.descendant({id:s.id})||[]).forEach((u,y)=>{l.mutations.set.push({id:u.id,prop:"order",value:y})}),n.run("after-del",{arguments:[e,l,"after-del"]}),l}function st(e={},t={}){let{members:r,family:o,dependency:i,hooks:a}=t,{id:n,prop:l,value:s}=e;if(o.hasnt({id:n}))return{};let p={raw:oe(l,{raw:!0})},d={raw:ie(l,{raw:!0})};if(Object.is(r[n][p.raw],s))return{};let u={mutations:{calc:[]},mutated:[]};if(l==="order"){let k=o.ancestor({id:n});return k?a.run("before-set",{arguments:[e,"before-set"]})?(o.reorder({id:n,order:e.value}),o.descendant(k).forEach(({id:x,order:R})=>{r[x][p.raw]=R,r[x][d.raw]=null,u.mutated.push({id:x}),u.mutations.calc.push({id:x,prop:l});let F=i.reliers({id:x,prop:l})||[];u.mutations.calc=u.mutations.calc.concat(F)}),a.run("after-set",{arguments:[e,u,"after-set"]}),u):{}:{}}if(!a.run("before-set",{arguments:[e,"before-set"]}))return{};r[n][p.raw]=e.value,r[n][d.raw]=null,u.mutated=[{id:n}];let y=i.reliers({id:n,prop:l})||[];return u.mutations.calc=[{id:n,prop:l}].concat(y),a.run("after-set",{arguments:[e,u,"after-set"]}),u}function Wr(e=[],t=[]){let[r,o]=[{},{}];return t.forEach(i=>{o[i]=[],r[i]=[]}),e.forEach(i=>{let{id:a,action:n}=i;!t.includes(n)||(o[n].push(a),r[n].push(i))}),{jobs:r,ids:o}}function xe(e={},t,r=[]){t||(t={}),t.mutated&&(e.mutated=e.mutated.concat(t.mutated)),r.forEach(o=>{e.mutations[o]||(e.mutations[o]=[]),t.mutations&&t.mutations[o]&&(e.mutations[o]=e.mutations[o].concat(t.mutations[o]))})}function $t(e=[]){return e.filter((t,r,o)=>o.findIndex(a=>a.id===t.id&&a.prop===t.prop)===r)}function pt(e=[],t={}){let{dispatcher:r}=t,o=["del","add","set","calc"],{jobs:i,ids:a}=Wr(e,o),n={mutated:[],mutations:{}};xe(n,{},o),i.del.forEach(l=>{xe(n,lt(l,t),["add","set","calc"])}),i.add=n.mutations.add.concat(i.add),i.add.forEach(l=>{let{id:s,parentId:p}=l;a.del.includes(s)||a.del.includes(p)||xe(n,at(l,t),["set","calc"])}),i.set=n.mutations.set.concat(i.set),i.set=$t(i.set.reverse()).reverse(),i.set.forEach(l=>{a.del.includes(l.id)||xe(n,st(l,t),["calc"])}),i.calc=n.mutations.calc.concat(i.calc),i.calc=$t(i.calc.reverse()).reverse(),i.calc.forEach(l=>{a.del.includes(l.id)||xe(n,nt(l,t),[])}),Y.unique(n.mutated.map(l=>l.id)).forEach(l=>{r.trigger({id:l,event:"after-mutation"})})}var ut=class{constructor(){this.members={},this.family=S.create(),this.dependency=q.create(),this.dispatcher=j.create(),this.hooks=H.create(),this.executor=te.create({runner:t=>pt(t,this)}),this.executor.run({action:"add",id:this.family.root().id})}static create(...t){return new ut(...t)}},v=ut;I(v,"Family",S),I(v,"Dependency",q),I(v,"Executor",te),I(v,"Dispatcher",j),I(v,"Hook",H);v.prototype.add=function(e){let t=E.array(e);t&&(e=[e||{}]);let r=e.map(o=>T(h({},o),{id:C(),action:"add"}));return this.executor.run(r),t?r[0].id:r.map(o=>o.id)};v.prototype.delete=function(e){if(!e){this.executor.abort(),this.dispatcher.abort(),this.hook.abort();for(let r in this)delete this[r];return}E.array(e)&&(e=[e]);let t=e.map(r=>T(h({},r),{action:"del"}));this.executor.run(t)};v.prototype.find=function(e){return E.function(e)?null:Object.keys(this.members).find(t=>e({id:t}))};v.prototype.get=function(e={},t={}){let{members:r}=this,o="include"in t?t.include:[],i=o.includes("error"),a=o.includes("raw");return"prop"in e?Xr(r,e,i,a):zr(r,e,i,a)};function Xr(e,t,r,o){let{id:i,prop:a}=t;if(!e[i])return null;let[n,l,s,p]=[null,null,null,null],d=oe(a);if(n=d in e[i]?e[i][d]:null,r){let u=ie(a);l=e[i][u]||null}if(o){let u=oe(a,{raw:!0});if(s=u in e[i]?e[i][u]:null,r){let y=ie(a,{raw:!0});p=e[i][y]||null}}return!r&&!o?n:r&&!o?{value:n,error:l}:r?{value:n,error:l,raw:{value:s,error:p}}:{value:n,raw:{value:s}}}function zr(e,t,r,o){let{id:i}=t,[a,n,l,s]=[{},null,{},null];return e[i]?(Object.keys(e[i]).forEach(p=>{let d=e[i][p];if(p.startsWith(Be))return a[p.replace(Be,"")]=d;if(d&&r&&p.startsWith(Ke))return n||(n={}),n[p.replace(Ke,"")]=d;if(o&&p.startsWith(je))return l[p.replace(je,"")]=d;if(d&&o&&r&&p.startsWith(He))return s||(s={}),s[p.replace(He,"")]=d}),!o&&!r?a:r&&!o?{values:a,errors:n}:r?{values:a,errors:n,raw:{values:l,errors:s}}:{values:a,raw:{values:l}}):null}v.prototype.naming=function(e=""){return{prop:oe(e),error:ie(e),raw:{prop:oe(e,{raw:!0}),error:ie(e,{raw:!0})}}};v.prototype.set=function(e){if(!e)return;E.array(e)&&(e=[e]);let t=e.map(r=>T(h({},r),{action:"set"}));this.executor.run(t)};v.prototype.subscribe=function(e={},t){let r={id:e.id,event:"after-mutation"},o="immediately"in e?e.immediately:!0,i=this.dispatcher.add(r,t);return o&&this.dispatcher.trigger(r,t),i};var fe={type:"Fieldset"};function Te(e,t={}){let r=e._storeOfSchema||(e._storeOfSchema={});return t===void 0?e._storeOfSchema:(Object.assign(r,J.collect(t,["parseExpression","parseReference"])),r)}var Ye="when",ge="then",Ae="else",Ne="and",Oe="or",Se="not";function ye(e){return E.object(e)?!1:Ye in e&&ge in e}function be(e){return E.object(e)?!1:Ae in e}function se(e){return ye(e)||be(e)}function $e(e){return E.array(e)?!1:!e.some(t=>!se(t))}var Le=class{static isConditionObject(t){return se(t)}static isConditionArray(t){return $e(t)}static isCondition(t){return se(t)||$e(t)}static isntCondition(t){return!Le.isCondition(t)}static mustbeCondition(t,r="The argument"){Le.isCondition(t)||b({type:Le.exceptions.INVALID_CONDITION,message:`${r} must be a condition statement.`})}},ae=Le;I(ae,"exceptions",{INVALID_CONDITION:"INVALID_CONDITION"});function ft(e={},t){let[r,o,i]=["unknown",e[Ye],-1];for(E.array(o)&&(o=[o]);++i<o.length;){let[a,n]=[o[i],[]];if(c.object(a)&&Ne in a){if(i>0&&r!==!0)break;a=a[Ne],n.push(Ne)}else if(c.object(a)&&Oe in a){if(i>0&&r===!0)break;a=a[Oe],n.push(Oe)}c.object(a)&&Se in a&&(a=a[Se],n.push(Se));let l=t(a);if(E.boolean(l)&&(l="unknown"),n.includes(Se)&&c.boolean(l)&&(l=!l),n.includes(Ne)){if(r=l,r!==!0)break}else if(n.includes(Oe)){if(r!==!0&&(r=l),r===!0)break}else r=l}return{truthy:r,result:e[ge]}}function ct(e={}){return{result:e[Ae]}}function Jr(e){if(c.boolean(e))return e}ae.parse=function(e,t){ae.mustbeCondition(e),t===void 0&&(t=Jr),m.function(t),se(e)&&(e=[e]);let r;return e.some(o=>{if(ye(o)){let{truthy:i,result:a}=ft(o,t);if(i===!0)return r=a,!0}else if(be(o)){let{result:i}=ct(o);return r=i,!0}return!1}),r};ae.possibilities=function(e){ae.mustbeCondition(e),se(e)&&(e=[e]);let t=!1,r=e.map(o=>{if(ye(o))return o[ge];if(be(o))return t=!0,o[Ae]});return r=Y.unique(r),t||!r.includes(void 0)&&r.push(void 0),r};var X=ae;var ve=/<<\s*([^(<<)(>>)\s]+)\s*>>/,Gt=new RegExp(ve,"g");function ke(e="",t={}){let{raw:r,flag:o,strict:i}=t;if(r)return`<< ${e} >>`;let a=`<<\\s*${e}\\s*>>`;return i&&(a=`^${a}$`),new RegExp(a,o)}function dt(e){return E.string(e)?!1:!!e.match(ve)}var Re=class{static isInterpolation(t){return dt(t)}static isntInterpolation(t){return!Re.isInterpolation(t)}static mustbeInterpolation(t,r="The argument"){Re.isInterpolation(t)||b({type:Re.exceptions.INVALID_INTERPOLATION,message:`${r} must be an interpolation statement.`})}},B=Re;I(B,"exceptions",{INVALID_INTERPOLATION:"INVALID_INTERPOLATION"});function Ce(e=""){return e.match(Gt)}function mt(e=""){let t=e.match(ve);return t?t[1]:null}B.references=function(e="",t={}){if(B.isntInterpolation(e))return null;let o=(Ce(e)||[]).map(i=>mt(i));return t.unique!==!1&&(o=Y.unique(o)),o.length?o:null};B.parse=function(e="",t={}){B.mustbeInterpolation(e);let r=Ce(e),o=B.references(e,{unique:!1}),i=a=>c.function(t)?t(a):t[a];if(r.length===1){let a=ke(o[0],{strict:!0});if(e.match(a))return e=i(o[0])}return o.forEach((a,n)=>{e=e.replace(r[n],i(a))}),e};B.replace=function(e="",t={}){return B.mustbeInterpolation(e),Object.keys(t).forEach(r=>{let o=ke(t[r],{raw:!0});r=ke(r,{flag:"g"}),e=e.replace(r,o)}),e};var ne=B;var ht=class{constructor(t={}){Te(this,t)}static create(...t){return new ht(...t)}},$=ht;I($,"Condition",X),I($,"Interpolation",ne);function Et(e,t){return c.array(e)?e=e.map(r=>Et(r,t)):c.object(e)?e=J.from(Object.keys(e).map(r=>[r,Et(e[r],t)])):ne.isInterpolation(e)&&(e=ne.parse(e,t)),e}function yt(e,t,r){if(c.array(e)){let o=X.isConditionArray(e);e=e.map(i=>yt(i,t,o))}else c.object(e)&&(e=J.from(Object.keys(e).map(o=>[o,yt(e[o],t)])));return X.isConditionArray(e)?e=X.parse(e,t):X.isConditionObject(e)&&!r&&(e=X.parse(e,t)),e}$.prototype.parse=function(e){let{parseReference:t,parseExpression:r}=Te(this);return e=Et(e,t),e=yt(e,r),e};$.prototype.possibilities=function(e){let t=null;return X.isCondition(e)?(t=[],X.possibilities(e).forEach(r=>{if(!X.isCondition(r))return t.push(r);t=t.concat(this.possibilities(r))})):c.object(e)?Object.keys(e).forEach(r=>{let o=this.possibilities(e[r]);!o||(t=t?t.concat(o):o)}):c.array(e)&&e.forEach(r=>{let o=this.possibilities(r);!o||(t=t?t.concat(o):o)}),t&&Y.unique(t)};$.prototype.references=function(e,t={}){let r=[];if(c.array(e))e.forEach(o=>{let i=this.references(o,t);i&&(r=r.concat(i))});else if(c.object(e))Object.keys(e).forEach(o=>{let i=this.references(e[o],t);i&&(r=r.concat(i))});else if(ne.isInterpolation(e)){let o=ne.references(e,t);o&&(r=r.concat(o))}return t.unique!==!1&&(r=Y.unique(r)),r.length?r:null};$.prototype.replace=function(e,t={}){return c.array(e)?e=e.map(r=>this.replace(r,t)):c.object(e)?e=J.from(Object.keys(e).map(r=>[r,this.replace(e[r],t)])):ne.isInterpolation(e)&&(e=ne.replace(e,t)),e};var Ge=$;function w(e={},t={}){return e._reactive||(e._reactive=h({},t))}var Qr={prop:()=>C(),default:null,schemable:!0,calculable:!0,validation:null},qt=Qr;var Wt=".",le=["children","order","type","name"],Pe="__REACTIVE_SCEHMA_REFERENCE__";function Xt(e=""){let t=e.split(Wt),r=t.pop();return{names:t,prop:r}}function De(e=[],t=""){return(t?e.concat(t):e).join(Wt)}function zt(e,t){let[r,o]=[e.schema.references(t),{}];return r?(r.forEach(i=>{let a=e.schema.reference.parse(i),n=c.object(a);if(n&&(n=c.nonblankString(a.id)),n&&(n=c.nonblankString(a.prop)),n)return o[i]=JSON.stringify(a);b({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:`Cannot find reference provider of '${i}'.`})}),e.schema.replace(t,o)):t}function Jt(e,t){let[r,o]=[e.schema.references(t),{}];return r?(r.forEach(i=>{let a=null;try{a=JSON.parse(i)}catch(s){return}let n=e.schema.reference.stringify(a);if(c.nonblankString(n))return o[i]=n;b({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:`Cannot find reference of provider '${i}'.`})}),e.schema.replace(t,o)):t}function Qt(e={},t={}){return h(h(h({},qt),t),e)}function Zt(e={}){return Object.keys(e).forEach(t=>{E.function(e[t])||(e[t]=e[t]())}),e}function bt(e={}){let{id:t,prop:r}=e,o=this.get({id:t,prop:"type"}),{props:i,fallback:a}=w(this).installed[o].config.schema;if(!r)return i.map(s=>{let p=Zt(Qt(s,a));return le.includes(p.prop)&&(p.schemable=p.calculable=!1),p});let n=i.find(s=>s.prop===r),l=Zt(Qt(n||a,a));return l.prop=r,le.includes(r)&&(l.schemable=l.calculable=!1),l}function gt(e="",t={}){var l,s;let{names:r,prop:o}=Xt(e),i=t.under||this.family.root(),[a,n]=[null,i.id];if(!r.length||this.family.hasnt({id:n}))return null;for(;a=r.shift();){if(n=(s=(l=this.family.descendant({id:n}))==null?void 0:l.find(y=>this.get({id:y.id,prop:"name"})===a))==null?void 0:s.id,!n)return null;let p=this.get({id:n,prop:"type"}),u=w(this).installed[p].config.schema.reference.parse;if(u)return e=De(r,o),u.call(this,{id:n},e)}return{id:n,prop:o}}function At(e={},t={}){let{id:r,prop:o}=e,i=t.under||this.family.root();if(this.family.hasnt({id:r}))return"";let a=this.family.ancestor({id:r},{deep:!0,self:!0}),[n,l]=[a.findIndex(p=>p.id===i.id),[]];if(n<0||(a=a.slice(0,n),!a.length))return"";let s=null;for(;s=a.pop();){l.push(this.get({id:s.id,prop:"name"}));let p=this.get({id:s.id,prop:"type"}),u=w(this).installed[p].config.schema.reference.stringify;if(u){let y=De(l);return u.call(this,{id:s.id,reference:y},o)}}return De(l,o)}function _t(e){let t=Ge.create({parseReference(r){return e.get(JSON.parse(r))},parseExpression(r={}){return e.validator.mustbeSupported(r),!e.validator.error(r)}});return t.for=bt.bind(e),t.reference={parse:gt.bind(e),stringify:At.bind(e)},t}var er={name:"dataType",ruleType:["String","Array"],valueType:"*",validate(e,t){if(!A.within({type:A.get(e),types:t}))return`Must be valid data type with in ${t}.`}};var tr={name:"equalTo",ruleType:"*",valueType:"*",validate(e,t){if(e!==t)return`Must be equal to ${t}.`}};var rr={name:"isInteger",valueType:"Number",validate(e){if(!c.integer(e))return`${e} is not an integer.`}};var or={name:"maxLength",ruleType:"Number",valueType:["String","Array"],validateRule(e){if(!c.positiveInteger(e))return"The rule of 'maxLength' validator must be a positive integer."},validate(e,t){if(e.length>t)return`Must has a length not greater than ${t}`}};var ir={name:"presence",valueType:"*",validate(e){if(c.blank(e))return"Musn't be blank."}};var ar={name:"withFormat",ruleType:"RegExp",valueType:"String",validate(e,t){if(!e.match(t))return`Must match format of ${t}`}};var nr=[ir,er,rr,ar,tr,or];function z(e={},t={}){return e._validator||(e._validator=h({},t))}var It=class{constructor(){z(this,{installed:{}}),nr.forEach(t=>this.install(t))}static create(...t){return new It(...t)}},_=It;I(_,"exceptions",{CONFLICTED_NAME:"VALIDATOR_CONFLICTED_NAME",VALIDATION_FAILED:"VALIDATOR_VALIDATION_FAILED",UNSUPPORTED_VALIDATION:"VALIDATOR_UNSUPPORTED_VALIDATION",UNSUPPORTED_VALIDATION_RULE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE"});var lr="valOf";function Fe(e={}){let t=e[lr];e=J.exclude(e,[lr]);let r=Object.keys(e)[0],o=e[r];return{name:r,rule:o,value:t}}_.prototype.mustbeSupported=function(e={},t={}){m.object(e,"Any validation");let r="strict"in t?t.strict:!0,{name:o,rule:i}=Fe(e),{installed:a}=z(this),n=a[o];if(!n&&b({type:_.exceptions.UNSUPPORTED_VALIDATION,message:`Validator '${o}' is not supported.`}),!(!r||!n.ruleType))try{if(A.mustWithin({type:A.get(i),types:n.ruleType}),n.validateRule){let l=n.validateRule(i);if(l)throw new Error(l)}}catch(l){b({type:_.exceptions.UNSUPPORTED_VALIDATION_RULE,message:l.message||`Validation rule ${i} is not supported.`})}};_.prototype.error=function(e={},t){let r=null;try{this.mustbeSupported(e)}catch(o){r=o}if(!r){let{installed:o}=z(this),{name:i,rule:a,value:n}=Fe(e);arguments.length>1&&(n=t);let l=o[i],[s,p]=[A.get(n),l.valueType];try{A.mustWithin({type:s,types:p})}catch(d){r=d}r||(r=l.validate(n,a))}return r?P.create({type:_.exceptions.VALIDATION_FAILED,message:(()=>{let o="The value is not valid.";return c.string(r)?r:r instanceof Error&&r.message||o})()}):null};_.prototype.for=function(e="*",t={}){let[r,o]=[[],z(this).installed],i="except"in t?t.except:[];return E.array(i)&&(i=[i]),Object.values(o).forEach(a=>{i.includes(a.name)||!A.within({type:e,types:a.valueType})||r.push(h({},a))}),r.length?r:null};_.prototype.install=function(e={}){m.object(e,"Any validator installer");let{name:t,valueType:r,ruleType:o,validate:i,validateRule:a}=e;m.nonblankString(t,"Validator name"),m.type(r,"Validator valueType property"),m.function(i,"Validator validate property"),o&&m.type(o,"Validator ruleType property"),a&&m.function(a,"Validator validateRule prop");let{installed:n}=z(this);t in n&&b({type:_.exceptions.CONFLICTED_NAME,message:`Validator name '${t}' has already been occupied.`}),n[t]=T(h({},e),{name:t,valueType:r,ruleType:o,validate:i,validateRule:a})};_.prototype.isSupported=function(...e){try{this.mustbeSupported(...e)}catch(t){return!1}return!0};_.prototype.isValid=function(...e){return!this.error(...e)};_.prototype.isntSupported=function(...e){return!this.isSupported(...e)};_.prototype.isntValid=function(...e){return!this.isValid(...e)};_.prototype.uninstall=function(e=""){let{installed:t}=z(this);e in t&&delete t[e]};function xt(e){return _.create()}function Tt(e){return L.create()}function Ve(e,t){!(t in w(e).installed)&&b({type:e.exceptions.UNINSTALLED_MEMBER_TYPE,message:`Uninstalled member type '${t}'.`})}function Zr(e,t={},r){let{hook:o,handler:i}=t;return E.array(o)&&(o=[o]),E.array(i)&&(i=[i]),i=i.map(a=>a.bind(e)),r?(i=i.map(a=>(n,...l)=>{let s=e.get({id:n.id,prop:"type"});if(s||(s=(n.props||{}).type||"default"),Ve(e,s),s===r)return a(n,...l)}),{hook:o,handler:i}):{hook:o,handler:i}}function Nt(e,t={}){if(!e)return;let r=t.only;E.array(e)&&(e=[e]),e.forEach(o=>{let{hook:i,handler:a}=Zr(this,o,r);i.forEach(n=>a.forEach(l=>this.hooks.add(n,l)))})}function Ot(e){return e.hooks.mount=Nt.bind(e),e.hooks}function St(e){let t=e.get;return e.get=function(r={},o={}){let{id:i,prop:a}=r,n=t.call(e,r,o);if(!n||!n.raw)return n;if("prop"in r){let l=n.raw.value;n.raw.value=sr(e,i,a,l)}else Object.keys(n.raw.values).forEach(l=>{let s=n.raw.values[l];n.raw.values[l]=sr(e,i,l,s)});return n}}function sr(e,t,r,o){return le.includes(r)||!e.schema.for({id:t,prop:r}).schemable?o:Jt(e,o)}function pr(e={}){let{installed:t}=w(this),r=e.type,o=c.function(e.collect)?e.collect:null,i=c.function(e.seed)?e.seed:null,a="hooks"in e?e.hooks:[],n="schema"in e?e.schema:{},l="props"in n?n.props:[],s="fallback"in n?n.fallback:{},p="reference"in n?n.reference:{},d="parse"in p?p.parse:null,u="stringify"in p?p.stringify:null;m.nonblankString(r,"member type"),i&&m.function(i,"seed function"),o&&m.function(o,"collect function"),d&&m.function(d,"schema.reference.parse function"),u&&m.function(u,"schema.reference.stringify function"),m.array(l,"Installer props schema"),m.object(s,"Installer fallback schema"),m.array(a,"Kernel installer hooks"),l.forEach(y=>m.object(y,"Props schema")),a=a.flat(1/0),a.forEach(y=>{let{hook:k,handler:x,scope:R}=y;R&&m.nonblankString(R),k=c.array(k)?k:[k],x=c.array(x)?x:[x],k.forEach(F=>m.nonblankString(F,"Hook point")),x.forEach(F=>m.function(F,"Hook handler"))}),r in t&&b({type:this.exceptions.CONFLICTED_MEMBER_TYPE,message:`Reactive member type '${r}' is already occupied.`}),t[r]={config:{type:r,hooks:a,collect:o,seed:i,schema:{fallback:s,props:l,reference:{parse:d,stringify:u}}}},a.forEach(y=>{if(!y.scope)return this.hooks.mount(y,{only:r});let k=c.array(y.hook)?y.hook:[y.hook];(c.array(y.handler)?y.handler:[y.handler]).forEach(R=>k.forEach(F=>{Object.keys(t).some(K=>K!==r&&t[K].config.hooks.some(M=>{let ce=c.array(M.hook)?M.hook:[M.hook],Dt=c.array(M.handler)?M.handler:[M.handler];return M.scope===y.scope&&Dt.includes(R)&&ce.includes(F)}))||this.hooks.mount(T(h({},y),{hook:F,handler:R}),{only:y.scope})}))})}function Lt(e={},t={}){let{id:r}=e;if(this.family.hasnt({id:r}))return null;let o="errors"in t?t.errors:!0,[i,a]=[t.only||[],t.except||[]];E.array(i)&&(i=[i]),E.array(a)&&(a=[a]);let{values:n,raw:l}=ur(this,r);if(n=vt(this,n,i,a),l.values=vt(this,l.values,i,a),!o)return{values:n,raw:l};let[s,p]=eo(this,r);return{values:n,errors:s,raw:T(h({},l),{errors:p})}}function ur(e,t){let r=e.get({id:t,prop:"type"}),o=w(e).installed[r].config.collect;if(o){let l=o.call(e,{id:t});return l||(l={}),l.values||(l.values={}),l.raw||(l.raw={}),l.raw.values||(l.raw.values={}),l}let{values:i,raw:a}=e.get({id:t},{include:"raw"});i.children=[],a.values.children=[];let n=e.family.descendant({id:t});return n?(n.forEach(l=>{let s=ur(e,l.id);i.children.push(s.values),a.values.children.push(s.raw.values)}),{values:i,raw:a}):{values:i,raw:a}}function vt(e,t={},r=[],o=[]){return Object.keys(t).forEach(i=>{r.length&&!r.includes(i)&&delete t[i],o.length&&o.includes(i)&&delete t[i]}),t.children&&t.children.forEach((i,a)=>{t.children[a]=vt(e,i,r,o)}),t}function eo(e,t){let[r,o]=[[],[]];return e.family.descendant({id:t},{deep:!0,self:!0}).forEach(({id:a})=>{let n=e.get({id:a},{include:["raw","error"]});n.errors&&r.push({id:a,errors:n.errors}),n.raw.errors&&o.push({id:a,errors:n.raw.errors})}),[r.length?r:null,o.length?o:null]}function kt(e={},t={},r={}){let o="execute"in r?r.execute:!0;if(o&&this.family.hasnt({id:e.id}))return;let[i,a,n]=[null,[{id:e.id,props:t}],[]];for(;i=a.shift();){let[l,s]=[i.id,i.props],p=this.family.has({id:l}),d=(()=>p?this.get({id:l,prop:"type"}):s.type||"default")(),u=w(this).installed[d].config.seed;if(u){let y=u.call(this,{id:l},s);y&&(n=n.concat(y))}else Object.keys(s).forEach(y=>{if(y!=="children"){let R={action:"set",id:l,prop:y,value:s[y]};return n.push(R)}let[k,x]=[l,this.family.descendant({id:l})||[]];s.children.forEach((R,F)=>{if(x[F])return a.push({id:x[F].id,props:R});let[O,K,M]=[C(),R.name,R.type||"default"],ce={action:"add",parentId:k,id:O,props:{type:M,name:K}};n.push(ce),a.push({id:O,props:T(h({},R),{type:M})})})})}return o?this.executor.run(n):n}var to=[{hook:"before-add",handler(e){let t=(e.props||{}).type||"default";Ve(this,t)}}],fr=to;var ro=[{hook:"before-del",handler(e){let{id:t}=e,{family:r,dependency:o}=this,i=r.descendant({id:t},{self:!0}),a={self:!1,group:Pe};o.reliers(i,a)&&b({type:this.exceptions.CONSTRAINTS_EXIST,message:"Cannot delete targets since some of them are referenced."})}}],cr=ro;var oo=[{hook:"after-add",handler(e){let[t,r]=[e.id,(e.props||{}).type||"default"],[o,i]=[this.members,this.naming("type")];o[t][i.raw.prop]=o[t][i.prop]=r,o[t][i.raw.error]=o[t][i.error]=null}},{hook:"before-del",handler(e){let t=this.get({id:e.id,prop:"type"});e.props||(e.props={}),e.props.type=t}}],dr=oo;var io=[{hook:"before-add",handler(e){let{id:t,props:r}=e;r||(e.props={}),e.props.name||(e.props.name=t)}},{hook:"after-add",handler(e){let{id:t,props:r}=e,[o,i]=[this.members,this.naming("name")];o[t][i.raw.prop]=o[t][i.prop]=r.name,o[t][i.raw.error]=o[t][i.error]=null}},{hook:"after-set",handler(e){let{id:t,prop:r,value:o}=e;if(r!=="name")return;let[i,a]=[this.members,this.naming("name")];i[t][a.raw.prop]=i[t][a.prop]=o,i[t][a.raw.error]=i[t][a.error]=null}}],mr=io;var ao=[{hook:["before-set","before-calc"],handler(e){if(e.prop==="type")return!1}}],hr=ao;function Er(e,t,r){let o=e.family.sibling({id:t});!o||o.find(({id:i})=>e.get({id:i,prop:"name"})===r)&&b({type:e.exceptions.CONFLICTED_MEMBER_NAME,message:`Member name '${r}' is already occupied.`})}var no=[{hook:"after-add",handler(e){let{id:t}=e,r=this.get({id:t,prop:"name"});Qe.blank(r,"Member name"),Er(this,t,r)}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(r!=="name")return;let o=this.get({id:t,prop:r},{include:["error","raw"]});if(o.raw.error)return console.warn("Skipping validating member name since prev errors exist.",o.raw.error);try{Qe.blank(o.raw.value,"Member name"),Er(this,t,o.raw.value)}catch(i){this.members[t][this.naming(r).raw.error]=[i]}}}],yr=no;var lo=[{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(le.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let i=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(i.raw.error)return console.warn("Skipping translating schema since prev errors exist.",i.raw.error);let[a,n]=[this.members,this.naming(r)];try{a[t][n.raw.prop]=zt(this,i.raw.value)}catch(l){a[t][n.raw.error]=[l]}}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,{schema:o,dependency:i,family:a,members:n}=this;if(le.includes(r)||!o.for({id:t,prop:r}).schemable)return;i.delete({id:t,prop:r},{only:"relier",group:Pe});let s=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(s.raw.error)return console.warn("Skipping adding new associations since prev errors exist.",s.raw.error);let p=o.references(s.raw.value);if(!p)return;let d=p.map(u=>({relier:{id:t,prop:r},provider:JSON.parse(u)}));d.forEach(u=>{let{provider:y,relier:k}=u,x={self:!0,deep:!0},R=a.ancestor({id:y.id},x);R.forEach((F,O)=>{O!==R.length-1&&d.push({relier:k,provider:{id:F.id,prop:"name"}})})});try{i.add(d,{group:Pe})}catch(u){n[t][this.naming(r).raw.error]=[u]}}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(le.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let o=this.constructor.prototype.get,{value:i,error:a}=o.call(this,{id:t,prop:r},{include:"error"}),[n,l]=[this.members,this.naming(r)];if(a)return n[t][l.prop]=null,console.warn("Skipping parsing schema since prev errors exist.",a);try{n[t][l.prop]=this.schema.parse(i)}catch(s){n[t][l.prop]=null,n[t][l.error]=[s],console.warn("Failed to parse schema.",s)}}}],br=lo;var so=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(le.includes(r))return;let o=this.schema.for({id:t,prop:r});if(!o.schemable||!o.calculable)return;let i=this.constructor.prototype.get,{value:a,error:n}=i.call(this,{id:t,prop:r},{include:"error"}),[l,s]=[this.members,this.naming(r)];if(n){let p=`Skipping trying calculating ${r}`;return p+=" since prev errors exist.",console.warn(p,n)}if(!!this.calculator.isSupported(a,{strict:!1}))try{l[t][s.prop]=this.calculator.calculate(a)}catch(p){l[t][s.error]=[p],console.warn(`Failed to calculate ${r}.`,p)}}}],gr=so;var po=[{hook:"after-add",handler(e,t){let[r,o]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(i=>{o.find(a=>a.prop===i.prop)||o.push({id:r,prop:i.prop,value:i.default})})}}],Ar=po;var uo=[{hook:"after-add",handler(e,t){let[r,o]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(i=>{if(!("always"in i))return;let a=o.find(n=>n.prop===i.prop);if(a)return a.value=i.always;o.push({id:r,prop:i.prop,value:i.always})})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:o}=e,i=this.schema.for({id:t,prop:r});"always"in i&&o!==i.always&&(e.value=i.always)}}],_r=uo;var fo=[{hook:"after-add",handler(e,t){let[r,o]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(i=>{!i.validation||o.find(a=>a.prop===i.prop)||o.push({id:r,prop:i.prop,value:i.default||null})})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e,{value:o,error:i}=this.get({id:t,prop:r},{include:"error"});if(i&&(E.array(i)&&(i=[i]),i=i.find(p=>p.type!==_.exceptions.VALIDATION_FAILED),i)){let p="Skipping validating value of prop";return p+=`'${r}' since prev errors exist.`,console.warn(p,i)}let{validation:a}=this.schema.for({id:t,prop:r}),[n,l]=[this.members,this.naming(r)];if(!a||(E.array(a)&&(a=[a]),(a.find(p=>"presence"in p)||E.blank(o))&&a.some(p=>{try{return c.function(p)?i=p.call(this,{id:t,prop:r,value:o}):i=this.validator.error(p,o)}catch(d){return i=d}}),!i))return n[t][l.error]=null;n[t][l.error]=[P.create({type:_.exceptions.VALIDATION_FAILED,message:c.string(i)?i:i.message||i.name})]}}],Ir=fo;var xr=[];function Rt(e={}){let t=e.accept;E.array(t)&&(t=[t]),t.forEach(o=>m.nonblankString(o));let r=xr.find(o=>o.accept.length!==t.length?!1:!o.accept.some(i=>!t.includes(i)));return r||(r={accept:t,HOOKS:[{hook:"before-add",handler(o){let i=(o.props||{}).type||"default",a=this.get({id:o.parentId,prop:"type"});!t.includes(a)&&b({type:this.exceptions.INVALID_PARENT,message:`'${i}' type members can only be
                   inserted into '${JSON.stringify(t)}' type parent.`})}}]},xr.push(r)),r.HOOKS}var Ct={CONFLICTED_MEMBER_TYPE:"REACTIVE_CONFLICTED_MEMBER_TYPE",UNINSTALLED_MEMBER_TYPE:"REACTIVE_UNINSTALLED_MEMBER_TYPE",CONSTRAINTS_EXIST:"REACTIVE_CONSTRAINTS_EXIST",CONFLICTED_MEMBER_NAME:"REACTIVE_CONFLICTED_MEMBER_NAME",REFERENCED_PROVIDER_NOT_FOUND:"REACTIVE_REFERENCED_PROVIDER_NOT_FOUND",INVALID_PARENT:"REACTIVE_INVALID_PARENT",HOOK_NOT_EXIST:"REACTIVE_HOOK_NOT_EXIST",VALIDATION_FAILED:"REACTIVE_VALIDATION_FAILED"},qe={ENABLE_SCHEMA_DEFAULT:Ar,ENABLE_SCHEMA_ALWAYS:_r,ENABLE_SCHEMA_VALIDATION:Ir,BLOCK_INVALID_PARENT:Rt};function g(){let e=v.create();w(e,{installed:{}}),e.guid=C,e.exceptions=Ct,e.seed=kt.bind(e),e.collect=Lt.bind(e),e.install=pr.bind(e),e.get=St(e),e.schema=_t(e),e.validator=xt(e),e.calculator=Tt(e),e.hooks=Ot(e),e.hooks.mount(fr),e.hooks.mount(cr),e.hooks.mount(dr),e.hooks.mount(mr),e.hooks.mount(hr),e.hooks.mount(yr),e.hooks.mount(br),e.hooks.mount(gr),e.install({type:"default",schema:{props:[{prop:"name"}]}});let t=e.members[e.family.root().id],r=e.naming("type");return t[r.raw.prop]=t[r.prop]="default",e}g.guid=C;g.exceptions=Ct;g.hooks={use(e,...t){return!(e in qe)&&b({type:Ct.HOOK_NOT_EXIST}),E.function(qe[e])?qe[e]:qe[e](...t)}};fe.hooks=[g.hooks.use("ENABLE_SCHEMA_DEFAULT"),g.hooks.use("ENABLE_SCHEMA_VALIDATION")];fe.schema={fallback:{prop:()=>g.guid(),label:()=>g.guid(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:"",hint:""},props:[{prop:"name",label:"Fieldset Name",placeholder:"E.g, fields",hint:""},{prop:"label",label:"Fieldset Title",default:"",schemable:!1,calculable:!1,validation:[{dataType:"String"}],placeholder:"E.g, User Information",hint:""},{prop:"description",label:"Fieldset Description",default:"",schemable:!1,calculable:!1,validation:[{dataType:"String"}],placeholder:"E.g, This fieldset should be...",hint:""}]};var f=class{};I(f,"GROUP_NAME","field"),I(f,"PARENT_TYPE","Fieldset"),I(f,"exceptions",{PROP_SCHEMA_NOT_EXIST:"FIELD_PROP_SCHEMA_NOT_EXIST",HOOK_NOT_EXIST:"FIELD_HOOK_NOT_EXIST",INVALID_PARENT:"FIELD_INVALID_PARENT",UNINSTALLED_TYPE:"FIELD_UNINSTALLED_TYPE"});f.extend=function(e={}){let{type:t,hooks:r,schema:o}=h({},e);return!r&&(r=f.hooks.default()),!o&&(o=f.schema.default()),!o.fallback&&(o.fallback=f.schema.default("fallback")),!o.props&&(o.props=f.schema.default("props")),T(h({},e),{group:f.GROUP_NAME,type:t,hooks:r,schema:o})};var co=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"calculation"};this.dependency.add({provider:r,relier:t})}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(r!=="calculation")return;let o=this.get({id:t,prop:r},{include:["error","raw"]});if(o.raw.error){let l="Skipping checking whether calculations are supported";return l+=" since prev errors exist.",console.warn(l,o.raw.error)}if(!o.raw.value)return;let i=this.schema.possibilities(o.raw.value);i||(i=[o.raw.value]);let[a,n]=[this.members,this.naming(r)];i.some(l=>!l||this.calculator.isSupported(l,{strict:!1})?!1:(l=c.object(l)?JSON.stringify(l):l,a[t][n.raw.error]=[P.create({type:L.exceptions.UNSUPPORTED_CALCULATION,message:`Unsupported calculation algorithm ${l}.`})],!0))}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="calculation")return;let o=this.get({id:t,prop:r},{include:["raw","error"]});if(o.error)return console.warn("Skipping using calculated value since prev errors exist.",o.error);!o.raw.value||this.set({id:t,prop:"value",value:o.value})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:o}=e;if(r!=="value")return;let i=this.get({id:t,prop:"calculation"},{include:"raw"});if(i.raw.value&&o!==i.value)return!1}}],Tr=co;var mo=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"validation"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let o=this.get({id:t,prop:"validation"},{include:"error"});if(o.error){let p=`Skipping validating ${r} using field validation`;return p+=" since field validation has errors.",console.warn(p,o.error)}if(!o.value)return;let{value:i,error:a}=this.get({id:t,prop:r},{include:"error"});if(a){let p="Skipping validating value using validation rules";return p+=" since prev value errors exist.",console.warn(p,a)}E.array(o.value)&&(o.value=[o.value]),(o.value.find(p=>p&&"presence"in p)||E.blank(i))&&o.value.some(p=>{try{return a=this.validator.error(p,i)}catch(d){return a=d}});let[l,s]=[this.members,this.naming(r)];if(!a)return l[t][s.error]=null;l[t][s.error]=[P.create({type:_.exceptions.VALIDATION_FAILED,message:c.string(a)?a:a.message||a.name})]}}],Nr=mo;var ho=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"options"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let{value:o,error:i}=this.get({id:t,prop:r},{include:"error"});if(i){let d="Skipping checking if value is within field options";return d+=" since prev value errors exist.",console.warn(d,i)}let a=this.get({id:t,prop:"options"},{include:"error"});if(a.error){let d="Skipping checking if value is within field options";return d+=" since field options has errors.",console.warn(d,a.error)}if(!a.value)return;let[n,l]=[this.members,this.naming(r)];if(c.blank(o))return n[t][l.error]=null;let s=a.value.map(d=>d.value);if(E.array(o)&&(o=[o]),!o.some(d=>!s.includes(d)))return n[t][l.error]=null;n[t][l.error]=[P.create({type:_.exceptions.VALIDATION_FAILED,message:"Each picked value must be included in option values."})]}}],Or=ho;var We={ENABLE_VALUE_CALCULATION:Tr,ENABLE_VALUE_VALIDATION:Nr,ENSURE_VALUE_WITHIN_OPTIONS:Or},Eo=[g.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),g.hooks.use("ENABLE_SCHEMA_DEFAULT"),We.ENABLE_VALUE_CALCULATION,g.hooks.use("ENABLE_SCHEMA_VALIDATION"),We.ENABLE_VALUE_VALIDATION];f.hooks={use(e){return!(e in We)&&b({type:f.exceptions.HOOK_NOT_EXIST}),We[e]},default(){return Eo.slice()}};var we={FALLBACK:{prop:()=>C(),label:()=>C(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:"",hint:""},PROPS:[{prop:"name",label:"Name",placeholder:"E.g, name",hint:""},{prop:"label",label:"Label",default:"A Form Field",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],placeholder:"E.g, Username",hint:""},{prop:"value",label:"Value",default:null,schemable:!1,calculable:!1,validation:null,placeholder:"E.g, Jim",hint:""},{prop:"placeholder",label:"Placeholder",default:"",schemable:!1,calculable:!1,validation:[{dataType:"String"}],placeholder:"E.g, Placeholder",hint:""},{prop:"editable",label:"If Editable",default:!0,schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],placeholder:"E.g, Yes",hint:""},{prop:"visible",label:"If Visible",default:!0,schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],placeholder:"E.g, Yes",hint:""},{prop:"validation",label:"Validation",default:null,schemable:!0,calculable:!0,validation:[{dataType:"Array"}],placeholder:"E.g, Must be present",hint:"Validation rules applied to the value of this filed."},{prop:"calculation",label:"Calculation",default:null,schemable:!0,calculable:!0,validation:null,placeholder:'E.g, {add: ["<< fields.age >>", "<< fields.count >>"]}',hint:"Calculation rules applied to the value of this filed."}]},yo={PROPS:[{prop:"options",label:"Options",default:[{label:"Option 1",value:"1"}],schemable:!1,calculable:!1,placeholder:"E.g, Options",hint:"",validation:[{presence:!0},{dataType:"Array"},function(e){let t=e.value;t.forEach((r,o)=>{m.object(r,"Each option"),m.string(r.label,"Option label"),m.string(r.value,"Option value"),t.some((i,a)=>a!==o&&i.value===r.value)&&b({type:_.exceptions.VALIDATION_FAILED,message:"Option value must be unique."})})}]}]};f.schema={use(e){return h({},Sr(e))},extend(e,t={}){return h(h({},Sr(e)),t)},default(e){return e==="fallback"?h({},we.FALLBACK):e==="props"?we.PROPS.slice():{fallback:h({},we.FALLBACK),props:we.PROPS.slice()}}};function Sr(e){let r=we.PROPS.concat(yo.PROPS).find(o=>o.prop===e);return!r&&b({type:f.exceptions.PROP_SCHEMA_NOT_EXIST,message:`Prop schema of '${e}' does not exist.`}),r}var Lr=f.extend({type:"CheckboxField",hooks:[g.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),g.hooks.use("ENABLE_SCHEMA_DEFAULT"),f.hooks.use("ENABLE_VALUE_CALCULATION"),g.hooks.use("ENABLE_SCHEMA_VALIDATION"),f.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),f.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[f.schema.use("name"),f.schema.extend("label",{default:"A Checkbox Field",placeholder:"E.g, A Checkbox Field."}),f.schema.extend("value",{validation:[{dataType:"Array"}]}),f.schema.use("options"),f.schema.use("editable"),f.schema.use("visible"),f.schema.use("validation"),f.schema.use("calculation")]}});var vr=f.extend({type:"MultipleSelectField",hooks:[g.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),g.hooks.use("ENABLE_SCHEMA_DEFAULT"),f.hooks.use("ENABLE_VALUE_CALCULATION"),g.hooks.use("ENABLE_SCHEMA_VALIDATION"),f.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),f.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[f.schema.use("name"),f.schema.extend("label",{default:"A Multiple Select Field",placeholder:"E.g, A Multiple Select Field"}),f.schema.extend("placeholder",{default:"E.g, Jim, Jerry"}),f.schema.extend("value",{placeholder:"E.g, Jim, Jerry",validation:[{dataType:"Array"}]}),f.schema.use("options"),f.schema.use("editable"),f.schema.use("visible"),f.schema.use("validation"),f.schema.use("calculation")]}});var kr=f.extend({type:"NumberField",schema:{props:[f.schema.use("name"),f.schema.extend("label",{default:"A Number Field",placeholder:"E.g, Age"}),f.schema.extend("placeholder",{placeholder:"E.g, 100"}),f.schema.extend("value",{placeholder:"E.g, 100",validation:[{dataType:"Number"}]}),f.schema.use("editable"),f.schema.use("visible"),f.schema.use("validation"),f.schema.use("calculation")]}});var Rr=f.extend({type:"RadioField",hooks:[g.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),g.hooks.use("ENABLE_SCHEMA_DEFAULT"),f.hooks.use("ENABLE_VALUE_CALCULATION"),g.hooks.use("ENABLE_SCHEMA_VALIDATION"),f.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),f.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[f.schema.use("name"),f.schema.extend("label",{default:"A Radio Field",placeholder:"E.g, A Radio Field."}),f.schema.extend("value",{validation:[{dataType:"String"}]}),f.schema.use("options"),f.schema.use("editable"),f.schema.use("visible"),f.schema.use("validation"),f.schema.use("calculation")]}});var Cr=f.extend({type:"SingleSelectField",hooks:[g.hooks.use("BLOCK_INVALID_PARENT",{accept:f.PARENT_TYPE}),g.hooks.use("ENABLE_SCHEMA_DEFAULT"),f.hooks.use("ENABLE_VALUE_CALCULATION"),g.hooks.use("ENABLE_SCHEMA_VALIDATION"),f.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),f.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[f.schema.use("name"),f.schema.extend("label",{default:"A Single Select Field",placeholder:"E.g, A Single Select Field"}),f.schema.extend("placeholder",{default:"E.g, Jim"}),f.schema.extend("value",{placeholder:"E.g, Jim",validation:[{dataType:"String"}]}),f.schema.use("options"),f.schema.use("editable"),f.schema.use("visible"),f.schema.use("validation"),f.schema.use("calculation")]}});var Pr=f.extend({type:"TextField",schema:{props:[f.schema.use("name"),f.schema.extend("label",{default:"A Text Field"}),f.schema.use("placeholder"),f.schema.extend("value",{validation:[{dataType:"String"}]}),f.schema.use("editable"),f.schema.use("visible"),f.schema.use("validation"),f.schema.use("calculation")]}});var Pt=[Pr,kr,Cr,vr,Rr,Lr];var G={type:"Subform"};G.collect=function(e){let t=this.get({id:e.id},{include:"raw"}),[r,o]=[[],[]],[i,a]=[[],[]];return(this.family.descendant(e)||[]).forEach((n,l)=>{let[s,p]=[{},{}];(this.family.descendant(n)||[]).forEach(d=>{let u=this.collect({id:d.id},{errors:!1});s[u.values.name]=u.values.value,p[u.values.name]=u.raw.values.value,l===0&&(delete u.values.value,delete u.raw.values.value,i.push(u.values),a.push(u.raw.values))}),r.push(s),o.push(p)}),t.values.value=r,t.raw.values.value=o,t.values.children=i,t.raw.values.children=a,t};G.hooks=[g.hooks.use("BLOCK_INVALID_PARENT",{accept:"Fieldset"}),g.hooks.use("ENABLE_SCHEMA_DEFAULT"),g.hooks.use("ENABLE_SCHEMA_VALIDATION")];G.schema={fallback:{prop:()=>g.guid(),label:()=>g.guid(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:"",hint:""},props:[{prop:"name",label:"Name",placeholder:"E.g, subform",hint:""},{prop:"label",label:"Label",default:"A Subform",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],placeholder:"E.g, A subform",hint:""},{prop:"editable",label:"If Editable",default:!0,schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],placeholder:"E.g, Yes",hint:""},{prop:"visible",label:"If Visible",default:!0,schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],placeholder:"E.g, Yes",hint:""}]};G.seed=function(e,t){let r=t.children||[],o=t.value||[];!o.length&&o.push({});let i=o.map(()=>{let[l,s]=[this.guid(),"SubformFieldset"];return{action:"add",parentId:e.id,id:l,props:{type:s}}}),a=Object.keys(t).map(l=>{if(!["children","value"].includes(l))return{action:"set",id:e.id,prop:l,value:t[l]}}).filter(l=>l),n=i.map((l,s)=>(r=r.map((p,d)=>{let y=c.object(o[s])&&p.name in o[s]?o[s][p.name]:null;return T(h({},p),{order:d,value:y})}),this.seed({id:l.id},{children:r},{execute:!1}))).flat();return i.concat(a,n).map(l=>T(h({},l),{__syncSubformField__:!0}))};var pe={type:"SubformFieldset"};pe.hooks=[g.hooks.use("BLOCK_INVALID_PARENT",{accept:"Subform"})];var U=class{};I(U,"GROUP_NAME","SubformField"),I(U,"PARENT_TYPE","SubformFieldset"),I(U,"TYPE_PREFIX","Subform"),I(U,"LABEL_PREFIX","Subform "),I(U,"exceptions",{INVALID_PARENT:"SUBFORM_FIELD_INVALID_PARENT",INVALID_FIELD_INSTALLER:"SUBFORM_FIELD_INVALID_FIELD_INSTALLER"});var bo=[{hook:"before-add",handler(e){let{parentId:t,props:r,__syncSubformField__:o}=e;if(o)return;let i=[T(h({},e),{action:"add",__syncSubformField__:!0})],a=this.family.sibling({id:t})||[];return i=i.concat(a.map(n=>({action:"add",__syncSubformField__:!0,parentId:n.id,id:this.guid(),props:r}))),this.executor.run(i),!1}},{hook:"before-del",handler(e){let{id:t,__syncSubformField__:r}=e;if(r)return;let o=[T(h({},e),{action:"del",__syncSubformField__:!0})],a=this.family.sibling({id:t},{self:!0}).findIndex(s=>s.id===t),n=this.family.ancestor({id:t}),l=this.family.sibling(n)||[];return o=o.concat(l.map(s=>({action:"del",__syncSubformField__:!0,id:this.family.descendant(s)[a].id}))),this.executor.run(o),!1}},{hook:"before-set",handler(e){let{id:t,prop:r,value:o,__syncSubformField__:i}=e;if(i||r==="value")return;let a=[T(h({},e),{action:"set",__syncSubformField__:!0})],l=this.family.sibling({id:t},{self:!0}).findIndex(d=>d.id===t),s=this.family.ancestor({id:t}),p=this.family.sibling(s)||[];return a=a.concat(p.map(d=>({action:"set",__syncSubformField__:!0,id:this.family.descendant(d)[l].id,prop:r,value:o}))),this.executor.run(a),!1}},{scope:pe.type,hook:"after-add",handler(e){let{id:t,props:r}=e,o=this.family.sibling({id:t});if(!o)return;let i=this.collect({id:o[0].id}).raw.values.children;if(!i.length)return;let a=i.map((n,l)=>{let s=((r==null?void 0:r.children)||[])[l]||{},p="value"in s?s.value:null;return{action:"add",__syncSubformField__:!0,parentId:t,id:this.guid(),props:T(h({},n),{order:l,value:p})}});this.executor.run(a)}}],Dr=bo;var go=[{hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:o,schema:i}=this;if(!i.for({id:t}).find(p=>p.prop==="value"))return;let n=r.ancestor({id:t}),s={id:r.ancestor(n).id,prop:"value"};o.add({relier:s,provider:{id:t,prop:"name"}}),o.add({relier:s,provider:{id:t,prop:"value"}})}},{scope:pe.type,hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:o}=this,a={id:r.ancestor({id:t}).id,prop:"value"};o.add({relier:a,provider:{id:t,prop:"order"}})}},{scope:G.type,hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let{family:o}=this,i=(o.descendant({id:t})||[]).map(a=>J.from((o.descendant(a)||[]).map(n=>{let l=this.get({id:n.id,prop:"name"}),s=this.get({id:n.id,prop:"value"});return[l,s]})));this.members[t][this.naming(r).prop]=i}}],Fr=go;U.generate=function(e={}){e.group!==f.GROUP_NAME&&b({type:U.exceptions.INVALID_FIELD_INSTALLER,message:`SubformField.generate only accepts field installer
             to generate a subform field installer.`});let t=e.hooks.slice(),r=U.TYPE_PREFIX+e.type,o="BLOCK_INVALID_PARENT",i=g.hooks.use(o,{accept:f.PARENT_TYPE}),a=g.hooks.use(o,{accept:U.PARENT_TYPE}),n=t.indexOf(i);return n>-1&&(t[n]=a),t=t.concat(Dr,Fr),T(h({},e),{type:r,group:U.GROUP_NAME,hooks:t})};var Xe=class{constructor(){this.reactive=g(),Xe.MEMBERS.forEach(t=>this.reactive.install(t))}static create(...t){return new Xe(...t)}},N=Xe;I(N,"MEMBERS",[]),I(N,"Reactive",g),I(N,"Field",f);N.group=function(e=""){let t=N.MEMBERS.filter(r=>e?r.group===e:!r.group);return t.length?t:null};N.install=function(e={}){E.array(e)&&(e=[e]),e.forEach(t=>{let{type:r,label:o,group:i,providers:a,validators:n}=h({},t);m.nonblankString(r,"Type"),i&&m.nonblankString(i,"Group"),o&&m.nonblankString(o,"Label"),a&&m.function(a,"Providers"),n&&m.function(n,"Providers"),N.MEMBERS.push(h({},t)),i===f.GROUP_NAME&&N.MEMBERS.push(U.generate(t))})};N.providers=function(e,t={}){var p;let{id:r,prop:o}=t,i=[];o="value";let a=e.get({id:r,prop:"type"}),n=(p=N.MEMBERS.find(d=>d.type===a))==null?void 0:p.providers;if(n)return n.call(e,{id:r,prop:o});if(Object.keys(e.members).forEach(d=>{if(d===r)return;let u=e.family.ancestor({id:d});!u||e.get({id:u.id,prop:"type"})!==fe.type||!(e.naming("value").prop in e.members[d])||i.push({id:d,prop:o})}),!i.length)return null;let l=e.dependency.reliers({id:r,prop:o});if(!l)return i;let s=i.filter(d=>!l.some(u=>d.id===u.id&&d.prop===u.prop));return s.length?s:null};N.uninstall=function(e=""){!e||(N.MEMBERS=N.MEMBERS.filter(t=>t.type!==e))};N.validators=function(e,t={}){var s;let{id:r,prop:o}=t;o="value";let i=e.get({id:r,prop:"type"}),a=(s=N.MEMBERS.find(p=>p.type===i))==null?void 0:s.validators;if(a)return a.call(e,{id:r,prop:o});let n=e.schema.for({id:r,prop:o}).validation||[];E.array(n)&&(n=[n]);let l=n.find(p=>"dataType"in p);return l?e.validator.for(l.dataType,{except:"dataType"}):e.validator.for("*",{except:"dataType"}).find(p=>p.name==="presence")};N.install(fe);N.install(G);N.install(pe);N.install(Pt);return Ao;})();
//# sourceMappingURL=rcfm.model.iife.min.js-06abb391.map
