/*!
 * rcfm 1.0.0 | Model iife | https://reactive-form.github.io/
 * Copyright 2021 - 2022 JLxiangyun | MIT license
 */
var ReactiveForm=(()=>{var ct=Object.defineProperty,Ai=Object.defineProperties;var vi=Object.getOwnPropertyDescriptors;var Jt=Object.getOwnPropertySymbols;var _i=Object.prototype.hasOwnProperty,Ni=Object.prototype.propertyIsEnumerable;var ft=(e,t,r)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t)=>{for(var r in t||(t={}))_i.call(t,r)&&ft(e,r,t[r]);if(Jt)for(var r of Jt(t))Ni.call(t,r)&&ft(e,r,t[r]);return e},x=(e,t)=>Ai(e,vi(t)),Ti=e=>ct(e,"__esModule",{value:!0});var Si=(e,t)=>{Ti(e);for(var r in t)ct(e,r,{get:t[r],enumerable:!0})};var _=(e,t,r)=>(ft(e,typeof t!="symbol"?t+"":t,r),r);var ho={};Si(ho,{Calculator:()=>D,Context:()=>C,Exception:()=>F,Form:()=>k,I18n:()=>M,Reactive:()=>A,Schema:()=>lt,Struct:()=>Me,Type:()=>N,Validator:()=>I,guid:()=>P});var _e=class extends Error{constructor(t={}){typeof t=="string"&&(t={type:t});let{type:r,message:i,data:o}=t;super(i);if(this.type=this.name=r,this.data=o||{},typeof this.data!="object"||Array.isArray(this.data))throw new Error("Exception data must be included in an object.")}static create(...t){return new _e(...t)}static raise(...t){throw new _e(...t)}static isException(t){return t instanceof _e}static isntException(t){return!_e.isException(t)}static mustbeException(t,r=""){_e.isntException(t)&&_e.raise({type:_e.exceptions.INVALID_INSTANCE,message:r||"Invalid exception instance."})}},F=_e;_(F,"exceptions",{INVALID_INSTANCE:"EXCEPTION_INVALID_INSTANCE"});var g=F.raise;var Oi=0;function P(){return`${Date.now()}${Oi+=1}`}var N={ANY_TYPE:"*",SPECIFIC_TYPES:["String","Number","Boolean","Array","Object","RegExp","Function","Null","Undefined","Map","WeakMap","Symbol","File","Blob","Promise"],exceptions:{INVALID_DATA_TYPE:"TYPE_INVALID_DATA_TYPE"},get(e){let t=/\[object\s+(.*)\]/;return Object.prototype.toString.call(e).match(t)[1]},within(e={}){let{type:t,types:r}=e;return!Array.isArray(t)&&(t=[t]),!Array.isArray(r)&&(r=[r]),t.includes(N.ANY_TYPE)||r.includes(N.ANY_TYPE)?!0:!t.some(i=>!r.includes(i))},mustWithin(e={},t=""){!N.within(e)&&g({type:N.exceptions.INVALID_DATA_TYPE,message:t||`Data type ${e.type} isn't within ${e.types}`})}},f=N.is={null(e){return N.get(e)==="Null"},undefined(e){return N.get(e)==="Undefined"},number(e){return N.get(e)==="Number"},integer(e){return Number.isInteger(e)},string(e){return N.get(e)==="String"},boolean(e){return N.get(e)==="Boolean"},array(e){return Array.isArray(e)},object(e){return N.get(e)==="Object"},regexp(e){return N.get(e)==="RegExp"},function(e){return N.get(e)==="Function"},positiveInteger(e){return f.integer(e)&&e>0},negativeInteger(e){return f.integer(e)&&e<0},blankArray(e){return f.array(e)&&e.length===0},blankString(e){return f.string(e)&&!!e.match(/^\s*$/)},blankObject(e){return f.object(e)&&Object.keys(e).length===0},nonblankArray(e){return f.array(e)&&e.length>0},nonblankString(e){return f.string(e)&&!!e.match(/\S/)},nonblankObject(e){return f.object(e)&&Object.keys(e).length>0},typeString(e){return e===N.ANY_TYPE?!0:N.SPECIFIC_TYPES.includes(e)},typeArray(e){return f.nonblankArray(e)?e.every(t=>t===N.ANY_TYPE?!0:N.within({type:t,types:N.SPECIFIC_TYPES})):!1},type(e){return f.typeString(e)||f.typeArray(e)},blank(e){return!!([null,void 0,NaN].includes(e)||f.blankString(e)||f.blankArray(e)||f.blankObject(e))}},h=N.isnt=(()=>{let e={};return Object.keys(f).forEach(t=>{e[t]=function(r){return!f[t](r)}}),e})(),E=N.mustbe=(()=>{let e={};return Object.keys(h).forEach(t=>{e[t]=function(r,i="The argument"){let o=f.object(i)?i.message:"";h[t](r)&&g({type:N.exceptions.INVALID_DATA_TYPE,message:o||`${i} must be '${t.toUpperCase()}'`})}}),e})(),mt=N.musntbe=(()=>{let e={};return Object.keys(f).forEach(t=>{e[t]=function(r,i="The argument"){let o=f.object(i)?i.message:"";f[t](r)&&g({type:N.exceptions.INVALID_DATA_TYPE,message:o||`${i} must not be '${t.toUpperCase()}'`})}}),e})();var Me={},te=Me.array={unique(e=[]){return e.filter((t,r)=>e.indexOf(t)===r)}},z=Me.object={from(e=[]){E.array(e);let t={};return e.forEach(r=>t[r[0]]=r[1]),t},collect(e={},t=[]){E.object(e),E.array(t);let r={};return Object.keys(e).forEach(i=>{t.includes(i)&&(r[i]=e[i])}),r},exclude(e={},t=[]){E.object(e),E.array(t);let r={};return Object.keys(e).forEach(i=>{!t.includes(i)&&(r[i]=e[i])}),r}},Ao=Me.string={capitalize(e=""){return e.replace(/\b\w/g,t=>t.toUpperCase())},dashCase(e=""){let t=/[A-Z]/g,r=i=>`-${i.toLowerCase()}`;return e[0].toLowerCase()+e.slice(1).replace(t,r)}};var Qt={name:"add",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t+r)}};var er={name:"devide",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t/r)}};var tr={name:"map",argumentSize:1,argumentType:"*",calculate(e){return e}};var rr={name:"minus",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t-r)}};var ir={name:"multiple",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t*r)}};var or=[Qt,rr,ir,er,tr];function ce(e={},t={}){return e._calculator||(e._calculator=u({},t))}var dt=class{constructor(){ce(this,{installed:{}}),or.forEach(t=>this.install(t))}static create(...t){return new dt(...t)}},D=dt;_(D,"exceptions",{CONFLICTED_NAME:"CALCULATOR_CONFLICTED_NAME",UNSUPPORTED_CALCULATION:"CALCULATOR_UNSUPPORTED_CALCULATION",INVALID_ARGUMENT_SIZE:"CALCULATOR_INVALID_ARGUMENT_SIZE",INVALID_ARGUMENT_TYPE:"CALCULATOR_INVALID_ARGUMENT_TYPE"});function je(e={}){let t=Object.keys(e)[0],r=e[t];return h.array(r)&&(r=[r]),{name:t,args:r}}function ht(e,t){return e.length>=t.min}function bt(e=[],t){return!e.some((r,i)=>{let o=t;return h.type(o)&&(o=o[i]||o[o.length-1]),!N.within({type:N.get(r),types:o})})}D.prototype.mustbeSupported=function(e={},t={}){E.object(e,"Calculation struct");let r="strict"in t?t.strict:!1,{name:i,args:o}=je(e),{installed:l}=ce(this);!l[i]&&g({type:D.exceptions.UNSUPPORTED_CALCULATION,message:`Unsupported calculator "${i}".`}),!!r&&o.forEach(a=>f.object(a)&&this.mustbeSupported(a,t))};D.prototype.isSupported=function(e={},t={}){try{this.mustbeSupported(e,t)}catch(r){return!1}return!0};D.prototype.isntSupported=function(e={},t={}){return!this.isSupported(e,t)};D.prototype.calculate=function(e={}){if(this.isntSupported(e))return null;let{installed:t}=ce(this),{name:r,args:i}=je(e),{argumentType:o,argumentSize:l,calculate:a}=t[r];return!ht(i,l)||(i=i.slice(0,l.max).map(n=>this.isSupported(n)?this.calculate(n):n),!bt(i,o))?null:a(...i)};function Et(e){return e===1/0?!1:f.positiveInteger(e)?!0:!f.nonblankArray(e)||e.length!==2||!f.positiveInteger(e[0])?!1:e[1]===1/0?!0:e[1]>e[0]}function yt(e){return f.type(e)?!0:h.nonblankArray(e)?!1:e.every(t=>f.typeArray(t))}function gt(e){return{min:f.integer(e)?e:e[0],max:f.integer(e)?e:e[1]}}D.prototype.install=function(e={}){E.object(e,"Calculator installer");let{name:t,argumentSize:r,argumentType:i,calculate:o}=e;E.nonblankString(t,'Calculator installer "name"'),E.function(o,'Calculator installer "calculate"'),!Et(r)&&g({type:D.exceptions.INVALID_ARGUMENT_SIZE,message:'Invalid calculator installer "argumentSize".'}),!yt(i)&&g({type:D.exceptions.INVALID_ARGUMENT_TYPE,message:'Invalid calculator installer "argumentType".'});let{installed:l}=ce(this);t in l&&g({type:D.exceptions.CONFLICTED_NAME,message:`Conflicted calculator name "${t}".`}),l[t]=x(u({},e),{name:t,argumentType:i,calculate:o,argumentSize:gt(r)})};D.prototype.uninstall=function(e=""){let{installed:t}=ce(this);e in t&&delete t[e]};function U(e={},t={}){return e._family||(e._family=u({},t))}var ke=class{constructor(){let t=P();U(this,{rootId:t,members:{[t]:{id:t,parentId:null,order:0}}})}static create(...t){return new ke(...t)}static isFamily(t){return t instanceof ke}static isntFamily(t){return!ke.isFamily(t)}static mustbeFamily(t,r=""){ke.isntFamily(t)&&g({type:ke.exceptions.INVALID_INSTANCE,message:r||"Invalid family instance."})}},R=ke;_(R,"exceptions",{MEMBER_NOT_EXIST:"FAMILY_MEMBER_NOT_EXIST",CONFLICTED_PARENT:"FAMILY_MEMBER_CONFLICTED_PARENT",SELF_REFERENCE:"FAMILY_MEMBER_SELF_REFERENCE",INVALID_INSTANCE:"FAMILY_INVALID_INSTANCE"});function lr(e={},t=[]){t=t.sort((i,o)=>"order"in i?"order"in o?i.order-o.order:-1:1);let r=t.find(i=>"expectedOrder"in i);if(r){let[i,o]=[t.indexOf(r),r.expectedOrder];t.splice(i,1),o<0?t.unshift(r):o>t.length-1?t.push(r):t.splice(o,0,r)}return t.forEach((i,o)=>{delete e[i.id].expectedOrder,e[i.id].order=o}),t}R.prototype.descendant=function(e={},t={}){let{rootId:r,members:i}=U(this),o=e.id||r,l="deep"in t?t.deep:!1,a="self"in t?t.self:!1,n="sort"in t?t.sort:!0;if(!i[o])return null;let[s,p]=[[u({},i[o])],-1];for(;++p<s.length;){let[d,c]=[s[p],[]];if(Object.values(i).forEach(b=>{b.id!==r&&b.parentId===d.id&&c.push(u({},b))}),c.length&&(n&&(c=lr(i,c)),s=s.concat(c)),!l)break}return a||s.shift(),s.length?s:null};R.prototype.add=function(e={}){let{rootId:t,members:r}=U(this),i=e.id||P(),o=(e.parent?e.parent.id:e.parentId)||t,l=e.order||1/0;if(E.nonblankString(i,'Family member "id"'),E.nonblankString(o,'Family member "parentId"'),E.number(l,'Family member "order"'),i===o&&g({type:R.exceptions.SELF_REFERENCE,message:"Any family member's parent cannot be itself."}),!r[o]&&g({type:R.exceptions.MEMBER_NOT_EXIST,message:`Family member ${o} is not existed.`}),r[i]){if(r[i].parentId===o)return u({},r[i]);g({type:R.exceptions.CONFLICTED_PARENT,message:"Any family member's parent cannot be changed."})}return r[i]={id:i,parentId:o,expectedOrder:l,touchedAt:P()},this.descendant({id:o},{sort:!0}),u({},r[i])};R.prototype.ancestor=function(e={},t={}){let{id:r}=e,{members:i}=U(this),o="deep"in t?t.deep:!1,l="self"in t?t.self:!1;if(!i[r])return null;let[a,n]=[[u({},i[r])],-1];for(;++n<a.length;){let s=i[a[n].parentId];if(s&&a.push(u({},s)),!o)break}return o?(l||a.shift(),a.length?a:null):(a.shift(),a[0]?a[0]:null)};R.prototype.delete=function(e={}){let{members:t,rootId:r}=U(this);if(e.id===r)return;let i=t[e.id];if(!i)return;let{parentId:o}=i;this.descendant({id:e.id},{self:!0,deep:!0,sort:!1}).forEach(({id:l})=>delete t[l]),this.descendant({id:o},{sort:!0})};R.prototype.has=function(e={}){let{members:t}=U(this);return e.id in t};R.prototype.hasnt=function(e={}){return!this.has(e)};R.prototype.reorder=function(e={}){let{id:t,order:r}=e,{rootId:i,members:o}=U(this);E.number(r,'Family member "order"'),!(!o[t]||t===i)&&r!==o[t].order&&(o[t].expectedOrder=r,o[t].touchedAt=P(),this.descendant({id:o[t].parentId},{sort:!0}))};R.prototype.root=function(){let{rootId:e,members:t}=U(this);return u({},t[e])};R.prototype.sibling=function(e={},t={}){let{id:r}=e,{members:i,rootId:o}=U(this),l="self"in t?t.self:!1;if(!i[r])return null;if(r===o)return l?[this.root()]:null;let a=this.ancestor({id:r});if(!a)return null;let n=this.descendant(a);return l?n:(n=n.filter(s=>s.id!==r),n.length?n:null)};function K(e={},t={}){return e._dependency||(e._dependency=u({},t))}var Ce=class{constructor(){K(this,{associations:{},group:{reliers:{}},cache:{reliers:{}}})}static create(...t){return new Ce(...t)}static isDependency(t){return t instanceof Ce}static isntDependency(t){return!Ce.isDependency(t)}static mustbeDependency(t,r=""){Ce.isntDependency(t)&&g({type:Ce.exceptions.INVALID_INSTANCE,message:r||"Invalid dependency instance."})}},oe=Ce;_(oe,"exceptions",{CIRCLE_REFERENCE:"DEPENDENCY_CIRCLE_REFERENCE",INVALID_INSTANCE:"DEPENDENCY_INVALID_INSTANCE"});var ar="#",Qe="_";function ae(e={}){let{id:t,prop:r}=e;return t?`${t}${ar}${r||""}`:Qe}function fe(e=""){if(e===Qe)return{id:"",prop:""};let[t,r]=e.split(ar);return{id:t,prop:r}}function Ne(e={},t){if(!t)return Object.keys(e).forEach(l=>delete e[l]);let{id:r,prop:i}=t;if(!r)return delete e[Qe];let o=ae({id:r,prop:i});i?(delete e[o],delete e[ae({id:r})],Object.keys(e).forEach(l=>{e[l].includes(o)&&delete e[l]})):Object.keys(e).forEach(l=>{(fe(l).id===r||e[l].includes(o))&&delete e[l]})}var Fe="__GLOBAL__";oe.prototype.add=function(e=[],t={}){let r="group"in t?t.group:Fe;E.nonblankString(r,'Association "group"'),h.array(e)&&(e=[e]),e=e.map(({provider:l,relier:a})=>{E.nonblankString(a.id,'Association "relier.id"'),E.nonblankString(l.id,'Association "provider.id"'),E.nonblankString(a.prop,'Association "relier.prop"'),E.nonblankString(l.prop,'Association "provider.prop"');let n={provider:ae(l),relier:ae(a)};return{provider:l,relier:a,path:n}});let{error:i,rollbackQueue:o}=Li(this,e);if(!i)return ki(this,e,r);throw Ri(this,o),i};function Li(e,t){let r=[],{associations:i}=K(e),o=K(e).cache.reliers;return t.some(({provider:a,relier:n,path:s})=>{if(s.provider===s.relier)return!0;let p=e.reliers(n,{split:!1});return p&&p.includes(s.provider)?!0:(i[s.provider]||(i[s.provider]=[]),i[s.provider].includes(s.relier)||(i[s.provider].push(s.relier),r.push({provider:a,relier:n,path:s}),Ne(o,a)),!1)})?{rollbackQueue:r,error:F.create({type:oe.exceptions.CIRCLE_REFERENCE})}:{error:null,rollbackQueue:null}}function Ri(e,t){let{associations:r}=K(e),i=K(e).cache.reliers;t.forEach(({provider:o,path:l})=>{let a=r[l.provider].indexOf(l.relier);a<0||(r[l.provider].splice(a,1),!r[l.provider].length&&delete r[l.provider],Ne(i,o))})}function ki(e,t,r){let i=K(e).group.reliers;t.forEach(({path:o})=>{let l=i[o.provider]||(i[o.provider]={}),a=l[o.relier]||(l[o.relier]=[]);!a.includes(r)&&a.push(r)})}oe.prototype.delete=function(e={},t={}){let{id:r,prop:i}=e;if(!r)return;let{only:o,group:l}=t,a=ae(e),{associations:n}=K(this),s=K(this).cache.reliers,p=K(this).group.reliers,d=i?c=>c===a:c=>fe(c).id===r;o!=="relier"&&(Ne(s,e),i?(delete n[a],delete p[a]):Object.keys(n).map(c=>{!d(c)||(delete n[c],delete p[c])})),Object.keys(n).forEach(c=>{let b=n[c].length;n[c]=n[c].filter(v=>{if(!d(v))return!0;if(o!=="relier"||!l||l===Fe)return delete p[c][v],!1;let O=p[c][v].findIndex(V=>V===l);return O>=0&&p[c][v].splice(O,1),p[c][v].length?!0:(delete p[c][v],!1)});let S=n[c].length;S!==b&&(Ne(s,fe(c)),!S&&delete n[c],!Object.keys(p[c]).length&&delete p[c])})};oe.prototype.reliers=function(e=[],t={}){h.array(e)&&(e=[e]);let r=e.some(L=>h.object(L)||!L.id);r&&(e=[{}]);let i="reload"in t?t.reload:!1,o="split"in t?t.split:!0,l="deep"in t?t.deep:!0,a="self"in t?t.self:!0,n="group"in t?t.group:"",{associations:s}=K(this),p=K(this).cache.reliers,d=K(this).group.reliers,[c,b,S]=[[],[],[]];if(e.forEach(L=>{let ee=ae(L);if("prop"in L?S.push(ee):Object.keys(s).forEach(G=>{fe(G).id===L.id&&S.push(G)}),b.push(L.id),!Ci(s,L))return Ne(p,L);(i||!(ee in p))&&(p[ee]=Fi(s,L),p[ee]=nr(s,p[ee])),c=c.concat(p[ee])}),!c.length)return null;if(e.length>1&&(c=nr(s,te.unique(c))),r||l&&a&&(!n||n===Fe))return o?c.map(L=>fe(L)):c;let[v,O]=[[],S.slice()],V=S.map(L=>s[L]).flat();return c.forEach(L=>{if(!l&&!V.includes(L))return;let ee=fe(L);if(!(!a&&b.includes(ee.id))){if(n&&n!==Fe){let G=Object.keys(d).some(Re=>!O.includes(Re)||!Object.keys(d[Re]).includes(L)?!1:d[Re][L].includes(n));if(O.push(L),!G)return}v.push(o?ee:L)}}),v.length?v:null};function Ci(e={},t={}){let{id:r,prop:i}=t;return r?i?ae(t)in e:Object.keys(e).filter(o=>fe(o).id===r).length>0:Object.keys(e).length>0}function Fi(e={},t={}){let{id:r,prop:i}=t,o=(()=>r?i?(e[ae(t)]||[]).slice():te.unique(Object.keys(e).filter(a=>fe(a).id===r).map(a=>e[a]).flat()):te.unique(Object.values(e).flat()))(),l=-1;for(;++l<o.length;)(e[o[l]]||[]).forEach(n=>!o.includes(n)&&o.push(n));return o}function nr(e={},t=[]){let r=-1;for(;++r<t.length;)(e[t[r]]||[]).forEach(o=>{let l=t.indexOf(o);l>r||(t.splice(l,1),t.push(o),r--)});return t}function me(e={},t={}){return e._dispatcher||(e._dispatcher=u({},t))}var W=class{constructor(t={}){"target"in t&&E.function(t.target,"options.target"),me(this,{isAborted:!1,listeners:{},target:t.target||function(r){return r}})}static create(...t){return new W(...t)}};W.prototype.abort=function(e=!0){me(this).isAborted=e===!0};function Be(e={},t,r){t in e&&(r?r=f.array(r)?r:[r]:r=Object.keys(e[t]),r.forEach(i=>{i in e[t]&&!e[t][i].length&&delete e[t][i]}),!Object.keys(e[t]).length&&delete e[t])}W.prototype.add=function(e={},t){let{id:r,event:i}=e,{listeners:o}=me(this);E.nonblankString(r,'Dispatcher "id"'),E.nonblankString(i,'Dispatcher "event"'),E.function(t,'Dispatcher "handler"'),o[r]||(o[r]={});let l={callback:t},a=o[r][i]||(o[r][i]=[]);return a.push(l),function(){!a.includes(l)||(a.splice(a.indexOf(l),1),Be(o,r,i))}};W.prototype.delete=function(e={},t){let{id:r,event:i}=e,{listeners:o}=me(this);if(!!o[r]){if(!i){r in o&&delete o[r];return}if(!!o[r][i]){if(!t){i in o[r]&&delete o[r][i];return}o[r][i]=o[r][i].filter(l=>l.callback!==t),Be(o,r,i)}}};W.prototype.trigger=function(e={},t){t&&E.function(t,'Dispatcher "handler"');let{id:r,event:i,detail:o}=e,{listeners:l,target:a,isAborted:n}=me(this);if(n||!l[r]||!l[r][i])return!1;let s=!1,p={type:i,target:a(r),detail:o};return t?t(p,o)===!1:(l[r][i].forEach(({callback:d})=>{let c=d(p,o)===!1;s||(s=c)}),!s)};function De(e={},t={}){return e._executor||(e._executor=u({},t))}var de=class{constructor(t={}){E.function(t.runner,"options.runner"),De(this,{isAborted:!1,queues:{current:[],next:[]},runner:t.runner||function(r){return r}})}static create(...t){return new de(...t)}};de.prototype.abort=function(e=!0){De(this).isAborted=e===!0};de.prototype.run=function(e){let{queues:t,runner:r,isAborted:i}=De(this);if(arguments.length&&(h.array(e)&&(e=[e]),t.next=t.next.concat(e)),!i&&!t.current.length&&!!t.next.length){t.current=t.next,t.next=[];try{r(t.current.slice())}catch(o){t.current=[],g({type:o.type||o.name,message:o.message})}t.current=[],this.run()}};function he(e={},t={}){return e._hook||(e._hook=u({},t))}var X=class{constructor(){he(this,{isAborted:!1,hooks:{}})}static create(...t){return new X(...t)}};X.prototype.abort=function(e=!0){he(this).isAborted=e===!0};X.prototype.add=function(e="",t){E.nonblankString(e,'Hook "type"'),E.function(t,'Hook "handler"');let{hooks:r}=he(this);return r[e]||(r[e]=[]),r[e].push(t),function(){let i=r[e].indexOf(t);i>=0&&r[e].splice(i,1)}};X.prototype.delete=function(e="",t){let{hooks:r}=he(this);!r[e]||(t?r[e]=r[e].filter(i=>i!==t):r[e]=[])};X.prototype.run=function(e="",t={}){let{hooks:r,isAborted:i}=he(this);if(i)return!1;if(!r[e])return!0;let[o,l]=[t.arguments,!1];return h.array(o)&&(o=[o]),r[e].forEach(a=>{let n=a(...o);l||(l=n===!1)}),i?!1:!l};function xt(e={},t={}){let{members:r,family:i,dependency:o,hooks:l}=t,a="id"in e?e.id:e.id=P(),n=i.root().id,s=a===n;if(s&&r[a])return{};let p=s?null:(()=>"parentId"in e?e.parentId:e.parentId=n)();if(!s&&i.has({id:a}))return{};if(!s&&i.hasnt({id:p}))return{};let d="props"in e?e.props:e.props={};"children"in d||(d.children=[]),"order"in d||(d.order=1/0);let c={mutations:{set:[],calc:[]},mutated:[]};return l.run("before-add",{arguments:[e,"before-add"]})?(!s&&i.add({id:a,parentId:p}),r[a]={},c.mutated=[{id:a}],Object.keys(e.props).forEach(b=>{c.mutations.set.push({id:a,prop:b,value:d[b]})}),!s&&o.add({provider:{id:a,prop:"order"},relier:{id:p,prop:"children"}}),l.run("after-add",{arguments:[e,c,"after-add"]}),c):{}}var et="__raw__prop__",tt="__raw__error__",rt="__prop__",it="__error__";function be(e,t={}){return(t.raw?et:rt)+e}function Ee(e,t={}){return(t.raw?tt:it)+e}function It(e={},t={}){let{members:r,family:i,hooks:o}=t,{id:l,prop:a}=e;if(i.hasnt({id:l}))return{};let n={mutated:[]},s={raw:be(a,{raw:!0}),calc:be(a)},p={raw:Ee(a,{raw:!0}),calc:Ee(a)};if(!o.run("before-calc",{arguments:[e,"before-calc"]}))return{};if(a==="children"){let d=i.descendant({id:l})||[];return r[l][s.calc]=d.map(({id:c})=>({id:c})),r[l][s.raw]=r[l][s.calc],r[l][p.calc]=r[l][p.raw],n.mutated.push({id:l}),o.run("after-calc",{arguments:[e,n,"after-calc"]}),n}return r[l][s.calc]=r[l][s.raw],r[l][p.calc]=r[l][p.raw],n.mutated.push({id:l}),o.run("after-calc",{arguments:[e,n,"after-calc"]}),n}function At(e={},t={}){let{id:r}=e,{members:i,family:o,dependency:l,hooks:a}=t;if(o.hasnt({id:r}))return{};if(r===o.root().id)return{};if(!a.run("before-del",{arguments:[e,"before-del"]}))return{};let n={mutations:{add:[],set:[],calc:[]},mutated:[]},s=o.ancestor({id:r}),p=o.descendant({id:r},{deep:!0,self:!0}),d=l.reliers(p,{self:!1});return p.forEach(({id:c})=>{delete i[c],o.delete({id:c}),l.delete({id:c}),n.mutated.push({id:c})}),d&&(n.mutations.calc=d),s&&(o.descendant({id:s.id})||[]).forEach((c,b)=>{n.mutations.set.push({id:c.id,prop:"order",value:b})}),s&&(e.parentId=s.id),a.run("after-del",{arguments:[e,n,"after-del"]}),n}function vt(e={},t={}){let{members:r,family:i,dependency:o,hooks:l}=t,{id:a,prop:n,value:s}=e;if(i.hasnt({id:a}))return{};let p={raw:be(n,{raw:!0})},d={raw:Ee(n,{raw:!0})};if(Object.is(r[a][p.raw],s))return{};let c={mutations:{calc:[]},mutated:[]};if(n==="order"){let S=i.ancestor({id:a});return S?l.run("before-set",{arguments:[e,"before-set"]})?(i.reorder({id:a,order:e.value}),i.descendant(S).forEach(({id:v,order:O})=>{r[v][p.raw]=O,r[v][d.raw]=null,c.mutated.push({id:v}),c.mutations.calc.push({id:v,prop:n});let V=o.reliers({id:v,prop:n})||[];c.mutations.calc=c.mutations.calc.concat(V)}),l.run("after-set",{arguments:[e,c,"after-set"]}),c):{}:{}}if(!l.run("before-set",{arguments:[e,"before-set"]}))return{};r[a][p.raw]=e.value,r[a][d.raw]=null,c.mutated=[{id:a}];let b=o.reliers({id:a,prop:n})||[];return c.mutations.calc=[{id:a,prop:n}].concat(b),l.run("after-set",{arguments:[e,c,"after-set"]}),c}function Di(e=[],t=[]){let[r,i]=[{},{}];return t.forEach(o=>{i[o]=[],r[o]=[]}),e.forEach(o=>{let{id:l,action:a}=o;!t.includes(a)||(i[a].push(l),r[a].push(o))}),{jobs:r,ids:i}}function He(e={},t,r=[]){t||(t={}),t.mutated&&(e.mutated=e.mutated.concat(t.mutated)),r.forEach(i=>{e.mutations[i]||(e.mutations[i]=[]),t.mutations&&t.mutations[i]&&(e.mutations[i]=e.mutations[i].concat(t.mutations[i]))})}function sr(e=[]){return e.filter((t,r,i)=>i.findIndex(l=>l.id===t.id&&l.prop===t.prop)===r)}function _t(e=[],t={}){let{dispatcher:r,family:i}=t,o=["del","add","set","calc"],{jobs:l,ids:a}=Di(e,o),n={mutated:[],mutations:{}};He(n,{},o),l.del.forEach(s=>{He(n,At(s,t),["add","set","calc"])}),l.add=n.mutations.add.concat(l.add),l.add.forEach(s=>{let{id:p,parentId:d}=s;a.del.includes(p)||a.del.includes(d)||He(n,xt(s,t),["set","calc"])}),l.set=n.mutations.set.concat(l.set),l.set=sr(l.set.reverse()).reverse(),l.set.forEach(s=>{a.del.includes(s.id)||He(n,vt(s,t),["calc"])}),l.calc=n.mutations.calc.concat(l.calc),l.calc=sr(l.calc.reverse()).reverse(),l.calc.forEach(s=>{a.del.includes(s.id)||He(n,It(s,t),[])}),te.unique(n.mutated.map(s=>s.id)).forEach(s=>{r.trigger({id:s,event:"after-mutation"}),i.hasnt({id:s})&&r.delete({id:s})})}var Ve=class{constructor(){this.members={},this.family=R.create(),this.dependency=oe.create(),this.dispatcher=W.create(),this.hooks=X.create(),this.executor=de.create({runner:t=>_t(t,this)}),this.executor.run({action:"add",id:this.family.root().id})}static create(...t){return new Ve(...t)}static isContext(t){return t instanceof Ve}static isntContext(t){return!Ve.isContext(t)}static mustbeContext(t,r=""){Ve.isntContext(t)&&g({type:Ve.exceptions.INVALID_INSTANCE,message:r||"Invalid context instance."})}},C=Ve;_(C,"Family",R),_(C,"Dependency",oe),_(C,"Executor",de),_(C,"Dispatcher",W),_(C,"Hook",X),_(C,"exceptions",{INVALID_INSTANCE:"INVALID_CONTEXT_INSTANCE"});C.prototype.add=function(e){let t=h.array(e);t&&(e=[e||{}]);let r=e.map(i=>x(u({},i),{id:P(),action:"add"}));return this.executor.run(r),t?r[0].id:r.map(i=>i.id)};C.prototype.delete=function(e){if(!e){this.executor.abort(),this.dispatcher.abort(),this.hooks.abort();for(let r in this)delete this[r];return}h.array(e)&&(e=[e]);let t=e.map(r=>x(u({},r),{action:"del"}));this.executor.run(t)};C.prototype.find=function(e){return h.function(e)?null:Object.keys(this.members).find(t=>e({id:t}))};C.prototype.get=function(e={},t={}){let{members:r}=this,i="include"in t?t.include:[],o=i.includes("error"),l=i.includes("raw");return"prop"in e?Vi(r,e,o,l):Pi(r,e,o,l)};function Vi(e,t,r,i){let{id:o,prop:l}=t;if(!e[o])return null;let[a,n,s,p]=[null,null,null,null],d=be(l);if(a=d in e[o]?e[o][d]:null,r){let c=Ee(l);n=e[o][c]||null}if(i){let c=be(l,{raw:!0});if(s=c in e[o]?e[o][c]:null,r){let b=Ee(l,{raw:!0});p=e[o][b]||null}}return!r&&!i?a:r&&!i?{value:a,error:n}:r?{value:a,error:n,raw:{value:s,error:p}}:{value:a,raw:{value:s}}}function Pi(e,t,r,i){let{id:o}=t,[l,a,n,s]=[{},null,{},null];return e[o]?(Object.keys(e[o]).forEach(p=>{let d=e[o][p];if(p.startsWith(rt))return l[p.replace(rt,"")]=d;if(d&&r&&p.startsWith(it))return a||(a={}),a[p.replace(it,"")]=d;if(i&&p.startsWith(et))return n[p.replace(et,"")]=d;if(d&&i&&r&&p.startsWith(tt))return s||(s={}),s[p.replace(tt,"")]=d}),!i&&!r?l:r&&!i?{values:l,errors:a}:r?{values:l,errors:a,raw:{values:n,errors:s}}:{values:l,raw:{values:n}}):null}C.prototype.naming=function(e=""){return{prop:be(e),error:Ee(e),raw:{prop:be(e,{raw:!0}),error:Ee(e,{raw:!0})}}};C.prototype.set=function(e){if(!e)return;h.array(e)&&(e=[e]);let t=e.map(r=>x(u({},r),{action:"set"}));this.executor.run(t)};C.prototype.subscribe=function(e={},t){let r={id:e.id,event:"after-mutation"},i="immediately"in e?e.immediately:!0,o=this.dispatcher.add(r,t);return i&&this.dispatcher.trigger(r,t),o};var Te={type:"Fieldset",group:"defaultChild"};function Ke(e,t={}){let r=e._storeOfSchema||(e._storeOfSchema={});return t===void 0?e._storeOfSchema:(Object.assign(r,z.collect(t,["parseExpression","parseReference"])),r)}var Le="when",Ie="then",Ae="else",ye="and",ne="or",le="not",Ue="_";function Se(e){return h.object(e)?!1:Le in e&&Ie in e}function Oe(e){return h.object(e)?!1:Ae in e}function se(e){return Se(e)||Oe(e)}function ot(e){return h.array(e)||!e.length?!1:!e.some(t=>!se(t))}var Ye=class{static isConditionObject(t){return se(t)}static isConditionArray(t){return ot(t)}static isCondition(t){return se(t)||ot(t)}static isntCondition(t){return!Ye.isCondition(t)}static mustbeCondition(t,r=""){Ye.isCondition(t)||g({type:Ye.exceptions.INVALID_CONDITION,message:r||"Invalid condition statement."})}},q=Ye;_(q,"exceptions",{INVALID_CONDITION:"CONDITION_INVALID_CONDITION"});q.combine=function(e={}){let t=[],r=f.array(e.whens)?e.whens:[],i=f.object(e.else)?e.else:{};return r.forEach(o=>{h.object(o)&&(o={}),t.push({[Le]:wi(o.rules),[Ie]:o.result})}),t.push({[Ae]:i.result}),t};function wi(e=[]){h.array(e)&&(e=[e]);let t=[ye,le].join(Ue),r=[ne,le].join(Ue),i=[ye,ne,le,t,r];return e.map(o=>{h.object(o)&&(o={});let l=i.includes(o.logic)?o.logic:"";if(!l)return o.expression;if([ye,ne].includes(l))return{[l]:o.expression};let a=l.split(Ue);return{[a[0]]:{[a[1]]:o.expression}}})}q.extract=function(e){let[t,r]=[[],{result:void 0}];return q.isntCondition(e)?{whens:t,else:r}:(se(e)&&(e=[e]),e.forEach(i=>{Se(i)?t.push({result:i[Ie],rules:Ui(i[Le])}):Oe(i)&&(r={result:i[Ae]})}),{whens:t,else:r})};function Ui(e=[]){return h.array(e)&&(e=[e]),e.map(t=>{if(h.object(t))return{logic:"",expression:t};let r=ye in t?ye:ne in t?ne:"";if(!r)return{logic:"",expression:t};let i=t[r];return f.object(i)&&le in i&&(r=[r,le].join(Ue),i=i[le]),{logic:r,expression:i}})}function Nt(e={},t){let[r,i,o]=[null,e[Le],-1];for(h.array(i)&&(i=[i]);++o<i.length;){let[l,a]=[i[o],[]];f.object(l)&&ye in l?(l=l[ye],a.push(ye)):f.object(l)&&ne in l&&(l=l[ne],a.push(ne)),f.object(l)&&le in l&&(l=l[le],a.push(le));let n=t(l);h.boolean(n)&&(n=null),a.includes(le)&&(n=!n),o===0?r=n:a.includes(ne)?r=r||n:r=r&&n}return{truthy:r,result:e[Ie]}}function Tt(e={}){return{result:e[Ae]}}function Mi(e){if(f.boolean(e))return e}q.parse=function(e,t){q.mustbeCondition(e),t===void 0&&(t=Mi),E.function(t,'Condition "parseExpression"'),se(e)&&(e=[e]);let r;return e.some(i=>{if(Se(i)){let{truthy:o,result:l}=Nt(i,t);if(o===!0)return r=l,!0}else if(Oe(i)){let{result:o}=Tt(i);return r=o,!0}return!1}),r};q.possibilities=function(e){q.mustbeCondition(e),se(e)&&(e=[e]);let t=!1,r=e.map(i=>{if(Se(i))return i[Ie];if(Oe(i))return t=!0,i[Ae]});return r=te.unique(r),t||!r.includes(void 0)&&r.push(void 0),r};var pe=q;var $e=/<<\s*([^(<<)(>>)\s]+)\s*>>/,pr=new RegExp($e,"g");function qe(e="",t={}){let{raw:r,flag:i,strict:o}=t;if(r)return`<< ${e} >>`;let l=`<<\\s*${e}\\s*>>`;return o&&(l=`^${l}$`),new RegExp(l,i)}function St(e){return h.string(e)?!1:!!e.match($e)}var Ge=class{static isInterpolation(t){return St(t)}static isntInterpolation(t){return!Ge.isInterpolation(t)}static mustbeInterpolation(t,r=""){Ge.isInterpolation(t)||g({type:Ge.exceptions.INVALID_INTERPOLATION,message:r||"Invalid interpolation statement."})}},Z=Ge;_(Z,"exceptions",{INVALID_INTERPOLATION:"INVALID_INTERPOLATION"});function ze(e=""){return e.match(pr)}function Ot(e=""){let t=e.match($e);return t?t[1]:null}Z.references=function(e="",t={}){if(Z.isntInterpolation(e))return null;let i=(ze(e)||[]).map(o=>Ot(o));return t.unique!==!1&&(i=te.unique(i)),i.length?i:null};Z.parse=function(e="",t={}){Z.mustbeInterpolation(e);let r=ze(e),i=Z.references(e,{unique:!1}),o=l=>f.function(t)?t(l):t[l];if(r.length===1){let l=qe(i[0],{strict:!0});if(e.match(l))return e=o(i[0])}return i.forEach((l,a)=>{e=e.replace(r[a],o(l))}),e};Z.replace=function(e="",t={}){return Z.mustbeInterpolation(e),Object.keys(t).forEach(r=>{let i=qe(t[r],{raw:!0});r=qe(r,{flag:"g"}),e=e.replace(r,i)}),e};var ge=Z;var Lt=class{constructor(t={}){Ke(this,t)}static create(...t){return new Lt(...t)}},re=Lt;_(re,"Condition",pe),_(re,"Interpolation",ge);function Rt(e,t){return f.array(e)?e=e.map(r=>Rt(r,t)):f.object(e)?e=z.from(Object.keys(e).map(r=>[r,Rt(e[r],t)])):ge.isInterpolation(e)&&(e=ge.parse(e,t)),e}function kt(e,t,r){if(f.array(e)){let i=pe.isConditionArray(e);e=e.map(o=>kt(o,t,i))}else f.object(e)&&(e=z.from(Object.keys(e).map(i=>[i,kt(e[i],t)])));return pe.isConditionArray(e)?e=pe.parse(e,t):pe.isConditionObject(e)&&!r&&(e=pe.parse(e,t)),e}re.prototype.parse=function(e){let{parseReference:t,parseExpression:r}=Ke(this);return e=Rt(e,t),e=kt(e,r),e};re.prototype.possibilities=function(e){let t=null;return pe.isCondition(e)?(t=[],pe.possibilities(e).forEach(r=>{if(!pe.isCondition(r))return t.push(r);t=t.concat(this.possibilities(r))})):f.object(e)?Object.keys(e).forEach(r=>{let i=this.possibilities(e[r]);!i||(t=t?t.concat(i):i)}):f.array(e)&&e.forEach(r=>{let i=this.possibilities(r);!i||(t=t?t.concat(i):i)}),t&&te.unique(t)};re.prototype.references=function(e,t={}){let r=[];if(f.array(e))e.forEach(i=>{let o=this.references(i,t);o&&(r=r.concat(o))});else if(f.object(e))Object.keys(e).forEach(i=>{let o=this.references(e[i],t);o&&(r=r.concat(o))});else if(ge.isInterpolation(e)){let i=ge.references(e,t);i&&(r=r.concat(i))}return t.unique!==!1&&(r=te.unique(r)),r.length?r:null};re.prototype.replace=function(e,t={}){return f.array(e)?e=e.map(r=>this.replace(r,t)):f.object(e)?e=z.from(Object.keys(e).map(r=>[r,this.replace(e[r],t)])):ge.isInterpolation(e)&&(e=ge.replace(e,t)),e};var lt=re;function Y(e={},t={}){return e._reactive||(e._reactive=u({},t))}var ji={prop:()=>P(),default:null,schemable:!0,calculable:!0,validation:null,rawValidation:null},ur=ji;function xe(e={},t={}){return e._i18n||(e._i18n=u({},t))}var Pe=class{constructor(){xe(this,{locales:{},locale:"en"})}static create(...t){return new Pe(...t)}static isI18n(t){return t instanceof Pe}static isntI18n(t){return!Pe.isI18n(t)}static mustbeI18n(t,r){Pe.isntI18n(t)&&g({type:Pe.exceptions.NOT_AN_INSTANCE,message:r||"Invalid i18n instance."})}},M=Pe;_(M,"exceptions",{NOT_AN_INSTANCE:"I18N_NOT_AN_INSTANCE_OF_I18N",UNSUPPORTED_LOCALE:"I18N_UNSUPPORTED_LOCALE"});var cr=".";function at(e=""){return e.split(cr).map(t=>t.trim()).filter(t=>t.length)}function fr(e=[]){return e.map(t=>t.trim()).filter(t=>t.length).join(cr)}M.prototype.define=function(e="",t=""){let r=xe(this).locales;if(!arguments.length)return JSON.parse(JSON.stringify(r));if(h.object(e))return mr(r,e,t);Object.keys(e).forEach(i=>{if(h.object(e[i]))return mr(r,i,e[i]);let o=Object.keys(e[i]).map(l=>[fr([i,l]),e[i][l]]);this.define(z.from(o))})};function mr(e={},t="",r=""){E.nonblankString(t,"I18n locale path"),E.string(r,"I18n locale template");let[i,o]=["",at(t)];for(;i=o.shift();){if(!(i in e))e[i]=o.length?{}:r;else{let l=e[i];o.length?f.string(l)&&(e[i]={_:l}):f.string(l)?e[i]=r:e[i]._=r}e=e[i]}}M.prototype.locale=function(e){if(!e)return xe(this).locale;xe(this).locale=e};function dr(e="",t="",r=""){let i=new RegExp(`{\\s*${t}\\s*}`,"g");if(f.string(r))return e.replace(i,r);try{r=JSON.stringify(r)}catch(o){r=String(r)}return e.replace(i,r)}M.prototype.translate=function(e="",t={}){let r="default"in t?t.default:"",i="variables"in t?t.variables:null;E.string(r,"Default i18n template"),i&&E.object(i,"I18n variables");let[o,l]=[at(e),xe(this).locales],a=Bi(l,[xe(this).locale].concat(o));return f.null(a)&&(a=r),!a||!i?a:Hi(a,i)};M.prototype.t=M.prototype.translate;function Bi(e={},t=""){let r="";return t.every((o,l)=>o in e?(e=e[o],l!==t.length-1||(r=f.string(e)?e:e._),!0):!1)?r:null}function Hi(e="",t={}){return Object.keys(t).forEach(r=>{e=dr(e,r,t[r])}),e}M.prototype.try=function(e=[],t={}){let r="";return e.some(i=>{if(r=this.translate(i,t),r)return!0}),r};var J=M.global=M.create();var hr={memberIsReferenced:"Referenced members cannot be deleted.",conflictedMemberName:"Member name { name } has been occupied.",memberNameRequired:"Member name cannot be blank.",mustBelongsToValidParent:"{ memberType } members can only be inserted into { acceptedParentTypes } parents.",referenceNotFound:"Cannot find reference { reference } among members.",conditionNotComplete:"Condition must contain at lease one case.",conditionBranchNotComplete:"Condition branch must contain at least one rule.",conditionReferenceNotPresence:"Condition reference cannot be blank.",conditionLogicNotSupported:"Lack of valid and/or keyword.",conditionValidationNotSupported:"Unsupported validation { label }.",conditionValidationRuleNotSupported:"Validation rule { rule } is not supported by { label }."};var br={memberIsReferenced:"\u65E0\u6CD5\u5220\u9664\u88AB\u5F15\u7528\u7684\u6210\u5458\u3002",conflictedMemberName:"\u6210\u5458\u540D\u79F0{ name }\u5DF2\u88AB\u5360\u7528\u3002",memberNameRequired:"\u6210\u5458\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\u3002",mustBelongsToValidParent:"{ memberType }\u7C7B\u578B\u6210\u5458\u53EA\u80FD\u4F5C\u4E3A{ acceptedParentTypes }\u7C7B\u578B\u5B50\u7EA7\u3002",referenceNotFound:"\u6210\u5458\u4E2D\u4E0D\u5B58\u5728\u5F15\u7528\u8DEF\u5F84{ reference }",conditionNotComplete:"\u6761\u4EF6\u5206\u652F\u81F3\u5C11\u8981\u5305\u542B\u4E00\u79CD\u60C5\u51B5\u3002",conditionBranchNotComplete:"\u6761\u4EF6\u5206\u652F\u5185\u81F3\u5C11\u8981\u5305\u542B\u4E00\u4E2A\u89C4\u5219\u3002",conditionReferenceNotPresence:"\u6761\u4EF6\u4F9D\u8D56\u4E0D\u80FD\u4E3A\u7A7A\u3002",conditionLogicNotSupported:"\u7F3A\u5C11\u5408\u6CD5\u7684\u4E0E\u6216\u5173\u952E\u5B57\u3002",conditionValidationNotSupported:"\u4E0D\u88AB\u652F\u6301\u7684\u6821\u9A8C{ label }\u3002",conditionValidationRuleNotSupported:"\u4E0D\u88AB{ label }\u652F\u6301\u7684\u6821\u9A8C\u89C4\u5219{ rule }\u3002"};J.define({en:{reactive:hr},zh:{reactive:br}});var j=J;var Er=".",ue=["children","order","type","name"],We="__REACTIVE_SCEHMA_REFERENCE__";function yr(e=""){let t=e.split(Er),r=t.pop();return{names:t,prop:r}}function Xe(e=[],t=""){return(t?e.concat(t):e).join(Er)}function gr(e,t,r){let[i,o]=[e.schema.references(t),{}];return i?(i.forEach(l=>{let a=e.schema.reference.parse(l,{relier:r}),n=f.object(a);if(n&&(n=f.nonblankString(a.id)),n&&(n=f.nonblankString(a.prop)),n)return o[l]=JSON.stringify(a);g({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:j.t("reactive.referenceNotFound",{variables:{reference:l}})})}),e.schema.replace(t,o)):t}function xr(e,t,r){let[i,o]=[e.schema.references(t),{}];return i?(i.forEach(l=>{let a=null;try{a=JSON.parse(l)}catch(p){return}let n=e.schema.reference.stringify(a,{relier:r});if(f.nonblankString(n))return o[l]=n;g({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:j.t("reactive.referenceNotFound",{variables:{reference:l}})})}),e.schema.replace(t,o)):t}function Ir(e={},t={}){return u(u(u({},ur),t),e)}function Ar(e={}){return Object.keys(e).forEach(t=>{h.function(e[t])||(e[t]=e[t]())}),e}function Ct(e={}){let{id:t,prop:r}=e,i=this.get({id:t,prop:"type"}),{props:o,fallback:l}=Y(this).installed[i].config.schema;if(!r)return o.map(s=>{let p=Ar(Ir(s,l));return ue.includes(p.prop)&&(p.schemable=p.calculable=!1),p});let a=o.find(s=>s.prop===r),n=Ar(Ir(a||l,l));return n.prop=r,ue.includes(r)&&(n.schemable=n.calculable=!1),n}function Ft(e="",t={}){var p,d;e=(this.schema.references(e)||[])[0]||e;let r=e,{names:i,prop:o}=yr(e),l=t.under||this.family.root(),a=t.relier||null,[n,s]=[null,l.id];if(!i.length||this.family.hasnt({id:s}))return null;for(;n=i.shift();){if(s=(d=(p=this.family.descendant({id:s}))==null?void 0:p.find(v=>this.get({id:v.id,prop:"name"})===n))==null?void 0:d.id,!s)return null;let c=this.get({id:s,prop:"type"}),S=Y(this).installed[c].config.schema.reference.parse;if(S)return e=Xe(i,o),S.call(this,{id:s,downPath:e,target:r},a?{id:a.id||"",prop:a.prop||""}:null)}return{id:s,prop:o}}function Dt(e={},t={}){let{id:r,prop:i}=e,o={id:r,prop:i},l=t.under||this.family.root(),a=t.relier||null,n=(()=>t.format!=="interpolation"?b=>b:b=>b&&`<< ${b} >>`)();if(this.family.hasnt({id:r}))return"";let s=this.family.ancestor({id:r},{deep:!0,self:!0}),[p,d]=[s.findIndex(b=>b.id===l.id),[]];if(p<0||(s=s.slice(0,p),!s.length))return"";let c=null;for(;c=s.pop();){d.push(this.get({id:c.id,prop:"name"}));let b=this.get({id:c.id,prop:"type"}),v=Y(this).installed[b].config.schema.reference.stringify;if(v){let O=Xe(d),V=v.call(this,{id:c.id,upPath:O,downPath:i,target:o},a?{id:a.id||"",prop:a.prop||""}:null);return n(V)}}return n(Xe(d,i))}function Vt(e){let t=lt.create({parseReference(r){return e.get(JSON.parse(r))},parseExpression(r={}){return e.validator.mustbeSupported(r),!e.validator.error(r)}});return t.for=Ct.bind(e),t.reference={parse:Ft.bind(e),stringify:Dt.bind(e)},t}var vr={validators:{dataType:{label:"Data Type",invalidValue:"Must be a data type within { rule }."},equalTo:{label:"Equal To",invalidRule:'Rule of "Equal To" validator Cannot be blank.',invalidValue:"Must be equal to { rule }."},isInteger:{label:"Is Integer",invalidValue:"{ value } is not an integer."},maxLength:{label:"Max Length",invalidRule:'Rule of "Max Length" validator must be a positive integer.',invalidValue:"Maximum length is { rule }."},presence:{label:"Presence",invalidValue:"Musn't be blank."},withFormat:{label:"With Format",invalidRule:'Rule of "With Format" validator must be a regexp or a string wrapped with "/".',invalidValue:"Must match format { rule }."}}};var _r={validators:{dataType:{label:"\u6570\u636E\u7C7B\u578B",invalidValue:"\u6570\u636E\u7C7B\u578B\u5FC5\u987B\u662F{ rule }\u3002"},equalTo:{label:"\u7B49\u4E8E",invalidRule:"\u7B49\u4E8E\u7684\u6821\u9A8C\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A\u3002",invalidValue:"\u5FC5\u987B\u7B49\u4E8E{ rule }\u3002"},isInteger:{label:"\u662F\u6574\u6570",invalidValue:"{ value }\u4E0D\u662F\u4E00\u4E2A\u6574\u6570\u3002"},maxLength:{label:"\u6700\u5927\u957F\u5EA6",invalidRule:"\u6700\u5927\u957F\u5EA6\u7684\u6821\u9A8C\u89C4\u5219\u5FC5\u987B\u662F\u4E00\u4E2A\u6B63\u6574\u6570\u3002",invalidValue:"\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7{ rule }\u3002"},presence:{label:"\u4E0D\u4E3A\u7A7A",invalidValue:"\u4E0D\u80FD\u4E3A\u7A7A\u3002"},withFormat:{label:"\u7B26\u5408\u683C\u5F0F",invalidRule:"\u683C\u5F0F\u6821\u9A8C\u7684\u89C4\u5219\u5FC5\u987B\u662F\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\u6216\u88AB\u201C/\u201D\u5305\u62EC\u7684\u5B57\u7B26\u4E32\u3002",invalidValue:"\u5FC5\u987B\u7B26\u5408\u683C\u5F0F{ rule }\u3002"}}};J.define({en:{validator:vr},zh:{validator:_r}});var Q=J;var Nr={name:"dataType",ruleType:["String","Array"],valueType:"*",validate(e,t){if(!N.within({type:N.get(e),types:t}))return Q.t("validator.validators.dataType.invalidValue",{variables:{value:e,rule:t}})}};function Tr(e,t){if(e===t)return!0;if(typeof e!="object"||typeof t!="object"||e==null||t==null)return!1;let[r,i]=[Object.keys(e),Object.keys(t)];if(r.length!==i.length)return!1;for(let o of r)if(!i.includes(o)||!Tr(e[o],t[o]))return!1;return!0}var Sr={name:"equalTo",ruleType:"*",valueType:"*",validateRule(e){if(f.blank(e))return Q.t("validator.validators.equalTo.invalidRule")},validate(e,t){if(!Tr(e,t))return Q.t("validator.validators.equalTo.invalidValue",{variables:{value:e,rule:t}})}};var Or={name:"isInteger",valueType:"Number",validate(e){if(!f.integer(e))return Q.t("validator.validators.isInteger.invalidValue",{variables:{value:e}})}};var Lr={name:"maxLength",ruleType:"Number",valueType:["String","Array"],validateRule(e){if(!f.positiveInteger(e))return Q.t("validator.validators.maxLength.invalidRule")},validate(e,t){if(e.length>t)return Q.t("validator.validators.maxLength.invalidValue",{variables:{value:e,rule:t}})}};var Rr={name:"presence",valueType:"*",validate(e){if(f.blank(e))return Q.t("validator.validators.presence.invalidValue",{variables:{value:e}})}};var kr=/^\/(.+)\/$/,Cr={name:"withFormat",ruleType:["RegExp","String"],valueType:"String",validateRule(e){if(!f.regexp(e)&&!(f.string(e)&&e.match(kr)))return Q.t("validator.validators.withFormat.invalidRule",{variables:{rule:e}})},validate(e,t){if(f.string(t)&&(t=new RegExp(t.match(kr)[1])),!e.match(t))return Q.t("validator.validators.withFormat.invalidValue",{variables:{value:e,rule:String(t)}})}};var Fr=[Rr,Nr,Or,Cr,Sr,Lr];function B(e={},t={}){return e._validator||(e._validator=u({},t))}var Pt=class{constructor(){B(this,{installed:{}}),Fr.forEach(t=>this.install(t))}static create(...t){return new Pt(...t)}},I=Pt;_(I,"exceptions",{CONFLICTED_NAME:"VALIDATOR_CONFLICTED_NAME",VALIDATION_FAILED:"VALIDATOR_VALIDATION_FAILED",UNSUPPORTED_VALIDATION:"VALIDATOR_UNSUPPORTED_VALIDATION",UNSUPPORTED_VALIDATION_RULE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE",UNSUPPORTED_VALIDATION_RULE_TYPE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE_TYPE"});var Ki="valOf";function nt(e={}){let t={};return"value"in e&&(t[Ki]=e.value),e.name&&(t[e.name]=void 0,"rule"in e&&(t[e.name]=e.rule)),t}I.prototype.combineValidation=function(e={}){let{installed:t}=B(this);return e.name in t?nt(x(u({},e),{rule:t[e.name].ruleType?e.rule:!0})):nt(e)};var Dr="valOf";function we(e={}){let t=e[Dr];e=z.exclude(e,[Dr]);let r=Object.keys(e)[0],i=e[r];return{name:r,rule:i,value:t}}I.prototype.mustbeSupported=function(e={},t={}){E.object(e,"Validation struct");let r="strict"in t?t.strict:!0,{name:i,rule:o}=we(e),{installed:l}=B(this),a=l[i];if(!a&&g({type:I.exceptions.UNSUPPORTED_VALIDATION,message:`Unsupported validator "${i}"`}),!(!r||!a.ruleType)){try{N.mustWithin({type:N.get(o),types:a.ruleType})}catch(n){g({type:I.exceptions.UNSUPPORTED_VALIDATION_RULE_TYPE,message:n.message||"Unsupported validation rule data type."})}if(!!a.validateRule)try{let n=a.validateRule(o);if(n)throw new Error(n)}catch(n){g({type:I.exceptions.UNSUPPORTED_VALIDATION_RULE,message:n.message||"Unsupported validation rule."})}}};I.prototype.error=function(e={},t){let r=null;try{this.mustbeSupported(e)}catch(i){r=i}if(!r){let{installed:i}=B(this),{name:o,rule:l,value:a}=we(e);arguments.length>1&&(a=t);let n=i[o],[s,p]=[N.get(a),n.valueType];try{N.mustWithin({type:s,types:p})}catch(d){r=d}r||(r=n.validate(a,l))}return r?F.create({type:I.exceptions.VALIDATION_FAILED,message:(()=>{let i="Not valid.";return f.string(r)?r:r instanceof Error&&r.message||i})()}):null};I.prototype.extractValidation=function(e={}){let{installed:t}=B(this),r=we(e);return r.name in t&&(t[r.name].ruleType||(r.rule=!0)),r};I.prototype.for=function(e="*",t={}){let[r,i]=[[],B(this).installed],o="except"in t?t.except:[];return h.array(o)&&(o=[o]),Object.values(i).forEach(l=>{o.includes(l.name)||!N.within({type:e,types:l.valueType})||r.push(u({},l))}),r.length?r:null};I.prototype.get=function(e=""){let t=B(this).installed;return e in t?u({},t[e]):null};I.prototype.install=function(e={}){E.object(e,"Validator installer");let{name:t,valueType:r,ruleType:i,validate:o,validateRule:l}=e;E.nonblankString(t,'Validator installer "name"'),E.type(r,'Validator installer "valueType"'),E.function(o,'Validator installer "validate"'),i&&E.type(i,'Validator installer "ruleType"'),l&&E.function(l,'Validator "validateRule"');let{installed:a}=B(this);t in a&&g({type:I.exceptions.CONFLICTED_NAME,message:`Validator name ${t} has been occupied.`}),a[t]=x(u({},e),{name:t,valueType:r,ruleType:i,validate:o,validateRule:l})};I.prototype.isSupported=function(...e){try{this.mustbeSupported(...e)}catch(t){return!1}return!0};I.prototype.isValid=function(...e){return!this.error(...e)};I.prototype.isntSupported=function(...e){return!this.isSupported(...e)};I.prototype.isntValid=function(...e){return!this.isValid(...e)};I.prototype.uninstall=function(e=""){let{installed:t}=B(this);e in t&&delete t[e]};function wt(e){return I.create()}function Ut(e){return D.create()}function Ze(e,t){!(t in Y(e).installed)&&g({type:e.exceptions.UNINSTALLED_MEMBER_TYPE,message:`Member type ${t} is not installed.`})}function Yi(e,t={},r){let{hook:i,handler:o}=t;return h.array(i)&&(i=[i]),h.array(o)&&(o=[o]),o=o.map(l=>l.bind(e)),r?(o=o.map(l=>(a,...n)=>{let s=e.get({id:a.id,prop:"type"});if(s||(s=(a.props||{}).type||"default"),Ze(e,s),s===r)return l(a,...n)}),{hook:i,handler:o}):{hook:i,handler:o}}function Mt(e,t={}){if(!e)return;let r=t.only;h.array(e)&&(e=[e]),e.forEach(i=>{let{hook:o,handler:l}=Yi(this,i,r);o.forEach(a=>l.forEach(n=>this.hooks.add(a,n)))})}function jt(e){return e.hooks.mount=Mt.bind(e),e.hooks}function Bt(e){let t=e.get;return e.get=function(r={},i={}){let{id:o,prop:l}=r,a=t.call(e,r,i);if(!a||!a.raw)return a;if("prop"in r){let n=a.raw.value;a.raw.value=Vr(e,o,l,n)}else Object.keys(a.raw.values).forEach(n=>{let s=a.raw.values[n];a.raw.values[n]=Vr(e,o,n,s)});return a}}function Vr(e,t,r,i){return ue.includes(r)||!e.schema.for({id:t,prop:r}).schemable?i:xr(e,i,{id:t,prop:r})}function Pr(e={}){let{installed:t}=Y(this),r=e.type,i=f.function(e.collect)?e.collect:null,o=f.function(e.seed)?e.seed:null,l="hooks"in e?e.hooks:[],a="schema"in e?e.schema:{},n="props"in a?a.props:[],s="fallback"in a?a.fallback:{},p="reference"in a?a.reference:{},d="parse"in p?p.parse:null,c="stringify"in p?p.stringify:null;E.nonblankString(r,'Reactive Member "type"'),o&&E.function(o,'Reactive Member "seed"'),i&&E.function(i,'Reactive Member "collect"'),d&&E.function(d,'Reactive Member "schema.reference.parse"'),c&&E.function(c,'Member "schema.reference.stringify"'),E.array(n,'Reactive Member "schema.props"'),E.object(s,'Reactive Member "schema.fallback"'),E.array(l,'Reactive Member "hooks"'),n.forEach(b=>E.object(b,"Reactive Member prop schema")),l=l.flat(1/0),l.forEach(b=>{let{hook:S,handler:v,scope:O}=b;O&&E.nonblankString(O,'Reactive Member hook "scope"'),S=f.array(S)?S:[S],v=f.array(v)?v:[v],S.forEach(V=>E.nonblankString(V,'Reactive Member hook "type"')),v.forEach(V=>E.function(V,'Reactive Member hook "handler"'))}),r in t&&g({type:this.exceptions.CONFLICTED_MEMBER_TYPE,message:`Reactive Member type '${r}' has been occupied.`}),t[r]={config:{type:r,hooks:l,collect:i,seed:o,schema:{fallback:s,props:n,reference:{parse:d,stringify:c}}}},l.forEach(b=>{if(!b.scope)return this.hooks.mount(b,{only:r});let S=f.array(b.hook)?b.hook:[b.hook];(f.array(b.handler)?b.handler:[b.handler]).forEach(O=>S.forEach(V=>{Object.keys(t).some(ee=>ee!==r&&t[ee].config.hooks.some(G=>{let Re=f.array(G.hook)?G.hook:[G.hook],Zt=f.array(G.handler)?G.handler:[G.handler];return G.scope===b.scope&&Zt.includes(O)&&Re.includes(V)}))||this.hooks.mount(x(u({},b),{hook:V,handler:O}),{only:b.scope})}))})}function Ht(e={},t={}){let{id:r}=e;if(this.family.hasnt({id:r}))return null;let i="errors"in t?t.errors:!0,[o,l]=[t.only||[],t.except||[]];h.array(o)&&(o=[o]),h.array(l)&&(l=[l]);let{values:a,raw:n}=wr(this,r);if(a=Kt(this,a,o,l),n.values=Kt(this,n.values,o,l),!i)return{values:a,raw:n};let[s,p]=$i(this,r);return{values:a,errors:s,raw:x(u({},n),{errors:p})}}function wr(e,t){let r=e.get({id:t,prop:"type"}),i=Y(e).installed[r].config.collect;if(i){let n=i.call(e,{id:t});return n||(n={}),n.values||(n.values={}),n.raw||(n.raw={}),n.raw.values||(n.raw.values={}),n}let{values:o,raw:l}=e.get({id:t},{include:"raw"});o.children=[],l.values.children=[];let a=e.family.descendant({id:t});return a?(a.forEach(n=>{let s=wr(e,n.id);o.children.push(s.values),l.values.children.push(s.raw.values)}),{values:o,raw:l}):{values:o,raw:l}}function Kt(e,t={},r=[],i=[]){return Object.keys(t).forEach(o=>{r.length&&!r.includes(o)&&delete t[o],i.length&&i.includes(o)&&delete t[o]}),t.children&&t.children.forEach((o,l)=>{t.children[l]=Kt(e,o,r,i)}),t}function $i(e,t){let[r,i]=[[],[]];return e.family.descendant({id:t},{deep:!0,self:!0}).forEach(({id:l})=>{let a=e.get({id:l},{include:["raw","error"]});a.errors&&r.push({id:l,errors:a.errors}),a.raw.errors&&i.push({id:l,errors:a.raw.errors})}),[r.length?r:null,i.length?i:null]}function Yt(e={},t={},r={}){let i="execute"in r?r.execute:!0;if(i&&this.family.hasnt({id:e.id}))return;let[o,l,a]=[null,[{id:e.id,props:t}],[]];for(;o=l.shift();){let[n,s]=[o.id,o.props],p=this.family.has({id:n}),d=(()=>p?this.get({id:n,prop:"type"}):s.type||"default")(),c=Y(this).installed[d].config.seed;if(c){let b=c.call(this,{id:n},s);b&&(a=a.concat(b))}else Object.keys(s).forEach(b=>{if(b!=="children"){let O={action:"set",id:n,prop:b,value:s[b]};return a.push(O)}let[S,v]=[n,this.family.descendant({id:n})||[]];s.children.forEach((O,V)=>{if(v[V])return l.push({id:v[V].id,props:O});let[L,ee,G]=[P(),O.name,O.type||"default"],Re={action:"add",parentId:S,id:L,props:{type:G,name:ee}};a.push(Re),l.push({id:L,props:x(u({},O),{type:G})})})})}return i?this.executor.run(a):a}var qi=[{hook:"before-add",handler(e){let t=(e.props||{}).type||"default";Ze(this,t)}}],Ur=qi;var Gi=[{hook:"before-del",handler(e){let{id:t}=e,{family:r,dependency:i}=this,o=r.descendant({id:t},{self:!0,deep:!0}),l={self:!1,deep:!1,group:We};i.reliers(o,l)&&g({type:this.exceptions.CONSTRAINTS_EXIST,message:j.t("reactive.memberIsReferenced",{variables:{id:t}})})}}],Mr=Gi;var zi=[{hook:"after-add",handler(e){let[t,r]=[e.id,(e.props||{}).type||"default"],[i,o]=[this.members,this.naming("type")];i[t][o.raw.prop]=i[t][o.prop]=r,i[t][o.raw.error]=i[t][o.error]=null}},{hook:"before-del",handler(e){let t=this.get({id:e.id,prop:"type"});e.props||(e.props={}),e.props.type=t}}],jr=zi;var Wi=[{hook:"before-add",handler(e){let{id:t,props:r}=e;r||(e.props={}),e.props.name||(e.props.name=t)}},{hook:"after-add",handler(e){let{id:t,props:r}=e,[i,o]=[this.members,this.naming("name")];i[t][o.raw.prop]=i[t][o.prop]=r.name,i[t][o.raw.error]=i[t][o.error]=null}},{hook:"after-set",handler(e){let{id:t,prop:r,value:i}=e;if(r!=="name")return;let[o,l]=[this.members,this.naming("name")];o[t][l.raw.prop]=o[t][l.prop]=i,o[t][l.raw.error]=o[t][l.error]=null}}],Br=Wi;var Xi=[{hook:["before-set","before-calc"],handler(e){if(e.prop==="type")return!1}}],Hr=Xi;function Kr(e,t,r){let i=e.family.sibling({id:t});!i||i.find(({id:o})=>e.get({id:o,prop:"name"})===r)&&g({type:e.exceptions.CONFLICTED_MEMBER_NAME,message:j.t("reactive.conflictedMemberName",{variables:{name:r}})})}var Zi=[{hook:"after-add",handler(e){let{id:t}=e,r=this.get({id:t,prop:"name"});mt.blank(r,{message:j.t("reactive.memberNameRequired")}),Kr(this,t,r)}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(r!=="name")return;let i=this.get({id:t,prop:r},{include:["error","raw"]});if(i.raw.error){let o=`Skipping validating name of member ${t},`;return o+=" since prev errors exist.",console.warn(o,i.raw.error)}try{mt.blank(i.raw.value,{message:j.t("reactive.memberNameRequired")}),Kr(this,t,i.raw.value)}catch(o){this.members[t][this.naming(r).raw.error]=[o]}}}],Yr=Zi;function $t(e,t){try{return e.validator.mustbeSupported(t,{strict:!0}),null}catch(r){let o=e.validator.constructor.exceptions,l=o.UNSUPPORTED_VALIDATION,a=o.UNSUPPORTED_VALIDATION_RULE_TYPE,n=o.UNSUPPORTED_VALIDATION_RULE,{name:s,rule:p}=e.validator.extractValidation(t),d=j.t(`validator.validators.${s}.label`)||s;if([n,a].includes(r.type)){let c="reactive.conditionValidationRuleNotSupported",b=j.t(c,{variables:{label:d,rule:p}}),S=r.type===a;r.message=S?b:r.message||b}else if(r.type===l){let c="reactive.conditionValidationNotSupported";r.message=j.t(c,{variables:{label:d}})}return r}}var $r=[{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(ue.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let o=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(o.raw.error){let p=`Skipping validating ${r} schema of member ${t},`;return p+=" since previous errors exist.",console.warn(p,o.raw.error)}let l=this.schema.constructor.Condition;if(!l.isCondition(o.raw.value))return;let a=l.extract(o.raw.value),[n,s]=[this.members,this.naming(r)];if(!a.whens.length){n[t][s.raw.error]=[F.create({data:{dueto:"whens"},type:l.exceptions.INVALID_CONDITION,message:j.t("reactive.conditionNotComplete")})];return}a.whens.some((p,d)=>!p.rules||!p.rules.length?(n[t][s.raw.error]=[F.create({data:{branchIndex:d,dueto:"rules"},type:l.exceptions.INVALID_CONDITION,message:j.t("reactive.conditionBranchNotComplete")})],!0):p.rules.some((c,b)=>{let{logic:S,expression:v}=c;if(b!==0&&!["and","or"].includes(S)){let V="reactive.conditionLogicNotSupported";return n[t][s.raw.error]=[F.create({data:{branchIndex:d,ruleIndex:b,dueto:"logic"},type:l.exceptions.INVALID_CONDITION,message:j.t(V,{variables:{logic:S}})})],!0}if(h.object(v)||f.blank(v.valOf)){let V="reactive.conditionReferenceNotPresence";return n[t][s.raw.error]=[F.create({data:{branchIndex:d,ruleIndex:b,dueto:"provider"},type:l.exceptions.INVALID_CONDITION,message:j.t(V)})],!0}let O=$t(this,v);return O?(n[t][s.raw.error]=[F.create({data:{branchIndex:d,ruleIndex:b,dueto:"validation"},type:l.exceptions.INVALID_CONDITION,message:O.message})],!0):!1}))}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(ue.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let o=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(o.raw.error){let n=`Skipping translating ${r} schema of member ${t},`;return n+=" since previous errors exist.",console.warn(n,o.raw.error)}let[l,a]=[this.members,this.naming(r)];try{l[t][a.raw.prop]=gr(this,o.raw.value,{id:t,prop:r})}catch(n){l[t][a.raw.error]=[n]}}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,{schema:i,dependency:o,family:l,members:a}=this;if(ue.includes(r)||!i.for({id:t,prop:r}).schemable)return;o.delete({id:t,prop:r},{only:"relier",group:We});let s=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(s.raw.error){let c="Skipping adding new associations for";return c+=` member ${t}'s ${r} since previous errors exist.`,console.warn(c,s.raw.error)}let p=i.references(s.raw.value);if(!p)return;let d=p.map(c=>({relier:{id:t,prop:r},provider:JSON.parse(c)}));d.forEach(c=>{let{provider:b,relier:S}=c,v={self:!0,deep:!0},O=l.ancestor({id:b.id},v);O.forEach((V,L)=>{L!==O.length-1&&d.push({relier:S,provider:{id:V.id,prop:"name"}})})});try{o.add(d,{group:We})}catch(c){a[t][this.naming(r).raw.error]=[c]}}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(ue.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let i=this.constructor.prototype.get,{value:o,error:l}=i.call(this,{id:t,prop:r},{include:"error"}),[a,n]=[this.members,this.naming(r)];if(l){a[t][n.prop]=null;let s=`Skipping parsing ${r} schema of member ${t},`;return s+=" since previous errors exist.",console.warn(s,l)}try{a[t][n.prop]=this.schema.parse(o)}catch(s){a[t][n.prop]=null,a[t][n.error]=[s],console.warn(`Failed to parse ${r} schema of member ${t}.`,s)}}}];var Ji=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(ue.includes(r))return;let i=this.schema.for({id:t,prop:r});if(!i.schemable||!i.calculable)return;let o=this.constructor.prototype.get,{value:l,error:a}=o.call(this,{id:t,prop:r},{include:"error"}),[n,s]=[this.members,this.naming(r)];if(a){let p=`Skipping trying to calculate ${r} of member ${t},`;return p+=" since previous errors exist.",console.warn(p,a)}if(!!this.calculator.isSupported(l,{strict:!1}))try{n[t][s.prop]=this.calculator.calculate(l)}catch(p){n[t][s.error]=[p],console.warn(`Failed to calculate ${r} of member ${t}.`,p)}}}],qr=Ji;var Qi=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{i.find(l=>l.prop===o.prop)||i.push({id:r,prop:o.prop,value:o.default})})}}],Gr=Qi;var eo=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{if(!("always"in o))return;let l=i.find(a=>a.prop===o.prop);if(l)return l.value=o.always;i.push({id:r,prop:o.prop,value:o.always})})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i}=e,o=this.schema.for({id:t,prop:r});"always"in o&&i!==o.always&&(e.value=o.always)}}],zr=eo;var to=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{!o.validation||i.find(l=>l.prop===o.prop)||i.push({id:r,prop:o.prop,value:o.default||null})})}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,i=this.get({id:t,prop:r},{include:["error","raw"]}),{value:o,error:l}=i.raw,a=`${I.exceptions.VALIDATION_FAILED}_RAW`;if(Wr(l,{exclude:a})){let b=`Skipping validating raw ${r} of member ${t},`;return b+=" since previous errors exist.",console.warn(b,l)}let n=this.schema.constructor.Condition,s=this.schema.for({id:t,prop:r}).rawValidation,[p,d]=[this.members,this.naming(r)],c=d.raw.error;if(!s)return p[t][c]=null;if(n.isntCondition(o)){if(l=qt(this,{id:t,prop:r,value:o,validation:s}),!l)return p[t][c]=null;p[t][c]=[Gt(l,{type:a})]}else{let[b,S]=[n.extract(o),-1];if(b.whens.concat(b.else).some(({result:v},O)=>{if(l=qt(this,{id:t,prop:r,value:v,validation:s}),l)return(S=O)||!0}),!l)return p[t][c]=null;p[t][c]=[Gt(l,{type:a,data:{branchIndex:S,dueto:"result"}})]}}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e,{value:i,error:o}=this.get({id:t,prop:r},{include:"error"}),l=I.exceptions.VALIDATION_FAILED;if(Wr(o,{exclude:l})){let p=`Skipping validating ${r} of member ${t},`;return p+=" since previous errors exist.",console.warn(p,o)}let{validation:a}=this.schema.for({id:t,prop:r}),[n,s]=[this.members,this.naming(r)];if(!a||(o=qt(this,{id:t,prop:r,value:i,validation:a}),!o))return n[t][s.error]=null;n[t][s.error]=[Gt(o,{type:l})]}}];function Wr(e,t={}){if(!e)return!1;h.array(e)&&(e=[e]);let r=f.array(t.exclude)?t.exclude:[t.exclude];if(e=e.find(i=>!r.includes(i.type)),e)return!0}function qt(e,t={}){let{id:r,prop:i,value:o,validation:l}=t;h.array(l)&&(l=[l]);let[a,n]=[null,l.find(s=>"presence"in s)];return n||![null,void 0,""].includes(o)?(l.some(s=>{try{return f.function(s)?a=s.call(e,{id:r,prop:i,value:o}):a=e.validator.error(s,o)}catch(p){return a=p}}),a):a=null}function Gt(e={},t={}){let r=f.string(e)?e:e.message||e.name,i=f.string(e)?{}:e.data,o=t.data||{};return F.create({type:t.type,message:r,data:u(u({},i),o)})}var Xr=to;var Zr=[];function zt(e={}){let t=e.accept;h.array(t)&&(t=[t]),t.forEach(i=>E.nonblankString(i));let r=Zr.find(i=>i.accept.length!==t.length?!1:!i.accept.some(o=>!t.includes(o)));return r||(r={accept:t,HOOKS:[{hook:"before-add",handler(i){let o=(i.props||{}).type||"default",l=this.get({id:i.parentId,prop:"type"});!t.includes(l)&&g({type:this.exceptions.INVALID_PARENT,message:j.t("reactive.mustBelongsToValidParent",{variables:{memberType:o,acceptedParentTypes:t}})})}}]},Zr.push(r)),r.HOOKS}var Wt={CONFLICTED_MEMBER_TYPE:"REACTIVE_CONFLICTED_MEMBER_TYPE",UNINSTALLED_MEMBER_TYPE:"REACTIVE_UNINSTALLED_MEMBER_TYPE",CONSTRAINTS_EXIST:"REACTIVE_CONSTRAINTS_EXIST",CONFLICTED_MEMBER_NAME:"REACTIVE_CONFLICTED_MEMBER_NAME",REFERENCED_PROVIDER_NOT_FOUND:"REACTIVE_REFERENCED_PROVIDER_NOT_FOUND",INVALID_PARENT:"REACTIVE_INVALID_PARENT",HOOK_NOT_EXIST:"REACTIVE_HOOK_NOT_EXIST",VALIDATION_FAILED:"REACTIVE_VALIDATION_FAILED"},st={ENABLE_SCHEMA_DEFAULT:Gr,ENABLE_SCHEMA_ALWAYS:zr,ENABLE_SCHEMA_VALIDATION:Xr,BLOCK_INVALID_PARENT:zt};function A(){let e=C.create();Y(e,{installed:{}}),e.guid=P,e.exceptions=Wt,e.seed=Yt.bind(e),e.collect=Ht.bind(e),e.install=Pr.bind(e),e.get=Bt(e),e.schema=Vt(e),e.validator=wt(e),e.calculator=Ut(e),e.hooks=jt(e),e.hooks.mount(Ur),e.hooks.mount(Mr),e.hooks.mount(jr),e.hooks.mount(Br),e.hooks.mount(Hr),e.hooks.mount(Yr),e.hooks.mount($r),e.hooks.mount(qr),e.install({type:"default",schema:{props:[{prop:"name"}]}});let t=e.members[e.family.root().id],r=e.naming("type");return t[r.raw.prop]=t[r.prop]="default",e}A.guid=P;A.exceptions=Wt;A.hooks={use(e,...t){return!(e in st)&&g({type:Wt.HOOK_NOT_EXIST}),h.function(st[e])?st[e]:st[e](...t)}};Te.hooks=[A.hooks.use("ENABLE_SCHEMA_DEFAULT"),A.hooks.use("ENABLE_SCHEMA_VALIDATION")];var Jr={schema:{props:{name:{label:"Fieldset Name"},label:{label:"Fieldset Title",default:"Fieldset"},description:{label:"Fieldset Description",default:"This is a fieldset."}}}};var Qr={schema:{props:{name:{label:"\u8F93\u5165\u9879\u96C6\u5408Name"},label:{label:"\u8F93\u5165\u9879\u96C6\u5408\u6807\u9898",default:"\u8F93\u5165\u9879\u96C6\u5408"},description:{label:"\u8F93\u5165\u9879\u96C6\u5408\u63CF\u8FF0",default:"\u8FD9\u662F\u4E00\u4E2A\u8F93\u5165\u9879\u96C6\u5408\u3002"}}}};J.define({en:{form:{fieldset:Jr}},zh:{form:{fieldset:Qr}}});var ie=J;Te.schema={fallback:{prop:()=>A.guid(),label:()=>A.guid(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>ie.t("form.fieldset.schema.fallback.placeholder"),hint:()=>ie.t("form.fieldset.schema.fallback.hint")},props:[{prop:"name",validation:[{dataType:"String"}],label:()=>ie.t("form.fieldset.schema.props.name.label"),placeholder:()=>ie.t("form.fieldset.schema.props.name.placeholder"),hint:()=>ie.t("form.fieldset.schema.props.name.hint")},{prop:"label",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>ie.t("form.fieldset.schema.props.label.default"),label:()=>ie.t("form.fieldset.schema.props.label.label"),placeholder:()=>ie.t("form.fieldset.schema.props.label.placeholder"),hint:()=>ie.t("form.fieldset.schema.props.label.hint")},{prop:"description",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>ie.t("form.fieldset.schema.props.description.default"),label:()=>ie.t("form.fieldset.schema.props.description.label"),placeholder:()=>ie.t("form.fieldset.schema.props.description.placeholder"),hint:()=>ie.t("form.fieldset.schema.props.description.hint")}]};var m=class{};_(m,"PARENT_TYPE","Fieldset"),_(m,"GROUP_NAMES",{Field:"Field",FieldsetChild:"FieldsetChild"}),_(m,"exceptions",{PROP_SCHEMA_NOT_EXIST:"FIELD_PROP_SCHEMA_NOT_EXIST",HOOK_NOT_EXIST:"FIELD_HOOK_NOT_EXIST",INVALID_PARENT:"FIELD_INVALID_PARENT",UNINSTALLED_TYPE:"FIELD_UNINSTALLED_TYPE"});m.extend=function(e={}){let{type:t,hooks:r,schema:i,group:o}=u({},e);return!r&&(r=m.hooks.default()),!i&&(i=m.schema.default()),!i.fallback&&(i.fallback=m.schema.default("fallback")),!i.props&&(i.props=m.schema.default("props")),o=o?f.array(o)?o.slice():[o]:[],Object.values(m.GROUP_NAMES).forEach(l=>{!o.includes(l)&&o.push(l)}),x(u({},e),{type:t,hooks:r,schema:i,group:o})};var ei={schema:{props:{name:{label:"Name"},label:{label:"Label",default:"Form Field"},value:{label:"Initial Value"},placeholder:{label:"Placeholder",default:""},editable:{label:"If Editable"},visible:{label:"If Visible"},validation:{label:"Validation"},calculation:{label:"Calculation",placeholder:'E.g, {"add": ["<< fields.age.value >>", "<< fields.count.value >>"]}',notSupported:"Unsupported calculation algorithm { name }."},options:{label:"Options",each:{mustbeObject:"Each option must be an object.",labelMustbeNonblankString:"Option label must be a non-blank string.",valueMustbeNonblankString:"Option value must be a non-blank string",mustbeUnique:"Option value must be unique.",label:"Option"}}}},textField:{schema:{props:{label:{default:"Text Field"}}}},multilineTextField:{schema:{props:{label:{default:"Multiline Text Field"}}}},numberField:{schema:{props:{label:{default:"Number Field"}}}},singleSelectField:{schema:{props:{label:{default:"Single Select"}}}},multipleSelectField:{schema:{props:{label:{default:"Multiple Select"}}}},radioField:{schema:{props:{label:{default:"Radio Field"}}}},checkboxField:{schema:{props:{label:{default:"Checkbox Field"}}}}};var ti={schema:{props:{name:{label:"\u8F93\u5165\u9879Name"},label:{label:"\u6807\u9898",default:"\u8F93\u5165\u9879"},value:{label:"\u521D\u59CB\u503C"},placeholder:{label:"\u5360\u4F4D\u7B26",default:""},editable:{label:"\u662F\u5426\u53EF\u7F16\u8F91"},visible:{label:"\u662F\u5426\u53EF\u89C1"},validation:{label:"\u6821\u9A8C\u89C4\u5219"},calculation:{label:"\u8BA1\u7B97\u89C4\u5219",placeholder:'\u4F8B\u5982: {"add": ["<< fields.age.value >>", "<< fields.count.value >>"]}',notSupported:"\u4E0D\u88AB\u652F\u6301\u7684\u8BA1\u7B97{ name }\u3002"},options:{label:"\u9009\u9879",each:{mustbeObject:"\u53EF\u9009\u9879\u76EE\u987B\u662F\u5BF9\u8C61\u3002",labelMustbeNonblankString:"\u53EF\u9009\u9879\u6807\u9898\u987B\u662F\u975E\u7A7A\u5B57\u7B26\u4E32\u3002",valueMustbeNonblankString:"\u53EF\u9009\u9879\u7684\u503C\u987B\u662F\u975E\u7A7A\u5B57\u7B26\u4E32\u3002",mustbeUnique:"\u9009\u9879\u503C\u4E0D\u80FD\u91CD\u590D\u3002",label:"\u9009\u9879"}}}},textField:{schema:{props:{label:{default:"\u5355\u884C\u6587\u672C"}}}},multilineTextField:{schema:{props:{label:{default:"\u591A\u884C\u6587\u672C"}}}},numberField:{schema:{props:{label:{default:"\u6570\u5B57"}}}},singleSelectField:{schema:{props:{label:{default:"\u4E0B\u62C9\u5355\u9009"}}}},multipleSelectField:{schema:{props:{label:{default:"\u4E0B\u62C9\u591A\u9009"}}}},radioField:{schema:{props:{label:{default:"\u5355\u9009"}}}},checkboxField:{schema:{props:{label:{default:"\u591A\u9009"}}}}};J.define({en:{form:{field:ei}},zh:{form:{field:ti}}});var T=J;var ro=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"calculation"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="calculation")return;let i=this.get({id:t,prop:r},{include:["raw","error"]});if(i.error)return console.warn("Skipping using calculated value since prev errors exist.",i.error);!i.raw.value||this.set({id:t,prop:"value",value:i.value})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i}=e;if(r!=="value")return;let o=this.get({id:t,prop:"calculation"},{include:"raw"});if(o.raw.value&&i!==o.value)return!1}}],ri=ro;var ii="FORM_FIELD_ENABLE_VALUE_VALIDATION",io=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(!["value","validation"].includes(r))return;let{value:i,error:o}=this.get({id:t,prop:"value"},{include:"error"});if(oo(o)){let p="Skipping validating value using validation rules";return p+=" since prev value errors exist.",console.warn(p,o)}let[l,a]=[this.members,this.naming("value")],n=this.get({id:t,prop:"validation"},{include:"error"});if(n.error){let p="Skipping validating value using field validation";return p+=" since field validation has errors.",console.warn(p,n.error),l[t][a.error]=null}if(o=null,!n.value&&(n.value=[]),h.array(n.value)&&(n.value=[n.value]),(n.value.find(p=>p&&"presence"in p)||h.blank(i))&&n.value.some(p=>{try{return o=this.validator.error(p,i)}catch(d){return o=d}}),!o)return l[t][a.error]=null;l[t][a.error]=[F.create({data:{hook:ii},type:I.exceptions.VALIDATION_FAILED,message:f.string(o)?o:o.message||o.name})]}}];function oo(e){if(!e)return!1;if(h.array(e)&&(e=[e]),e=e.find(t=>{var r;return((r=t==null?void 0:t.data)==null?void 0:r.hook)!==ii}),e)return!0}var oi=io;var li="FORM_FIELD_ENSURE_VALUE_WITHIN_OPTIONS",lo=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(!["value","options"].includes(r))return;let{value:i,error:o}=this.get({id:t,prop:"value"},{include:"error"});if(ao(o)){let d="Skipping checking if value is within field options";return d+=" since prev value errors exist.",console.warn(d,o)}let[l,a]=[this.members,this.naming("value")],n=this.get({id:t,prop:"options"},{include:"error"});if(n.error){let d="Skipping checking if value is within field options";return d+=" since field options has errors.",console.warn(d,n.error),l[t][a.error]=null}if(f.blank(i))return l[t][a.error]=null;h.array(i)&&(i=[i]);let s=(n.value||[]).map(d=>d.value);if(!i.some(d=>!s.includes(d)))return l[t][a.error]=null;l[t][a.error]=[F.create({data:{hook:li},type:I.exceptions.VALIDATION_FAILED,message:"Each picked value must be included in option values."})]}}];function ao(e){if(!e)return!1;if(h.array(e)&&(e=[e]),e=e.find(t=>{var r;return((r=t==null?void 0:t.data)==null?void 0:r.hook)!==li}),e)return!0}var ai=lo;var pt={ENABLE_VALUE_CALCULATION:ri,ENABLE_VALUE_VALIDATION:oi,ENSURE_VALUE_WITHIN_OPTIONS:ai},no=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),pt.ENABLE_VALUE_CALCULATION,A.hooks.use("ENABLE_SCHEMA_VALIDATION"),pt.ENABLE_VALUE_VALIDATION];m.hooks={use(e){return!(e in pt)&&g({type:m.exceptions.HOOK_NOT_EXIST}),pt[e]},default(){return no.slice()}};var Je={FALLBACK:{prop:()=>P(),label:()=>P(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>T.t("form.field.schema.fallback.placeholder"),hint:()=>T.t("form.field.schema.fallback.hint")},PROPS:[{prop:"name",validation:[{dataType:"String"}],label:()=>T.t("form.field.schema.props.name.label"),placeholder:()=>T.t("form.field.schema.props.name.placeholder"),hint:()=>T.t("form.field.schema.props.name.placeholder")},{prop:"label",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],default:()=>T.t("form.field.schema.props.label.default"),label:()=>T.t("form.field.schema.props.label.label"),placeholder:()=>T.t("form.field.schema.props.label.placeholder"),hint:()=>T.t("form.field.schema.props.label.hint")},{prop:"value",schemable:!1,calculable:!1,validation:null,default:null,label:()=>T.t("form.field.schema.props.value.label"),placeholder:()=>T.t("form.field.schema.props.value.placeholder"),hint:()=>T.t("form.field.schema.props.value.hint")},{prop:"placeholder",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>T.t("form.field.schema.props.placeholder.default"),label:()=>T.t("form.field.schema.props.placeholder.label"),placeholder:()=>T.t("form.field.schema.props.placeholder.placeholder"),hint:()=>T.t("form.field.schema.props.placeholder.hint")},{prop:"editable",schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],rawValidation:[{presence:!0},{dataType:"Boolean"}],default:!0,label:()=>T.t("form.field.schema.props.editable.label"),placeholder:()=>T.t("form.field.schema.props.editable.placeholder"),hint:()=>T.t("form.field.schema.props.editable.hint")},{prop:"visible",schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],rawValidation:[{presence:!0},{dataType:"Boolean"}],default:!0,label:()=>T.t("form.field.schema.props.visible.label"),placeholder:()=>T.t("form.field.schema.props.visible.placeholder"),hint:()=>T.t("form.field.schema.props.visible.hint")},u({prop:"validation",schemable:!0,calculable:!0,default:null,label:()=>T.t("form.field.schema.props.validation.label"),placeholder:()=>T.t("form.field.schema.props.validation.placeholder"),hint:()=>T.t("form.field.schema.props.validation.hint")},(()=>{let e=[{dataType:"Array"},function(t){let[r,i]=[-1,null];for(;++r<t.value.length;){i=t.value[r];let o=$t(this,i);if(o)return o.data.validationIndex=r,o}}];return{validation:e,rawValidation:e}})()),{prop:"calculation",schemable:!0,calculable:!0,default:null,label:()=>T.t("form.field.schema.props.calculation.label"),placeholder:()=>T.t("form.field.schema.props.calculation.placeholder"),hint:()=>T.t("form.field.schema.props.calculation.hint"),validation:null,rawValidation:[function(e){if(!this.calculator.isSupported(e.value,{strict:!0}))return F.create({type:D.exceptions.UNSUPPORTED_CALCULATION,message:T.t("form.field.schema.props.calculation.notSupported",{variables:{name:e.value}})})}]}]},so={PROPS:[{prop:"options",schemable:!1,calculable:!1,default:()=>{let e="1",t="form.field.schema.props.options.each.label";return[{value:e,label:`${T.t(t)} ${e}`}]},label:()=>T.t("form.field.schema.props.options.label"),placeholder:()=>T.t("form.field.schema.props.options.placeholder"),hint:()=>T.t("form.field.schema.props.options.hint"),rawValidation:null,validation:[{presence:!0},{dataType:"Array"},function(e){let t=e.value;t.forEach((r,i)=>{let[o,l,a]=[!0,"",-1];h.object(r)?(o=!1,l="form.field.schema.props.options.each.mustbeObject"):h.nonblankString(r.label)?(o=!1,l="form.field.schema.props.options.each.labelMustbeNonblankString"):h.nonblankString(r.value)?(o=!1,l="form.field.schema.props.options.each.valueMustbeNonblankString"):(a=t.findIndex((n,s)=>s!==i&&n.value===r.value),a>=0&&(o=!1,l="form.field.schema.props.options.each.mustbeUnique")),!o&&g({data:{optionIndex:a>=0?a:i},type:I.exceptions.VALIDATION_FAILED,message:T.t(l)})})}]}]};m.schema={use(e){return u({},ni(e))},extend(e,t={}){return u(u({},ni(e)),t)},default(e){return e==="fallback"?u({},Je.FALLBACK):e==="props"?Je.PROPS.slice():{fallback:u({},Je.FALLBACK),props:Je.PROPS.slice()}}};function ni(e){let r=Je.PROPS.concat(so.PROPS).find(i=>i.prop===e);return!r&&g({type:m.exceptions.PROP_SCHEMA_NOT_EXIST,message:`Prop schema of '${e}' does not exist.`}),r}function y(e="",t="",r){return f.undefined(r)&&(r=["label","placeholder","hint"]),z.from(r.map(i=>[i,po(e,t,i)]))}function po(e,t,r){return()=>T.try([`form.field.${e}.schema.props.${t}.${r}`,`form.field.schema.props.${t}.${r}`])}var si=m.extend({type:"CheckboxField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},y("checkboxField","name"))),m.schema.extend("label",u({},y("checkboxField","label",["label","placeholder","hint","default"]))),m.schema.extend("value",x(u({},y("checkboxField","value")),{validation:[{dataType:"Array"}]})),m.schema.extend("options",u({},y("checkboxField","options"))),m.schema.extend("editable",u({},y("checkboxField","editable"))),m.schema.extend("visible",u({},y("checkboxField","visible"))),m.schema.extend("validation",u({},y("checkboxField","validation"))),m.schema.extend("calculation",u({},y("checkboxField","calculation")))]}});var pi=m.extend({type:"MultilineTextField",schema:{props:[m.schema.extend("name",u({},y("multilineTextField","name"))),m.schema.extend("label",u({},y("multilineTextField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},y("multilineTextField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",x(u({},y("multilineTextField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("editable",u({},y("multilineTextField","editable"))),m.schema.extend("visible",u({},y("multilineTextField","visible"))),m.schema.extend("validation",u({},y("multilineTextField","validation"))),m.schema.extend("calculation",u({},y("multilineTextField","calculation")))]}});var ui=m.extend({type:"MultipleSelectField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},y("multipleSelectField","name"))),m.schema.extend("label",u({},y("multipleSelectField","label",["label","placeholder","hint","default"]))),m.schema.extend("value",x(u({},y("multipleSelectField","value")),{validation:[{dataType:"Array"}]})),m.schema.extend("options",u({},y("multipleSelectField","options"))),m.schema.extend("editable",u({},y("multipleSelectField","editable"))),m.schema.extend("visible",u({},y("multipleSelectField","visible"))),m.schema.extend("validation",u({},y("multipleSelectField","validation"))),m.schema.extend("calculation",u({},y("multipleSelectField","calculation")))]}});var ci=m.extend({type:"NumberField",schema:{props:[m.schema.extend("name",u({},y("numberField","name"))),m.schema.extend("label",u({},y("numberField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},y("numberField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",x(u({},y("numberField","value")),{validation:[{dataType:"Number"}]})),m.schema.extend("editable",u({},y("numberField","editable"))),m.schema.extend("visible",u({},y("numberField","visible"))),m.schema.extend("validation",u({},y("numberField","validation"))),m.schema.extend("calculation",u({},y("numberField","calculation")))]}});var fi=m.extend({type:"RadioField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},y("radioField","name"))),m.schema.extend("label",u({},y("radioField","label",["label","placeholder","hint","default"]))),m.schema.extend("value",x(u({},y("radioField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("options",u({},y("radioField","options"))),m.schema.extend("editable",u({},y("radioField","editable"))),m.schema.extend("visible",u({},y("radioField","visible"))),m.schema.extend("validation",u({},y("radioField","validation"))),m.schema.extend("calculation",u({},y("radioField","calculation")))]}});var mi=m.extend({type:"SingleSelectField",hooks:[A.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),A.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},y("singleSelectField","name"))),m.schema.extend("label",u({},y("singleSelectField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},y("singleSelectField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",x(u({},y("singleSelectField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("options",u({},y("singleSelectField","options"))),m.schema.extend("editable",u({},y("singleSelectField","editable"))),m.schema.extend("visible",u({},y("singleSelectField","visible"))),m.schema.extend("validation",u({},y("singleSelectField","validation"))),m.schema.extend("calculation",u({},y("singleSelectField","calculation")))]}});var di=m.extend({type:"TextField",schema:{props:[m.schema.extend("name",u({},y("textField","name"))),m.schema.extend("label",u({},y("textField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},y("textField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",x(u({},y("textField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("editable",u({},y("textField","editable"))),m.schema.extend("visible",u({},y("textField","visible"))),m.schema.extend("validation",u({},y("textField","validation"))),m.schema.extend("calculation",u({},y("textField","calculation")))]}});var Xt=[di,pi,ci,mi,ui,fi,si];var $={type:"Subform",group:"FieldsetChild"};$.collect=function(e){let t=this.get({id:e.id},{include:"raw"}),[r,i]=[[],[]],[o,l]=[[],[]];return(this.family.descendant(e)||[]).forEach((a,n)=>{let[s,p]=[{},{}];(this.family.descendant(a)||[]).forEach(d=>{let c=this.collect({id:d.id},{errors:!1});s[c.values.name]=c.values.value,p[c.values.name]=c.raw.values.value,n===0&&(delete c.values.value,delete c.raw.values.value,o.push(c.values),l.push(c.raw.values))}),r.push(s),i.push(p)}),t.values.value=r,t.raw.values.value=i,t.values.children=o,t.raw.values.children=l,t};$.hooks=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:"Fieldset"}),A.hooks.use("ENABLE_SCHEMA_DEFAULT"),A.hooks.use("ENABLE_SCHEMA_VALIDATION")];var hi={schema:{props:{name:{label:"Name"},label:{label:"Label",default:"Subform"},editable:{label:"If Editable"},visible:{label:"If Visible"}}},fieldSizeIsInvalid:"Each subform must contain one field at least."};var bi={schema:{props:{name:{label:"\u5B50\u8868\u5355Name"},label:{label:"\u5B50\u8868\u5355\u6807\u9898",default:"\u5B50\u8868\u5355"},editable:{label:"\u662F\u5426\u53EF\u7F16\u8F91"},visible:{label:"\u662F\u5426\u53EF\u89C1"}}},fieldSizeIsInvalid:"\u5B50\u8868\u5355\u81F3\u5C11\u8981\u5305\u542B\u4E00\u4E2A\u8F93\u5165\u9879\u3002"};J.define({en:{form:{subform:hi}},zh:{form:{subform:bi}}});var H=J;$.schema={fallback:{prop:()=>A.guid(),label:"",default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>H.t("form.subform.schema.fallback.placeholder"),hint:()=>H.t("form.subform.schema.fallback.hint")},props:[{prop:"name",validation:[{dataType:"String"}],label:()=>H.t("form.subform.schema.props.name.label"),placeholder:()=>H.t("form.subform.schema.props.name.placeholder"),hint:()=>H.t("form.subform.schema.props.name.hint")},{prop:"label",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],default:()=>H.t("form.subform.schema.props.label.default"),label:()=>H.t("form.subform.schema.props.label.label"),placeholder:()=>H.t("form.subform.schema.props.label.placeholder"),hint:()=>H.t("form.subform.schema.props.label.hint")},{prop:"editable",default:!0,schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],label:()=>H.t("form.subform.schema.props.editable.label"),placeholder:()=>H.t("form.subform.schema.props.editable.placeholder"),hint:()=>H.t("form.subform.schema.props.editable.hint")},{prop:"visible",default:!0,schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],label:()=>H.t("form.subform.schema.props.visible.label"),placeholder:()=>H.t("form.subform.schema.props.visible.placeholder"),hint:()=>H.t("form.subform.schema.props.visible.hint")}]};$.seed=function(e,t){let r=t.children||[],i=t.value||[];!i.length&&i.push({});let o=i.map(()=>{let[n,s]=[this.guid(),"SubformFieldset"];return{action:"add",parentId:e.id,id:n,props:{type:s}}}),l=Object.keys(t).map(n=>{if(!["children","value"].includes(n))return{action:"set",id:e.id,prop:n,value:t[n]}}).filter(n=>n),a=o.map((n,s)=>(r=r.map((p,d)=>{let b=f.object(i[s])&&p.name in i[s]?i[s][p.name]:null;return x(u({},p),{order:d,value:b})}),this.seed({id:n.id},{children:r},{execute:!1}))).flat();return o.concat(l,a).map(n=>x(u({},n),{__syncSubformField__:!0}))};var ve={type:"SubformFieldset",group:"SubformChild"};ve.hooks=[A.hooks.use("BLOCK_INVALID_PARENT",{accept:"Subform"})];var w=class{};_(w,"TYPE_PREFIX","Subform"),_(w,"LABEL_PREFIX","Subform "),_(w,"PARENT_TYPE","SubformFieldset"),_(w,"GROUP_NAMES",{SubformField:"SubformField",SubformFieldsetChild:"SubformFieldsetChild"}),_(w,"exceptions",{INVALID_PARENT:"SUBFORM_FIELD_INVALID_PARENT",INVALID_FIELD_INSTALLER:"SUBFORM_FIELD_INVALID_FIELD_INSTALLER",INVALID_FIELD_SIZE:"SUBFORM_FIELD_INVALID_FIELD_SIZE"});var uo=[{hook:"before-add",handler(e){let{parentId:t,props:r,__syncSubformField__:i}=e;if(i)return;let o=[x(u({},e),{action:"add",__syncSubformField__:!0})],l=this.family.sibling({id:t})||[];return o=o.concat(l.map(a=>({action:"add",__syncSubformField__:!0,parentId:a.id,id:this.guid(),props:r}))),this.executor.run(o),!1}},{hook:"before-del",handler(e){let{id:t,__syncSubformField__:r}=e;if(r)return;let i=[x(u({},e),{action:"del",__syncSubformField__:!0})],l=this.family.sibling({id:t},{self:!0}).findIndex(s=>s.id===t),a=this.family.ancestor({id:t}),n=this.family.sibling(a)||[];return i=i.concat(n.map(s=>({action:"del",__syncSubformField__:!0,id:this.family.descendant(s)[l].id}))),this.executor.run(i),!1}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i,__syncSubformField__:o}=e;if(o||r==="value")return;let l=[x(u({},e),{action:"set",__syncSubformField__:!0})],n=this.family.sibling({id:t},{self:!0}).findIndex(d=>d.id===t),s=this.family.ancestor({id:t}),p=this.family.sibling(s)||[];return l=l.concat(p.map(d=>({action:"set",__syncSubformField__:!0,id:this.family.descendant(d)[n].id,prop:r,value:i}))),this.executor.run(l),!1}},{scope:ve.type,hook:"after-add",handler(e){let{id:t,props:r}=e,i=this.family.sibling({id:t});if(!i)return;let o=this.collect({id:i[0].id}).raw.values.children;if(!o.length)return;let l=o.map((a,n)=>{let s=((r==null?void 0:r.children)||[])[n]||{},p="value"in s?s.value:null;return{action:"add",__syncSubformField__:!0,parentId:t,id:this.guid(),props:x(u({},a),{order:n,value:p})}});this.executor.run(l)}}],Ei=uo;var co=[{hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:i,schema:o}=this;if(!o.for({id:t}).find(p=>p.prop==="value"))return;let a=r.ancestor({id:t}),s={id:r.ancestor(a).id,prop:"value"};i.add({relier:s,provider:{id:t,prop:"name"}}),i.add({relier:s,provider:{id:t,prop:"value"}})}},{scope:ve.type,hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:i}=this,l={id:r.ancestor({id:t}).id,prop:"value"};i.add({relier:l,provider:{id:t,prop:"order"}})}},{scope:$.type,hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let{family:i}=this,o=(i.descendant({id:t})||[]).map(n=>z.from((i.descendant(n)||[]).map(s=>{let p=this.get({id:s.id,prop:"name"}),d=this.get({id:s.id,prop:"value"});return[p,d]}))),[l,a]=[this.members[t],this.naming(r)];l[a.prop]=l[a.raw.prop]=o}}],yi=co;var fo=[{scope:$.type,hook:"after-add",handler(e){let[t,r]=[e.id,"value"],[i,o]=[this.members[t],this.naming(r)],{error:l}=this.get({id:t,prop:r},{include:"error"});i[o.error]=gi(l)}},{scope:$.type,hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let i=w.exceptions.INVALID_FIELD_SIZE,{error:o}=this.get({id:t,prop:r},{include:["error"]});if(xi(o,{except:[i]})){let p=`Skipping checking subform*Field exists of member ${t},`;return p+=" since previous errors exist.",console.warn(p,o)}let l=this.get({id:t,prop:r}),[a,n]=[this.members[t],this.naming(r)];o=!l||!l.length||!Object.keys(l[0]).length?gi(o):mo(o),a[n.error]=o}}];function gi(e){let t=e||[],r=w.exceptions.INVALID_FIELD_SIZE;return h.array(t)&&(t=[t]),!xi(t,{include:[r]})&&t.push(F.create({type:r,message:H.t("form.subform.fieldSizeIsInvalid")})),t}function mo(e){if(!e||!e.length)return null;h.array(errors)&&(errors=[errors]);let t=w.exceptions.INVALID_FIELD_SIZE;return errors=errors.filter(r=>r.type===t),errors.length?errors:null}function xi(e,t={}){if(!e||!e.length)return!1;h.array(e)&&(e=[e]);let{include:r,except:i}=t;return r?e.some(o=>r.includes(o.type)):i?e.some(o=>!i.includes(o.type)):!0}var Ii=fo;w.generate=function(e={}){let{type:t,hooks:r,group:i}=e;i=i?f.array(i)?i.slice():[i]:[],!i.includes(m.GROUP_NAMES.Field)&&g({type:w.exceptions.INVALID_FIELD_INSTALLER,message:`SubformField.generate only accepts field installer
             to generate a subform field installer.`});let o=Object.values(m.GROUP_NAMES);i=i.filter(p=>!o.includes(p)),Object.values(w.GROUP_NAMES).forEach(p=>{!i.includes(p)&&i.push(p)}),t=w.TYPE_PREFIX+t,r=r?r.slice():[];let l="BLOCK_INVALID_PARENT",a=A.hooks.use(l,{accept:m.PARENT_TYPE}),n=A.hooks.use(l,{accept:w.PARENT_TYPE}),s=r.indexOf(a);return s>-1&&(r[s]=n),r=r.concat(Ei,yi,Ii),x(u({},e),{type:t,hooks:r,group:i})};var ut=class{constructor(){this.i18n=M.create(),this.reactive=A({i18n:this.i18n}),ut.MEMBERS.forEach(t=>this.reactive.install(t))}static create(...t){return new ut(...t)}},k=ut;_(k,"MEMBERS",[]),_(k,"Field",m);k.group=function(e=""){let t=k.MEMBERS.filter(r=>e?r.group.includes(e):!r.group.length);return t.length?t:null};k.install=function(e={}){h.array(e)&&(e=[e]),e.forEach(t=>{let{type:r,group:i,providers:o,validators:l}=u({},t);i="group"in t?i:[],h.array(i)&&(i=[i]),E.nonblankString(r,'Form Member "Type"'),o&&E.function(o,'Form Member "providers"'),l&&E.function(l,'Form Member "validators"'),i.forEach(a=>E.nonblankString(a,'Form Member "group"')),k.MEMBERS.push(x(u({},t),{group:i})),!!i.includes(m.GROUP_NAMES.Field)&&k.MEMBERS.push(w.generate(t))})};k.providers=function(e,t={},r={}){var d;let{id:i,prop:o}=t,l=[],a=e.get({id:i,prop:"type"}),n=(d=k.MEMBERS.find(c=>c.type===a))==null?void 0:d.providers;if(n)return n.call(e,{id:i,prop:o},r);if(Object.keys(e.members).forEach(c=>{if(c===i)return;let b=e.family.ancestor({id:c});!b||e.get({id:b.id,prop:"type"})!==Te.type||!(e.naming("value").prop in e.members[c])||l.push({id:c,prop:"value"})}),!l.length)return null;let s=e.dependency.reliers({id:i,prop:o});if(!s)return l;let p=l.filter(c=>!s.some(b=>c.id===b.id&&c.prop===b.prop));return p.length?p:null};k.uninstall=function(e=""){!e||(k.MEMBERS=k.MEMBERS.filter(t=>t.type!==e))};k.validators=function(e,t={},r={}){var p;let{id:i,prop:o}=t;o="value";let l=e.get({id:i,prop:"type"}),a=(p=k.MEMBERS.find(d=>d.type===l))==null?void 0:p.validators;if(a)return a.call(e,{id:i,prop:o},r);let n=e.schema.for({id:i,prop:o}).validation||[];h.array(n)&&(n=[n]);let s=n.find(d=>"dataType"in d);return s?e.validator.for(s.dataType,{except:"dataType"}):[e.validator.get("presence")]};k.install(Te);k.install($);k.install(ve);k.install(Xt);return ho;})();
//# sourceMappingURL=rcfm.model.iife.min.js-fa1f4157.map
