/*!
 * rcfm 2.2.1 | rcfm/model iife | https://reactive-form.github.io/
 * Copyright 2021 - 2023 JLxiangyun | MIT license
 */
var ReactiveForm=(()=>{var ft=Object.defineProperty,Ii=Object.defineProperties;var vi=Object.getOwnPropertyDescriptors;var Qt=Object.getOwnPropertySymbols;var _i=Object.prototype.hasOwnProperty,Ni=Object.prototype.propertyIsEnumerable;var mt=(e,t,r)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t)=>{for(var r in t||(t={}))_i.call(t,r)&&mt(e,r,t[r]);if(Qt)for(var r of Qt(t))Ni.call(t,r)&&mt(e,r,t[r]);return e},v=(e,t)=>Ii(e,vi(t)),Ti=e=>ft(e,"__esModule",{value:!0});var Si=(e,t)=>{Ti(e);for(var r in t)ft(e,r,{get:t[r],enumerable:!0})};var S=(e,t,r)=>(mt(e,typeof t!="symbol"?t+"":t,r),r);var bo={};Si(bo,{Calculator:()=>P,Context:()=>F,Exception:()=>D,Form:()=>C,I18n:()=>j,Reactive:()=>_,Schema:()=>at,Struct:()=>je,Type:()=>O,Validator:()=>A,guid:()=>V});var Ne=class extends Error{constructor(t={}){typeof t=="string"&&(t={type:t});let{type:r,message:i,data:o}=t;super(i);if(this.type=this.name=r,this.data=o||{},typeof this.data!="object"||Array.isArray(this.data))throw new Error("Exception data must be included in an object.")}static create(...t){return new Ne(...t)}static raise(...t){throw new Ne(...t)}static isException(t){return t instanceof Ne}static isntException(t){return!Ne.isException(t)}static mustbeException(t,r=""){Ne.isntException(t)&&Ne.raise({type:Ne.exceptions.INVALID_INSTANCE,message:r||"Invalid exception instance."})}},D=Ne;S(D,"exceptions",{INVALID_INSTANCE:"EXCEPTION_INVALID_INSTANCE"});var g=D.raise;var Oi=0;function V(){return`${Date.now()}${Oi+=1}`}var O={ANY_TYPE:"*",SPECIFIC_TYPES:["String","Number","Boolean","Array","Object","RegExp","Function","Null","Undefined","Map","WeakMap","Symbol","File","Blob","Promise"],exceptions:{INVALID_DATA_TYPE:"TYPE_INVALID_DATA_TYPE"},get(e){let t=/\[object\s+(.*)\]/;return Object.prototype.toString.call(e).match(t)[1]},within(e={}){let{type:t,types:r}=e;return!Array.isArray(t)&&(t=[t]),!Array.isArray(r)&&(r=[r]),t.includes(O.ANY_TYPE)||r.includes(O.ANY_TYPE)?!0:!t.some(i=>!r.includes(i))},mustWithin(e={},t=""){!O.within(e)&&g({type:O.exceptions.INVALID_DATA_TYPE,message:t||`Data type ${e.type} isn't within ${e.types}`})}},f=O.is={null(e){return O.get(e)==="Null"},undefined(e){return O.get(e)==="Undefined"},number(e){return O.get(e)==="Number"},integer(e){return Number.isInteger(e)},string(e){return O.get(e)==="String"},boolean(e){return O.get(e)==="Boolean"},array(e){return Array.isArray(e)},object(e){return O.get(e)==="Object"},regexp(e){return O.get(e)==="RegExp"},function(e){return O.get(e)==="Function"},positiveInteger(e){return f.integer(e)&&e>0},negativeInteger(e){return f.integer(e)&&e<0},blankArray(e){return f.array(e)&&e.length===0},blankString(e){return f.string(e)&&!!e.match(/^\s*$/)},blankObject(e){return f.object(e)&&Object.keys(e).length===0},nonblankArray(e){return f.array(e)&&e.length>0},nonblankString(e){return f.string(e)&&!!e.match(/\S/)},nonblankObject(e){return f.object(e)&&Object.keys(e).length>0},typeString(e){return e===O.ANY_TYPE?!0:O.SPECIFIC_TYPES.includes(e)},typeArray(e){return f.nonblankArray(e)?e.every(t=>t===O.ANY_TYPE?!0:O.within({type:t,types:O.SPECIFIC_TYPES})):!1},type(e){return f.typeString(e)||f.typeArray(e)},blank(e){return!!([null,void 0,NaN].includes(e)||f.blankString(e)||f.blankArray(e)||f.blankObject(e))}},h=O.isnt=(()=>{let e={};return Object.keys(f).forEach(t=>{e[t]=function(r){return!f[t](r)}}),e})(),y=O.mustbe=(()=>{let e={};return Object.keys(h).forEach(t=>{e[t]=function(r,i="The argument"){let o=f.object(i)?i.message:"";h[t](r)&&g({type:O.exceptions.INVALID_DATA_TYPE,message:o||`${i} must be '${t.toUpperCase()}'`})}}),e})(),dt=O.musntbe=(()=>{let e={};return Object.keys(f).forEach(t=>{e[t]=function(r,i="The argument"){let o=f.object(i)?i.message:"";f[t](r)&&g({type:O.exceptions.INVALID_DATA_TYPE,message:o||`${i} must not be '${t.toUpperCase()}'`})}}),e})();var je={},le=je.array={unique(e=[]){return e.filter((t,r)=>e.indexOf(t)===r)}},W=je.object={from(e=[]){y.array(e);let t={};return e.forEach(r=>t[r[0]]=r[1]),t},collect(e={},t=[]){y.object(e),y.array(t);let r={};return Object.keys(e).forEach(i=>{t.includes(i)&&(r[i]=e[i])}),r},exclude(e={},t=[]){y.object(e),y.array(t);let r={};return Object.keys(e).forEach(i=>{!t.includes(i)&&(r[i]=e[i])}),r}},vo=je.string={capitalize(e=""){return e.replace(/\b\w/g,t=>t.toUpperCase())},dashCase(e=""){let t=/[A-Z]/g,r=i=>`-${i.toLowerCase()}`;return e[0].toLowerCase()+e.slice(1).replace(t,r)}};var er={name:"add",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t+r)}};var tr={name:"devide",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t/r)}};var rr={name:"map",argumentSize:1,argumentType:"*",calculate(e){return e}};var ir={name:"minus",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t-r)}};var or={name:"multiple",argumentSize:[2,1/0],argumentType:"Number",calculate(...e){return e.reduce((t,r)=>t*r)}};var lr=[er,ir,or,tr,rr];function ce(e={},t={}){return e._calculator||(e._calculator=u({},t))}var ht=class{constructor(){ce(this,{installed:{}}),lr.forEach(t=>this.install(t))}static create(...t){return new ht(...t)}},P=ht;S(P,"exceptions",{CONFLICTED_NAME:"CALCULATOR_CONFLICTED_NAME",UNSUPPORTED_CALCULATION:"CALCULATOR_UNSUPPORTED_CALCULATION",INVALID_ARGUMENT_SIZE:"CALCULATOR_INVALID_ARGUMENT_SIZE",INVALID_ARGUMENT_TYPE:"CALCULATOR_INVALID_ARGUMENT_TYPE"});function Be(e={}){let t=Object.keys(e)[0],r=e[t];return h.array(r)&&(r=[r]),{name:t,args:r}}function bt(e,t){return e.length>=t.min}function yt(e=[],t){return!e.some((r,i)=>{let o=t;return h.type(o)&&(o=o[i]||o[o.length-1]),!O.within({type:O.get(r),types:o})})}P.prototype.mustbeSupported=function(e={},t={}){y.object(e,"Calculation struct");let r="strict"in t?t.strict:!1,{name:i,args:o}=Be(e),{installed:l}=ce(this);!l[i]&&g({type:P.exceptions.UNSUPPORTED_CALCULATION,message:`Unsupported calculator "${i}".`}),!!r&&o.forEach(a=>f.object(a)&&this.mustbeSupported(a,t))};P.prototype.isSupported=function(e={},t={}){try{this.mustbeSupported(e,t)}catch(r){return!1}return!0};P.prototype.isntSupported=function(e={},t={}){return!this.isSupported(e,t)};P.prototype.calculate=function(e={}){if(this.isntSupported(e))return null;let{installed:t}=ce(this),{name:r,args:i}=Be(e),{argumentType:o,argumentSize:l,calculate:a}=t[r];return!bt(i,l)||(i=i.slice(0,l.max).map(n=>this.isSupported(n)?this.calculate(n):n),!yt(i,o))?null:a(...i)};function Et(e){return e===1/0?!1:f.positiveInteger(e)?!0:!f.nonblankArray(e)||e.length!==2||!f.positiveInteger(e[0])?!1:e[1]===1/0?!0:e[1]>e[0]}function gt(e){return f.type(e)?!0:h.nonblankArray(e)?!1:e.every(t=>f.typeArray(t))}function xt(e){return{min:f.integer(e)?e:e[0],max:f.integer(e)?e:e[1]}}P.prototype.install=function(e={}){y.object(e,"Calculator installer");let{name:t,argumentSize:r,argumentType:i,calculate:o}=e;y.nonblankString(t,'Calculator installer "name"'),y.function(o,'Calculator installer "calculate"'),!Et(r)&&g({type:P.exceptions.INVALID_ARGUMENT_SIZE,message:'Invalid calculator installer "argumentSize".'}),!gt(i)&&g({type:P.exceptions.INVALID_ARGUMENT_TYPE,message:'Invalid calculator installer "argumentType".'});let{installed:l}=ce(this);t in l&&g({type:P.exceptions.CONFLICTED_NAME,message:`Conflicted calculator name "${t}".`}),l[t]=v(u({},e),{name:t,argumentType:i,calculate:o,argumentSize:xt(r)})};P.prototype.uninstall=function(e=""){let{installed:t}=ce(this);e in t&&delete t[e]};function M(e={},t={}){return e._family||(e._family=u({},t))}var Ce=class{constructor(){let t=V();M(this,{rootId:t,members:{[t]:{id:t,parentId:null,order:0,children:[]}}})}static create(...t){return new Ce(...t)}static isFamily(t){return t instanceof Ce}static isntFamily(t){return!Ce.isFamily(t)}static mustbeFamily(t,r=""){Ce.isntFamily(t)&&g({type:Ce.exceptions.INVALID_INSTANCE,message:r||"Invalid family instance."})}},k=Ce;S(k,"exceptions",{MEMBER_NOT_EXIST:"FAMILY_MEMBER_NOT_EXIST",CONFLICTED_PARENT:"FAMILY_MEMBER_CONFLICTED_PARENT",SELF_REFERENCE:"FAMILY_MEMBER_SELF_REFERENCE",INVALID_INSTANCE:"FAMILY_INVALID_INSTANCE"});function Ue(e={},t=[]){t=t.sort((i,o)=>"order"in i?"order"in o?i.order-o.order:-1:1);let r=t.find(i=>"expectedOrder"in i);if(r){let[i,o]=[t.indexOf(r),r.expectedOrder];t.splice(i,1),o<0?t.unshift(r):o>t.length-1?t.push(r):t.splice(o,0,r)}return t.forEach((i,o)=>{delete e[i.id].expectedOrder,e[i.id].order=o}),t}k.prototype.add=function(e={}){let{rootId:t,members:r}=M(this),i=e.id||V(),o=(e.parent?e.parent.id:e.parentId)||t,l=e.order||1/0;if(y.nonblankString(i,'Family member "id"'),y.nonblankString(o,'Family member "parentId"'),y.number(l,'Family member "order"'),i===o&&g({type:k.exceptions.SELF_REFERENCE,message:"Any family member's parent cannot be itself."}),!r[o]&&g({type:k.exceptions.MEMBER_NOT_EXIST,message:`Family member ${o} is not existed.`}),r[i]){if(r[i].parentId===o)return u({},r[i]);g({type:k.exceptions.CONFLICTED_PARENT,message:"Any family member's parent cannot be changed."})}return r[i]={id:i,expectedOrder:l,touchedAt:V(),parentId:o,children:[]},r[o].children.push(r[i]),r[o].children=Ue(r,r[o].children),u({},r[i])};k.prototype.ancestor=function(e={},t={}){let{id:r}=e,{members:i}=M(this),o="deep"in t?t.deep:!1,l="self"in t?t.self:!1;if(!i[r])return null;let[a,n]=[[u({},i[r])],-1];for(;++n<a.length;){let s=i[a[n].parentId];if(s&&a.push(u({},s)),!o)break}return o?(l||a.shift(),a.length?a:null):(a.shift(),a[0]?a[0]:null)};k.prototype.delete=function(e={}){let{members:t,rootId:r}=M(this);if(e.id===r)return;let i=t[e.id];if(!i)return;let{parentId:o}=i;this.descendant({id:e.id},{self:!0,deep:!0,sort:!1}).forEach(({id:l})=>delete t[l]),t[o].children.splice(i.order,1),t[o].children=Ue(t,t[o].children)};k.prototype.descendant=function(e={},t={}){let{rootId:r,members:i}=M(this),o=e.id||r,l="deep"in t?t.deep:!1,a="self"in t?t.self:!1,n="sort"in t?t.sort:!0;if(!i[o])return null;let[s,p]=[[u({},i[o])],-1];for(;++p<s.length;){let[d,c]=[s[p],s[p].children];if(s.push(...c),!l)break}return a||s.shift(),s.length?s:null};k.prototype.has=function(e={}){let{members:t}=M(this);return e.id in t};k.prototype.hasnt=function(e={}){return!this.has(e)};k.prototype.reorder=function(e={}){let{id:t,order:r}=e,{rootId:i,members:o}=M(this);if(y.number(r,'Family member "order"'),!o[t]||t===i||r===o[t].order)return;o[t].expectedOrder=r,o[t].touchedAt=V();let{parentId:l}=o[t];o[l].children=Ue(o,o[l].children)};k.prototype.root=function(){let{rootId:e,members:t}=M(this);return u({},t[e])};k.prototype.sibling=function(e={},t={}){let{id:r}=e,{members:i,rootId:o}=M(this),l="self"in t?t.self:!1;if(!i[r])return null;if(r===o)return l?[this.root()]:null;let a=this.ancestor({id:r});if(!a)return null;let n=this.descendant(a);return l?n:(n=n.filter(s=>s.id!==r),n.length?n:null)};function Y(e={},t={}){return e._dependency||(e._dependency=u({},t))}var Fe=class{constructor(){Y(this,{associations:{},group:{reliers:{}},cache:{reliers:{}}})}static create(...t){return new Fe(...t)}static isDependency(t){return t instanceof Fe}static isntDependency(t){return!Fe.isDependency(t)}static mustbeDependency(t,r=""){Fe.isntDependency(t)&&g({type:Fe.exceptions.INVALID_INSTANCE,message:r||"Invalid dependency instance."})}},ie=Fe;S(ie,"exceptions",{CIRCLE_REFERENCE:"DEPENDENCY_CIRCLE_REFERENCE",INVALID_INSTANCE:"DEPENDENCY_INVALID_INSTANCE"});var ar="#",et="_";function ae(e={}){let{id:t,prop:r}=e;return t?`${t}${ar}${r||""}`:et}function fe(e=""){if(e===et)return{id:"",prop:""};let[t,r]=e.split(ar);return{id:t,prop:r}}function Te(e={},t){if(!t)return Object.keys(e).forEach(l=>delete e[l]);let{id:r,prop:i}=t;if(!r)return delete e[et];let o=ae({id:r,prop:i});i?(delete e[o],delete e[ae({id:r})],Object.keys(e).forEach(l=>{e[l].includes(o)&&delete e[l]})):Object.keys(e).forEach(l=>{(fe(l).id===r||e[l].includes(o))&&delete e[l]})}var De="__GLOBAL__";ie.prototype.add=function(e=[],t={}){let r="group"in t?t.group:De;y.nonblankString(r,'Association "group"'),h.array(e)&&(e=[e]),e=e.map(({provider:l,relier:a})=>{y.nonblankString(a.id,'Association "relier.id"'),y.nonblankString(l.id,'Association "provider.id"'),y.nonblankString(a.prop,'Association "relier.prop"'),y.nonblankString(l.prop,'Association "provider.prop"');let n={provider:ae(l),relier:ae(a)};return{provider:l,relier:a,path:n}});let{error:i,rollbackQueue:o}=Li(this,e);if(!i)return ki(this,e,r);throw Ri(this,o),i};function Li(e,t){let r=[],{associations:i}=Y(e),o=Y(e).cache.reliers;return t.some(({provider:a,relier:n,path:s})=>{if(s.provider===s.relier)return!0;let p=e.reliers(n,{split:!1});return p&&p.includes(s.provider)?!0:(i[s.provider]||(i[s.provider]=[]),i[s.provider].includes(s.relier)||(i[s.provider].push(s.relier),r.push({provider:a,relier:n,path:s}),Te(o,a)),!1)})?{rollbackQueue:r,error:D.create({type:ie.exceptions.CIRCLE_REFERENCE})}:{error:null,rollbackQueue:null}}function Ri(e,t){let{associations:r}=Y(e),i=Y(e).cache.reliers;t.forEach(({provider:o,path:l})=>{let a=r[l.provider].indexOf(l.relier);a<0||(r[l.provider].splice(a,1),!r[l.provider].length&&delete r[l.provider],Te(i,o))})}function ki(e,t,r){let i=Y(e).group.reliers;t.forEach(({path:o})=>{let l=i[o.provider]||(i[o.provider]={}),a=l[o.relier]||(l[o.relier]=[]);!a.includes(r)&&a.push(r)})}ie.prototype.delete=function(e={},t={}){let{id:r,prop:i}=e;if(!r)return;let{only:o,group:l}=t,a=ae(e),{associations:n}=Y(this),s=Y(this).cache.reliers,p=Y(this).group.reliers,d=i?c=>c===a:c=>fe(c).id===r;o!=="relier"&&(Te(s,e),i?(delete n[a],delete p[a]):Object.keys(n).map(c=>{!d(c)||(delete n[c],delete p[c])})),Object.keys(n).forEach(c=>{let b=n[c].length;n[c]=n[c].filter(x=>{if(!d(x))return!0;if(o!=="relier"||!l||l===De)return delete p[c][x],!1;let N=p[c][x].findIndex(R=>R===l);return N>=0&&p[c][x].splice(N,1),p[c][x].length?!0:(delete p[c][x],!1)});let I=n[c].length;I!==b&&(Te(s,fe(c)),!I&&delete n[c],!Object.keys(p[c]).length&&delete p[c])})};ie.prototype.reliers=function(e=[],t={}){h.array(e)&&(e=[e]);let r=e.some(L=>h.object(L)||!L.id);r&&(e=[{}]);let i="reload"in t?t.reload:!1,o="split"in t?t.split:!0,l="deep"in t?t.deep:!0,a="self"in t?t.self:!0,n="group"in t?t.group:"",{associations:s}=Y(this),p=Y(this).cache.reliers,d=Y(this).group.reliers,[c,b,I]=[[],[],[]];if(e.forEach(L=>{let G=ae(L);if("prop"in L?I.push(G):Object.keys(s).forEach(U=>{fe(U).id===L.id&&I.push(U)}),b.push(L.id),!Ci(s,L))return Te(p,L);(i||!(G in p))&&(p[G]=Fi(s,L),p[G]=nr(s,p[G])),c=c.concat(p[G])}),!c.length)return null;if(e.length>1&&(c=nr(s,le.unique(c))),r||l&&a&&(!n||n===De))return o?c.map(L=>fe(L)):c;let[x,N]=[[],I.slice()],R=I.map(L=>s[L]).flat();return c.forEach(L=>{if(!l&&!R.includes(L))return;let G=fe(L);if(!(!a&&b.includes(G.id))){if(n&&n!==De){let U=Object.keys(d).some(Re=>!N.includes(Re)||!Object.keys(d[Re]).includes(L)?!1:d[Re][L].includes(n));if(N.push(L),!U)return}x.push(o?G:L)}}),x.length?x:null};function Ci(e={},t={}){let{id:r,prop:i}=t;return r?i?ae(t)in e:Object.keys(e).filter(o=>fe(o).id===r).length>0:Object.keys(e).length>0}function Fi(e={},t={}){let{id:r,prop:i}=t,o=(()=>r?i?(e[ae(t)]||[]).slice():le.unique(Object.keys(e).filter(a=>fe(a).id===r).map(a=>e[a]).flat()):le.unique(Object.values(e).flat()))(),l=-1;for(;++l<o.length;)(e[o[l]]||[]).forEach(n=>!o.includes(n)&&o.push(n));return o}function nr(e={},t=[]){let r=-1;for(;++r<t.length;)(e[t[r]]||[]).forEach(o=>{let l=t.indexOf(o);l>r||(t.splice(l,1),t.push(o),r--)});return t}function me(e={},t={}){return e._dispatcher||(e._dispatcher=u({},t))}var X=class{constructor(t={}){"target"in t&&y.function(t.target,"options.target"),me(this,{isAborted:!1,listeners:{},target:t.target||function(r){return r}})}static create(...t){return new X(...t)}};X.prototype.abort=function(e=!0){me(this).isAborted=e===!0};function He(e={},t,r){t in e&&(r?r=f.array(r)?r:[r]:r=Object.keys(e[t]),r.forEach(i=>{i in e[t]&&!e[t][i].length&&delete e[t][i]}),!Object.keys(e[t]).length&&delete e[t])}X.prototype.add=function(e={},t){let{id:r,event:i}=e,{listeners:o}=me(this);y.nonblankString(r,'Dispatcher "id"'),y.nonblankString(i,'Dispatcher "event"'),y.function(t,'Dispatcher "handler"'),o[r]||(o[r]={});let l={callback:t},a=o[r][i]||(o[r][i]=[]);return a.push(l),function(){!a.includes(l)||(a.splice(a.indexOf(l),1),He(o,r,i))}};X.prototype.delete=function(e={},t){let{id:r,event:i}=e,{listeners:o}=me(this);if(!!o[r]){if(!i){r in o&&delete o[r];return}if(!!o[r][i]){if(!t){i in o[r]&&delete o[r][i];return}o[r][i]=o[r][i].filter(l=>l.callback!==t),He(o,r,i)}}};X.prototype.trigger=function(e={},t){t&&y.function(t,'Dispatcher "handler"');let{id:r,event:i,detail:o}=e,{listeners:l,target:a,isAborted:n}=me(this);if(n||!l[r]||!l[r][i])return!1;let s=!1,p={type:i,target:a(r),detail:o};return t?t(p,o)===!1:(l[r][i].forEach(({callback:d})=>{let c=d(p,o)===!1;s||(s=c)}),!s)};function Pe(e={},t={}){return e._executor||(e._executor=u({},t))}var de=class{constructor(t={}){y.function(t.runner,"options.runner"),Pe(this,{isAborted:!1,queues:{current:[],next:[]},runner:t.runner||function(r){return r}})}static create(...t){return new de(...t)}};de.prototype.abort=function(e=!0){Pe(this).isAborted=e===!0};de.prototype.run=function(e){let{queues:t,runner:r,isAborted:i}=Pe(this);if(arguments.length&&(h.array(e)&&(e=[e]),t.next=t.next.concat(e)),!i&&!t.current.length&&!!t.next.length){t.current=t.next,t.next=[];try{r(t.current.slice())}catch(o){t.current=[],g({type:o.type||o.name,message:o.message})}t.current=[],this.run()}};function he(e={},t={}){return e._hook||(e._hook=u({},t))}var Z=class{constructor(){he(this,{isAborted:!1,hooks:{}})}static create(...t){return new Z(...t)}};Z.prototype.abort=function(e=!0){he(this).isAborted=e===!0};Z.prototype.add=function(e="",t){y.nonblankString(e,'Hook "type"'),y.function(t,'Hook "handler"');let{hooks:r}=he(this);return r[e]||(r[e]=[]),r[e].push(t),function(){let i=r[e].indexOf(t);i>=0&&r[e].splice(i,1)}};Z.prototype.delete=function(e="",t){let{hooks:r}=he(this);!r[e]||(t?r[e]=r[e].filter(i=>i!==t):r[e]=[])};Z.prototype.run=function(e="",t={}){let{hooks:r,isAborted:i}=he(this);if(i)return!1;if(!r[e])return!0;let[o,l]=[t.arguments,!1];return h.array(o)&&(o=[o]),r[e].forEach(a=>{let n=a(...o);l||(l=n===!1)}),i?!1:!l};function At(e={},t={}){var b;let{members:r,family:i,dependency:o,hooks:l}=t,a="id"in e?e.id:e.id=V(),n=i.root().id,s=a===n;if(s&&r[a])return{};let p=s?null:(()=>"parentId"in e?e.parentId:e.parentId=n)();if(!s&&i.has({id:a}))return{};if(!s&&i.hasnt({id:p}))return{};let d="props"in e?e.props:e.props={};"children"in d||(d.children=[]),"order"in d||(d.order=((b=i.descendant({id:p}))==null?void 0:b.length)||0);let c={mutations:{set:[],calc:[]},mutated:[]};return l.run("before-add",{arguments:[e,"before-add"]})?(!s&&i.add({id:a,parentId:p}),r[a]={},c.mutated=[{id:a}],Object.keys(e.props).forEach(I=>{c.mutations.set.push({id:a,prop:I,value:d[I]})}),!s&&o.add({provider:{id:a,prop:"order"},relier:{id:p,prop:"children"}}),l.run("after-add",{arguments:[e,c,"after-add"]}),c):{}}var tt="__raw__prop__",rt="__raw__error__",it="__prop__",ot="__error__";function be(e,t={}){return(t.raw?tt:it)+e}function ye(e,t={}){return(t.raw?rt:ot)+e}function It(e={},t={}){let{members:r,family:i,hooks:o}=t,{id:l,prop:a}=e;if(i.hasnt({id:l}))return{};let n={mutated:[]},s={raw:be(a,{raw:!0}),calc:be(a)},p={raw:ye(a,{raw:!0}),calc:ye(a)};if(!o.run("before-calc",{arguments:[e,"before-calc"]}))return{};if(a==="children"){let d=i.descendant({id:l})||[];return r[l][s.calc]=d.map(({id:c})=>({id:c})),r[l][s.raw]=r[l][s.calc],r[l][p.calc]=r[l][p.raw],n.mutated.push({id:l}),o.run("after-calc",{arguments:[e,n,"after-calc"]}),n}return r[l][s.calc]=r[l][s.raw],r[l][p.calc]=r[l][p.raw],n.mutated.push({id:l}),o.run("after-calc",{arguments:[e,n,"after-calc"]}),n}function vt(e={},t={}){let{id:r}=e,{members:i,family:o,dependency:l,hooks:a}=t;if(o.hasnt({id:r}))return{};if(r===o.root().id)return{};if(!a.run("before-del",{arguments:[e,"before-del"]}))return{};let n={mutations:{add:[],set:[],calc:[]},mutated:[]},s=o.ancestor({id:r}),p=o.descendant({id:r},{deep:!0,self:!0}),d=l.reliers(p,{self:!1});return p.forEach(({id:c})=>{delete i[c],o.delete({id:c}),l.delete({id:c}),n.mutated.push({id:c})}),d&&(n.mutations.calc=d),s&&(o.descendant({id:s.id})||[]).forEach((c,b)=>{n.mutations.set.push({id:c.id,prop:"order",value:b})}),s&&(e.parentId=s.id),a.run("after-del",{arguments:[e,n,"after-del"]}),n}function _t(e={},t={}){let{members:r,family:i,dependency:o,hooks:l}=t,{id:a,prop:n,value:s}=e;if(i.hasnt({id:a}))return{};let p={raw:be(n,{raw:!0})},d={raw:ye(n,{raw:!0})};if(Object.is(r[a][p.raw],s))return{};let c={mutations:{calc:[]},mutated:[]};if(n==="order"){let x=function(N,R){r[N][p.raw]=R,r[N][d.raw]=null,c.mutated.push({id:N}),c.mutations.calc.push({id:N,prop:n});let L=o.reliers({id:N,prop:n})||[];c.mutations.calc=c.mutations.calc.concat(L)},I=i.ancestor({id:a});return I?l.run("before-set",{arguments:[e,"before-set"]})?(i.reorder({id:a,order:e.value}),p.raw in r[a]?i.descendant(I).forEach(({id:N,order:R})=>{x(N,R)}):x(a,i.add({id:a,parentId:I.id}).order),l.run("after-set",{arguments:[e,c,"after-set"]}),c):{}:{}}if(!l.run("before-set",{arguments:[e,"before-set"]}))return{};r[a][p.raw]=e.value,r[a][d.raw]=null,c.mutated=[{id:a}];let b=o.reliers({id:a,prop:n})||[];return c.mutations.calc=[{id:a,prop:n}].concat(b),l.run("after-set",{arguments:[e,c,"after-set"]}),c}function Di(e=[],t=[]){let[r,i]=[{},{}];return t.forEach(o=>{i[o]=[],r[o]=[]}),e.forEach(o=>{let{id:l,action:a}=o;!t.includes(a)||(i[a].push(l),r[a].push(o))}),{jobs:r,ids:i}}function Ke(e={},t,r=[]){t||(t={}),t.mutated&&e.mutated.push(...t.mutated),r.forEach(i=>{e.mutations[i]||(e.mutations[i]=[]),t.mutations&&t.mutations[i]&&e.mutations[i].push(...t.mutations[i])})}function sr(e=[]){let t={};return e.filter(r=>{let i=r.id+r.prop;return i in t?!1:t[i]=!0})}function Pi(e=[]){let[t,r]=[{},[]];return e.forEach(i=>{i.id in t||(r.push(i.id),t[i.id]=!0)}),r}function Nt(e=[],t={}){let{dispatcher:r,family:i}=t,o=["del","add","set","calc"],{jobs:l,ids:a}=Di(e,o),n={mutated:[],mutations:{}};Ke(n,{},o),l.del.forEach(s=>{Ke(n,vt(s,t),["add","set","calc"])}),n.mutations.add.push(...l.add),n.mutations.add.forEach(s=>{let{id:p,parentId:d}=s;a.del.includes(p)||a.del.includes(d)||Ke(n,At(s,t),["set","calc"])}),n.mutations.set.push(...l.set),l.set=sr(n.mutations.set.reverse()).reverse(),l.set.forEach(s=>{a.del.includes(s.id)||Ke(n,_t(s,t),["calc"])}),n.mutations.calc.push(...l.calc),l.calc=sr(n.mutations.calc.reverse()).reverse(),l.calc.forEach(s=>{a.del.includes(s.id)||Ke(n,It(s,t),[])}),Pi(n.mutated).forEach(s=>{r.trigger({id:s,event:"after-mutation"}),i.hasnt({id:s})&&r.delete({id:s})})}var Ve=class{constructor(){this.members={},this.family=k.create(),this.dependency=ie.create(),this.dispatcher=X.create(),this.hooks=Z.create(),this.executor=de.create({runner:t=>Nt(t,this)}),this.executor.run({action:"add",id:this.family.root().id})}static create(...t){return new Ve(...t)}static isContext(t){return t instanceof Ve}static isntContext(t){return!Ve.isContext(t)}static mustbeContext(t,r=""){Ve.isntContext(t)&&g({type:Ve.exceptions.INVALID_INSTANCE,message:r||"Invalid context instance."})}},F=Ve;S(F,"Family",k),S(F,"Dependency",ie),S(F,"Executor",de),S(F,"Dispatcher",X),S(F,"Hook",Z),S(F,"exceptions",{INVALID_INSTANCE:"INVALID_CONTEXT_INSTANCE"});F.prototype.add=function(e){let t=h.array(e);t&&(e=[e||{}]);let r=e.map(i=>v(u({},i),{id:V(),action:"add"}));return this.executor.run(r),t?r[0].id:r.map(i=>i.id)};F.prototype.delete=function(e){if(!e){this.executor.abort(),this.dispatcher.abort(),this.hooks.abort();for(let r in this)delete this[r];return}h.array(e)&&(e=[e]);let t=e.map(r=>v(u({},r),{action:"del"}));this.executor.run(t)};F.prototype.find=function(e){return h.function(e)?null:Object.keys(this.members).find(t=>e({id:t}))};F.prototype.get=function(e={},t={}){let{members:r}=this,i="include"in t?t.include:[],o=i.includes("error"),l=i.includes("raw");return"prop"in e?Vi(r,e,o,l):wi(r,e,o,l)};function Vi(e,t,r,i){let{id:o,prop:l}=t;if(!e[o])return null;let[a,n,s,p]=[null,null,null,null],d=be(l);if(a=d in e[o]?e[o][d]:null,r){let c=ye(l);n=e[o][c]||null}if(i){let c=be(l,{raw:!0});if(s=c in e[o]?e[o][c]:null,r){let b=ye(l,{raw:!0});p=e[o][b]||null}}return!r&&!i?a:r&&!i?{value:a,error:n}:r?{value:a,error:n,raw:{value:s,error:p}}:{value:a,raw:{value:s}}}function wi(e,t,r,i){let{id:o}=t,[l,a,n,s]=[{},null,{},null];return e[o]?(Object.keys(e[o]).forEach(p=>{let d=e[o][p];if(p.startsWith(it))return l[p.replace(it,"")]=d;if(d&&r&&p.startsWith(ot))return a||(a={}),a[p.replace(ot,"")]=d;if(i&&p.startsWith(tt))return n[p.replace(tt,"")]=d;if(d&&i&&r&&p.startsWith(rt))return s||(s={}),s[p.replace(rt,"")]=d}),!i&&!r?l:r&&!i?{values:l,errors:a}:r?{values:l,errors:a,raw:{values:n,errors:s}}:{values:l,raw:{values:n}}):null}F.prototype.naming=function(e=""){return{prop:be(e),error:ye(e),raw:{prop:be(e,{raw:!0}),error:ye(e,{raw:!0})}}};F.prototype.set=function(e){if(!e)return;h.array(e)&&(e=[e]);let t=e.map(r=>v(u({},r),{action:"set"}));this.executor.run(t)};F.prototype.subscribe=function(e={},t){let r={id:e.id,event:"after-mutation"},i="immediately"in e?e.immediately:!0,o=this.dispatcher.add(r,t);return i&&this.dispatcher.trigger(r,t),o};var Se={type:"Fieldset",group:"defaultChild"};function Ye(e,t={}){let r=e._storeOfSchema||(e._storeOfSchema={});return t===void 0?e._storeOfSchema:(Object.assign(r,W.collect(t,["parseExpression","parseReference"])),r)}var ke="when",Ae="then",Ie="else",Ee="and",ne="or",oe="not",Me="_";function Oe(e){return h.object(e)?!1:ke in e&&Ae in e}function Le(e){return h.object(e)?!1:Ie in e}function se(e){return Oe(e)||Le(e)}function lt(e){return h.array(e)||!e.length?!1:!e.some(t=>!se(t))}var $e=class{static isConditionObject(t){return se(t)}static isConditionArray(t){return lt(t)}static isCondition(t){return se(t)||lt(t)}static isntCondition(t){return!$e.isCondition(t)}static mustbeCondition(t,r=""){$e.isCondition(t)||g({type:$e.exceptions.INVALID_CONDITION,message:r||"Invalid condition statement."})}},z=$e;S(z,"exceptions",{INVALID_CONDITION:"CONDITION_INVALID_CONDITION"});z.combine=function(e={}){let t=[],r=f.array(e.whens)?e.whens:[],i=f.object(e.else)?e.else:{};return r.forEach(o=>{h.object(o)&&(o={}),t.push({[ke]:Ui(o.rules),[Ae]:o.result})}),t.push({[Ie]:i.result}),t};function Ui(e=[]){h.array(e)&&(e=[e]);let t=[Ee,oe].join(Me),r=[ne,oe].join(Me),i=[Ee,ne,oe,t,r];return e.map(o=>{h.object(o)&&(o={});let l=i.includes(o.logic)?o.logic:"";if(!l)return o.expression;if([Ee,ne].includes(l))return{[l]:o.expression};let a=l.split(Me);return{[a[0]]:{[a[1]]:o.expression}}})}z.extract=function(e){let[t,r]=[[],{result:void 0}];return z.isntCondition(e)?{whens:t,else:r}:(se(e)&&(e=[e]),e.forEach(i=>{Oe(i)?t.push({result:i[Ae],rules:Mi(i[ke])}):Le(i)&&(r={result:i[Ie]})}),{whens:t,else:r})};function Mi(e=[]){return h.array(e)&&(e=[e]),e.map(t=>{if(h.object(t))return{logic:"",expression:t};let r=Ee in t?Ee:ne in t?ne:"";if(!r)return{logic:"",expression:t};let i=t[r];return f.object(i)&&oe in i&&(r=[r,oe].join(Me),i=i[oe]),{logic:r,expression:i}})}function Tt(e={},t){let[r,i,o]=[null,e[ke],-1];for(h.array(i)&&(i=[i]);++o<i.length;){let[l,a]=[i[o],[]];f.object(l)&&Ee in l?(l=l[Ee],a.push(Ee)):f.object(l)&&ne in l&&(l=l[ne],a.push(ne)),f.object(l)&&oe in l&&(l=l[oe],a.push(oe));let n=t(l);h.boolean(n)&&(n=null),a.includes(oe)&&(n=!n),o===0?r=n:a.includes(ne)?r=r||n:r=r&&n}return{truthy:r,result:e[Ae]}}function St(e={}){return{result:e[Ie]}}function ji(e){if(f.boolean(e))return e}z.parse=function(e,t){z.mustbeCondition(e),t===void 0&&(t=ji),y.function(t,'Condition "parseExpression"'),se(e)&&(e=[e]);let r;return e.some(i=>{if(Oe(i)){let{truthy:o,result:l}=Tt(i,t);if(o===!0)return r=l,!0}else if(Le(i)){let{result:o}=St(i);return r=o,!0}return!1}),r};z.possibilities=function(e){z.mustbeCondition(e),se(e)&&(e=[e]);let t=!1,r=e.map(i=>{if(Oe(i))return i[Ae];if(Le(i))return t=!0,i[Ie]});return r=le.unique(r),t||!r.includes(void 0)&&r.push(void 0),r};var pe=z;var qe=/<<\s*([^(<<)(>>)\s]+)\s*>>/,pr=new RegExp(qe,"g");function Ge(e="",t={}){let{raw:r,flag:i,strict:o}=t;if(r)return`<< ${e} >>`;let l=`<<\\s*${e}\\s*>>`;return o&&(l=`^${l}$`),new RegExp(l,i)}function Ot(e){return h.string(e)?!1:!!e.match(qe)}var ze=class{static isInterpolation(t){return Ot(t)}static isntInterpolation(t){return!ze.isInterpolation(t)}static mustbeInterpolation(t,r=""){ze.isInterpolation(t)||g({type:ze.exceptions.INVALID_INTERPOLATION,message:r||"Invalid interpolation statement."})}},J=ze;S(J,"exceptions",{INVALID_INTERPOLATION:"INVALID_INTERPOLATION"});function We(e=""){return e.match(pr)}function Lt(e=""){let t=e.match(qe);return t?t[1]:null}J.references=function(e="",t={}){if(J.isntInterpolation(e))return null;let i=(We(e)||[]).map(o=>Lt(o));return t.unique!==!1&&(i=le.unique(i)),i.length?i:null};J.parse=function(e="",t={}){J.mustbeInterpolation(e);let r=We(e),i=J.references(e,{unique:!1}),o=l=>f.function(t)?t(l):t[l];if(r.length===1){let l=Ge(i[0],{strict:!0});if(e.match(l))return e=o(i[0])}return i.forEach((l,a)=>{e=e.replace(r[a],o(l))}),e};J.replace=function(e="",t={}){return J.mustbeInterpolation(e),Object.keys(t).forEach(r=>{let i=Ge(t[r],{raw:!0});r=Ge(r,{flag:"g"}),e=e.replace(r,i)}),e};var ge=J;var Rt=class{constructor(t={}){Ye(this,t)}static create(...t){return new Rt(...t)}},te=Rt;S(te,"Condition",pe),S(te,"Interpolation",ge);function kt(e,t){return f.array(e)?e=e.map(r=>kt(r,t)):f.object(e)?e=W.from(Object.keys(e).map(r=>[r,kt(e[r],t)])):ge.isInterpolation(e)&&(e=ge.parse(e,t)),e}function Ct(e,t,r){if(f.array(e)){let i=pe.isConditionArray(e);e=e.map(o=>Ct(o,t,i))}else f.object(e)&&(e=W.from(Object.keys(e).map(i=>[i,Ct(e[i],t)])));return pe.isConditionArray(e)?e=pe.parse(e,t):pe.isConditionObject(e)&&!r&&(e=pe.parse(e,t)),e}te.prototype.parse=function(e){let{parseReference:t,parseExpression:r}=Ye(this);return e=kt(e,t),e=Ct(e,r),e};te.prototype.possibilities=function(e){let t=null;return pe.isCondition(e)?(t=[],pe.possibilities(e).forEach(r=>{if(!pe.isCondition(r))return t.push(r);t=t.concat(this.possibilities(r))})):f.object(e)?Object.keys(e).forEach(r=>{let i=this.possibilities(e[r]);!i||(t=t?t.concat(i):i)}):f.array(e)&&e.forEach(r=>{let i=this.possibilities(r);!i||(t=t?t.concat(i):i)}),t&&le.unique(t)};te.prototype.references=function(e,t={}){let r=[];if(f.array(e))e.forEach(i=>{let o=this.references(i,t);o&&(r=r.concat(o))});else if(f.object(e))Object.keys(e).forEach(i=>{let o=this.references(e[i],t);o&&(r=r.concat(o))});else if(ge.isInterpolation(e)){let i=ge.references(e,t);i&&(r=r.concat(i))}return t.unique!==!1&&(r=le.unique(r)),r.length?r:null};te.prototype.replace=function(e,t={}){return f.array(e)?e=e.map(r=>this.replace(r,t)):f.object(e)?e=W.from(Object.keys(e).map(r=>[r,this.replace(e[r],t)])):ge.isInterpolation(e)&&(e=ge.replace(e,t)),e};var at=te;function $(e={},t={}){return e._reactive||(e._reactive=u({},t))}var Bi={prop:()=>V(),default:null,schemable:!0,calculable:!0,validation:null,rawValidation:null},ur=Bi;function xe(e={},t={}){return e._i18n||(e._i18n=u({},t))}var we=class{constructor(){xe(this,{locales:{},locale:"en"})}static create(...t){return new we(...t)}static isI18n(t){return t instanceof we}static isntI18n(t){return!we.isI18n(t)}static mustbeI18n(t,r){we.isntI18n(t)&&g({type:we.exceptions.NOT_AN_INSTANCE,message:r||"Invalid i18n instance."})}},j=we;S(j,"exceptions",{NOT_AN_INSTANCE:"I18N_NOT_AN_INSTANCE_OF_I18N",UNSUPPORTED_LOCALE:"I18N_UNSUPPORTED_LOCALE"});var cr=".";function nt(e=""){return e.split(cr).map(t=>t.trim()).filter(t=>t.length)}function fr(e=[]){return e.map(t=>t.trim()).filter(t=>t.length).join(cr)}j.prototype.define=function(e="",t=""){let r=xe(this).locales;if(!arguments.length)return JSON.parse(JSON.stringify(r));if(h.object(e))return mr(r,e,t);Object.keys(e).forEach(i=>{if(h.object(e[i]))return mr(r,i,e[i]);let o=Object.keys(e[i]).map(l=>[fr([i,l]),e[i][l]]);this.define(W.from(o))})};function mr(e={},t="",r=""){y.nonblankString(t,"I18n locale path"),y.string(r,"I18n locale template");let[i,o]=["",nt(t)];for(;i=o.shift();){if(!(i in e))e[i]=o.length?{}:r;else{let l=e[i];o.length?f.string(l)&&(e[i]={_:l}):f.string(l)?e[i]=r:e[i]._=r}e=e[i]}}j.prototype.locale=function(e){if(!e)return xe(this).locale;xe(this).locale=e};function dr(e="",t="",r=""){let i=new RegExp(`{\\s*${t}\\s*}`,"g");if(f.string(r))return e.replace(i,r);try{r=JSON.stringify(r)}catch(o){r=String(r)}return e.replace(i,r)}j.prototype.translate=function(e="",t={}){let r="default"in t?t.default:"",i="variables"in t?t.variables:null;y.string(r,"Default i18n template"),i&&y.object(i,"I18n variables");let[o,l]=[nt(e),xe(this).locales],a=Hi(l,[xe(this).locale].concat(o));return f.null(a)&&(a=r),!a||!i?a:Ki(a,i)};j.prototype.t=j.prototype.translate;function Hi(e={},t=""){let r="";return t.every((o,l)=>o in e?(e=e[o],l!==t.length-1||(r=f.string(e)?e:e._),!0):!1)?r:null}function Ki(e="",t={}){return Object.keys(t).forEach(r=>{e=dr(e,r,t[r])}),e}j.prototype.try=function(e=[],t={}){let r="";return e.some(i=>{if(r=this.translate(i,t),r)return!0}),r};var Q=j.global=j.create();var hr={memberIsReferenced:"Referenced members cannot be deleted.",conflictedMemberName:"Member name { name } has been occupied.",memberNameRequired:"Member name cannot be blank.",mustBelongsToValidParent:"{ memberType } members can only be inserted into { acceptedParentTypes } parents.",referenceNotFound:"Cannot find reference { reference } among members.",conditionNotComplete:"Condition must contain at lease one case.",conditionBranchNotComplete:"Condition branch must contain at least one rule.",conditionReferenceNotPresence:"Condition reference cannot be blank.",conditionLogicNotSupported:"Lack of valid and/or keyword.",conditionValidationNotSupported:"Unsupported validation { label }.",conditionValidationRuleNotSupported:"Validation rule { rule } is not supported by { label }."};var br={memberIsReferenced:"\u65E0\u6CD5\u5220\u9664\u88AB\u5F15\u7528\u7684\u6210\u5458\u3002",conflictedMemberName:"\u6210\u5458\u540D\u79F0{ name }\u5DF2\u88AB\u5360\u7528\u3002",memberNameRequired:"\u6210\u5458\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\u3002",mustBelongsToValidParent:"{ memberType }\u7C7B\u578B\u6210\u5458\u53EA\u80FD\u4F5C\u4E3A{ acceptedParentTypes }\u7C7B\u578B\u5B50\u7EA7\u3002",referenceNotFound:"\u6210\u5458\u4E2D\u4E0D\u5B58\u5728\u5F15\u7528\u8DEF\u5F84{ reference }",conditionNotComplete:"\u6761\u4EF6\u5206\u652F\u81F3\u5C11\u8981\u5305\u542B\u4E00\u79CD\u60C5\u51B5\u3002",conditionBranchNotComplete:"\u6761\u4EF6\u5206\u652F\u5185\u81F3\u5C11\u8981\u5305\u542B\u4E00\u4E2A\u89C4\u5219\u3002",conditionReferenceNotPresence:"\u6761\u4EF6\u4F9D\u8D56\u4E0D\u80FD\u4E3A\u7A7A\u3002",conditionLogicNotSupported:"\u7F3A\u5C11\u5408\u6CD5\u7684\u4E0E\u6216\u5173\u952E\u5B57\u3002",conditionValidationNotSupported:"\u4E0D\u88AB\u652F\u6301\u7684\u6821\u9A8C{ label }\u3002",conditionValidationRuleNotSupported:"\u4E0D\u88AB{ label }\u652F\u6301\u7684\u6821\u9A8C\u89C4\u5219{ rule }\u3002"};Q.define({en:{reactive:hr},zh:{reactive:br}});var B=Q;var yr=".",ue=["children","order","type","name"],Xe="__REACTIVE_SCEHMA_REFERENCE__";function Er(e=""){let t=e.split(yr),r=t.pop();return{names:t,prop:r}}function Ze(e=[],t=""){return(t?e.concat(t):e).join(yr)}function gr(e,t,r){let[i,o]=[e.schema.references(t),{}];return i?(i.forEach(l=>{let a=e.schema.reference.parse(l,{relier:r}),n=f.object(a);if(n&&(n=f.nonblankString(a.id)),n&&(n=f.nonblankString(a.prop)),n)return o[l]=JSON.stringify(a);g({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:B.t("reactive.referenceNotFound",{variables:{reference:l}})})}),e.schema.replace(t,o)):t}function xr(e,t,r){let[i,o]=[e.schema.references(t),{}];return i?(i.forEach(l=>{let a=null;try{a=JSON.parse(l)}catch(p){return}let n=e.schema.reference.stringify(a,{relier:r});if(f.nonblankString(n))return o[l]=n;g({type:e.exceptions.REFERENCED_PROVIDER_NOT_FOUND,message:B.t("reactive.referenceNotFound",{variables:{reference:l}})})}),e.schema.replace(t,o)):t}function Ar(e={},t={}){return u(u(u({},ur),t),e)}function Ir(e={}){return Object.keys(e).forEach(t=>{h.function(e[t])||(e[t]=e[t]())}),e}function Ft(e={},t={}){let{id:r,prop:i}=e,o=this.get({id:r,prop:"type"}),{props:l,fallback:a}=$(this).installed[o].config.schema;if(!i){let p=[],d="only"in t?t.only:[],c="except"in t?t.except:[];return h.array(d)&&(d=[d]),h.array(c)&&(c=[c]),l.forEach(b=>{if(d.length&&!d.includes(b.prop)||c.length&&c.includes(b.prop))return;let I=Ir(Ar(b,a));ue.includes(I.prop)&&(I.schemable=I.calculable=!1),p.push(I)}),p}let n=l.find(p=>p.prop===i),s=Ir(Ar(n||a,a));return s.prop=i,ue.includes(i)&&(s.schemable=s.calculable=!1),s}function Dt(e="",t={}){var p,d;e=(this.schema.references(e)||[])[0]||e;let r=e,{names:i,prop:o}=Er(e),l=t.under||this.family.root(),a=t.relier||null,[n,s]=[null,l.id];if(!i.length||this.family.hasnt({id:s}))return null;for(;n=i.shift();){if(s=(d=(p=this.family.descendant({id:s}))==null?void 0:p.find(x=>this.get({id:x.id,prop:"name"})===n))==null?void 0:d.id,!s)return null;let c=this.get({id:s,prop:"type"}),I=$(this).installed[c].config.schema.reference.parse;if(I)return e=Ze(i,o),I.call(this,{id:s,downPath:e,target:r},a?{id:a.id||"",prop:a.prop||""}:null)}return{id:s,prop:o}}function Pt(e={},t={}){let{id:r,prop:i}=e,o={id:r,prop:i},l=t.under||this.family.root(),a=t.relier||null,n=(()=>t.format!=="interpolation"?b=>b:b=>b&&`<< ${b} >>`)();if(this.family.hasnt({id:r}))return"";let s=this.family.ancestor({id:r},{deep:!0,self:!0}),[p,d]=[s.findIndex(b=>b.id===l.id),[]];if(p<0||(s=s.slice(0,p),!s.length))return"";let c=null;for(;c=s.pop();){d.push(this.get({id:c.id,prop:"name"}));let b=this.get({id:c.id,prop:"type"}),x=$(this).installed[b].config.schema.reference.stringify;if(x){let N=Ze(d),R=x.call(this,{id:c.id,upPath:N,downPath:i,target:o},a?{id:a.id||"",prop:a.prop||""}:null);return n(R)}}return n(Ze(d,i))}function Vt(e){let t=at.create({parseReference(r){return e.get(JSON.parse(r))},parseExpression(r={}){return e.validator.mustbeSupported(r),!e.validator.error(r)}});return t.for=Ft.bind(e),t.reference={parse:Dt.bind(e),stringify:Pt.bind(e)},t}var vr={validators:{dataType:{label:"Data Type",invalidValue:"Must be a data type within { rule }."},equalTo:{label:"Equal To",invalidRule:'Rule of "Equal To" validator Cannot be blank.',invalidValue:"Must be equal to { rule }."},isInteger:{label:"Is Integer",invalidValue:"{ value } is not an integer."},maxLength:{label:"Max Length",invalidRule:'Rule of "Max Length" validator must be a positive integer.',invalidValue:"Maximum length is { rule }."},presence:{label:"Presence",invalidValue:"Musn't be blank."},withFormat:{label:"With Format",invalidRule:'Rule of "With Format" validator must be a regexp or a string wrapped with "/".',invalidValue:"Must match format { rule }."}}};var _r={validators:{dataType:{label:"\u6570\u636E\u7C7B\u578B",invalidValue:"\u6570\u636E\u7C7B\u578B\u5FC5\u987B\u662F{ rule }\u3002"},equalTo:{label:"\u7B49\u4E8E",invalidRule:"\u7B49\u4E8E\u7684\u6821\u9A8C\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A\u3002",invalidValue:"\u5FC5\u987B\u7B49\u4E8E{ rule }\u3002"},isInteger:{label:"\u662F\u6574\u6570",invalidValue:"{ value }\u4E0D\u662F\u4E00\u4E2A\u6574\u6570\u3002"},maxLength:{label:"\u6700\u5927\u957F\u5EA6",invalidRule:"\u6700\u5927\u957F\u5EA6\u7684\u6821\u9A8C\u89C4\u5219\u5FC5\u987B\u662F\u4E00\u4E2A\u6B63\u6574\u6570\u3002",invalidValue:"\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7{ rule }\u3002"},presence:{label:"\u4E0D\u4E3A\u7A7A",invalidValue:"\u4E0D\u80FD\u4E3A\u7A7A\u3002"},withFormat:{label:"\u7B26\u5408\u683C\u5F0F",invalidRule:"\u683C\u5F0F\u6821\u9A8C\u7684\u89C4\u5219\u5FC5\u987B\u662F\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\u6216\u88AB\u201C/\u201D\u5305\u62EC\u7684\u5B57\u7B26\u4E32\u3002",invalidValue:"\u5FC5\u987B\u7B26\u5408\u683C\u5F0F{ rule }\u3002"}}};Q.define({en:{validator:vr},zh:{validator:_r}});var ee=Q;var Nr={name:"dataType",ruleType:["String","Array"],valueType:"*",validate(e,t){if(!O.within({type:O.get(e),types:t}))return ee.t("validator.validators.dataType.invalidValue",{variables:{value:e,rule:t}})}};function Tr(e,t){if(e===t)return!0;if(typeof e!="object"||typeof t!="object"||e==null||t==null)return!1;let[r,i]=[Object.keys(e),Object.keys(t)];if(r.length!==i.length)return!1;for(let o of r)if(!i.includes(o)||!Tr(e[o],t[o]))return!1;return!0}var Sr={name:"equalTo",ruleType:"*",valueType:"*",validateRule(e){if(f.blank(e))return ee.t("validator.validators.equalTo.invalidRule")},validate(e,t){if(!Tr(e,t))return ee.t("validator.validators.equalTo.invalidValue",{variables:{value:e,rule:t}})}};var Or={name:"isInteger",valueType:"Number",validate(e){if(!f.integer(e))return ee.t("validator.validators.isInteger.invalidValue",{variables:{value:e}})}};var Lr={name:"maxLength",ruleType:"Number",valueType:["String","Array"],validateRule(e){if(!f.positiveInteger(e))return ee.t("validator.validators.maxLength.invalidRule")},validate(e,t){if(e.length>t)return ee.t("validator.validators.maxLength.invalidValue",{variables:{value:e,rule:t}})}};var Rr={priority:1,name:"presence",valueType:"*",validate(e){if(f.blank(e))return ee.t("validator.validators.presence.invalidValue",{variables:{value:e}})}};var kr=/^\/(.+)\/$/,Cr={name:"withFormat",ruleType:["RegExp","String"],valueType:"String",validateRule(e){if(!f.regexp(e)&&!(f.string(e)&&e.match(kr)))return ee.t("validator.validators.withFormat.invalidRule",{variables:{rule:e}})},validate(e,t){if(f.string(t)&&(t=new RegExp(t.match(kr)[1])),!e.match(t))return ee.t("validator.validators.withFormat.invalidValue",{variables:{value:e,rule:String(t)}})}};var Fr=[Rr,Nr,Or,Cr,Sr,Lr];function H(e={},t={}){return e._validator||(e._validator=u({},t))}var wt=class{constructor(){H(this,{installed:{}}),Fr.forEach(t=>this.install(t))}static create(...t){return new wt(...t)}},A=wt;S(A,"exceptions",{CONFLICTED_NAME:"VALIDATOR_CONFLICTED_NAME",VALIDATION_FAILED:"VALIDATOR_VALIDATION_FAILED",UNSUPPORTED_VALIDATION:"VALIDATOR_UNSUPPORTED_VALIDATION",UNSUPPORTED_VALIDATION_RULE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE",UNSUPPORTED_VALIDATION_RULE_TYPE:"VALIDATOR_UNSUPPORTED_VALIDATION_RULE_TYPE"});var Yi="valOf";function st(e={}){let t={};return"value"in e&&(t[Yi]=e.value),e.name&&(t[e.name]=void 0,"rule"in e&&(t[e.name]=e.rule)),t}A.prototype.combineValidation=function(e={}){let{installed:t}=H(this);return e.name in t?st(v(u({},e),{rule:t[e.name].ruleType?e.rule:!0})):st(e)};var Dr="valOf";function ve(e={}){let t=e[Dr];e=W.exclude(e,[Dr]);let r=Object.keys(e)[0],i=e[r];return{name:r,rule:i,value:t}}A.prototype.mustbeSupported=function(e={},t={}){y.object(e,"Validation struct");let r="strict"in t?t.strict:!0,{name:i,rule:o}=ve(e),{installed:l}=H(this),a=l[i];if(!a&&g({type:A.exceptions.UNSUPPORTED_VALIDATION,message:`Unsupported validator "${i}"`}),!(!r||!a.ruleType)){try{O.mustWithin({type:O.get(o),types:a.ruleType})}catch(n){g({type:A.exceptions.UNSUPPORTED_VALIDATION_RULE_TYPE,message:n.message||"Unsupported validation rule data type."})}if(!!a.validateRule)try{let n=a.validateRule(o);if(n)throw new Error(n)}catch(n){g({type:A.exceptions.UNSUPPORTED_VALIDATION_RULE,message:n.message||"Unsupported validation rule."})}}};A.prototype.error=function(e={},t){let r=null;try{this.mustbeSupported(e)}catch(i){r=i}if(!r){let{installed:i}=H(this),{name:o,rule:l,value:a}=ve(e);arguments.length>1&&(a=t);let n=i[o],[s,p]=[O.get(a),n.valueType];try{O.mustWithin({type:s,types:p})}catch(d){r=d}r||(r=n.validate(a,l))}return r?D.create({type:A.exceptions.VALIDATION_FAILED,message:(()=>{let i="Not valid.";return f.string(r)?r:r instanceof Error&&r.message||i})()}):null};A.prototype.extractValidation=function(e={}){let{installed:t}=H(this),r=ve(e);return r.name in t&&(t[r.name].ruleType||(r.rule=!0)),r};A.prototype.for=function(e="*",t={}){let[r,i]=[[],H(this).installed],o="except"in t?t.except:[];return h.array(o)&&(o=[o]),Object.values(i).forEach(l=>{o.includes(l.name)||!O.within({type:e,types:l.valueType})||r.push(u({},l))}),r.length?r:null};A.prototype.get=function(e=""){let t=H(this).installed;return e in t?u({},t[e]):null};A.prototype.install=function(e={}){y.object(e,"Validator installer");let{name:t,valueType:r,ruleType:i,validate:o,validateRule:l}=e,a="priority"in e?e.priority:0;y.number(a,'Validation installer "priority"'),y.nonblankString(t,'Validator installer "name"'),y.type(r,'Validator installer "valueType"'),y.function(o,'Validator installer "validate"'),i&&y.type(i,'Validator installer "ruleType"'),l&&y.function(l,'Validator "validateRule"');let{installed:n}=H(this);t in n&&g({type:A.exceptions.CONFLICTED_NAME,message:`Validator name ${t} has been occupied.`}),n[t]=v(u({},e),{priority:a,name:t,valueType:r,ruleType:i,validate:o,validateRule:l})};A.prototype.isSupported=function(...e){try{this.mustbeSupported(...e)}catch(t){return!1}return!0};A.prototype.isValid=function(...e){return!this.error(...e)};A.prototype.isntSupported=function(...e){return!this.isSupported(...e)};A.prototype.isntValid=function(...e){return!this.isValid(...e)};A.prototype.sort=function(e=[]){return h.array(e)&&(e=[e]),e.slice().sort((t,r)=>{let[i,o]=[0,0];return this.isSupported(t)&&(i=this.get(ve(t).name).priority),this.isSupported(r)&&(o=this.get(ve(r).name).priority),o-i})};A.prototype.uninstall=function(e=""){let{installed:t}=H(this);e in t&&delete t[e]};function Ut(e){return A.create()}function Mt(e){return P.create()}function Je(e,t){!(t in $(e).installed)&&g({type:e.exceptions.UNINSTALLED_MEMBER_TYPE,message:`Member type ${t} is not installed.`})}function $i(e,t={},r){let{hook:i,handler:o}=t;return h.array(i)&&(i=[i]),h.array(o)&&(o=[o]),o=o.map(l=>l.bind(e)),r?(o=o.map(l=>(a,...n)=>{let s=e.get({id:a.id,prop:"type"});if(s||(s=(a.props||{}).type||"default"),Je(e,s),s===r)return l(a,...n)}),{hook:i,handler:o}):{hook:i,handler:o}}function jt(e,t={}){if(!e)return;let r=t.only;h.array(e)&&(e=[e]),e.forEach(i=>{let{hook:o,handler:l}=$i(this,i,r);o.forEach(a=>l.forEach(n=>this.hooks.add(a,n)))})}function Bt(e){return e.hooks.mount=jt.bind(e),e.hooks}function Ht(e){let t=e.get;return e.get=function(r={},i={}){let{id:o,prop:l}=r,a=t.call(e,r,i);if(!a||!a.raw)return a;if("prop"in r){let n=a.raw.value;a.raw.value=Pr(e,o,l,n)}else Object.keys(a.raw.values).forEach(n=>{let s=a.raw.values[n];a.raw.values[n]=Pr(e,o,n,s)});return a}}function Pr(e,t,r,i){return ue.includes(r)||!e.schema.for({id:t,prop:r}).schemable?i:xr(e,i,{id:t,prop:r})}function Vr(e={}){let{installed:t}=$(this),r=e.type,i=f.function(e.collect)?e.collect:null,o=f.function(e.seed)?e.seed:null,l="hooks"in e?e.hooks:[],a="schema"in e?e.schema:{},n="props"in a?a.props:[],s="fallback"in a?a.fallback:{},p="reference"in a?a.reference:{},d="parse"in p?p.parse:null,c="stringify"in p?p.stringify:null;y.nonblankString(r,'Reactive Member "type"'),o&&y.function(o,'Reactive Member "seed"'),i&&y.function(i,'Reactive Member "collect"'),d&&y.function(d,'Reactive Member "schema.reference.parse"'),c&&y.function(c,'Member "schema.reference.stringify"'),y.array(n,'Reactive Member "schema.props"'),y.object(s,'Reactive Member "schema.fallback"'),y.array(l,'Reactive Member "hooks"'),n.forEach(b=>y.object(b,"Reactive Member prop schema")),l=l.flat(1/0),l.forEach(b=>{let{hook:I,handler:x,scope:N}=b;N&&y.nonblankString(N,'Reactive Member hook "scope"'),I=f.array(I)?I:[I],x=f.array(x)?x:[x],I.forEach(R=>y.nonblankString(R,'Reactive Member hook "type"')),x.forEach(R=>y.function(R,'Reactive Member hook "handler"'))}),r in t&&g({type:this.exceptions.CONFLICTED_MEMBER_TYPE,message:`Reactive Member type '${r}' has been occupied.`}),t[r]={config:{type:r,hooks:l,collect:i,seed:o,schema:{fallback:s,props:n,reference:{parse:d,stringify:c}}}},l.forEach(b=>{if(!b.scope)return this.hooks.mount(b,{only:r});let I=f.array(b.hook)?b.hook:[b.hook];(f.array(b.handler)?b.handler:[b.handler]).forEach(N=>I.forEach(R=>{Object.keys(t).some(G=>G!==r&&t[G].config.hooks.some(U=>{let Re=f.array(U.hook)?U.hook:[U.hook],Jt=f.array(U.handler)?U.handler:[U.handler];return U.scope===b.scope&&Jt.includes(N)&&Re.includes(R)}))||this.hooks.mount(v(u({},b),{hook:R,handler:N}),{only:b.scope})}))})}function Kt(e={},t={}){let{id:r}=e;if(this.family.hasnt({id:r}))return null;let i="errors"in t?t.errors:!0,[o,l]=[t.only||[],t.except||[]];h.array(o)&&(o=[o]),h.array(l)&&(l=[l]);let{values:a,raw:n}=wr(this,r);if(a=Yt(this,a,o,l),n.values=Yt(this,n.values,o,l),!i)return{values:a,raw:n};let[s,p]=qi(this,r);return{values:a,errors:s,raw:v(u({},n),{errors:p})}}function wr(e,t){let r=e.get({id:t,prop:"type"}),i=$(e).installed[r].config.collect;if(i){let n=i.call(e,{id:t});return n||(n={}),n.values||(n.values={}),n.raw||(n.raw={}),n.raw.values||(n.raw.values={}),n}let{values:o,raw:l}=e.get({id:t},{include:"raw"});o.children=[],l.values.children=[];let a=e.family.descendant({id:t});return a?(a.forEach(n=>{let s=wr(e,n.id);o.children.push(s.values),l.values.children.push(s.raw.values)}),{values:o,raw:l}):{values:o,raw:l}}function Yt(e,t={},r=[],i=[]){return Object.keys(t).forEach(o=>{r.length&&!r.includes(o)&&delete t[o],i.length&&i.includes(o)&&delete t[o]}),t.children&&t.children.forEach((o,l)=>{t.children[l]=Yt(e,o,r,i)}),t}function qi(e,t){let[r,i]=[[],[]];return e.family.descendant({id:t},{deep:!0,self:!0}).forEach(({id:l})=>{let a=e.get({id:l},{include:["raw","error"]});a.errors&&r.push({id:l,errors:a.errors}),a.raw.errors&&i.push({id:l,errors:a.raw.errors})}),[r.length?r:null,i.length?i:null]}function $t(e={},t={},r={}){let i="execute"in r?r.execute:!0;if(i&&this.family.hasnt({id:e.id}))return;let[o,l,a]=[null,[{id:e.id,props:t}],[]];for(;o=l.shift();){let[n,s]=[o.id,o.props],p=this.family.has({id:n}),d=(()=>p?this.get({id:n,prop:"type"}):s.type||"default")(),c=$(this).installed[d].config.seed;if(c){let b=c.call(this,{id:n},s);b&&(a=a.concat(b))}else Object.keys(s).forEach(b=>{if(b!=="children"){let N={action:"set",id:n,prop:b,value:s[b]};return a.push(N)}let[I,x]=[n,this.family.descendant({id:n})||[]];s.children.forEach((N,R)=>{if(x[R])return l.push({id:x[R].id,props:N});let[L,G,U]=[V(),N.name,N.type||"default"],Re={action:"add",parentId:I,id:L,props:{type:U,name:G}};a.push(Re),l.push({id:L,props:v(u({},N),{type:U})})})})}return i?this.executor.run(a):a}var Gi=[{hook:"before-add",handler(e){let t=(e.props||{}).type||"default";Je(this,t)}}],Ur=Gi;var zi=[{hook:"before-del",handler(e){let{id:t}=e,{family:r,dependency:i}=this,o=r.descendant({id:t},{self:!0,deep:!0}),l={self:!1,deep:!1,group:Xe};i.reliers(o,l)&&g({type:this.exceptions.CONSTRAINTS_EXIST,message:B.t("reactive.memberIsReferenced",{variables:{id:t}})})}}],Mr=zi;var Wi=[{hook:"after-add",handler(e){let[t,r]=[e.id,(e.props||{}).type||"default"],[i,o]=[this.members,this.naming("type")];i[t][o.raw.prop]=i[t][o.prop]=r,i[t][o.raw.error]=i[t][o.error]=null}},{hook:"before-del",handler(e){let t=this.get({id:e.id,prop:"type"});e.props||(e.props={}),e.props.type=t}}],jr=Wi;var Xi=[{hook:"before-add",handler(e){let{id:t,props:r}=e;r||(e.props={}),e.props.name||(e.props.name=t)}},{hook:"after-add",handler(e){let{id:t,props:r}=e,[i,o]=[this.members,this.naming("name")];i[t][o.raw.prop]=i[t][o.prop]=r.name,i[t][o.raw.error]=i[t][o.error]=null}},{hook:"after-set",handler(e){let{id:t,prop:r,value:i}=e;if(r!=="name")return;let[o,l]=[this.members,this.naming("name")];o[t][l.raw.prop]=o[t][l.prop]=i,o[t][l.raw.error]=o[t][l.error]=null}}],Br=Xi;var Zi=[{hook:["before-set","before-calc"],handler(e){if(e.prop==="type")return!1}}],Hr=Zi;function Kr(e,t,r){let i=e.family.sibling({id:t});!i||i.find(({id:o})=>e.get({id:o,prop:"name"})===r)&&g({type:e.exceptions.CONFLICTED_MEMBER_NAME,message:B.t("reactive.conflictedMemberName",{variables:{name:r}})})}var Ji=[{hook:"after-add",handler(e){let{id:t}=e,r=this.get({id:t,prop:"name"});dt.blank(r,{message:B.t("reactive.memberNameRequired")}),Kr(this,t,r)}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(r!=="name")return;let i=this.get({id:t,prop:r},{include:["error","raw"]});if(i.raw.error){let o=`Skipping validating name of member ${t},`;return o+=" since prev errors exist.",console.warn(o,i.raw.error)}try{dt.blank(i.raw.value,{message:B.t("reactive.memberNameRequired")}),Kr(this,t,i.raw.value)}catch(o){this.members[t][this.naming(r).raw.error]=[o]}}}],Yr=Ji;function qt(e,t){try{return e.validator.mustbeSupported(t,{strict:!0}),null}catch(r){let o=e.validator.constructor.exceptions,l=o.UNSUPPORTED_VALIDATION,a=o.UNSUPPORTED_VALIDATION_RULE_TYPE,n=o.UNSUPPORTED_VALIDATION_RULE,{name:s,rule:p}=e.validator.extractValidation(t),d=B.t(`validator.validators.${s}.label`)||s;if([n,a].includes(r.type)){let c="reactive.conditionValidationRuleNotSupported",b=B.t(c,{variables:{label:d,rule:p}}),I=r.type===a;r.message=I?b:r.message||b}else if(r.type===l){let c="reactive.conditionValidationNotSupported";r.message=B.t(c,{variables:{label:d}})}return r}}var $r=[{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(ue.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let o=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(o.raw.error){let p=`Skipping validating ${r} schema of member ${t},`;return p+=" since previous errors exist.",console.warn(p,o.raw.error)}let l=this.schema.constructor.Condition;if(!l.isCondition(o.raw.value))return;let a=l.extract(o.raw.value),[n,s]=[this.members,this.naming(r)];if(!a.whens.length){n[t][s.raw.error]=[D.create({data:{dueto:"whens"},type:l.exceptions.INVALID_CONDITION,message:B.t("reactive.conditionNotComplete")})];return}a.whens.some((p,d)=>!p.rules||!p.rules.length?(n[t][s.raw.error]=[D.create({data:{branchIndex:d,dueto:"rules"},type:l.exceptions.INVALID_CONDITION,message:B.t("reactive.conditionBranchNotComplete")})],!0):p.rules.some((c,b)=>{let{logic:I,expression:x}=c;if(b!==0&&!["and","or"].includes(I)){let R="reactive.conditionLogicNotSupported";return n[t][s.raw.error]=[D.create({data:{branchIndex:d,ruleIndex:b,dueto:"logic"},type:l.exceptions.INVALID_CONDITION,message:B.t(R,{variables:{logic:I}})})],!0}if(h.object(x)||f.blank(x.valOf)){let R="reactive.conditionReferenceNotPresence";return n[t][s.raw.error]=[D.create({data:{branchIndex:d,ruleIndex:b,dueto:"provider"},type:l.exceptions.INVALID_CONDITION,message:B.t(R)})],!0}let N=qt(this,x);return N?(n[t][s.raw.error]=[D.create({data:{branchIndex:d,ruleIndex:b,dueto:"validation"},type:l.exceptions.INVALID_CONDITION,message:N.message})],!0):!1}))}},{hook:"after-set",handler(e){let{id:t,prop:r}=e;if(ue.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let o=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(o.raw.error){let n=`Skipping translating ${r} schema of member ${t},`;return n+=" since previous errors exist.",console.warn(n,o.raw.error)}let[l,a]=[this.members,this.naming(r)];try{l[t][a.raw.prop]=gr(this,o.raw.value,{id:t,prop:r})}catch(n){l[t][a.raw.error]=[n]}}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,{schema:i,dependency:o,family:l,members:a}=this;if(ue.includes(r)||!i.for({id:t,prop:r}).schemable)return;o.delete({id:t,prop:r},{only:"relier",group:Xe});let s=this.constructor.prototype.get.call(this,{id:t,prop:r},{include:["raw","error"]});if(s.raw.error){let c="Skipping adding new associations for";return c+=` member ${t}'s ${r} since previous errors exist.`,console.warn(c,s.raw.error)}let p=i.references(s.raw.value);if(!p)return;let d=p.map(c=>({relier:{id:t,prop:r},provider:JSON.parse(c)}));d.forEach(c=>{let{provider:b,relier:I}=c,x={self:!0,deep:!0},N=l.ancestor({id:b.id},x);N.forEach((R,L)=>{L!==N.length-1&&d.push({relier:I,provider:{id:R.id,prop:"name"}})})});try{o.add(d,{group:Xe})}catch(c){a[t][this.naming(r).raw.error]=[c]}}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(ue.includes(r)||!this.schema.for({id:t,prop:r}).schemable)return;let i=this.constructor.prototype.get,{value:o,error:l}=i.call(this,{id:t,prop:r},{include:"error"}),[a,n]=[this.members,this.naming(r)];if(l){a[t][n.prop]=null;let s=`Skipping parsing ${r} schema of member ${t},`;return s+=" since previous errors exist.",console.warn(s,l)}try{a[t][n.prop]=this.schema.parse(o)}catch(s){a[t][n.prop]=null,a[t][n.error]=[s],console.warn(`Failed to parse ${r} schema of member ${t}.`,s)}}}];var Qi=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(ue.includes(r))return;let i=this.schema.for({id:t,prop:r});if(!i.schemable||!i.calculable)return;let o=this.constructor.prototype.get,{value:l,error:a}=o.call(this,{id:t,prop:r},{include:"error"}),[n,s]=[this.members,this.naming(r)];if(a){let p=`Skipping trying to calculate ${r} of member ${t},`;return p+=" since previous errors exist.",console.warn(p,a)}if(!!this.calculator.isSupported(l,{strict:!1}))try{n[t][s.prop]=this.calculator.calculate(l)}catch(p){n[t][s.error]=[p],console.warn(`Failed to calculate ${r} of member ${t}.`,p)}}}],qr=Qi;var eo=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{i.find(l=>l.prop===o.prop)||i.push({id:r,prop:o.prop,value:o.default})})}}],Gr=eo;var to=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{if(!("always"in o))return;let l=i.find(a=>a.prop===o.prop);if(l)return l.value=o.always;i.push({id:r,prop:o.prop,value:o.always})})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i}=e,o=this.schema.for({id:t,prop:r});"always"in o&&i!==o.always&&(e.value=o.always)}}],zr=to;var ro=[{hook:"after-add",handler(e,t){let[r,i]=[e.id,t.mutations.set];this.schema.for({id:r}).forEach(o=>{!o.validation||i.find(l=>l.prop===o.prop)||i.push({id:r,prop:o.prop,value:o.default||null})})}},{hook:"after-set",handler(e){let{id:t,prop:r}=e,i=this.get({id:t,prop:r},{include:["error","raw"]}),{value:o,error:l}=i.raw,a=`${A.exceptions.VALIDATION_FAILED}_RAW`;if(Wr(l,{exclude:a})){let b=`Skipping validating raw ${r} of member ${t},`;return b+=" since previous errors exist.",console.warn(b,l)}let n=this.schema.constructor.Condition,s=this.schema.for({id:t,prop:r}).rawValidation,[p,d]=[this.members,this.naming(r)],c=d.raw.error;if(!s)return p[t][c]=null;if(n.isntCondition(o)){if(l=Gt(this,{id:t,prop:r,value:o,validation:s}),!l)return p[t][c]=null;p[t][c]=[zt(l,{type:a})]}else{let[b,I]=[n.extract(o),-1];if(b.whens.concat(b.else).some(({result:x},N)=>{if(l=Gt(this,{id:t,prop:r,value:x,validation:s}),l)return(I=N)||!0}),!l)return p[t][c]=null;p[t][c]=[zt(l,{type:a,data:{branchIndex:I,dueto:"result"}})]}}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e,{value:i,error:o}=this.get({id:t,prop:r},{include:"error"}),l=A.exceptions.VALIDATION_FAILED;if(Wr(o,{exclude:l})){let p=`Skipping validating ${r} of member ${t},`;return p+=" since previous errors exist.",console.warn(p,o)}let{validation:a}=this.schema.for({id:t,prop:r}),[n,s]=[this.members,this.naming(r)];if(!a||(o=Gt(this,{id:t,prop:r,value:i,validation:a}),!o))return n[t][s.error]=null;n[t][s.error]=[zt(o,{type:l})]}}];function Wr(e,t={}){if(!e)return!1;h.array(e)&&(e=[e]);let r=f.array(t.exclude)?t.exclude:[t.exclude];if(e=e.find(i=>!r.includes(i.type)),e)return!0}function Gt(e,t={}){let{id:r,prop:i,value:o,validation:l}=t;h.array(l)&&(l=[l]);let[a,n]=[null,l.find(s=>"presence"in s)];return n||![null,void 0,""].includes(o)?(e.validator.sort(l).some(s=>{try{return f.function(s)?a=s.call(e,{id:r,prop:i,value:o}):a=e.validator.error(s,o)}catch(p){return a=p}}),a):a=null}function zt(e={},t={}){let r=f.string(e)?e:e.message||e.name,i=f.string(e)?{}:e.data,o=t.data||{};return D.create({type:t.type,message:r,data:u(u({},i),o)})}var Xr=ro;var Zr=[];function Wt(e={}){let t=e.accept;h.array(t)&&(t=[t]),t.forEach(i=>y.nonblankString(i));let r=Zr.find(i=>i.accept.length!==t.length?!1:!i.accept.some(o=>!t.includes(o)));return r||(r={accept:t,HOOKS:[{hook:"before-add",handler(i){let o=(i.props||{}).type||"default",l=this.get({id:i.parentId,prop:"type"});!t.includes(l)&&g({type:this.exceptions.INVALID_PARENT,message:B.t("reactive.mustBelongsToValidParent",{variables:{memberType:o,acceptedParentTypes:t}})})}}]},Zr.push(r)),r.HOOKS}var Xt={CONFLICTED_MEMBER_TYPE:"REACTIVE_CONFLICTED_MEMBER_TYPE",UNINSTALLED_MEMBER_TYPE:"REACTIVE_UNINSTALLED_MEMBER_TYPE",CONSTRAINTS_EXIST:"REACTIVE_CONSTRAINTS_EXIST",CONFLICTED_MEMBER_NAME:"REACTIVE_CONFLICTED_MEMBER_NAME",REFERENCED_PROVIDER_NOT_FOUND:"REACTIVE_REFERENCED_PROVIDER_NOT_FOUND",INVALID_PARENT:"REACTIVE_INVALID_PARENT",HOOK_NOT_EXIST:"REACTIVE_HOOK_NOT_EXIST",VALIDATION_FAILED:"REACTIVE_VALIDATION_FAILED"},pt={ENABLE_SCHEMA_DEFAULT:Gr,ENABLE_SCHEMA_ALWAYS:zr,ENABLE_SCHEMA_VALIDATION:Xr,BLOCK_INVALID_PARENT:Wt};function _(){let e=F.create();$(e,{installed:{}}),e.guid=V,e.exceptions=Xt,e.seed=$t.bind(e),e.collect=Kt.bind(e),e.install=Vr.bind(e),e.get=Ht(e),e.schema=Vt(e),e.validator=Ut(e),e.calculator=Mt(e),e.hooks=Bt(e),e.hooks.mount(Ur),e.hooks.mount(Mr),e.hooks.mount(jr),e.hooks.mount(Br),e.hooks.mount(Hr),e.hooks.mount(Yr),e.hooks.mount($r),e.hooks.mount(qr),e.install({type:"default",schema:{props:[{prop:"name"}]}});let t=e.members[e.family.root().id],r=e.naming("type");return t[r.raw.prop]=t[r.prop]="default",e}_.guid=V;_.exceptions=Xt;_.hooks={use(e,...t){return!(e in pt)&&g({type:Xt.HOOK_NOT_EXIST}),h.function(pt[e])?pt[e]:pt[e](...t)}};Se.hooks=[_.hooks.use("ENABLE_SCHEMA_DEFAULT"),_.hooks.use("ENABLE_SCHEMA_VALIDATION")];var Jr={schema:{props:{name:{label:"Fieldset Name"},label:{label:"Fieldset Title",default:"Fieldset"},description:{label:"Fieldset Description",default:"This is a fieldset."}}}};var Qr={schema:{props:{name:{label:"\u8F93\u5165\u9879\u96C6\u5408Name"},label:{label:"\u8F93\u5165\u9879\u96C6\u5408\u6807\u9898",default:"\u8F93\u5165\u9879\u96C6\u5408"},description:{label:"\u8F93\u5165\u9879\u96C6\u5408\u63CF\u8FF0",default:"\u8FD9\u662F\u4E00\u4E2A\u8F93\u5165\u9879\u96C6\u5408\u3002"}}}};Q.define({en:{form:{fieldset:Jr}},zh:{form:{fieldset:Qr}}});var re=Q;Se.schema={fallback:{prop:()=>_.guid(),label:()=>_.guid(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>re.t("form.fieldset.schema.fallback.placeholder"),hint:()=>re.t("form.fieldset.schema.fallback.hint")},props:[{prop:"name",validation:[{dataType:"String"}],label:()=>re.t("form.fieldset.schema.props.name.label"),placeholder:()=>re.t("form.fieldset.schema.props.name.placeholder"),hint:()=>re.t("form.fieldset.schema.props.name.hint")},{prop:"label",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>re.t("form.fieldset.schema.props.label.default"),label:()=>re.t("form.fieldset.schema.props.label.label"),placeholder:()=>re.t("form.fieldset.schema.props.label.placeholder"),hint:()=>re.t("form.fieldset.schema.props.label.hint")},{prop:"description",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>re.t("form.fieldset.schema.props.description.default"),label:()=>re.t("form.fieldset.schema.props.description.label"),placeholder:()=>re.t("form.fieldset.schema.props.description.placeholder"),hint:()=>re.t("form.fieldset.schema.props.description.hint")}]};var m=class{};S(m,"PARENT_TYPE","Fieldset"),S(m,"GROUP_NAMES",{Field:"Field",FieldsetChild:"FieldsetChild"}),S(m,"exceptions",{PROP_SCHEMA_NOT_EXIST:"FIELD_PROP_SCHEMA_NOT_EXIST",HOOK_NOT_EXIST:"FIELD_HOOK_NOT_EXIST",INVALID_PARENT:"FIELD_INVALID_PARENT",UNINSTALLED_TYPE:"FIELD_UNINSTALLED_TYPE"});m.extend=function(e={}){let{type:t,hooks:r,schema:i,group:o}=u({},e);return!r&&(r=m.hooks.default()),!i&&(i=m.schema.default()),!i.fallback&&(i.fallback=m.schema.default("fallback")),!i.props&&(i.props=m.schema.default("props")),o=o?f.array(o)?o.slice():[o]:[],Object.values(m.GROUP_NAMES).forEach(l=>{!o.includes(l)&&o.push(l)}),v(u({},e),{type:t,hooks:r,schema:i,group:o})};var ei={schema:{props:{name:{label:"Name"},label:{label:"Label",default:"Form Field"},order:{label:"Order"},value:{label:"Initial Value"},placeholder:{label:"Placeholder",default:""},editable:{label:"If Editable"},visible:{label:"If Visible"},validation:{label:"Validation"},calculation:{label:"Calculation",placeholder:'E.g, {"add": ["<< fields.age.value >>", "<< fields.count.value >>"]}',notSupported:"Unsupported calculation algorithm { name }."},options:{label:"Options",each:{mustbeObject:"Each option must be an object.",labelMustbeNonblankString:"Option label must be a non-blank string.",valueMustbeNonblankString:"Option value must be a non-blank string",mustbeUnique:"Option value must be unique.",label:"Option"}}}},textField:{schema:{props:{label:{default:"Text Field"}}}},multilineTextField:{schema:{props:{label:{default:"Multiline Text Field"}}}},numberField:{schema:{props:{label:{default:"Number Field"}}}},singleSelectField:{schema:{props:{label:{default:"Single Select"}}}},multipleSelectField:{schema:{props:{label:{default:"Multiple Select"}}}},radioField:{schema:{props:{label:{default:"Radio Field"}}}},checkboxField:{schema:{props:{label:{default:"Checkbox Field"}}}}};var ti={schema:{props:{name:{label:"\u8F93\u5165\u9879Name"},label:{label:"\u6807\u9898",default:"\u8F93\u5165\u9879"},order:{label:"\u987A\u5E8F"},value:{label:"\u521D\u59CB\u503C"},placeholder:{label:"\u5360\u4F4D\u7B26",default:""},editable:{label:"\u662F\u5426\u53EF\u7F16\u8F91"},visible:{label:"\u662F\u5426\u53EF\u89C1"},validation:{label:"\u6821\u9A8C\u89C4\u5219"},calculation:{label:"\u8BA1\u7B97\u89C4\u5219",placeholder:'\u4F8B\u5982: {"add": ["<< fields.age.value >>", "<< fields.count.value >>"]}',notSupported:"\u4E0D\u88AB\u652F\u6301\u7684\u8BA1\u7B97{ name }\u3002"},options:{label:"\u9009\u9879",each:{mustbeObject:"\u53EF\u9009\u9879\u76EE\u987B\u662F\u5BF9\u8C61\u3002",labelMustbeNonblankString:"\u53EF\u9009\u9879\u6807\u9898\u987B\u662F\u975E\u7A7A\u5B57\u7B26\u4E32\u3002",valueMustbeNonblankString:"\u53EF\u9009\u9879\u7684\u503C\u987B\u662F\u975E\u7A7A\u5B57\u7B26\u4E32\u3002",mustbeUnique:"\u9009\u9879\u503C\u4E0D\u80FD\u91CD\u590D\u3002",label:"\u9009\u9879"}}}},textField:{schema:{props:{label:{default:"\u5355\u884C\u6587\u672C"}}}},multilineTextField:{schema:{props:{label:{default:"\u591A\u884C\u6587\u672C"}}}},numberField:{schema:{props:{label:{default:"\u6570\u5B57"}}}},singleSelectField:{schema:{props:{label:{default:"\u4E0B\u62C9\u5355\u9009"}}}},multipleSelectField:{schema:{props:{label:{default:"\u4E0B\u62C9\u591A\u9009"}}}},radioField:{schema:{props:{label:{default:"\u5355\u9009"}}}},checkboxField:{schema:{props:{label:{default:"\u591A\u9009"}}}}};Q.define({en:{form:{field:ei}},zh:{form:{field:ti}}});var T=Q;var io=[{hook:"after-add",handler(e){let t={id:e.id,prop:"value"},r={id:e.id,prop:"calculation"};this.dependency.add({provider:r,relier:t})}},{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="calculation")return;let i=this.get({id:t,prop:r},{include:["raw","error"]});if(i.error)return console.warn("Skipping using calculated value since prev errors exist.",i.error);!i.raw.value||this.set({id:t,prop:"value",value:i.value})}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i}=e;if(r!=="value")return;let o=this.get({id:t,prop:"calculation"},{include:"raw"});if(o.raw.value&&i!==o.value)return!1}}],ri=io;var ii="FORM_FIELD_ENABLE_VALUE_VALIDATION",oo=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(!["value","validation"].includes(r))return;let{value:i,error:o}=this.get({id:t,prop:"value"},{include:"error"});if(lo(o)){let p="Skipping validating value using validation rules";return p+=" since prev value errors exist.",console.warn(p,o)}let[l,a]=[this.members,this.naming("value")],n=this.get({id:t,prop:"validation"},{include:"error"});if(n.error){let p="Skipping validating value using field validation";return p+=" since field validation has errors.",console.warn(p,n.error),l[t][a.error]=null}if(o=null,!n.value&&(n.value=[]),h.array(n.value)&&(n.value=[n.value]),(n.value.find(p=>p&&"presence"in p)||h.blank(i))&&this.validator.sort(n.value).some(p=>{try{return o=this.validator.error(p,i)}catch(d){return o=d}}),!o)return l[t][a.error]=null;l[t][a.error]=[D.create({data:{hook:ii},type:A.exceptions.VALIDATION_FAILED,message:f.string(o)?o:o.message||o.name})]}}];function lo(e){if(!e)return!1;if(h.array(e)&&(e=[e]),e=e.find(t=>{var r;return((r=t==null?void 0:t.data)==null?void 0:r.hook)!==ii}),e)return!0}var oi=oo;var li="FORM_FIELD_ENSURE_VALUE_WITHIN_OPTIONS",ao=[{hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(!["value","options"].includes(r))return;let{value:i,error:o}=this.get({id:t,prop:"value"},{include:"error"});if(no(o)){let d="Skipping checking if value is within field options";return d+=" since prev value errors exist.",console.warn(d,o)}let[l,a]=[this.members,this.naming("value")],n=this.get({id:t,prop:"options"},{include:"error"});if(n.error){let d="Skipping checking if value is within field options";return d+=" since field options has errors.",console.warn(d,n.error),l[t][a.error]=null}if(f.blank(i))return l[t][a.error]=null;h.array(i)&&(i=[i]);let s=(n.value||[]).map(d=>d.value);if(!i.some(d=>!s.includes(d)))return l[t][a.error]=null;l[t][a.error]=[D.create({data:{hook:li},type:A.exceptions.VALIDATION_FAILED,message:"Each picked value must be included in option values."})]}}];function no(e){if(!e)return!1;if(h.array(e)&&(e=[e]),e=e.find(t=>{var r;return((r=t==null?void 0:t.data)==null?void 0:r.hook)!==li}),e)return!0}var ai=ao;var ut={ENABLE_VALUE_CALCULATION:ri,ENABLE_VALUE_VALIDATION:oi,ENSURE_VALUE_WITHIN_OPTIONS:ai},so=[_.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),_.hooks.use("ENABLE_SCHEMA_DEFAULT"),ut.ENABLE_VALUE_CALCULATION,_.hooks.use("ENABLE_SCHEMA_VALIDATION"),ut.ENABLE_VALUE_VALIDATION];m.hooks={use(e){return!(e in ut)&&g({type:m.exceptions.HOOK_NOT_EXIST}),ut[e]},default(){return so.slice()}};var Qe={FALLBACK:{prop:()=>V(),label:()=>V(),default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>T.t("form.field.schema.fallback.placeholder"),hint:()=>T.t("form.field.schema.fallback.hint")},PROPS:[{prop:"name",validation:[{dataType:"String"}],label:()=>T.t("form.field.schema.props.name.label"),placeholder:()=>T.t("form.field.schema.props.name.placeholder"),hint:()=>T.t("form.field.schema.props.name.placeholder")},{prop:"label",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],default:()=>T.t("form.field.schema.props.label.default"),label:()=>T.t("form.field.schema.props.label.label"),placeholder:()=>T.t("form.field.schema.props.label.placeholder"),hint:()=>T.t("form.field.schema.props.label.hint")},{prop:"order",schemable:!1,calculable:!1,validation:[{dataType:"Number"}],label:()=>T.t("form.field.schema.props.order.label"),placeholder:()=>T.t("form.field.schema.props.order.placeholder"),hint:()=>T.t("form.field.schema.props.order.hint")},{prop:"value",schemable:!1,calculable:!1,validation:null,default:null,label:()=>T.t("form.field.schema.props.value.label"),placeholder:()=>T.t("form.field.schema.props.value.placeholder"),hint:()=>T.t("form.field.schema.props.value.hint")},{prop:"placeholder",schemable:!1,calculable:!1,validation:[{dataType:"String"}],default:()=>T.t("form.field.schema.props.placeholder.default"),label:()=>T.t("form.field.schema.props.placeholder.label"),placeholder:()=>T.t("form.field.schema.props.placeholder.placeholder"),hint:()=>T.t("form.field.schema.props.placeholder.hint")},{prop:"editable",schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],rawValidation:[{presence:!0},{dataType:"Boolean"}],default:!0,label:()=>T.t("form.field.schema.props.editable.label"),placeholder:()=>T.t("form.field.schema.props.editable.placeholder"),hint:()=>T.t("form.field.schema.props.editable.hint")},{prop:"visible",schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],rawValidation:[{presence:!0},{dataType:"Boolean"}],default:!0,label:()=>T.t("form.field.schema.props.visible.label"),placeholder:()=>T.t("form.field.schema.props.visible.placeholder"),hint:()=>T.t("form.field.schema.props.visible.hint")},u({prop:"validation",schemable:!0,calculable:!0,default:null,label:()=>T.t("form.field.schema.props.validation.label"),placeholder:()=>T.t("form.field.schema.props.validation.placeholder"),hint:()=>T.t("form.field.schema.props.validation.hint")},(()=>{let e=[{dataType:"Array"},function(t){let[r,i]=[-1,null];for(;++r<t.value.length;){i=t.value[r];let o=qt(this,i);if(o)return o.data.validationIndex=r,o}}];return{validation:e,rawValidation:e}})()),{prop:"calculation",schemable:!0,calculable:!0,default:null,label:()=>T.t("form.field.schema.props.calculation.label"),placeholder:()=>T.t("form.field.schema.props.calculation.placeholder"),hint:()=>T.t("form.field.schema.props.calculation.hint"),validation:null,rawValidation:[function(e){if(!this.calculator.isSupported(e.value,{strict:!0}))return D.create({type:P.exceptions.UNSUPPORTED_CALCULATION,message:T.t("form.field.schema.props.calculation.notSupported",{variables:{name:e.value}})})}]}]},po={PROPS:[{prop:"options",schemable:!1,calculable:!1,default:()=>{let e="1",t="form.field.schema.props.options.each.label";return[{value:e,label:`${T.t(t)} ${e}`}]},label:()=>T.t("form.field.schema.props.options.label"),placeholder:()=>T.t("form.field.schema.props.options.placeholder"),hint:()=>T.t("form.field.schema.props.options.hint"),rawValidation:null,validation:[{presence:!0},{dataType:"Array"},function(e){let t=e.value;t.forEach((r,i)=>{let[o,l,a]=[!0,"",-1];h.object(r)?(o=!1,l="form.field.schema.props.options.each.mustbeObject"):h.nonblankString(r.label)?(o=!1,l="form.field.schema.props.options.each.labelMustbeNonblankString"):h.nonblankString(r.value)?(o=!1,l="form.field.schema.props.options.each.valueMustbeNonblankString"):(a=t.findIndex((n,s)=>s!==i&&n.value===r.value),a>=0&&(o=!1,l="form.field.schema.props.options.each.mustbeUnique")),!o&&g({data:{optionIndex:a>=0?a:i},type:A.exceptions.VALIDATION_FAILED,message:T.t(l)})})}]}]};m.schema={use(e){return u({},ni(e))},extend(e,t={}){return u(u({},ni(e)),t)},default(e){return e==="fallback"?u({},Qe.FALLBACK):e==="props"?Qe.PROPS.slice():{fallback:u({},Qe.FALLBACK),props:Qe.PROPS.slice()}}};function ni(e){let r=Qe.PROPS.concat(po.PROPS).find(i=>i.prop===e);return!r&&g({type:m.exceptions.PROP_SCHEMA_NOT_EXIST,message:`Prop schema of '${e}' does not exist.`}),r}function E(e="",t="",r){return f.undefined(r)&&(r=["label","placeholder","hint"]),W.from(r.map(i=>[i,uo(e,t,i)]))}function uo(e,t,r){return()=>T.try([`form.field.${e}.schema.props.${t}.${r}`,`form.field.schema.props.${t}.${r}`])}var si=m.extend({type:"CheckboxField",hooks:[_.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),_.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),_.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},E("checkboxField","name"))),m.schema.extend("label",u({},E("checkboxField","label",["label","placeholder","hint","default"]))),m.schema.extend("value",v(u({},E("checkboxField","value")),{validation:[{dataType:"Array"}]})),m.schema.extend("options",u({},E("checkboxField","options"))),m.schema.extend("editable",u({},E("checkboxField","editable"))),m.schema.extend("visible",u({},E("checkboxField","visible"))),m.schema.extend("validation",u({},E("checkboxField","validation"))),m.schema.extend("calculation",u({},E("checkboxField","calculation")))]}});var pi=m.extend({type:"MultilineTextField",schema:{props:[m.schema.extend("name",u({},E("multilineTextField","name"))),m.schema.extend("label",u({},E("multilineTextField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},E("multilineTextField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",v(u({},E("multilineTextField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("editable",u({},E("multilineTextField","editable"))),m.schema.extend("visible",u({},E("multilineTextField","visible"))),m.schema.extend("validation",u({},E("multilineTextField","validation"))),m.schema.extend("calculation",u({},E("multilineTextField","calculation")))]}});var ui=m.extend({type:"MultipleSelectField",hooks:[_.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),_.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),_.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},E("multipleSelectField","name"))),m.schema.extend("label",u({},E("multipleSelectField","label",["label","placeholder","hint","default"]))),m.schema.extend("value",v(u({},E("multipleSelectField","value")),{validation:[{dataType:"Array"}]})),m.schema.extend("options",u({},E("multipleSelectField","options"))),m.schema.extend("editable",u({},E("multipleSelectField","editable"))),m.schema.extend("visible",u({},E("multipleSelectField","visible"))),m.schema.extend("validation",u({},E("multipleSelectField","validation"))),m.schema.extend("calculation",u({},E("multipleSelectField","calculation")))]}});var ci=m.extend({type:"NumberField",schema:{props:[m.schema.extend("name",u({},E("numberField","name"))),m.schema.extend("label",u({},E("numberField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},E("numberField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",v(u({},E("numberField","value")),{validation:[{dataType:"Number"}]})),m.schema.extend("editable",u({},E("numberField","editable"))),m.schema.extend("visible",u({},E("numberField","visible"))),m.schema.extend("validation",u({},E("numberField","validation"))),m.schema.extend("calculation",u({},E("numberField","calculation")))]}});var fi=m.extend({type:"RadioField",hooks:[_.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),_.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),_.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},E("radioField","name"))),m.schema.extend("label",u({},E("radioField","label",["label","placeholder","hint","default"]))),m.schema.extend("value",v(u({},E("radioField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("options",u({},E("radioField","options"))),m.schema.extend("editable",u({},E("radioField","editable"))),m.schema.extend("visible",u({},E("radioField","visible"))),m.schema.extend("validation",u({},E("radioField","validation"))),m.schema.extend("calculation",u({},E("radioField","calculation")))]}});var mi=m.extend({type:"SingleSelectField",hooks:[_.hooks.use("BLOCK_INVALID_PARENT",{accept:m.PARENT_TYPE}),_.hooks.use("ENABLE_SCHEMA_DEFAULT"),m.hooks.use("ENABLE_VALUE_CALCULATION"),_.hooks.use("ENABLE_SCHEMA_VALIDATION"),m.hooks.use("ENSURE_VALUE_WITHIN_OPTIONS"),m.hooks.use("ENABLE_VALUE_VALIDATION")],schema:{props:[m.schema.extend("name",u({},E("singleSelectField","name"))),m.schema.extend("label",u({},E("singleSelectField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},E("singleSelectField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",v(u({},E("singleSelectField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("options",u({},E("singleSelectField","options"))),m.schema.extend("editable",u({},E("singleSelectField","editable"))),m.schema.extend("visible",u({},E("singleSelectField","visible"))),m.schema.extend("validation",u({},E("singleSelectField","validation"))),m.schema.extend("calculation",u({},E("singleSelectField","calculation")))]}});var di=m.extend({type:"TextField",schema:{props:[m.schema.extend("name",u({},E("textField","name"))),m.schema.extend("label",u({},E("textField","label",["label","placeholder","hint","default"]))),m.schema.extend("placeholder",u({},E("textField","placeholder",["label","placeholder","hint","default"]))),m.schema.extend("value",v(u({},E("textField","value")),{validation:[{dataType:"String"}]})),m.schema.extend("editable",u({},E("textField","editable"))),m.schema.extend("visible",u({},E("textField","visible"))),m.schema.extend("validation",u({},E("textField","validation"))),m.schema.extend("calculation",u({},E("textField","calculation")))]}});var Zt=[di,pi,ci,mi,ui,fi,si];var q={type:"Subform",group:"FieldsetChild"};q.collect=function(e){let t=this.get({id:e.id},{include:"raw"}),[r,i]=[[],[]],[o,l]=[[],[]];return(this.family.descendant(e)||[]).forEach((a,n)=>{let[s,p]=[{},{}];(this.family.descendant(a)||[]).forEach(d=>{let c=this.collect({id:d.id},{errors:!1});s[c.values.name]=c.values.value,p[c.values.name]=c.raw.values.value,n===0&&(delete c.values.value,delete c.raw.values.value,o.push(c.values),l.push(c.raw.values))}),r.push(s),i.push(p)}),t.values.value=r,t.raw.values.value=i,t.values.children=o,t.raw.values.children=l,t};q.hooks=[_.hooks.use("BLOCK_INVALID_PARENT",{accept:"Fieldset"}),_.hooks.use("ENABLE_SCHEMA_DEFAULT"),_.hooks.use("ENABLE_SCHEMA_VALIDATION")];var hi={schema:{props:{name:{label:"Name"},label:{label:"Label",default:"Subform"},editable:{label:"If Editable"},visible:{label:"If Visible"}}},fieldSizeIsInvalid:"Each subform must contain one field at least."};var bi={schema:{props:{name:{label:"\u5B50\u8868\u5355Name"},label:{label:"\u5B50\u8868\u5355\u6807\u9898",default:"\u5B50\u8868\u5355"},editable:{label:"\u662F\u5426\u53EF\u7F16\u8F91"},visible:{label:"\u662F\u5426\u53EF\u89C1"}}},fieldSizeIsInvalid:"\u5B50\u8868\u5355\u81F3\u5C11\u8981\u5305\u542B\u4E00\u4E2A\u8F93\u5165\u9879\u3002"};Q.define({en:{form:{subform:hi}},zh:{form:{subform:bi}}});var K=Q;q.schema={fallback:{prop:()=>_.guid(),label:"",default:null,schemable:!1,calculable:!1,validation:null,placeholder:()=>K.t("form.subform.schema.fallback.placeholder"),hint:()=>K.t("form.subform.schema.fallback.hint")},props:[{prop:"name",validation:[{dataType:"String"}],label:()=>K.t("form.subform.schema.props.name.label"),placeholder:()=>K.t("form.subform.schema.props.name.placeholder"),hint:()=>K.t("form.subform.schema.props.name.hint")},{prop:"label",schemable:!1,calculable:!1,validation:[{presence:!0},{dataType:"String"}],default:()=>K.t("form.subform.schema.props.label.default"),label:()=>K.t("form.subform.schema.props.label.label"),placeholder:()=>K.t("form.subform.schema.props.label.placeholder"),hint:()=>K.t("form.subform.schema.props.label.hint")},{prop:"editable",default:!0,schemable:!0,calculable:!0,validation:[{presence:!0},{dataType:"Boolean"}],label:()=>K.t("form.subform.schema.props.editable.label"),placeholder:()=>K.t("form.subform.schema.props.editable.placeholder"),hint:()=>K.t("form.subform.schema.props.editable.hint")},{prop:"visible",default:!0,schemable:!0,validation:[{presence:!0},{dataType:"Boolean"}],label:()=>K.t("form.subform.schema.props.visible.label"),placeholder:()=>K.t("form.subform.schema.props.visible.placeholder"),hint:()=>K.t("form.subform.schema.props.visible.hint")}]};q.seed=function(e,t){let[r,i]=[t.value||[],t.children||[]],o=Object.keys(t).map(x=>{if(!["children","value"].includes(x))return{action:"set",id:e.id,prop:x,value:t[x]}}).filter(x=>x),l=this.family.descendant({id:e.id})||[],a=Math.max(l.length,r.length),[n,s]=[[],a-l.length];for(s<=0&&(s=1);--s>=0;)n.push({action:"add",parentId:e.id,id:this.guid(),props:{type:"SubformFieldset"}});let[p,d]=[l.length?l[0]:null,[]];p&&(d=this.family.descendant({id:p.id})||[]);let c=Math.max(d.length,i.length),b=d.map(({id:x},N)=>{let R=this.get({id:x},{include:"raw"}).raw.values,L=f.object(i[N])?i[N]:{};return u(u({},R),L)}).concat(c-d.length>0?i.slice(d.length):[]),I=l.concat(n).map((x,N)=>{let R=b.map((L,G)=>{let U=v(u({},L),{order:G});return delete U.value,f.object(r[N])&&L.name in r[N]&&(U.value=r[N][L.name]),U});return this.seed({id:x.id},{children:R},{execute:!1})}).flat();return o.concat(n,I).map(x=>v(u({},x),{__syncSubformField__:!0}))};var _e={type:"SubformFieldset",group:"SubformChild"};_e.hooks=[_.hooks.use("BLOCK_INVALID_PARENT",{accept:"Subform"})];var w=class{};S(w,"TYPE_PREFIX","Subform"),S(w,"LABEL_PREFIX","Subform "),S(w,"PARENT_TYPE","SubformFieldset"),S(w,"GROUP_NAMES",{SubformField:"SubformField",SubformFieldsetChild:"SubformFieldsetChild"}),S(w,"exceptions",{INVALID_PARENT:"SUBFORM_FIELD_INVALID_PARENT",INVALID_FIELD_INSTALLER:"SUBFORM_FIELD_INVALID_FIELD_INSTALLER",INVALID_FIELD_SIZE:"SUBFORM_FIELD_INVALID_FIELD_SIZE"});var co=[{hook:"before-add",handler(e){let{parentId:t,props:r,__syncSubformField__:i}=e;if(i)return;let o=[v(u({},e),{action:"add",__syncSubformField__:!0})],l=this.family.sibling({id:t})||[];return o=o.concat(l.map(a=>({action:"add",__syncSubformField__:!0,parentId:a.id,id:this.guid(),props:r}))),this.executor.run(o),!1}},{hook:"before-del",handler(e){let{id:t,__syncSubformField__:r}=e;if(r)return;let i=[v(u({},e),{action:"del",__syncSubformField__:!0})],l=this.family.sibling({id:t},{self:!0}).findIndex(s=>s.id===t),a=this.family.ancestor({id:t}),n=this.family.sibling(a)||[];return i=i.concat(n.map(s=>({action:"del",__syncSubformField__:!0,id:this.family.descendant(s)[l].id}))),this.executor.run(i),!1}},{hook:"before-set",handler(e){let{id:t,prop:r,value:i,__syncSubformField__:o}=e;if(o||r==="value")return;let l=[v(u({},e),{action:"set",__syncSubformField__:!0})],n=this.family.sibling({id:t},{self:!0}).findIndex(d=>d.id===t),s=this.family.ancestor({id:t}),p=this.family.sibling(s)||[];return l=l.concat(p.map(d=>({action:"set",__syncSubformField__:!0,id:this.family.descendant(d)[n].id,prop:r,value:i}))),this.executor.run(l),!1}},{scope:_e.type,hook:"after-add",handler(e){let{id:t,props:r,__syncSubformField__:i}=e;if(i)return;let o=this.family.sibling({id:t});if(!o)return;let l=this.collect({id:o[0].id}).raw.values.children;if(!l.length)return;let a=l.map((n,s)=>{let p=((r==null?void 0:r.children)||[])[s]||{},d="value"in p?p.value:null;return{action:"add",__syncSubformField__:!0,parentId:t,id:this.guid(),props:v(u({},n),{order:s,value:d})}});this.executor.run(a)}}],yi=co;var fo=[{hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:i,schema:o}=this;if(!o.for({id:t}).find(p=>p.prop==="value"))return;let a=r.ancestor({id:t}),s={id:r.ancestor(a).id,prop:"value"};i.add({relier:s,provider:{id:t,prop:"name"}}),i.add({relier:s,provider:{id:t,prop:"value"}})}},{scope:_e.type,hook:"after-add",handler(e){let{id:t}=e,{family:r,dependency:i}=this,l={id:r.ancestor({id:t}).id,prop:"value"};i.add({relier:l,provider:{id:t,prop:"order"}})}},{scope:q.type,hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let{family:i}=this,o=(i.descendant({id:t})||[]).map(n=>W.from((i.descendant(n)||[]).map(s=>{let p=this.get({id:s.id,prop:"name"}),d=this.get({id:s.id,prop:"value"});return[p,d]}))),[l,a]=[this.members[t],this.naming(r)];l[a.prop]=l[a.raw.prop]=o}}],Ei=fo;var mo=[{scope:q.type,hook:"after-add",handler(e){let[t,r]=[e.id,"value"],[i,o]=[this.members[t],this.naming(r)],{error:l}=this.get({id:t,prop:r},{include:"error"});i[o.error]=gi(l)}},{scope:q.type,hook:"after-calc",handler(e){let{id:t,prop:r}=e;if(r!=="value")return;let i=w.exceptions.INVALID_FIELD_SIZE,{error:o}=this.get({id:t,prop:r},{include:["error"]});if(xi(o,{except:[i]})){let p=`Skipping checking subform*Field exists of member ${t},`;return p+=" since previous errors exist.",console.warn(p,o)}let l=this.get({id:t,prop:r}),[a,n]=[this.members[t],this.naming(r)];o=!l||!l.length||!Object.keys(l[0]).length?gi(o):ho(o),a[n.error]=o}}];function gi(e){let t=e||[],r=w.exceptions.INVALID_FIELD_SIZE;return h.array(t)&&(t=[t]),!xi(t,{include:[r]})&&t.push(D.create({type:r,message:K.t("form.subform.fieldSizeIsInvalid")})),t}function ho(e){if(!e||!e.length)return null;h.array(errors)&&(errors=[errors]);let t=w.exceptions.INVALID_FIELD_SIZE;return errors=errors.filter(r=>r.type===t),errors.length?errors:null}function xi(e,t={}){if(!e||!e.length)return!1;h.array(e)&&(e=[e]);let{include:r,except:i}=t;return r?e.some(o=>r.includes(o.type)):i?e.some(o=>!i.includes(o.type)):!0}var Ai=mo;w.generate=function(e={}){let{type:t,hooks:r,group:i}=e;i=i?f.array(i)?i.slice():[i]:[],!i.includes(m.GROUP_NAMES.Field)&&g({type:w.exceptions.INVALID_FIELD_INSTALLER,message:`SubformField.generate only accepts field installer
             to generate a subform field installer.`});let o=Object.values(m.GROUP_NAMES);i=i.filter(p=>!o.includes(p)),Object.values(w.GROUP_NAMES).forEach(p=>{!i.includes(p)&&i.push(p)}),t=w.TYPE_PREFIX+t,r=r?r.slice():[];let l="BLOCK_INVALID_PARENT",a=_.hooks.use(l,{accept:m.PARENT_TYPE}),n=_.hooks.use(l,{accept:w.PARENT_TYPE}),s=r.indexOf(a);return s>-1&&(r[s]=n),r=r.concat(yi,Ei,Ai),v(u({},e),{type:t,hooks:r,group:i})};var ct=class{constructor(){this.i18n=j.create(),this.reactive=_({i18n:this.i18n}),ct.MEMBERS.forEach(t=>this.reactive.install(t))}static create(...t){return new ct(...t)}},C=ct;S(C,"MEMBERS",[]),S(C,"Field",m);C.group=function(e=""){let t=C.MEMBERS.filter(r=>e?r.group.includes(e):!r.group.length);return t.length?t:null};C.install=function(e={}){h.array(e)&&(e=[e]),e.forEach(t=>{let{type:r,group:i,providers:o,validators:l}=u({},t);i="group"in t?i:[],h.array(i)&&(i=[i]),y.nonblankString(r,'Form Member "Type"'),o&&y.function(o,'Form Member "providers"'),l&&y.function(l,'Form Member "validators"'),i.forEach(a=>y.nonblankString(a,'Form Member "group"')),C.MEMBERS.push(v(u({},t),{group:i})),!!i.includes(m.GROUP_NAMES.Field)&&C.MEMBERS.push(w.generate(t))})};C.providers=function(e,t={},r={}){var d;let{id:i,prop:o}=t,l=[],a=e.get({id:i,prop:"type"}),n=(d=C.MEMBERS.find(c=>c.type===a))==null?void 0:d.providers;if(n)return n.call(e,{id:i,prop:o},r);if(Object.keys(e.members).forEach(c=>{if(c===i)return;let b=e.family.ancestor({id:c});!b||e.get({id:b.id,prop:"type"})!==Se.type||!(e.naming("value").prop in e.members[c])||l.push({id:c,prop:"value"})}),!l.length)return null;let s=e.dependency.reliers({id:i,prop:o});if(!s)return l;let p=l.filter(c=>!s.some(b=>c.id===b.id&&c.prop===b.prop));return p.length?p:null};C.uninstall=function(e=""){!e||(C.MEMBERS=C.MEMBERS.filter(t=>t.type!==e))};C.validators=function(e,t={},r={}){var p;let{id:i,prop:o}=t;o="value";let l=e.get({id:i,prop:"type"}),a=(p=C.MEMBERS.find(d=>d.type===l))==null?void 0:p.validators;if(a)return a.call(e,{id:i,prop:o},r);let n=e.schema.for({id:i,prop:o}).validation||[];h.array(n)&&(n=[n]);let s=n.find(d=>"dataType"in d);return s?e.validator.for(s.dataType,{except:"dataType"}):[e.validator.get("presence")]};C.install(Se);C.install(q);C.install(_e);C.install(Zt);return bo;})();
//# sourceMappingURL=rcfm.model.iife.min.js-0aef1410.map
