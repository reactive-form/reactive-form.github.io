{"version":3,"sources":["../../coffee/degradation.coffee"],"names":["Degradation","_URL_ATTRIBUTE","_HTML","join","_CSS_PROPERTIES","display","position","_JS_PROPERTIES","es6Class","es6ArrowFunction","mutationObserver","proxy","performance","_NOTIFY_MILLSECONDS","check","this","_checkEnv","_checkJS","_checkCSS","_eval","script","geval","eval","document","window","global","Error","properties","err","property","results","value","error","_notify","ele","i","len","name","valueEle","createElement","length","_CSSPropertySupported","results1","Array","results2","j","len1","_CSSValueSupported","style","valueStr","values","split","_self","redirectUrl","ref","documentElement","getAttribute","location","href","scripts","setInterval","getElementById","body","innerHTML"],"mappings":";;;;;2LAAA,IAAAA,YAAAA,YAEE,CAAAC,eAAgB,uBAEhBC,MAAO,CACL,mCACA,gDACA,oCACA,MACA,gDACA,4DACA,0BACA,OACA,QACA,UACEC,KAAK,IAETC,gBAAiB,CACf,CAAAC,QAAS,OACTC,SAAU,CAAC,yBAA0B,UACrC,aACA,aAGFC,eACE,CAAAC,SAAU,aACVC,iBAAkB,eAClBC,iBAAkB,qCAClBC,MAAO,mBACPC,YAAa,4BAEfC,oBAAqB,IAErBC,MAAO,WACLC,KAACC,YACDD,KAACE,SAASF,KAACR,uBACXQ,KAACG,UAAUH,KAACX,kBAEde,MAAO,SAACC,QACN,IAAAC,MAAAA,MAAQC,KACRF,OAAS,eAAiBA,OAAS,cACnCC,MAAMD,SAERJ,UAAW,WACT,UAAUO,WAAc,YAAxB,CACE,UAAwBC,SAAY,YAApC,CAAA,OAAOA,OACP,UAAwBC,SAAY,YAApC,CAAA,OAAOA,QACT,MAAM,IAAIC,MAAM,qCAElBT,SAAU,SAACU,YACT,IAAAC,IAAAC,SAAAC,QAAAC,MAAAD,QAAA,GAAA,IAAAD,YAAAF,WAAA,4BACE,iBACEZ,KAACI,MAAMY,QADT,MAAAC,OAEMJ,IAAAI,MACJjB,KAACkB,UACD,MAAM,IAAIP,MAAMG,SAAW,IAAMD,sBAEvCV,UAAW,SAACS,YACV,IAAAO,IAAAC,EAAAC,IAAAC,KAAAR,SAAAC,QAAAC,MAAAO,SAAAJ,IAAMX,SAASgB,cAAc,OAC7BT,QAAA,GAAA,IAAAK,EAAA,EAAAC,IAAAT,WAAAa,OAAAL,EAAAC,IAAAD,IAAA,wBACE,UAAUN,WAAY,SAAtB,cACEd,KAAC0B,sBAAsBP,IAAKL,eAD9B,sCAGEa,SAAA,GAAA,IAAAL,QAAAR,SAAA,sBACEd,KAAC0B,sBAAsBP,IAAKG,MAC5B,GAAGN,iBAAiBY,MAApB,8CAC0CC,SAAA,GAAA,IAAAC,EAAA,EAAAC,KAAAf,MAAAS,OAAAK,EAAAC,KAAAD,IAAA,iCAAxC9B,KAACgC,mBAAmBb,IAAKG,KAAMC,4CADjC,eAGEvB,KAACgC,mBAAmBb,IAAKG,KAAMN,uDAEzCU,sBAAuB,SAACP,IAAKL,UAC3B,UAAcK,IAAIc,MAAMnB,YAAa,SAArC,CACEd,KAACkB,UACD,MAAM,IAAIP,MAAM,6BAA+BG,YAEnDkB,mBAAoB,SAACb,IAAKL,SAAUoB,UAClC,IAAAd,EAAAC,IAAAL,MAAAmB,OAAAA,OAASD,SAASE,MAAM,MACxB,IAAAhB,EAAA,EAAAC,IAAAc,OAAAV,OAAAL,EAAAC,IAAAD,IAAA,iBACED,IAAIc,MAAMnB,UAAYE,MACtB,GAAUG,IAAIc,MAAMnB,YAAaE,MAAjC,CAAA,QACFhB,KAACkB,UACD,MAAM,IAAIP,MAAM,mCACdG,SAAW,IAAMoB,WAErBhB,QAAS,WACP,IAAAmB,MAAAjB,EAAAC,IAAAiB,YAAAC,IAAAlC,OAAAiC,YAAc9B,SAASgC,gBAAgBC,aAAazC,KAACd,gBACrD,GAAsCoD,YAAtC,CAAA,OAAOI,SAASC,KAAOL,YACvBC,IAAA/B,SAAAoC,QAAA,IAAAxB,EAAA,EAAAC,IAAAkB,IAAAd,OAAAL,EAAAC,IAAAD,IAAA,eACEkB,YAAcjC,OAAOoC,aAAazC,KAACd,gBACnC,GAAsCoD,YAAtC,CAAA,OAAOI,SAASC,KAAOL,aACzBD,MAAQrC,YACR6C,YAAY,WACV,IAAOrC,SAASsC,eAAe,yBAA/B,CACE,GAAyCtC,SAASuC,KAAlD,QAAAvC,SAASuC,KAAKC,UAAYX,MAAMlD,SAClCa,KAACF,uBAKPb,YAAYc","sourcesContent":["Degradation =\n\n  _URL_ATTRIBUTE: 'data-degradation-url'\n\n  _HTML: [\n    '<div id=\"luda-degradation-html\" '\n    'style=\"padding:100px 30px;text-align:center\">'\n    '<h1>Your Browser is Too Old!</h1>'\n    '<p>'\n    'Please visit this site with a modern browser '\n    '<a target=\"_blank\" href=\"https://www.google.com/chrome/\">'\n    '(Chrome is recommended)'\n    '</a>'\n    '.</p>'\n    '</div>'\n    ].join('')\n\n  _CSS_PROPERTIES: [\n    display: 'flex'\n    position: ['sticky||-webkit-sticky', 'fixed']\n    'transition'\n    'animation'\n  ]\n\n  _JS_PROPERTIES:\n    es6Class: 'class X {}'\n    es6ArrowFunction: '((x) => x)()'\n    mutationObserver: 'new MutationObserver(function(){})'\n    proxy: 'new Proxy({},{})'\n    performance: 'performance.clearMarks()'\n\n  _NOTIFY_MILLSECONDS: 500\n\n  check: ->\n    @_checkEnv()\n    @_checkJS @_JS_PROPERTIES\n    @_checkCSS @_CSS_PROPERTIES\n\n  _eval: (script) ->\n    geval = eval\n    script = '(function(){' + script + '})()'\n    geval script\n\n  _checkEnv: ->\n    if typeof document isnt 'undefined'\n      return window if typeof window isnt 'undefined'\n      return global if typeof global isnt 'undefined'\n    throw new Error 'Unsupported runtime environment.'\n\n  _checkJS: (properties) ->\n    for property, value of properties\n      try\n        @_eval value\n      catch err\n        @_notify()\n        throw new Error property + ' ' + err\n\n  _checkCSS: (properties) ->\n    ele = document.createElement 'div'\n    for property in properties\n      if typeof property is 'string'\n        @_CSSPropertySupported ele, property\n      else\n        for name, value of property\n          @_CSSPropertySupported ele, name\n          if value instanceof Array\n            @_CSSValueSupported ele, name, valueEle for valueEle in value\n          else\n            @_CSSValueSupported ele, name, value\n\n  _CSSPropertySupported: (ele, property) ->\n    unless typeof ele.style[property] is 'string'\n      @_notify()\n      throw new Error 'Unsupported CSS property: ' + property\n\n  _CSSValueSupported: (ele, property, valueStr) ->\n    values = valueStr.split '||'\n    for value in values\n      ele.style[property] = value\n      return if ele.style[property] is value\n    @_notify()\n    throw new Error 'Unsupported CSS property value: ' \\\n    + property + ' ' + valueStr\n\n  _notify: ->\n    redirectUrl = document.documentElement.getAttribute @_URL_ATTRIBUTE\n    return location.href = redirectUrl if redirectUrl\n    for script in document.scripts\n      redirectUrl = script.getAttribute @_URL_ATTRIBUTE\n      return location.href = redirectUrl if redirectUrl\n    _self = this\n    setInterval(->\n      unless document.getElementById 'luda-degradation-html'\n        document.body.innerHTML = _self._HTML if document.body\n    , @_NOTIFY_MILLSECONDS)\n\n\n\n\nDegradation.check()"]}