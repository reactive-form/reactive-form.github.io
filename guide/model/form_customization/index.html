<!doctype html> <html> <head> <title>Reactive Form - 模型驱动、可扩展的表单引擎</title> <meta charset=UTF-8> <meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"> <meta name=renderer content=webkit> <meta http-equiv=X-UA-Compatible content="IE=Edge,chrome=1"> <meta name=apple-mobile-web-app-capable content=yes> <meta name=apple-mobile-web-app-status-bar-style content=black-translucent> <meta name=apple-mobile-web-app-title content=ReactiveForm> <meta name=mobile-web-app-capable content=ReactiveForm> <meta name=application-name content=ReactiveForm> <meta content="telephone=no" name=format-detection> <meta name=msapplication-tap-highlight content=no> <meta name=author content=""> <meta name=keywords content=""> <meta name=description content=""> <link rel="shortcut icon" href="/favicon.ico"> <script src="/assets/javascripts/luda-degradation.min-de40bf23.js"></script> <script src="/assets/javascripts/turbo.es2017-umd.min-6c3e5b73.js" data-turbo-track=reload></script> <link href="/assets/stylesheets/luda-default.min-d9508530.css" rel=stylesheet data-turbo-track=reload /> <link href="/assets/stylesheets/rouge-ebba3ab6.css" rel=stylesheet data-turbo-track=reload /> <link href="/assets/stylesheets/site-b4ec337b.css" rel=stylesheet data-turbo-track=reload /> <script src="/assets/javascripts/luda.min-10857b5a.js" data-turbo-track=reload></script> </head> <body id=""> <div class=grid-edge> <aside class="nav-aside col-12 col-3-m bc-light sd-low"> <a href="/" class=nav-logo> <picture class=d-block> <source srcset="/assets/images/logo-f19b9c85.svg" media="(min-width: 768px)"> <img src="/assets/images/logo_full-dcdab38b.svg" alt="rcfm logo" width=""/> </picture> </a> <button class="nav-open btn btn-ico btn-text-dark" data-toggle-for=aside-menu> <i class="ico ico-menu"></i> </button> <div class="nav-menu pb-large" data-toggle-target=aside-menu> <button class="nav-close btn btn-ico btn-text-dark" data-toggleable> <i class="ico ico-cross"></i> </button> <div class="nav-items mx-medium"> <p class="nav-items-title px-small mb-tiny fw-bold c-dark">开始</p> <a href="/guide/general/situations/" title="适用场景" class="btn btn-text-dark btn-small mt-tiny rounded ">适用场景</a> <a href="/guide/general/platforms/" title="兼容性" class="btn btn-text-dark btn-small mt-tiny rounded ">兼容性</a> <a href="/guide/general/installation/" title="安装方式" class="btn btn-text-dark btn-small mt-tiny rounded ">安装方式</a> <a href="/guide/general/get_started/" title="入门示例" class="btn btn-text-dark btn-small mt-tiny rounded ">入门示例</a> </div> <div class="nav-items mx-medium"> <p class="nav-items-title px-small mb-tiny fw-bold c-dark">模型</p> <a href="/guide/model/introduction/" title="概述" class="btn btn-text-dark btn-small mt-tiny rounded ">概述</a> <a href="/guide/model/reactive/" title=Reactive class="btn btn-text-dark btn-small mt-tiny rounded ">Reactive</a> <a href="/guide/model/reactive_customization/" title="构建引擎" class="btn btn-text-dark btn-small mt-tiny rounded ">构建引擎</a> <a href="/guide/model/form/" title="内置引擎" class="btn btn-text-dark btn-small mt-tiny rounded ">内置引擎</a> <a href="/guide/model/form_customization/" title="扩展内置引擎" class="btn btn-text-dark btn-small mt-tiny rounded btn-active">扩展内置引擎</a> <a href="/guide/model/i18n/" title="国际化" class="btn btn-text-dark btn-small mt-tiny rounded ">国际化</a> </div> <div class="nav-items mx-medium"> <p class="nav-items-title px-small mb-tiny fw-bold c-dark">组件</p> <a href="/guide/ui/introduction/" title="概述" class="btn btn-text-dark btn-small mt-tiny rounded ">概述</a> <a href="/guide/ui/subscription/" title="订阅成员状态" class="btn btn-text-dark btn-small mt-tiny rounded ">订阅成员状态</a> <a href="/guide/ui/installation/" title="注册成员组件" class="btn btn-text-dark btn-small mt-tiny rounded ">注册成员组件</a> <a href="/guide/ui/form/" title="内置引擎组件" class="btn btn-text-dark btn-small mt-tiny rounded ">内置引擎组件</a> </div> <div class="nav-items mx-medium"> <p class="nav-items-title px-small mb-tiny fw-bold c-dark">其它</p> <a href="/guide/others/faq/" title=FAQ class="btn btn-text-dark btn-small mt-tiny rounded ">FAQ</a> <a href="/guide/others/summary/" title="写在最后" class="btn btn-text-dark btn-small mt-tiny rounded ">写在最后</a> </div> </div> </aside> <div class=col-auto> <article class="docs article p-medium p-large-m "> <h1 id="扩展内置-form-引擎">扩展内置 Form 引擎</h1> <p>Reactive Form 的内置引擎被封装在 <a href="/api/form/"><code>Form</code></a> 模型内，除了集成常用的成员类型， 还提供了一些帮助扩展成员类型的方法，以便于开发人员可以根据需要，丰富内置引擎的能力。 在本章中，我们将一起熟悉这些方法，并通过具体的示例来学习如何使用。</p> <h2 id="注册成员类型">注册成员类型</h2> <p>在介绍 <a href="/guide/model/reactive/">Reactive</a> 的实现原理时， 我们提到过可以向 Reactive 实例中注册成员类型。 对于内置引擎而言，成员类型也是被注册到 Reactive 实例中， 不过，<a href="/api/form/#.install()"><code>Form.install()</code></a> 方法对 <a href="/api/reactive/##install()"><code>reactive#install()</code></a> 方法进行了装饰， 提供了额外的能力，这些能力特性包括:</p> <h3 id="分组设定">分组设定</h3> <p>在使用 <a href="/api/form/#.install()"><code>Form.install()</code></a> 注册内置引擎的成员类型时， 可以通过 <code>group</code> 属性对类型进行分组， 分组后的类型可通过 <a href="/api/form/#.group()"><code>Form.group()</code></a> 方法，按分组名称查询到注册时的配置。 当成员类型较多时，分组设定就为归类成员类型提供了帮助，我们通过下面的示例来具体说明。</p> <iframe height=600 style="width: 100%;" scrolling=no title="model/form/customization/1" src="https://codepen.io/rcfm/embed/abEovvz?default-tab=js%2Cresult&amp;editable=true" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/rcfm/pen/abEovvz"> model/form/customization/1</a> by rcfm (<a href="https://codepen.io/rcfm">@rcfm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <h3 id="引用范围设定">引用范围设定</h3> <p>为了保证成员间引用的灵活性，<a href="/guide/model/reactive/#dsl">Reactive DSL</a> 在解析插值符中的引用路径时，并不对引用范围做限制，这意味着任何成员的任何属性间都可以产生引用。 对于一些表单引擎而言，成员的引用范围因输入项类型不同可能有所差异， 为了支持此类场景，<a href="/api/form/"><code>Form</code></a> 模型提供了设定成员引用范围的能力。</p> <p>在使用 <a href="/api/form/#.install()"><code>Form.install()</code></a> 注册类型时， 可以通过 <code>providers</code> 属性对该类型成员的引用范围进行设定， 设定后可通过 <a href="/api/form/#.providers()"><code>Form.providers()</code></a> 方法， 查询到该类型下某成员属性可引用的其它成员及属性范围。</p> <p>基于这两个方法组合使用的能力，开发人员可以对不在范围内的引用进行适当的处理， 处理方式多种多样，并没有统一定论，比如，可以通过添加钩子函数， 向成员的存储空间中写入错误信息，或在产生引用的属性上进行过滤，甚至直接将产生引用的属性置空，等等。 下面，我们使用直接置空属性设定值的方式做例。</p> <iframe height=600 style="width: 100%;" scrolling=no title="model/form/customization/2" src="https://codepen.io/rcfm/embed/NWXKrOo?default-tab=js%2Cresult&amp;editable=true" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/rcfm/pen/NWXKrOo"> model/form/customization/2</a> by rcfm (<a href="https://codepen.io/rcfm">@rcfm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <p>需要提及的一点是，对于注册时未设定 <code>providers</code> 的类型（如内置引擎默认集成的各输入项类型）， 调用 <a href="/api/form/#.providers()"><code>Form.providers()</code></a> 将返回默认引用范围。 默认可被引用的成员是所有 <code>Fieldset</code> 子级中含有 <code>value</code> 属性且不与被查询成员产生循环引用的成员， 默认可被引用的属性则是 <code>value</code>。默认引用范围这样设定的原因是，大部分表单引擎中，成员属性的引用多发生在输入项的值之间。</p> <p>另外， <a href="/api/form/#.providers()"><code>Form.providers()</code></a> 方法在 Reactive Form 内置引擎配套的 UI 组件中，也起到了一定的辅助作用，后续的组件教程中将会介绍。</p> <h3 id="校验方法范围设定">校验方法范围设定</h3> <p>在使用 <a href="/api/form/#.install()"><code>Form.install()</code></a> 注册类型时， 可以通过 <code>validators</code> 属性对可用于该类型成员的校验方法范围进行设定， 设定后可通过 <a href="/api/form/#.validators()"><code>Form.validators()</code></a> 方法， 查询到该类型下某成员可用的校验方法。</p> <p>与处理引用范围异常类似，组合使用这两个方法，可对成员属性包含不合规校验方法的情况， 进行适当的处理。下面，我们仍以直接置空属性设定值的方式做例。</p> <iframe height=600 style="width: 100%;" scrolling=no title="model/form/customization/3" src="https://codepen.io/rcfm/embed/abEOgJR?default-tab=js%2Cresult&amp;editable=true" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/rcfm/pen/abEOgJR"> model/form/customization/3</a> by rcfm (<a href="https://codepen.io/rcfm">@rcfm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <p>对于注册时未设定 <code>validators</code> 的类型（如内置引擎默认集成的各输入项类型）， 调用 <a href="/api/form/#.validators()"><code>Form.validators()</code></a> 将返回默认的可用校验方法范围。 默认范围的匹配规则是，如果 <code>schema</code> 定义中 <code>value</code> 属性的 <code>validation</code> 指定了 <code>dataType</code>， 则返回所有可用于该 <code>dataType</code> 的校验方法，否则只返回 <code>presence</code> 校验方法。</p> <p>比如，内置引擎集成的 <code>TextField</code>，其 <code>schema</code> 中对 <code>value</code> 属性的定义是：</p> <div class=highlight><pre class="code javascript"><code><span class="p">{</span>
  <span class="nl">prop</span><span class="p">:</span> <span class="dl">'</span><span class="s1">value</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">validation</span><span class="p">:</span> <span class="p">[{</span> <span class="na">dataType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">String</span><span class="dl">'</span> <span class="p">}],</span>
  <span class="p">...</span><span class="nx">otherDefinations</span>
<span class="p">}</span>
</code></pre></div><p>因为 <code>validation</code> 包含了 <code>{dataType: 'String'}</code>，所以，调用 <a href="/api/form/#.validators()"><code>Form.validators()</code></a> 查询 <code>TextField</code> 成员的可用校验方法范围，就会返回所有可应用于 <code>String</code> 数据类型的校验方法。</p> <p>另外， <a href="/api/form/#.validators()"><code>Form.validators()</code></a> 方法在 Reactive Form 内置引擎配套的 UI 组件中，也起到了一定的辅助作用，后续的组件教程中将会介绍。</p> <h3 id="计算方法范围设定">计算方法范围设定</h3> <p>当前版本暂不提供设定成员属性计算规则范围的内置方法，后续版本中将逐渐添加。 现阶段，开发人员如有需求，可以先自行实现。</p> <h2 id="注册输入项类型">注册输入项类型</h2> <p>为了便于注册输入项类型，<a href="/api/form/#.Field"><code>Form.Field</code></a> 模型提供了，构建输入项类型配置对象的方法 <a href="/api/form/#.Field.schema.extend()"><code>Form.Field.schema.extend()</code></a>，还提供了可复用的 <code>schema</code> 配置以及钩子函数。 下面将介绍具体的使用方法。</p> <h3 id="复用-schema">复用 schema</h3> <p>在输入项类型的注册过程中，很多属性的 <code>schema</code> 定义都是雷同的， 比如标题数据类型为字符串、校验规则默认为空，等等。 <a href="/api/form/#.Field"><code>Form.Field</code></a> 内置了输入项类型常用的 <code>schema</code>， 这些 <code>schema</code> 可通过 <a href="/api/form/#.Field.schema.use()"><code>Form.Field.schema.use()</code></a> 方法和 <a href="/api/form/#.Field.schema.extend()"><code>Form.Field.schema.extend()</code></a> 方法直接复用或扩展后复用。 我们来看下面的示例。</p> <iframe height=600 style="width: 100%;" scrolling=no title="model/form/customization/4" src="https://codepen.io/rcfm/embed/QWajWYO?default-tab=js%2Cresult&amp;editable=true" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/rcfm/pen/QWajWYO"> model/form/customization/4</a> by rcfm (<a href="https://codepen.io/rcfm">@rcfm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <p>通过示例可以看到，<code>use</code> 和 <code>extend</code> 这两个方法都会返回一个属性的 <code>schema</code> 定义。 这样，我们就可以在 <code>schema.props</code> 数组中，把不同属性的定义，按需拼装到一起了。 内置的 <code>schema</code> 属性范围包括 <code>name</code>、<code>label</code>、<code>value</code>、<code>options</code>、<code>placeholder</code>、<code>editable</code>、<code>visible</code>、 <code>validation</code>、<code>calculation</code>，读者可通过 <code>use</code> 方法查看它们的定义。</p> <h3 id="复用钩子函数">复用钩子函数</h3> <p>在介绍 <a href="/guide/model/reactive/">Reactive</a> 时，介绍过 <code>Reactive</code> 为了方便扩展， 内置了一些可复用的钩子函数。同样的，<a href="/api/form/#.Field"><code>Form.Field</code></a> 也内置了可复用的钩子函数， 这些钩子函数主要应用于输入项类型，可通过 <a href="/api/form/#.Field.hooks.use()"><code>Form.Field.hooks.use()</code></a> 方法复用。 我们在下面的示例中将逐一展示这些钩子函数的作用和用法。</p> <h4 id=enable_value_calculation>ENABLE_VALUE_CALCULATION</h4> <p><code>ENABLE_VALUE_CALCULATION</code> 添加了输入项成员 <code>calclation</code> 属性和 <code>value</code> 属性的联动逻辑， 每当 <code>calculation</code> 当前值更新时，会使用该值设定 <code>value</code> 属性。具体用法如下例。</p> <iframe height=600 style="width: 100%;" scrolling=no title="model/form/customization/5" src="https://codepen.io/rcfm/embed/oNpjXvw?default-tab=js%2Cresult&amp;editable=true" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/rcfm/pen/oNpjXvw"> model/form/customization/5</a> by rcfm (<a href="https://codepen.io/rcfm">@rcfm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <h4 id=enable_value_validation>ENABLE_VALUE_VALIDATION</h4> <p><code>ENABLE_VALUE_VALIDATION</code> 添加了输入项成员 <code>validation</code> 属性和 <code>value</code> 属性的联动逻辑， 每当 <code>validation</code> 当前值更新时或 <code>value</code> 当前值更新时，会使用前者校验后者，并清空或写入 <code>value</code> 错误信息。 具体用法如下例。</p> <iframe height=600 style="width: 100%;" scrolling=no title="model/form/customization/6" src="https://codepen.io/rcfm/embed/wvpKagZ?default-tab=js%2Cresult&amp;editable=true" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/rcfm/pen/wvpKagZ"> model/form/customization/6</a> by rcfm (<a href="https://codepen.io/rcfm">@rcfm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <h4 id=ensure_value_within_options>ENSURE_VALUE_WITHIN_OPTIONS</h4> <p><code>ENSURE_VALUE_WITHIN_OPTIONS</code> 添加了输入项成员 <code>options</code> 属性和 <code>value</code> 属性的联动逻辑， 每当 <code>options</code> 当前值更新时或 <code>value</code> 当前值更新为非空值时，都会校验 <code>value</code> 是否在 <code>options</code> 范围内， 并清空或写入 <code>value</code> 错误信息。具体用法如下例。</p> <iframe height=600 style="width: 100%;" scrolling=no title="model/form/customization/7" src="https://codepen.io/rcfm/embed/XWVmbER?default-tab=js%2Cresult&amp;editable=true" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/rcfm/pen/XWVmbER"> model/form/customization/7</a> by rcfm (<a href="https://codepen.io/rcfm">@rcfm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <h4 id=formfieldhooksdefault->Form.Field.hooks.default ()</h4> <p>当我们注册的输入项类型比较多以后，会发现有一些内置钩子函数的复用频率很高， 为了便于批量复用，<a href="/api/form/#.Field.hooks.default()"><code>Form.Field.hooks.default()</code></a> 方法聚合了高频复用的钩子函数， 当该方法被调用时，会返回一个由这些钩子函数构成的数组，可以在注册输入项类型时直接使用。 其返回结果中包含的钩子函数按数组下标顺序依次为:</p> <div class=highlight><pre class="code javascript"><code><span class="nx">Reactive</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">BLOCK_INVALID_PARENT</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">accept</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Fieldset</span><span class="dl">'</span><span class="p">})</span>
<span class="nx">Reactive</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">ENABLE_SCHEMA_DEFAULT</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">Form</span><span class="p">.</span><span class="nx">Filed</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">ENABLE_VALUE_CALCULATION</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">Reactive</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">ENABLE_SCHEMA_VALIDATION</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">Form</span><span class="p">.</span><span class="nx">Filed</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">ENABLE_VALUE_VALIDATION</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div> <p>开发人员可以在这些钩子函数基础上按需追加，对特定输入项类型的实现更多定制。</p> <h2 id="自动注册子表单输入项类型">自动注册子表单输入项类型</h2> <p>在<a href="/guide/model/form/">上一章</a>，我们介绍过， 内置引擎集成的输入项类型经过自动化元编程处理后，可在子表单中嵌套。 这是因为内置引擎集成的输入项类型在注册前，使用 <a href="/api/form/#.Field.extend()"><code>Form.Field.extend()</code></a> 方法进行了装饰，装饰过程包括向 <code>group</code> 追加 <code>Field</code> 分组名称， 以便在注册时被识别，从而触发子表单输入项类型的生成过程，自动注册一个 <code>Subform*Field</code> 类型。</p> <p>多数情况下我们希望自定义注册的输入项类型也可以嵌套进子表单， 那么就也可以使用 <a href="/api/form/#.Field.extend()"><code>Form.Field.extend()</code></a> 方法来装饰。 具体用法如下例。</p> <iframe height=600 style="width: 100%;" scrolling=no title="model/form/customization/8" src="https://codepen.io/rcfm/embed/eYyppaP?default-tab=js%2Cresult&amp;editable=true" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/rcfm/pen/eYyppaP"> model/form/customization/8</a> by rcfm (<a href="https://codepen.io/rcfm">@rcfm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <h2 id="小结">小结</h2> <ul> <li>内置引擎中的成员默认可引用的是所有 <code>Fieldset</code> 子级中含有 <code>value</code> 属性且不与自身产生循环引用的成员的 <code>value</code> 属性。</li> <li>内置引擎中的成员默认可用校验方法范围是，如果 <code>schema</code> 定义中 <code>value</code> 属性的 <code>validation</code> 指定了 <code>dataType</code>， 则为所有可用于该 <code>dataType</code> 的校验方法，否则为 <code>presence</code> 校验方法。</li> <li><code>Form.Field</code> 内置 <code>schema</code> 可通过 <a href="/api/form/#.Field.schema.use()"><code>Form.Field.schema.use()</code></a> 方法和 <a href="/api/form/#.Field.schema.extend()"><code>Form.Field.schema.extend()</code></a> 方法直接复用或扩展后复用。</li> <li><code>Form.Field</code> 内置钩子函数可通过 <a href="/api/form/#.Field.hooks.use()"><code>Form.Field.hooks.use()</code></a> 方法复用。</li> <li><a href="/api/form/#.Field.hooks.default()"><code>Form.Field.hooks.default()</code></a> 方法聚合了注册输入项类型时高频复用的钩子函数。</li> <li>经 <a href="/api/form/#.Field.extend()"><code>Form.Field.extend()</code></a> 方法来装饰的输入项类型，在注册时会自动注册一个对应的子表单输入项类型。</li> </ul> </article> <footer class="footer py-medium px-medium py-large-m sd-low"> <p class="p7 ta-center c-secondary"> Reactive Form 基于 <a href="https://creativecommons.org/licenses/by-nd/3.0/cn/legalcode">CC BY-ND</a> 协议发布 </br> Copyright © 2022 吉林省吉林祥云信息技术有限公司 </p> </footer> </div> </div> </body> </html>